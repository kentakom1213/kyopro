
# Product of Range 解説

各クエリに対して愚直に掛け算をしていく場合、計算量は $O(NK)$ となってしまい、間に合いません。
ここで、各クエリをより高速に処理する方法を考えます。

ある数列の連続する部分列の総和を高速に処理するアルゴリズムとして**累積和**が有名ですが、この問題ではその応用として**累積積**を用います。

具体的には、
$$
\begin{align*}
    S_i = \prod_{k=0}^{i} a_k
\end{align*}
$$

を満たす数列 $\{S_N\}$ をあらかじめ計算しておくことで、求める値を
$$
\begin{align*}
    P_{l,r} &= \frac{S_r}{S_{l-1}}\\
            &= S_r\cdot S_{l_1}^{-1}
\end{align*}
$$

として求めることができます。

ここで問題となるのがあまりです。この問題は、**モジュラ逆数**（通称**逆元**）という概念を用いることで解決できます。（逆元の求め方は長くなるので割愛）

## 計算量について
累積和アルゴリズムと同様に、前処理が $O(N)$、各クエリの計算に $O(1)$、合わせて $O(N+K)$ でこの問題を解くことができます。

（逆元は、合同式の法 $M$ の大きさに関して対数時間で求められるため、$M=998244353$ と決まっているこの問題では $O(1)$ とみなすことができます。）


## 参考
- [競技プログラミングにおける剰余の基礎と mod 逆元](https://www.creativ.xyz/modulo-basic/)
