define(["require","exports","tslib","react","typescript/libraries/file-viewer/src/plugins/index","modules/core/i18n","modules/core/browser","modules/clean/clipboard_v3","modules/clean/sharing/ui_notifications_util","dig-components/typography","dig-components/icons","dig-components/icons/src","modules/clean/react/file_viewer/sdk_file_viewer/download_utils","dig-illustrations/spot/phone-checkmark","dig-components/modal","dig-components/buttons","modules/clean/react/file_viewer/utils","modules/clean/open_in_app/actions","modules/clean/react/components/modal","modules/clean/react/file_viewer/sdk_file_viewer/utils","modules/clean/react/components/css"],(function(e,o,t,n,i,l,a,s,r,c,d,m,u,p,f,b,g,_,h,C,w){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.makeMobilePluginLoader=o.MOBILE_PLUGIN_ID=void 0,n=t.__importStar(n);const y=({onReportIssue:e})=>n.default.createElement(c.Text,{onClick:e},n.default.createElement(d.UIIcon,{size:"large",src:m.FlagLine}),l.intl.formatMessage({id:"awDFu9",defaultMessage:"Report issue"}));y.displayName="ReportIssue",y.displayName="ReportIssue";const M=({onCopyLink:e})=>n.default.createElement(c.Text,{onClick:e},n.default.createElement(d.UIIcon,{size:"large",src:m.LinkLine}),l.intl.formatMessage({id:"HTAvDi",defaultMessage:"Copy Link"}));M.displayName="CopyLink",M.displayName="CopyLink";const k=({onDownload:e,downloadsEnabled:o})=>n.default.createElement(c.Text,{color:o?"standard":"faint",onClick:o?e:()=>null},n.default.createElement(d.UIIcon,{size:"large",src:m.DownloadLine}),l.intl.formatMessage({id:"ogWgkE",defaultMessage:"Download"}));k.displayName="DownloadSharedFile",k.displayName="DownloadFile";const E=({onCopy:e})=>n.default.createElement(c.Text,{onClick:e},n.default.createElement(d.UIIcon,{size:"large",src:m.DropboxLine}),l.intl.formatMessage({id:"CCOvo/",defaultMessage:"Save a copy to Dropbox"}));E.displayName="CopyToDropbox",E.displayName="DownloadFile";const D=({onComment:e})=>n.default.createElement(c.Text,{onClick:e},n.default.createElement(d.UIIcon,{size:"large",src:m.CommentLine}),l.intl.formatMessage({id:"Y3uqW1",defaultMessage:"Comment"}));D.displayName="Comment";const I=w.requireCssWithComponent(({getActiveFile:e,shareToken:o,sharePermission:t,user:i})=>{const[a,s]=n.useState(!0),r=()=>s(!1);return n.default.createElement(f.Modal,{open:a,isCentered:!0,onRequestClose:r},n.default.createElement(f.Modal.Header,{hasBottomSpacing:"title-standard"},n.default.createElement(p.PhoneCheckmarkSpot,null)),n.default.createElement(f.Modal.Body,{hasVerticalSpacing:!0},n.default.createElement(b.IconButton,{className:"close-comment-modal",onClick:r,variant:"transparent"},n.default.createElement(d.UIIcon,{src:m.CloseLine})),n.default.createElement(c.Text,null,l.intl.formatMessage({id:"axPbQG",defaultMessage:"Download the Dropbox app to comment on this file"})),n.default.createElement("div",null,n.default.createElement(b.Button,{onClick:()=>{const{file:n}=e(),l=g.getOpenInAppUrls(n,o,t,i);l&&_.openInApp(l)},variant:"primary"},l.intl.formatMessage({id:"fGQoFI",defaultMessage:"Download the app"})))))},["/static/css/preview/sdk_file_viewer-vfljWfFpE.css"]);o.MOBILE_PLUGIN_ID="mobile_plugin",o.makeMobilePluginLoader=({previewSurface:e,sharedLinkInfo:o,getActiveFile:t,user:l,encryptionOptions:c,authModalKind:d,shareToken:m,sharePermission:p})=>()=>Promise.resolve(class{constructor(e){this.actionDefinitions={mobileWeb:this.actionToDisplay()},this.lifecycle={},this.context=e}actionToDisplay(){return this.mobilePluginDefinition()}mobilePluginDefinition(){const f=()=>{this.context.logUserAction({action:"report_issue",context:"mobile_meatball_menu"});const e=window.location&&encodeURIComponent(window.location.href);a.redirect(`/report_abuse?ssu=${e}`)},b=()=>{if(!o)throw new Error("Shared link info is not defined");this.context.logUserAction({action:"copy_link",context:"mobile_meatball_menu"}),s.copyToClipboard(o.url,()=>r.showCopyLinkSuccessSnackbar(o.url),()=>{throw new Error("Copy link failed")})},_=()=>{this.context.logUserAction({action:"download",context:"mobile_meatball_menu"});const{file:e}=t();u.downloadActiveFile(e,l,c,d,this.context.logUserAction)},w=()=>{const{file:e}=t();u.saveToDropbox(e,()=>this.context.logUserAction({action:"save_a_copy",context:"mobile_meatball_menu"}),l,m,c)},x=()=>{this.context.logUserAction({action:"open_in_app",context:"mobile_meatball_menu"}),h.Modal.showInstance(n.default.createElement(I,{getActiveFile:t,shareToken:m,sharePermission:p,user:l}))},A=g.canDownloadFile(o,p),P=e=>{const o={[i.MobileWebPluginAction.ReportIssue]:n.default.createElement(y,{onReportIssue:f}),[i.MobileWebPluginAction.CopyLink]:n.default.createElement(M,{onCopyLink:b}),[i.MobileWebPluginAction.DownloadSharedFile]:n.default.createElement(k,{downloadsEnabled:A,onDownload:_}),[i.MobileWebPluginAction.CopyToDropbox]:n.default.createElement(E,{onCopy:w}),[i.MobileWebPluginAction.Comment]:n.default.createElement(D,{onComment:x})};return e.map(e=>o[e])};if(e===C.SDKPreviewSurface.SHARED_LINK&&!l)return{footerActions:{[i.MobileWebPluginAction.DownloadSharedFile]:_,[i.MobileWebPluginAction.CopyLink]:b,[i.MobileWebPluginAction.CopyToDropbox]:w},meatballMenuComponents:P([i.MobileWebPluginAction.DownloadSharedFile,i.MobileWebPluginAction.CopyToDropbox,i.MobileWebPluginAction.CopyLink,i.MobileWebPluginAction.Comment,i.MobileWebPluginAction.ReportIssue])}}})}));
//# sourceMappingURL=mobile_plugin.min.js-vfls50L80.map