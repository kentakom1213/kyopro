define(["require","exports","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/libraries/comments2/src/mentions/index","typescript/libraries/comments2/src/transforms/index","typescript/component_libraries/files_components/src/blades/comments/data/transform","redux","api_v2/redux/comments2","api_v2/redux/media_addon","typescript/component_libraries/flows/src/components/approval-forms/reducer","typescript/component_libraries/files_components/src/blades/comments/data/uuid"],(function(e,t,n,s,i,a,r,o,c,d,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reducer=t.reducers=t.DEFAULT_STATE=t.Status=void 0;var u;(u=t.Status||(t.Status={}))[u.Disabled=0]="Disabled",u[u.ReadOnly=1]="ReadOnly",u[u.FullyEnabled=2]="FullyEnabled",t.DEFAULT_STATE={threads:{},supportedEnhancements:{},boltInfo:{fileIdentifierToBoltMap:{},boltUniqueIdToStream:{}},activeThreadID:{},focusedThreadID:{},hoverThreadID:{},mentionsSearchResult:{currentQuery:"",result:[]},draftAnnotation:{},annotationState:null,permissions:{},editorFocusRequest:{},pendingNavigationToActiveThreadAnnotation:{},status:{},thirdPartySource:{},mediaAddonFeatures:null,subscriptionStatus:{},enableCommentStatus:{},showResolvedComments:!1,approvalFormStatus:{}};const m=e=>{const{payload:{arg:{stream:t}}}=e;return g(t)};function g(e){return"file_path_or_id"===e.identifier[".tag"]?e.identifier.file_path_or_id:"shared_link_details"===e.identifier[".tag"]?e.identifier.url:void 0}function b(e){const{stream:t,id:n}=e.payload.arg;return"file_path_or_id"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.file_path_or_id,threadId:n}:"shared_link_details"===t.identifier[".tag"]?{fileIdOrUrl:t.identifier.url,threadId:n}:{}}function O(e){var t;const{payload:{arg:{id:n,stream:{identifier:s}}}}=e,i=null===(t=e.meta)||void 0===t?void 0:t.threadId;return"file_path_or_id"===s[".tag"]?{fileIdOrUrl:s.file_path_or_id,commentId:n,threadId:i}:"shared_link_details"===s[".tag"]?{fileIdOrUrl:s.url,commentId:n,threadId:i}:{}}function p(e,t,n,s){return Object.assign(Object.assign({},e),{[t]:n,pending:{action:s,originalValue:e[t],pendingValue:n}})}function f(e,t,n,s,i){const{comments:a}=e,r=a.findIndex(e=>e.id===t),o=a[r];if(!o)return e;const c=Object.assign(Object.assign({},o),{[n]:s}),d=[...a];return d.splice(r,1,c),p(e,"comments",d,i)}function j(e,t,n){return Object.assign(Object.assign({},e),{[t]:n?e.pending.originalValue:e[t],pending:void 0})}t.reducers={boltInfo:(e=t.DEFAULT_STATE.boltInfo,n)=>{if(n.type===o.Action.ListCommentsResult){const{payload:{arg:t,result:s}}=n,i=g(t.stream);if(i&&s)return{fileIdentifierToBoltMap:Object.assign(Object.assign({},e.fileIdentifierToBoltMap),{[i]:s.bolt_info}),boltUniqueIdToStream:Object.assign(Object.assign({},e.boltUniqueIdToStream),{[s.bolt_info.unique_id]:t.stream})}}return e},threads:(e=t.DEFAULT_STATE.threads,s)=>{const i=!!s.error;switch(s.type){case o.Action.AddComment:return A(e,s);case o.Action.AddCommentResult:return h(e,s,i);case o.Action.MarkThreadRead:case o.Action.MarkThreadUnread:return T(e,s);case o.Action.MarkThreadReadResult:case o.Action.MarkThreadUnreadResult:return I(e,s,i);case o.Action.ResolveThread:case o.Action.UnresolveThread:return y(e,s);case o.Action.ResolveThreadResult:case o.Action.UnresolveThreadResult:return v(e,s,i);case o.Action.EditComment:return _(e,s);case o.Action.EditCommentResult:return C(e,s,i);case o.Action.DeleteComment:return S(e,s);case o.Action.DeleteCommentResult:return E(e,s,i);case o.Action.ListCommentsResult:case o.Action.LoggedOutListCommentsResult:return R(e,s);case n.Action.AddAndCommitComment:return F(e,s);case n.Action.EditAndCommitComment:return U(e,s);case n.Action.DeleteAndCommitComment:return L(e,s);case n.Action.DeleteAndCommitThread:return V(e,s);default:return e}},supportedEnhancements:(e={},t)=>{var n;if(t.type===o.Action.ListCommentsResult){const{payload:{arg:s,result:i}}=t,a=g(s.stream);if(null!=a&&null!=i)return Object.assign(Object.assign({},e),{[a]:null!==(n=i.supported_enhancements)&&void 0!==n?n:{}})}return e},activeThreadID:(e=t.DEFAULT_STATE.activeThreadID,s)=>{switch(s.type){case n.Action.ActivateThread:case n.Action.ActivateInitialThread:return Object.assign(Object.assign({},e),{[s.payload.fileViewerId]:s.payload.threadId});case n.Action.DeactivateAllThreads:return Object.assign(Object.assign({},e),{[s.payload.fileViewerId]:""});case o.Action.AddComment:if(s.meta&&s.meta.tempThreadId)return Object.assign(Object.assign({},e),{[s.meta.fileViewerId]:s.meta.tempThreadId});break;case o.Action.AddCommentResult:const{meta:t,payload:{result:i}}=s;if(i&&t&&t.tempThreadId===e[t.fileViewerId])return Object.assign(Object.assign({},e),{[t.fileViewerId]:i.id})}return e},focusedThreadID:(e=t.DEFAULT_STATE.hoverThreadID,{type:s,payload:i})=>{if(s===n.Action.FocusThread){const t=Object.assign({},e);return null==i.threadId?delete t[i.fileViewerId]:t[i.fileViewerId]=i.threadId,t}return e},hoverThreadID:(e=t.DEFAULT_STATE.hoverThreadID,{type:s,payload:i})=>{if(s===n.Action.HoverThread){const t=Object.assign({},e);return null==i.threadId?delete t[i.fileViewerId]:t[i.fileViewerId]=i.threadId,t}return e},mentionsSearchResult:(e=t.DEFAULT_STATE.mentionsSearchResult,n)=>{switch(n.type){case s.MentionsAction.SearchContacts:return Object.assign(Object.assign({},e),{currentQuery:n.payload});case s.MentionsAction.SearchContactsResult:if(n.payload.query===e.currentQuery)return Object.assign(Object.assign({},e),{result:n.payload.result})}return e},permissions:(e=t.DEFAULT_STATE.permissions,n)=>{if(n.type!==o.Action.ListCommentsResult&&n.type!==o.Action.LoggedOutListCommentsResult)return e;const{payload:{arg:s,result:i}}=n,a=g(s.stream);if(!a||!i)return e;const r=i.permissions;return Object.assign(Object.assign({},e),{[a]:r})},draftAnnotation:(e=t.DEFAULT_STATE.draftAnnotation,s)=>{switch(s.type){case n.Action.UpdateDraftAnnotation:{const{fileViewerId:t,annotation:n}=s.payload;return n===e[t]?e:Object.assign(Object.assign({},e),{[t]:n})}case n.Action.CancelAnnotating:case n.Action.ClearDraftAnnotation:{const{fileViewerId:t}=s.payload;if(!(t in e))return e;const n=Object.assign({},e);return delete n[t],n}case o.Action.AddComment:if(null!=s.meta){const{fileViewerId:t}=s.meta;if(!(t in e))return e;const n=Object.assign({},e);return delete n[t],n}}return e},annotationState:(e=t.DEFAULT_STATE.annotationState,s)=>{switch(s.type){case n.Action.CancelAnnotating:case o.Action.AddComment:return null;case n.Action.ActivateThread:case n.Action.ActivateInitialThread:return null===e?"viewing":"viewing"!==e?null:e;case n.Action.DeactivateAllThreads:return"viewing"===e?null:e;case n.Action.StartAnnotating:return s.payload.accessible?"annotating-ax":"annotating";case n.Action.ConfirmDraftAnnotation:return"commenting"}return e},editorFocusRequest:(e=t.DEFAULT_STATE.editorFocusRequest,{type:s,payload:i})=>{if(s===n.Action.ConfirmDraftAnnotation&&!e[i.fileViewerId])return Object.assign(Object.assign({},e),{[i.fileViewerId]:!0});if(s===n.Action.FocusEditor&&!e[i.fileViewerId])return Object.assign(Object.assign({},e),{[i.fileViewerId]:!0});if(s===n.Action.EditorDidFocus&&e[i.fileViewerId]){const t=Object.assign({},e);return delete t[i.fileViewerId],t}return e},pendingNavigationToActiveThreadAnnotation:(e=t.DEFAULT_STATE.pendingNavigationToActiveThreadAnnotation,{type:s,payload:i})=>{if(s===n.Action.ActivateThread||s===n.Action.ActivateInitialThread)return Object.assign({[i.fileViewerId]:!0},e);if(s===n.Action.ResolveNavigationToActiveThreadAnnotation){const t=Object.assign({},e);return delete t[i.fileViewerId],t}return e},status:(e=t.DEFAULT_STATE.status,n)=>{if(n.type===o.Action.ListCommentsResult){const{payload:{arg:s,result:i}}=n,a=g(s.stream);if(a&&i)switch(i.status[".tag"]){case"disabled":return Object.assign(Object.assign({},e),{[a]:t.Status.Disabled});case"enabled":return Object.assign(Object.assign({},e),{[a]:t.Status.FullyEnabled});case"readonly":return Object.assign(Object.assign({},e),{[a]:t.Status.ReadOnly})}}if(n.type===o.Action.LoggedOutListCommentsResult){const{payload:{arg:s}}=n,i=g(s.stream);if(i)return Object.assign(Object.assign({},e),{[i]:t.Status.FullyEnabled})}return e},thirdPartySource:(e=t.DEFAULT_STATE.thirdPartySource,n)=>{if(n.type!==o.Action.ListCommentsResult)return e;const{payload:{arg:s,result:a}}=n,r=g(s.stream);if(!r||!a)return e;const c=a.supported_enhancements&&a.supported_enhancements.third_party_source;return Object.assign(Object.assign({},e),{[r]:c?i.thirdPartySourceToIThirdPartySource(c):void 0})},mediaAddonFeatures:(e=null,t)=>{var n;return t.type===c.Action.GetFeaturesResult?null!==(n=t.payload.result)&&void 0!==n?n:null:e},subscriptionStatus:(e=t.DEFAULT_STATE.subscriptionStatus,n)=>{if(n.type!==o.Action.SubscribeResult&&n.type!==o.Action.UnsubscribeResult)return e;const s=m(n);if(void 0===s)return e;switch(n.type){case o.Action.SubscribeResult:return Object.assign(Object.assign({},e),{[s]:{isSubscribed:!0,canSubscribe:!0}});case o.Action.UnsubscribeResult:return Object.assign(Object.assign({},e),{[s]:{isSubscribed:!1,canSubscribe:!0}});default:return e}},enableCommentStatus:(e=t.DEFAULT_STATE.enableCommentStatus,n)=>{var s;if(n.type!==o.Action.EnableCommentingResult&&n.type!==o.Action.DisableCommentingResult&&n.type!==o.Action.ListCommentsResult&&n.type!==o.Action.LoggedOutListCommentsResult)return e;const i=m(n);if(void 0===i)return e;switch(n.type){case o.Action.EnableCommentingResult:return Object.assign(Object.assign({},e),{[i]:{commentsEnabled:!0,canEnableCommenting:!0}});case o.Action.DisableCommentingResult:return Object.assign(Object.assign({},e),{[i]:{commentsEnabled:!1,canEnableCommenting:!0}});case o.Action.ListCommentsResult:case o.Action.LoggedOutListCommentsResult:const t=n.payload.result;return t?Object.assign(Object.assign({},e),{[i]:{commentsEnabled:!("disabled"===t.status[".tag"]),canEnableCommenting:!!(null===(s=t.permissions)||void 0===s?void 0:s.can_enable_commenting)}}):e;default:return e}},showResolvedComments:(e=t.DEFAULT_STATE.showResolvedComments,s)=>{switch(s.type){case n.Action.UpdateShowResolvedComments:return s.payload.showResolvedComments;default:return e}},approvalFormStatus:d.approvalReducer};const A=(e,t)=>{const{payload:{arg:{thread_id:n,stream:s}}}=t,i=g(s);if(!i||!t.meta)return e;const r=e[i],{content:o,author:c,annotation:d}=t.meta;if(n){const s=r[n],{comments:l}=s,u=Object.assign(Object.assign({},s),{comments:[...l,a.newCommentFromICommentContent({content:o,threadId:n,author:c})],annotation:d||s.annotation});return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{[n]:Object.assign(Object.assign({},u),{pending:{action:t.type,originalValue:s,newValue:u}})})})}const{tempThreadId:l}=t.meta;if(l){const n=a.newCommentFromICommentContent({threadId:l,author:c,content:o}),s={id:l,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[n],annotation:d,isThirdParty:!1},u=Object.assign(Object.assign({},s),{pending:{action:t.type,originalValue:void 0,pendingValue:s}});return Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{[l]:u})})}return e},h=(e,t,n)=>{const{payload:{arg:{thread_id:s,stream:i}}}=t,a=g(i);if(!a||!t.meta)return e;const r=e[a];if(s){const t=Object.assign({},r[s]),{originalValue:i}=t.pending;return t.pending=void 0,Object.assign(Object.assign({},e),{[a]:Object.assign(Object.assign({},r),{[s]:n?i:t})})}const{tempThreadId:o}=t.meta;let c=r;if(!n&&o in r&&t.payload.result){c=Object.assign({},r),delete c[o];const e=r[o],{id:n}=t.payload.result;e.readonly=!1,e.id=n,c[n]=Object.assign(Object.assign({},e),{pending:void 0})}return Object.assign(Object.assign({},e),{[a]:c})},T=(e,t)=>{const{fileIdOrUrl:n,threadId:s}=b(t);if(!n||!s)return e;const i=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},i),{[s]:p(i[s],"read",t.type===o.Action.MarkThreadRead,t.type)})})},I=(e,t,n)=>{const{fileIdOrUrl:s,threadId:i}=b(t);if(!s||!i)return e;const a=e[s];return Object.assign(Object.assign({},e),{[s]:Object.assign(Object.assign({},a),{[i]:j(a[i],"read",n)})})},y=(e,t)=>{const{fileIdOrUrl:n,threadId:s}=b(t);if(!n||!s)return e;const i=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},i),{[s]:p(i[s],"resolved",t.type===o.Action.ResolveThread,t.type)})})},v=(e,t,n)=>{const{fileIdOrUrl:s,threadId:i}=b(t);if(!s||!i)return e;const a=e[s];return Object.assign(Object.assign({},e),{[s]:Object.assign(Object.assign({},a),{[i]:j(a[i],"resolved",n)})})},_=(e,t)=>{const{fileIdOrUrl:n,threadId:s,commentId:i}=O(t);if(!(n&&s&&i&&t.meta))return e;const a=e[n],{content:r}=t.meta;return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},a),{[s]:f(a[s],i,"content",r,t.type)})})},C=(e,t,n)=>{const{fileIdOrUrl:s,threadId:i,commentId:a}=O(t);if(!s||!i||!a)return e;const r=e[s];return Object.assign(Object.assign({},e),{[s]:Object.assign(Object.assign({},r),{[i]:j(r[i],"comments",n)})})},S=(e,t)=>{const{fileIdOrUrl:n,threadId:s,commentId:i}=O(t);if(!n||!s||!i)return e;const a=e[n];return Object.assign(Object.assign({},e),{[n]:Object.assign(Object.assign({},a),{[s]:f(a[s],i,"deleted",!0,t.type)})})},E=(e,t,n)=>{const{fileIdOrUrl:s,threadId:i,commentId:a}=O(t);if(!s||!i||!a)return e;const r=e[s];return Object.assign(Object.assign({},e),{[s]:Object.assign(Object.assign({},r),{[i]:j(r[i],"comments",n)})})},R=(e,t)=>{const{payload:{arg:n,result:s}}=t,a=g(n.stream);return a&&s?Object.assign(Object.assign({},e),{[a]:i.threadsToIThreadMap(s.threads,i.usersToIUserMap(s.users))}):e};function w(e,t,n){return Object.assign(Object.assign({},e),{[t]:n})}function D(e,t,n,s){const{comments:i}=e,a=i.findIndex(e=>e.id===t),r=i[a];if(!r)return e;const o=Object.assign(Object.assign({},r),{[n]:s}),c=[...i];return c.splice(a,1,o),w(e,"comments",c)}t.reducer=r.combineReducers(t.reducers);const U=(e,t)=>{const{payload:{content:n,threadId:s,fileIdentifier:i,commentId:a}}=t,r=e[i],o=r[s];return o?Object.assign(Object.assign({},e),{[i]:Object.assign(Object.assign({},r),{[s]:D(o,a,"content",n)})}):e},F=(e,t)=>{const{payload:{author:n,content:s,threadId:i,fileIdentifier:r}}=t,o=e[r];if(i){const t=o[i];if(!t)return e;const{comments:c}=t,d=Object.assign(Object.assign({},t),{comments:[...c,a.newCommentFromICommentContent({content:s,threadId:i,author:n})]});return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},o),{[i]:Object.assign({},d)})})}{const t=l.v4(),i=a.newCommentFromICommentContent({threadId:t,author:n,content:s}),c={id:t,timestamp:new Date,read:!0,readonly:!0,resolved:!1,comments:[i],isThirdParty:!1};return Object.assign(Object.assign({},e),{[r]:Object.assign(Object.assign({},o),{[t]:c})})}},L=(e,t)=>{const{payload:{threadId:n,fileIdentifier:s,commentId:i}}=t;if(!s||!n||!i)return e;const a=e[s],r=a[n];return r?Object.assign(Object.assign({},e),{[s]:Object.assign(Object.assign({},a),{[n]:D(r,i,"deleted",!0)})}):e},V=(e,t)=>{const{payload:{threadId:n,fileIdentifier:s}}=t;if(!s||!n)return e;const i=e[s],a=i[n];return a?Object.assign(Object.assign({},e),{[s]:Object.assign(Object.assign({},i),{[n]:w(a,"comments",a.comments.map(e=>Object.assign(Object.assign({},e),{deleted:!0})))})}):e}}));
//# sourceMappingURL=reducer.amd.min.js-vflW5FAMy.map