define("modules/clean/react/home/actions_post_tti",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/core/notify","modules/clean/react/home/api_post_tti","modules/core/i18n"],(function(e,t,i,n,o,s,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setSectionVisibilityHelper=t.setSectionVisibilityPostTTI=void 0,t.setSectionVisibilityPostTTI=(e,n,o)=>{t.setSectionVisibilityHelper(e,n,o,()=>i.__awaiter(void 0,void 0,void 0,(function*(){return a.setSectionVisibility})))},t.setSectionVisibilityHelper=(e,t,a,c)=>i.__awaiter(void 0,void 0,void 0,(function*(){const i=t[".tag"];n.Dispatcher.dispatch({type:o.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:i,visible:a}});try{yield(yield c())(e,t,a)}catch(e){const t=a?r.intl.formatMessage({id:"D9XHqB",defaultMessage:"Unable to show section."}):r.intl.formatMessage({id:"W8LAoH",defaultMessage:"Unable to hide section."});throw s.Notify.error(t),n.Dispatcher.dispatch({type:o.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:i,visible:!a}}),e}}))})),define("modules/clean/react/home/actions",["require","exports","tslib","modules/constants/env","modules/core/uri","modules/core/i18n","modules/core/notify","modules/clean/react/home/post_tti/api","modules/clean/react/home/actions_post_tti","modules/clean/viewer"],(function(e,t,i,n,o,s,a,r,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HomeActions=void 0;t.HomeActions=class{static setSectionVisibility(e,t,n){return i.__awaiter(this,void 0,void 0,(function*(){c.setSectionVisibilityHelper(e,t,n,()=>i.__awaiter(this,void 0,void 0,(function*(){const{setSectionVisibility:e}=yield r.waitForHomeTTI();return e})))}))}static createPaperDocInNewTab(e){return i.__awaiter(this,void 0,void 0,(function*(){const t=s.intl.formatMessage({id:"PhUVTN",defaultMessage:"Could not create paper document."}),i=window.open("about:blank");try{const{createPaperDoc:s}=yield r.waitForHomeTTI(),c=yield s(e),d=l.Viewer.get_viewer(),m=d.get_user_by_id(e),u=d.is_paired?{role:m.role}:{};if(i&&!i.closed){const e=new o.URI({scheme:"https",authority:n.NOTES_WEBSERVER,path:"/doc/"+c.doc_id,query:u}).toString();i.location.replace(e)}else a.Notify.error(t)}catch(e){if(a.Notify.error(t),i&&!i.closed)return i.close()}}))}}})),define("modules/clean/react/home/api_post_tti",["require","exports","api_v2/user_client"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPaperDoc=t.setSectionVisibility=void 0,t.setSectionVisibility=(e,t,n)=>(new i.UserApiV2Client).ns("home").rpc("set_section_visibility",{section:t,visible:n},{subjectUserId:e}),t.createPaperDoc=e=>(new i.UserApiV2Client).ns("paper").upload("docs/create",{import_format:{".tag":"plain_text"}},"",{subjectUserId:e})})),define("modules/clean/react/home/api",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","lodash","modules/core/exception","modules/clean/web_timing_logger"],(function(e,t,i,n,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logHomeActivity=t.makeRequest=t.now=void 0,o=i.__importStar(o);t.now=()=>Date.now();let r=0,c=0,l=t.now();t.makeRequest=function(e,{delayRequest:o,isBackground:a,shouldAssertResponse:d}={}){r++;const m=new Promise((d,m)=>i.__awaiter(this,void 0,void 0,(function*(){const u=yield(function(e){return i.__awaiter(this,void 0,void 0,(function*(){const i=l;if(l=t.now(),e||l-i<40){c++;const e=10+~~(90*Math.random());return yield new Promise(t=>setTimeout(t,e)),c--,e}return 0}))})(!!o),h=t.now();(a?n.SilentBackgroundRequest:n.WebRequest)(Object.assign({dataType:"json",success:d,error:(i,n,l)=>{if("abort"===n)return;const d=e&&e.url||"no url",_=l?`: '${l}'`:"",p=`makeRequest to '${d}' failed - ${n}${_}`;s.reportStack(p,{severity:s.SEVERITY.NONCRITICAL,exc_extra:{errorThrown:l,textStatus:n,requestParams:e,delayRequest:o,isBackground:a,requestDelay:u,openRequests:r,delayedRequests:c,requestDuration:t.now()-h,status:i.status,"exclog.exc_group":`homeapi:${n}:${l}:${d}`}}),m()}},e))})));return m.finally(()=>r--),m};let d={};const m=o.throttle(()=>{o.size(d)>1&&s.reportStack("Multiple role activities",{severity:s.SEVERITY.NONCRITICAL,exc_extra:d}),Object.keys(d).forEach(e=>{const i=d[e];t.makeRequest({url:"/home_feed/log_activities",type:"POST",data:{role:e,activities_json:JSON.stringify(o.map(i,"json")),send_ts:t.now(),page_start_ts:window.performance&&window.performance.timing?window.performance.timing.navigationStart||window.performance.timing.fetchStart:void 0}},{isBackground:!0,delayRequest:!0,shouldAssertResponse:!0}).then(()=>i.forEach(e=>e.resolve()),()=>i.forEach(e=>e.reject()))}),d={}},1e3,{leading:!0,trailing:!0});t.logHomeActivity=function({role:e,eventName:n,extra:s}){return new Promise((r,c)=>i.__awaiter(this,void 0,void 0,(function*(){d[e]=d[e]||[],d[e].push({json:{event_name:n,event_time:t.now(),extra:o.mapValues(s||{},e=>String(e))},resolve:r,reject:c}),yield a.waitForTTI(),m()})))}})),define("modules/clean/react/home/constants",["require","exports","modules/clean/react/display_types/constants"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUGGEST_GRID_FEATURE=t.DisplayTypeToIconName=t.DisplayTypeToResourceType=t.PAPER_FOLDER_RESOURCE_TYPE=t.PAPER_DOCUMENT_RESOURCE_TYPE=t.FOLDER_RESOURCE_TYPE=t.FILE_RESOURCE_TYPE=t.LoadingStates=t.HomePrefetchTypes=t.LoggingTypes=t.ConditionalSections=t.DEFAULT_PRE_TTI_PROPS=t.HomeSections=t.HomeResourceStoreActionTypes=t.HomeTabId=t.HomeActionTypes=t.ConditionalSectionLoadingMode=t.ConditionalSectionLoadingPreference=void 0,(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.DO_NOT_LOAD=1]="DO_NOT_LOAD",e[e.IMMEDIATE=2]="IMMEDIATE",e[e.POST_TTI=3]="POST_TTI"})(t.ConditionalSectionLoadingPreference||(t.ConditionalSectionLoadingPreference={})),(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SYNCHRONOUS=1]="SYNCHRONOUS",e[e.ASYNCHRONOUS_PRE_TTI=2]="ASYNCHRONOUS_PRE_TTI",e[e.POST_TTI=3]="POST_TTI"})(t.ConditionalSectionLoadingMode||(t.ConditionalSectionLoadingMode={})),t.HomeActionTypes={INITIALIZE_STORE:"HOME_INITIALIZE_STORE",SET_PRE_TTI_PROPS:"HOME_SET_PRE_TTI_PROPS",SET_POST_TTI_PROPS_PROMISE:"HOME_SET_POST_TTI_PROPS_PROMISE",SET_SECTION_VISIBILITY:"HOME_SET_SECTION_VISIBILITY",LOADED_ASYNC_CONDITIONAL_SECTION:"HOME_STORE_LOADED_ASYNC_CONDITIONAL_SECTION",DECLARE_CONDITIONAL_SECTION:"HOME_STORE_DECLARE_CONDITIONAL_SECTION",HOME_PREFETCH_RECEIVED_DATA:"HOME_PREFETCH_RECEIVED_DATA",SET_TAB_ID:"HOME_SET_TAB_ID",OPEN_FILE_VIEWER:"HOME_OPEN_FILE_VIEWER",CLOSE_FILE_VIEWER:"HOME_CLOSE_FILE_VIEWER"},(function(e){e.STARRED="Starred",e.TASKS="To-do"})(t.HomeTabId||(t.HomeTabId={})),t.HomeResourceStoreActionTypes={RECEIVED_RESOURCE_ID_TO_FILE:"HOME_RESOURCE_STORE_RECEIVED_RESOURCE_ID_TO_FILE",REQUEST_PREVIEW:"HOME_RESOURCE_STORE_REQUEST_PREVIEW"},t.HomeSections={STARRED:"starred",RECENTS:"recents",SUGGEST:"suggest",TEAMS:"teams",PROMPT:"prompt",RECOMMENDED_MEMBERS:"recommended_members"},t.DEFAULT_PRE_TTI_PROPS={isPaperEnabledForUser:!1,activeVariants:{},homeStarredActionBar:"OFF"},t.ConditionalSections={PAPER_RECENTS:"paper_recents"},t.LoggingTypes={CLICK_SHOW_ALL:"click_show_all",HOME_PAGE_SHOWN:"home_page_shown",STARRED_SHOWN:"starred_shown",RECENTS_SHOWN:"recents_shown",HIDE_SECTION:"hide_section",UNHIDE_SECTION:"unhide_section",RECENTS_ITEM_ACTION:"recents_item_action",OPEN_FILTERS_MENU:"open_filters_menu",CLOSE_FILTERS_MENU:"close_filters_menu",RESET_FILTERS_MENU:"reset_filters_menu",SELECT_FILTERS_MENU_ITEM:"select_filters_menu_item",DESELECT_FILTERS_MENU_ITEM:"deselect_filters_menu_item",OPEN_STARRED_ITEM:"open_starred_item",UNDO_UNSTAR_ITEM:"undo_unstar_item",CLICK_STAR_OVERFLOW_MENU:"click_star_overflow_menu",CLICK_STAR_OVERFLOW_SHARE:"click_star_overflow_share",SELECT_TASKS_TAB:"select_tasks_tab",SELECT_TASKS_FILTER:"select_tasks_filter",OPEN_DOC_FROM_TASK:"open_doc_from_tasks",CLICK_DOC_TASKS_OVERFLOW_MENU:"click_doc_tasks_overflow_menu",CLICK_DOC_TASKS_OVERFLOW_SHARE:"click_doc_tasks_overflow_share",CLICK_CREATE_NEW_FILE:"create_new_file",CLICK_UPLOAD_FILES:"upload_files",CLICK_UPLOAD_FOLDER:"upload_folder",CLICK_CREATE_PAPER_DOC:"create_paper_doc",CLICK_NEW_SHARED_FOLDER:"new_shared_folder",CLICK_NEW_FOLDER:"create_folder"},t.HomePrefetchTypes={RETRIEVE_STARRED:"retrieve_starred",RECENTS_JSON:"recents_json",RETRIEVE_PAPER_RECENTS:"retrieve_paper_recents",GET_SUGGESTED:"get_suggested"},t.LoadingStates={LOADING:"LOADING",SUCCESS:"SUCCESS",FAILURE:"FAILURE"},t.FILE_RESOURCE_TYPE="FILE",t.FOLDER_RESOURCE_TYPE="FOLDER",t.PAPER_DOCUMENT_RESOURCE_TYPE="PAPER_DOCUMENT",t.PAPER_FOLDER_RESOURCE_TYPE="PAPER_FOLDER",t.DisplayTypeToResourceType={DOC:t.FILE_RESOURCE_TYPE,MSDOC:t.FILE_RESOURCE_TYPE,PDF:t.FILE_RESOURCE_TYPE,SPREADSHEET:t.FILE_RESOURCE_TYPE,FILE:t.FILE_RESOURCE_TYPE,FOLDER:t.FOLDER_RESOURCE_TYPE,SHARED_FOLDER:t.FOLDER_RESOURCE_TYPE,TEAM_FOLDER:t.FOLDER_RESOURCE_TYPE,SHARED_FOLDER_READ_ONLY:t.FOLDER_RESOURCE_TYPE,CDM_TEAM_MEMBER_FOLDER:t.FOLDER_RESOURCE_TYPE,TEAM_READ_ONLY:t.FOLDER_RESOURCE_TYPE,PAPER_DOCUMENT:t.PAPER_DOCUMENT_RESOURCE_TYPE,PAPER_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PUBLIC_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PROJECT:t.PAPER_FOLDER_RESOURCE_TYPE,EXTERNAL:i.EXTERNAL_RESOURCE_TYPE},t.DisplayTypeToIconName={AGGREGATION:"image-small",FOLDER:"folder-small",SHARED_FOLDER:"folder_shared-small",TEAM_FOLDER:"folder_team-small",CDM_TEAM_MEMBER_FOLDER:"folder_team_member-small",PAPER_DOCUMENT:"paper-small",PAPER_FOLDER:"folder-small",PAPER_PUBLIC_FOLDER:"folder_team-small",PAPER_PROJECT:"folder_project-small",TEAM_READ_ONLY:"folder_team_read_only-small",SHARED_FOLDER_READ_ONLY:"folder_shared_read_only-small",RESTRICTED_FOLDER:"folder_confidential-small",CAMERA_UPLOADS:"folder_camera_upload-small"},t.SUGGEST_GRID_FEATURE="home_suggest_grid"})),define("modules/clean/react/home/modals/async_home_modals",["require","exports","tslib"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asyncShowCreateAutomatedFolderModal=t.asyncShowNewFolderModal=void 0,t.asyncShowNewFolderModal=({user:t,origin:n,initialPath:o,onShowModal:s,onErrorShowingModal:a,redirectOnClose:r})=>i.__awaiter(void 0,void 0,void 0,(function*(){try{const{showNewFolderModal:a}=yield new Promise((t,i)=>{e(["modules/clean/react/home/modals/new_folder_modal"],t,i)}).then(i.__importStar);a({user:t,onShowModal:s,initialPath:o,origin:n,redirectOnClose:r})}catch(e){a&&a()}})),t.asyncShowCreateAutomatedFolderModal=(t,n)=>i.__awaiter(void 0,void 0,void 0,(function*(){const{asyncLaunchCreateAutoFolderModalFromHome:o}=yield new Promise((t,i)=>{e(["modules/clean/react/flows/utils/folder_rules"],t,i)}).then(i.__importStar),{logCreateAutomatedFolderClick:s}=yield new Promise((t,i)=>{e(["modules/clean/react/browse/action_logger"],t,i)}).then(i.__importStar);o({parentFqPath:t,user:n}),s({uid:n.id,source:"home_web"})}))})),define("modules/clean/react/home/post_tti/api",["require","exports","tslib","react","modules/clean/web_timing_logger","modules/clean/react/async/loadable","modules/clean/react/common/rendering"],(function(e,t,i,n,o,s,a){"use strict";function r(){return i.__awaiter(this,void 0,void 0,(function*(){return yield o.waitForTTI(),yield new Promise((t,i)=>{e(["modules/clean/react/home/post_tti/interface"],t,i)}).then(i.__importStar)}))}function c(){return i.__awaiter(this,void 0,void 0,(function*(){const e=yield r();return{imports:e,props:window.RUNNING_IN_EDISON?yield e.getPostTTIPropsInEdison():yield e.getPostTTIProps()}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.LazyFileUploader=t.PostHomeTTIComponentWithProps=t.waitForHomeTTIWithProps=t.PostHomeTTIComponent=t.waitForHomeTTI=void 0,n=i.__importDefault(n),t.waitForHomeTTI=r,t.PostHomeTTIComponent=function(e){const{getPostTTIRenderer:t,preTTIRenderer:n,displayName:o}=e;return s.Loadable({displayName:`PostHomeTTIComponent(${o})`,loader:()=>i.__awaiter(this,void 0,void 0,(function*(){return t(yield r())})),loading:n})},t.waitForHomeTTIWithProps=c;class l extends n.default.PureComponent{render(){return null}}l.displayName="NullComponent",t.PostHomeTTIComponentWithProps=function(e){const{getPostTTIRenderer:t,preTTIRenderer:o,displayName:a}=e;return s.Loadable({displayName:`PostHomeTTIComponentWithProps(${a})`,loader:()=>i.__awaiter(this,void 0,void 0,(function*(){const e=yield c();return(yield t(e))||(()=>n.default.createElement(l,null))})),loading:o})};const d=n.default.lazy(()=>i.__awaiter(void 0,void 0,void 0,(function*(){const{FileUploader:t}=yield new Promise((t,i)=>{e(["modules/clean/react/home/roots/file_uploader"],t,i)}).then(i.__importStar);return{default:t}})));t.LazyFileUploader=e=>n.default.createElement(a.LazySuspense,null,n.default.createElement(d,Object.assign({},e)))})),define("modules/clean/react/home/recents/actions/error_actions",["require","exports","tslib","lodash","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_dispatcher","modules/core/exception","modules/core/i18n","modules/core/notify"],(function(e,t,i,n,o,s,a,r,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorActions=t.ErrorActions=void 0,n=i.__importStar(n),a=i.__importStar(a);class l{constructor(e){this._flushQueues=()=>{this._rafId=null;const e=this._recentActivityQueue;this._recentActivityQueue=[],e.length&&this._dispatcher.dispatch({type:o.RAW_RECENT_ACTIVITY_PARSE_ERROR,errors:e});const t=this._relatedActivityQueue;this._relatedActivityQueue=[],t.length&&this._dispatcher.dispatch({type:o.RAW_RELATED_ACTIVITY_PARSE_ERROR,errors:t})},this._notify=n.throttle(()=>{const e=r.intl.formatMessage({id:"QANSaH",defaultMessage:"Sorry, we were unable to show some recent items. The team has been notified"});c.Notify.error(e)},500,{trailing:!1}),this._dispatcher=e,this._recentActivityQueue=[],this._relatedActivityQueue=[],this._rafId=null}recentActivityParseError(e,t){a.reportException({err:t}),this._notify(),this._enqueueError(this._recentActivityQueue,e,t)}relatedActivityParseError(e,t){a.reportException({err:t}),this._notify(),this._enqueueError(this._relatedActivityQueue,e,t)}_enqueueError(e,t,i){e.push({activityKey:t,error:i}),this._rafId||(this._rafId=window.requestAnimationFrame(this._flushQueues))}}t.ErrorActions=l,t.errorActions=new l(s.recentActivityDispatcher)})),define("modules/clean/react/home/recents/actions/federated_recent_activity_actions",["require","exports","tslib","modules/core/i18n","modules/core/browser","modules/clean/react/components/modal","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_dispatcher","modules/clean/react/home/recents/recent_activity_federated_model","modules/clean/react/home/recents/stores/recent_activity_store","modules/core/exception","modules/core/notify","modules/clean/react/home/recents/utils/events","modules/clean/react/home/post_tti/api"],(function(e,t,i,n,o,s,a,r,c,l,d,m,u,h){"use strict";function _(e,t,i){e?o.open_tab(e):d.reportStack(`Cannot open tab to preform the action ${t}`,{severity:d.SEVERITY.NONCRITICAL,exc_extra:{paperRecentItem:i.paperRecentItem}})}function p(e,t,i){u.logFederatedItemEvent(e,i.cellView,t)}function E(e,t){r.recentActivityDispatcher.dispatch({type:e,activityKey:t})}Object.defineProperty(t,"__esModule",{value:!0}),t.promptAndArchiveItem=t.previewItem=t.shareItem=void 0,o=i.__importStar(o),t.shareItem=function(e,t){p(a.ActionType.PAPER_SHARE,e,t),_(c.getPaperShareUrl(e),a.ActionType.PAPER_SHARE,e)},t.previewItem=function(e,t){p(a.ActionType.PAPER_OPEN,e,t),_(e.getUrl(),a.ActionType.PAPER_OPEN,e)},t.promptAndArchiveItem=function(e,t,o){const r=e.getActivityKey();if(l.getRecentActivityStore().canArchiveActivityKey(r)){const r=e.getActivityKey();s.SimpleModal.show({title_text:n.intl.formatMessage({id:"bArtK/",defaultMessage:"Archive document?"}),body_html:n.intl.formatMessage({id:"S6cb1J",defaultMessage:"Do you want to archive this document?"}),confirm_text:n.intl.formatMessage({id:"JiHG/V",defaultMessage:"Archive"}),cancel_text:n.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),autoclose:!0,confirm_callback:()=>i.__awaiter(this,void 0,void 0,(function*(){p(a.ActionType.PAPER_ARCHIVE,e,o),E(a.ARCHIVE_PAPER_DOCUMENT_PENDING,r);try{(yield(yield h.waitForHomeTTI()).archivePaperResources(t,[e.paperRecentItem])).some(t=>c.equalsPaperRecentItem(e,t))?(E(a.ARCHIVE_PAPER_DOCUMENT_COMMIT,r),m.Notify.success(n.intl.formatMessage({id:"r3vKLt",defaultMessage:"The document was archived."}))):E(a.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,r)}catch(e){E(a.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,r)}}))})}}})),define("modules/clean/react/home/recents/actions/recent_activity_action_permissions",["require","exports","lodash","modules/clean/react/home/recents/models/utils","modules/clean/pnm/utils"],(function(e,t,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldRenderActionsMenu=t.getRecentActivityItemViewPermissions=void 0,t.getRecentActivityItemViewPermissions=function(e,t){if(e.federatedRecentItem)return{archive:e.federatedRecentItem.isArchiveable(),comment:!1,delete:!1,download:!1,open:!1,share:e.federatedRecentItem.isShareable(),versions:!1,viewInFolder:!1};{const s=t[0],a=1===t.length;if(n.isMountedRecentItem(e)){const n=a&&!s.isDir,r=a&&!s.isCloudDoc,c=a&&s.isVersionable,l=e.paths.length?i.last(e.paths):null,d={archive:!1,comment:n&&r,delete:t.every(e=>!e.isReadOnly),download:a&&r,open:!(!a||!s.canOpen),share:a,versions:n&&c,viewInFolder:!(!l||!l.url)},m=e.perNodeMetadata;return m&&(o.hasValidLinkNode(m)&&(d.archive=!1,d.comment=!1,d.delete=!1,d.download=!1,d.open=!1,d.share=!1,d.versions=!1,d.viewInFolder=!1),m.suppress_delete&&(d.delete=!1),(m.suppress_ns_partition||m.suppress_shared_link)&&(d.share=!1)),d}return{archive:!1,comment:!1,delete:!1,download:!1,open:!!e.scl,share:!1,versions:!1,viewInFolder:!1}}},t.shouldRenderActionsMenu=function(e){for(const t in e)if("share"!==t&&e[t])return!0;return!1}})),define("modules/clean/react/home/recents/actions/recent_activity_actions",["require","exports","tslib","lodash","modules/clean/navigation","modules/clean/pnm/utils","modules/clean/react/home/post_tti/api","modules/clean/react/home/recents/actions/federated_recent_activity_actions","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_dispatcher","modules/clean/react/home/recents/stores/recent_activity_store","modules/clean/react/plusplus/logging","modules/core/exception"],(function(e,t,i,n,o,s,a,r,c,l,d,m,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.refreshRecentItems=t.openVersions=t.downloadFiles=t.openFile=t.hasCursor=t.loadNextPage=t.archiveRecentItem=t.deleteRecentItem=t.previewRecentItem=t.shareRecentItem=void 0,n=i.__importStar(n),t.shareRecentItem=function(e,t,n,o){return i.__awaiter(this,void 0,void 0,(function*(){e.federatedRecentItem?r.shareItem(e.federatedRecentItem,n):yield(yield a.waitForHomeTTI()).shareFile(t[0].id,n,o)}))},t.previewRecentItem=function(e,t,n,o){if(s.isSupportedLinkNodeClickAction(e.perNodeMetadata))a.waitForHomeTTI().then(({handleLinkNodeAction:t})=>i.__awaiter(this,void 0,void 0,(function*(){t(e.perNodeMetadata,t=>{m.logProductAnalytics(e.viewingUserId,"web","select",t,"recents")})})));else if(e.federatedRecentItem)r.previewItem(e.federatedRecentItem,n);else if(1===e.attachmentIds.length)a.waitForHomeTTI().then(({previewFileSyncRecentItem:i})=>i(e,!!o,t,n));else{const{index:i,shouldUseEntityUri:n}=t;u.reportStack("To preview, file sync items must have 1 attachment id",{severity:u.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e,index:i,shouldUseEntityUri:n}})}},t.deleteRecentItem=function(e,t,n){return i.__awaiter(this,void 0,void 0,(function*(){a.waitForHomeTTIWithProps().then(({imports:o,props:r})=>{o.deleteRecentItem(e,t,n,r),(function(e){if(!s.isPreSetupLinkNode(e.perNodeMetadata))return;a.waitForHomeTTI().then(({getLinkNodeEventObject:t})=>i.__awaiter(this,void 0,void 0,(function*(){const i=t(e.perNodeMetadata);i&&m.logProductAnalytics(e.viewingUserId,"web","delete",i,"recents")})))})(e)})}))},t.archiveRecentItem=function(e,t){e.federatedRecentItem?r.promptAndArchiveItem(e.federatedRecentItem,e.viewingUserId,t):u.reportStack("Archiving is not supported",{severity:u.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e}})},t.loadNextPage=function(){const e=d.getRecentActivityStore().getFileSyncCursor();return e&&a.waitForHomeTTI().then(({loadRecentItems:t})=>t(e)),!!e},t.hasCursor=function(){return!!d.getRecentActivityStore().getFileSyncCursor()},t.openFile=function(e,t,o=n.noop){return i.__awaiter(this,void 0,void 0,(function*(){yield(yield a.waitForHomeTTI()).openFile(e,t),o()}))},t.downloadFiles=function(e,t){return i.__awaiter(this,void 0,void 0,(function*(){(yield a.waitForHomeTTI()).downloadFiles(e,t)}))},t.openVersions=function(e,t){return i.__awaiter(this,void 0,void 0,(function*(){(yield a.waitForHomeTTI()).openVersions(o.NavigationMethod.REDIRECT,e,t)}))},t.refreshRecentItems=function(){return i.__awaiter(this,void 0,void 0,(function*(){if(d.getRecentActivityStore().didReceiveItemsFromAllStreams()){l.recentActivityDispatcher.dispatch({type:c.REFRESH_RECENT_ACTIVITIES});const{loadRecentItems:e,loadPaperRecentItems:t}=yield a.waitForHomeTTI();yield Promise.all([e(),t(!1)])}}))}})),define("modules/clean/react/home/recents/components/pending_attachment_list_view",["require","exports","tslib","react"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PendingAttachmentListView=void 0,n=i.__importDefault(n);class o extends n.default.Component{render(){const{count:e}=this.props;return n.default.createElement("ul",{className:"recents-item__attachments"},new Array(Math.min(e,4)).fill(null).map((e,t)=>n.default.createElement("li",{className:"recents-item__attachment-item",key:t})))}}t.PendingAttachmentListView=o,o.displayName="PendingAttachmentListView"})),define("modules/clean/react/home/recents/components/recent_activity_container",["require","exports","tslib","classnames","react","react-dom","dig-components/progress_indicators","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/post_tti/api","modules/clean/react/home/recents/actions/recent_activity_actions","modules/clean/react/home/recents/components/recent_activity_item_container","modules/clean/react/home/recents/stores/recent_activity_store","modules/clean/react/components/section/section_header","modules/clean/react/home/store","modules/clean/react/components/section/section_empty_text","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/show_hide_link","modules/core/i18n","spectrum/media_table_skeleton/index"],(function(e,t,i,n,o,s,a,r,c,l,d,m,u,h,_,p,E,T,g,I,R,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecentActivityContainerInSearchEmptyState=t.RecentActivityContainer=t.RecentActivityContainerInner=void 0,n=i.__importDefault(n),o=i.__importDefault(o),s=i.__importDefault(s);class S extends o.default.PureComponent{constructor(e){super(e),this.onShouldLoadMore=()=>{const e=u.getRecentActivityStore();if(!this.state.isPending&&this.state.showAll&&!e.didTruncateRecentItems()&&e.didReceiveItemsFromAllStreams()){const{items:t}=e.getRecentItems();t.length>this.state.items.length?this.setState({items:t}):d.loadNextPage()&&this.setState({isPending:!0})}},this.onChangeRecentsVisibility=()=>{const e=!this.props.isHiddenByUser;r.HomeActions.setSectionVisibility(_.getUserId(),{".tag":"recents"},!e),E.homeActivityLogger.logShowHideSection(c.HomeSections.RECENTS,e)},this.handleVisibilityChange=()=>{"visible"===document.visibilityState&&d.refreshRecentItems()},this.onStoreUpdate=()=>this.setState(this.getStateFromStore()),this.onShowAll=()=>{this.setState({showAll:!0});const e=s.default.findDOMNode(this.refs.lastUnhiddenActivity);if(e){const t=e.querySelector("a");t&&t.focus()}},this.removeStoreListeners=u.getRecentActivityStore().addListener(this.onStoreUpdate),this.state=Object.assign(Object.assign({},this.getStateFromStore()),{isUnityAvailable:!1,showAll:!!e.showAll})}componentDidMount(){this.props.isHiddenByUser&&g.homeTimingLogger.logSkippedSection(c.HomeSections.RECENTS),l.waitForHomeTTI().then(e=>i.__awaiter(this,void 0,void 0,(function*(){e.recentActivityContainerComponentDidMount(this.onShouldLoadMore),(yield e.getUnityFeatures())&&this.setState({isUnityAvailable:!0})}))),!this.state.items.length&&u.getRecentActivityStore().didReceiveItemsFromAllStreams()&&this.setState({isPending:!1}),document.addEventListener("visibilitychange",this.handleVisibilityChange,!1)}componentWillUnmount(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.removeStoreListeners()}getStateFromStore(){const e=u.getRecentActivityStore(),t=!e.didReceiveItemsFromAllStreams(),{items:i}=e.getRecentItems();if(!t){if(g.homeTimingLogger.logTTData(c.HomeSections.RECENTS)){const e=i.length;e&&E.homeActivityLogger.logRecentsShown(e,!_.getHomeStore().getSectionVisibility()[c.HomeSections.RECENTS])}}return{isPending:t,items:i}}renderLoadingView(){const{showSkeletonWhenLoading:e}=this.props;return o.default.createElement("div",{className:"recents-loading-view",key:"loading"},e?o.default.createElement(f.MediaTableSkeletonRow,null):o.default.createElement(a.Spinner,{size:"small","aria-valuetext":R.intl.formatMessage({id:"k2bVak",defaultMessage:"Loading your recent items"})}))}renderItems(){const{now:e,fullItemView:t,loggedComponentName:i}=this.props,{items:n,showAll:s,isUnityAvailable:a}=this.state,r={isUnityAvailable:a,now:e,user:_.getUser()},c=t?10:3,l=s?n:n.slice(0,c);return o.default.createElement("div",null,l.map((e,n)=>o.default.createElement(m.RecentActivityItemContainer,{key:e.id,recentItem:e,renderingInfo:r,fullItemView:t,ref:9===n?"lastUnhiddenActivity":void 0,loggedComponentName:i})))}renderShowMoreLink(){const{items:e,showAll:t}=this.state,i=Math.max(e.length-10,0);return this.props.fullItemView?t||!d.hasCursor()&&i<=0?null:o.default.createElement(I.ShowHideLink,{key:"show_more",onClick:this.onShowAll,isExpanded:!1,hiddenItemCount:i,canLoadMore:!0}):null}renderContent(){const{isPending:e,items:t}=this.state;return t.length?[this.renderItems(),this.renderShowMoreLink(),e&&this.renderLoadingView()]:e?this.renderLoadingView():o.default.createElement(p.SectionEmptyText,{message:R.intl.formatMessage({id:"hFDfoh",defaultMessage:"Items you recently viewed show up here."}),learnMoreLink:"/help/desktop-web/recents-overview"})}render(){const{canRenderItems:e,isHiddenByUser:t,showHeader:i,className:s}=this.props;if(!e)return null;const{isPending:a,items:r}=this.state,c=n.default({"home-recents-section__container":!0,"recents-view":!0,"recents-view--is-pending":a&&0===r.length}),l=n.default("home-access-section home-recents-section",s);return o.default.createElement("section",{className:l},i?o.default.createElement(h.SectionHeader,{title:R.intl.formatMessage({id:"hApMtp",defaultMessage:"Recent"}),ueName:"recents",isHidden:t,onToggleHidden:this.onChangeRecentsVisibility}):null,o.default.createElement("div",{className:"home-access-section__content"},!t&&o.default.createElement("div",{className:c},this.renderContent())))}}t.RecentActivityContainerInner=S,S.displayName="RecentActivityContainer",t.RecentActivityContainer=T.timingComponent(S,c.HomeSections.RECENTS),t.RecentActivityContainerInSearchEmptyState=S})),define("modules/clean/react/home/recents/components/recent_activity_item_actions_view",["require","exports","tslib","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/menu","modules/core/i18n"],(function(e,t,i,n,o,s,a,r,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecentActivityItemActionsView=void 0,n=i.__importDefault(n);const l=e=>{e.stopPropagation(),e.preventDefault()},d=(e,t)=>{l(t),e(t)},m=e=>t=>t.permissions[e],u=[{name:"handleDownload",label:c.intl.formatMessage({id:"iFX+XI",defaultMessage:"Download"}),shouldRender:m("download")},{name:"handleComment",label:c.intl.formatMessage({id:"tJzlWE",defaultMessage:"Comment"}),shouldRender:m("comment")},{name:"handleDelete",label:c.intl.formatMessage({id:"NQS3dU",defaultMessage:"Delete all…"}),shouldRender:e=>e.permissions.delete&&e.attachmentCount>1},{name:"handleDelete",label:c.intl.formatMessage({id:"Ieup/u",defaultMessage:"Delete…"}),shouldRender:e=>e.permissions.delete&&e.attachmentCount<=1},{name:"handleArchive",label:c.intl.formatMessage({id:"CvAVX3",defaultMessage:"Archive"}),shouldRender:m("archive")},{name:"handleVersions",label:c.intl.formatMessage({id:"jId+M1",defaultMessage:"Version history"}),shouldRender:m("versions")},{name:"handleViewInFolder",label:c.intl.formatMessage({id:"3Dgw+C",defaultMessage:"View in folder"}),shouldRender:m("viewInFolder")}];t.RecentActivityItemActionsView=e=>{if(e.disableActions)return null;const t=u.filter(t=>t.shouldRender(e));return t.length?n.default.createElement(r.Menu.Wrapper,{className:"recents-item__unportaled-menu",onSelection:d,isPortaled:!1},({getContentProps:i,getTriggerProps:d})=>n.default.createElement(n.default.Fragment,null,n.default.createElement(o.IconButton,Object.assign({variant:"transparent"},d({onClick:l})),n.default.createElement(s.UIIcon,{src:a.MoreHorizontalLine,"aria-label":c.intl.formatMessage({id:"mnOOD/",defaultMessage:"More actions"})})),n.default.createElement(r.Menu.Content,Object.assign({},i({onClick:l}),{placement:"bottom-end"}),n.default.createElement(r.Menu.Segment,null,t.map(({name:t,label:i})=>n.default.createElement(r.Menu.ActionItem,{key:t,value:e.handler[t]},i)))))):null},t.RecentActivityItemActionsView.displayName="RecentActivityItemActionsView"})),define("modules/clean/react/home/recents/components/recent_activity_item_container",["require","exports","tslib","lodash","react","modules/core/assert","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/actions/recent_activity_actions","modules/clean/react/home/recents/components/recent_activity_item_view","modules/clean/react/home/recents/utils/events","modules/clean/react/home/recents/stores/attachment_store","modules/clean/react/home/post_tti/api"],(function(e,t,i,n,o,s,a,r,c,l,d,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecentActivityItemContainer=void 0,n=i.__importStar(n),o=i.__importDefault(o);class u extends o.default.PureComponent{constructor(e){super(e),this.onAttachmentStoreChange=()=>{this.setState({attachments:d.getAttachmentStore().getByIds(this.getRecentItem().attachmentIds)})},this.handleArchive=()=>r.archiveRecentItem(this.getRecentItem(),this.getLogData()),this.handleComment=()=>{const e=this.getSingleAttachment("handleComment only supports a single attachment"),t=Math.max(0,this.state.attachments.indexOf(e));this.previewOrOpenFiles({index:t,isCommentAction:!0})},this.handleDelete=()=>{r.deleteRecentItem(this.getRecentItem(),this.state.attachments,this.getLogData())},this.handleDownload=()=>{const e=this.getSingleAttachment("handleDownload only supports a single attachment");r.downloadFiles([e.id],this.getLogData())},this.handleHeaderClick=()=>{const{isCollapsed:e,attachments:t}=this.state,i=e?a.ActionType.UNCOLLAPSE:a.ActionType.COLLAPSE;l.logEvent(i,this,this.state.attachments,t.length),this.setState({isCollapsed:!e})},this.handleOpen=()=>{const e=this.getSingleAttachment("handleOpen only supports a single attachment");r.openFile(e.id,this.getLogData())},this.handlePathClick=e=>{const t=this.getAttachmentFqPaths(),{recentItem:i}=this.props,{attachmentIds:n,viewingUserId:o}=i;m.waitForHomeTTI().then(({logOpenPathUrl:i,openUrl:s})=>{i(o,t,n.length,this),s(e,a.ActionType.OPEN_PATH,n,this.getLogData())})},this.handleViewInFolder=()=>{const e=this.getAttachmentFqPaths(),{recentItem:t}=this.props,{attachmentIds:i,viewingUserId:o}=t;m.waitForHomeTTI().then(({logViewInFolder:s,openUrl:r})=>{s(o,e,i.length,this),r(n.last(t.paths).url,a.ActionType.VIEW_IN_FOLDER,i,this.getLogData())})},this.handlePreview=e=>{this.previewOrOpenFiles({},e)},this.handleShare=()=>{r.shareRecentItem(this.getRecentItem(),this.state.attachments,this.getLogData(),!1)},this.handleVersions=()=>{const e=this.getSingleAttachment("handleVersions only supports a single attachment");r.openVersions(e.id,this.getLogData())},this.removeStoreListeners=null,this.state={attachments:[],isCollapsed:!0}}getRecentItem(){return this.props.recentItem}getLogData(){return{totalCount:this.props.recentItem.attachmentIds.length,cellView:this,loggedComponentName:this.props.loggedComponentName}}getAttachmentFqPaths(){return n.compact(n.map(this.state.attachments,"fqPath"))}getSingleAttachment(e){return e&&s.assert(1===this.state.attachments.length,e),this.state.attachments[0]}previewOrOpenFiles(e,t){const{recentItem:i}=this.props;r.previewRecentItem(i,Object.assign({},e),this.getLogData(),t)}UNSAFE_componentWillMount(){this.removeStoreListeners=d.getAttachmentStore().addListener(this.onAttachmentStoreChange),this.onAttachmentStoreChange()}componentWillUnmount(){this.removeStoreListeners&&this.removeStoreListeners()}render(){return o.default.createElement(c.RecentActivityItemView,{recentItem:this.getRecentItem(),attachments:this.state.attachments,handler:this,isCollapsed:this.state.isCollapsed,renderingInfo:this.props.renderingInfo,showExpand:this.props.fullItemView,showStar:this.props.fullItemView,showLastAccess:this.props.fullItemView,showActions:this.props.fullItemView})}}t.RecentActivityItemContainer=u,u.displayName="RecentActivityItemContainer"})),define("modules/clean/react/home/recents/components/recent_activity_item_view",["require","exports","tslib","classnames","lodash","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","dig-components/tooltips","dig-components/typography","modules/clean/browse_uri_interface","modules/clean/datetime/datetime","modules/clean/em_string","modules/clean/filepath/filepath","modules/clean/react/display_types/constants","modules/clean/react/home/recents/actions/recent_activity_action_permissions","modules/clean/react/home/recents/components/pending_attachment_list_view","modules/clean/react/home/recents/components/recent_activity_item_actions_view","modules/clean/react/home/recents/models/utils","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_text_helper","modules/clean/react/home/util/conditional_api","modules/clean/react/home/util/post_tti_components","modules/clean/react/home/util/resource_icon","modules/clean/react/starred/constants","modules/core/exception","modules/core/i18n"],(function(e,t,i,n,o,s,a,r,c,l,d,m,u,h,_,p,E,T,g,I,R,f,S,y,A,P,v,C){"use strict";function O(e){return 0===e.button&&!(function(e){return e.altKey||e.ctrlKey||e.metaKey||e.shiftKey})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.RecentActivityItemView=void 0,n=i.__importDefault(n),s=i.__importDefault(s),f=i.__importStar(f);class N extends s.default.Component{constructor(){super(...arguments),this.onShare=e=>{e.preventDefault(),e.stopPropagation(),this.props.handler.handleShare()},this.handleTitleClick=e=>{e.stopPropagation(),O(e)&&(e.preventDefault(),this.props.handler.handlePreview(e.metaKey))},this.handleClick=e=>{e.stopPropagation(),e.preventDefault(),this.isAggregation()?this.props.handler.handleHeaderClick():this.props.handler.handlePreview(e.metaKey)},this.handleParentClick=e=>{e.stopPropagation(),O(e)&&(e.preventDefault(),this.props.handler.handlePathClick(this.getParentPathComponent().url))}}shouldDisableActions(){const{federatedRecentItem:e}=this.props.recentItem;return e?!e.hasMenuActions():!this.hasLoadedAttachments()}isAggregation(){return this.props.recentItem.attachmentIds.length>1}shouldShowThumbnails(){const{recentItem:e}=this.props;return I.isMountedRecentItem(e)&&I.shouldShowThumbnailsForRecentItem(e)}getLoadedAttachmentsCount(){return this.props.attachments.filter(e=>e.isLoaded).length}canRenderAttachmentView(){const e=this.getLoadedAttachmentsCount();return e===this.props.recentItem.attachmentIds.length||e>=R.MAX_INITIAL_THUMBNAIL_ATTACHMENTS}hasLoadedAttachments(){return!(!this.props.attachments.length||!this.getLoadedAttachmentsCount())}getHeading(){const{attachments:e,recentItem:t}=this.props;if(e.length<2){const e=t.displayName||"";return h.Emstring.em_snippet(e,30)}{const i=t.attachmentIds.length,n=t.uniqueFilterTypes,o=[];for(const t of e)t.isLoaded&&t.displayName&&o.push(t.displayName);switch(n.length){case 1:switch(n[0]){case R.RECENT_EVENT_FILTER_TYPE.PHOTOS:return C.intl.formatMessage({id:"HxTR1s",defaultMessage:"{count, plural, one{{count} image} other{{count} images}}"},{count:i});case R.RECENT_EVENT_FILTER_TYPE.VIDEOS:return C.intl.formatMessage({id:"fmi87t",defaultMessage:"{count, plural, one{{count} video} other{{count} videos}}"},{count:i});case R.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES:return C.intl.formatMessage({id:"vZtJe2",defaultMessage:"{count, plural, one{{count} visual note} other{{count} visual notes}}"},{count:i})}break;case 2:if(n.indexOf(R.RECENT_EVENT_FILTER_TYPE.PHOTOS)>=0&&n.indexOf(R.RECENT_EVENT_FILTER_TYPE.VIDEOS)>=0)return C.intl.formatMessage({id:"E1nUJ4",defaultMessage:"{count} images and videos"},{count:i})}return o.length?f.snippetList(o,30,{totalCount:i}):C.intl.formatMessage({id:"IGlwYu",defaultMessage:"{count, plural, one{{count} file} other{{count} files}}"},{count:i})}}getParentPathComponent(){const{recentItem:e}=this.props,{type:t,paths:i}=e;if(!I.isMountedRecentItem(e))return t===R.RECENT_EVENT_TYPES.FILE_SHARED_ADD?{name:C.intl.formatMessage({id:"guiO/P",defaultMessage:"Your links"}),url:"/share/links"}:null;if(i.length){const e=o.last(i);if(e.url)return e}return null}renderStar(){const{attachments:e,recentItem:t,renderingInfo:i}=this.props,n=Boolean(e.length>0&&e[0].isDir);return S.waitForStarred(e=>{const{Star:o,getIdTypePairFromRecentItem:a}=e,r=a(t);return r?s.default.createElement(o,{id:r.id,idType:r.type,isDir:n,itemName:t.displayName||void 0,user:i.user,source:P.StarredSource.HOME_RECENTS}):null},!1)}componentDidMount(){this.shouldShowThumbnails()||this.isAggregation()&&v.reportStack("Tried to render non-photo aggregation but failed",{severity:v.SEVERITY.NONCRITICAL,exc_extra:{isMounted:this.props.recentItem.isMounted,hasSCL:!!this.props.recentItem.scl,attachment_lenth:this.props.attachments.length}})}render(){const{recentItem:e,attachments:t,handler:i,renderingInfo:o,isCollapsed:h,showExpand:R,showStar:f,showLastAccess:S,showActions:P}=this.props,{displayType:v,federatedRecentItem:O,fqPath:N,scl:w}=e,D=this.getParentPathComponent(),L=new Date(e.when),b=E.getRecentActivityItemViewPermissions(e,t),M=I.isMountedRecentItem(e),F=b.share&&(O?O.isShareable():this.hasLoadedAttachments()),H=this.isAggregation()?void 0:M?N?m.preview_uri_for_fq_path(o.user,N).toString():void 0:w,V=n.default({"recents-item":!0,"recents-item--loaded":this.hasLoadedAttachments()});return s.default.createElement("div",{"data-item-id":e.id,"data-item-type":e.type,"data-item-date":e.when,className:V,onClick:this.handleClick},s.default.createElement("div",{className:"recents-item-header"},R&&s.default.createElement("div",{className:"recents-item-header__chevron"},this.isAggregation()&&s.default.createElement(a.IconButton,{onClick:this.props.handler.handleHeaderClick,variant:"transparent",className:"recents-item-header__chevron-button","aria-label":h?C.intl.formatMessage({id:"5loFC4",defaultMessage:"Expand"}):C.intl.formatMessage({id:"cwEFpr",defaultMessage:"Collapse"})},s.default.createElement(r.UIIcon,{src:h?c.ChevronRightLine:c.ChevronDownLine,size:"small"}))),s.default.createElement("div",{className:"recents-item-header__icon"},s.default.createElement(A.HomeResourceIcon,{displayType:v||p.DisplayTypes.FILE,fileName:e.displayName||"",shortcutUrlForIcon:e.fqPath&&"web"===_.file_extension(e.fqPath)&&e.scl||void 0,icon:e.icon||void 0})),s.default.createElement("div",{className:`recents-item-header__content ${S?"":"recents-item-header-search_empty_state__experiment"}`},s.default.createElement("div",{className:"recents-item-header__title"},H?s.default.createElement(d.Link,{variant:"monochromatic",hasNoUnderline:!0,className:"recents-item-header__title-text",href:H,onClick:this.handleTitleClick},this.getHeading()):s.default.createElement(d.Text,{className:"recents-item-header__title-text"},this.getHeading()),f&&this.renderStar()),s.default.createElement(d.Text,{size:S?"small":void 0,color:"faint",className:"recents-item-header__subtitle"},S?`${I.getActionTypeLocalizedString(e)} `:"",S&&s.default.createElement(l.Tooltip,{placement:"top",title:u.format_date(L,"MMM d, yyyy "+u.localized_time_format)},s.default.createElement("span",null,u.agoFromDate(L,o.now,!1))),D?S?" · ":" • ":"",D&&s.default.createElement(d.Link,{href:D.url,onClick:this.handleParentClick,variant:"monochromatic",hasNoUnderline:!0},D.name))),P&&s.default.createElement("div",{className:"recents-item__actions"},F&&s.default.createElement("div",{className:"recents-item__action recents-item__action--hover-only recents-item__action--standard-breakpoint-only"},s.default.createElement(a.Button,{onClick:this.onShare,variant:"opacity"},C.intl.formatMessage({id:"2ZK3bH",defaultMessage:"Share"}))),s.default.createElement(y.PostTTIRecentsActivityFileActions,{recentItem:this.props.recentItem,attachments:this.props.attachments}),s.default.createElement(g.RecentActivityItemActionsView,{handler:i,isMountedItem:M,permissions:b,attachmentCount:e.attachmentIds.length,disableActions:this.shouldDisableActions(),renderingInfo:o}))),this.shouldShowThumbnails()&&!this.props.isCollapsed&&(this.canRenderAttachmentView()?s.default.createElement(y.PostTTIRecentActivityImageAttachments,{attachments:t}):s.default.createElement(T.PendingAttachmentListView,{count:e.attachmentIds.length})))}}t.RecentActivityItemView=N,N.displayName="RecentActivityItemView"})),define("modules/clean/react/home/recents/models/attachment",["require","exports","modules/core/exception"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPartialAttachmentsFromRecentActivity=t.convertFileActivityToAttachmentItem=void 0,t.convertFileActivityToAttachmentItem=function(e){const t=e.preview_jsinfo||null;let n=null,o=null;if(t&&(t.thumbnail_url_tmpl&&(n=t.thumbnail_url_tmpl),t.thumbnail_dimensions)){const[e,i]=t.thumbnail_dimensions;o={height:i,width:e}}const s=e.comment||{},a=s.commenter_dict||{};return s.raw_comment_text&&i.reportStack("Received a comment attachment",{severity:i.SEVERITY.NONCRITICAL,exc_extra:{activity:e}}),{id:e.activity_key,isLoaded:!0,viewingUserId:e.viewing_user.id,displayName:e.name||null,displayType:e.activity_data&&e.activity_data.home_display_type||null,previewInfo:e.preview_jsinfo||null,fqPath:e.fq_path||null,nsPath:e.ns_path||null,nsId:e.ns_id||null,thumbnailUrl:n||null,thumbnailDimensions:o||null,canOpen:!1,inRootCollection:!1,isReadOnly:!!e.is_read_only,isDir:!!e.is_dir,isCloudDoc:!!e.is_cloud_doc,isVersionable:!!e.is_versionable,perNodeMetadata:e.per_node_metadata||null,commentRawText:s.raw_comment_text||null,commenterId:a.id||null,commenterDisplayName:a.display_name||null,commenterPhotoUrl:a.photo_circle_url||null}},t.createPartialAttachmentsFromRecentActivity=function(e){return(e.related_activity_keys||[]).map(t=>({id:t,viewingUserId:e.viewing_user.id,displayName:null,displayType:null,isLoaded:!1,canOpen:!1,inRootCollection:!1,isReadOnly:!1,isDir:!1,isCloudDoc:!1,isVersionable:!1,perNodeMetadata:null,previewInfo:null,fqPath:null,nsPath:null,nsId:null,thumbnailUrl:null,thumbnailDimensions:null,commentRawText:null,commenterId:null,commenterDisplayName:null,commenterPhotoUrl:null}))}})),define("modules/clean/react/home/recents/models/federated_recent_item",["require","exports","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_federated_model"],(function(e,t,i,n){"use strict";function o(e){switch(e.action||i.PaperRecentItemAction.OPENED){case i.PaperRecentItemAction.CREATED:return i.RECENT_EVENT_TYPES.PAPER_ADD;case i.PaperRecentItemAction.EDITED:return i.RECENT_EVENT_TYPES.PAPER_EDIT;default:return i.RECENT_EVENT_TYPES.PAPER_VIEW}}Object.defineProperty(t,"__esModule",{value:!0}),t.createRecentItemFromPaperRecentItem=void 0,t.createRecentItemFromPaperRecentItem=function(e,t,s){const a=new n.FederatedRecentItem(e),r=a.getActivityKey();return{federatedRecentItem:a,id:r,idType:e.id_type,resourceId:e.resource_id,type:o(e),icon:a.getIcon(),displayType:e.display_type,when:e.time,viewingUserId:t.id,displayName:e.name,accountDisplayName:t.display_name,contextDisplayName:a.getFolderPath()||t.display_name,attachmentIds:[r],paths:e.path,order:s,uniqueFilterTypes:[i.RECENT_EVENT_FILTER_TYPE.DOCUMENTS]}}})),define("modules/clean/react/home/recents/models/recent_item",["require","exports","tslib","lodash","modules/clean/react/home/recents/actions/error_actions","modules/clean/react/home/recents/models/utils"],(function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertRecentActivityToRecentItem=void 0,n=i.__importStar(n);let a=0;const r=n.memoize(e=>a+=1);t.convertRecentActivityToRecentItem=function(e){try{const t=e.skeleton_data;return{id:e.activity_key,type:e.recent_event_type||null,icon:e.icon||t&&t.icon||null,displayType:e.activity_data&&e.activity_data.home_display_type||null,when:e.when_milli||null,viewingUserId:e.viewing_user.id,displayName:t&&t.display_name||null,accountDisplayName:t&&t.account_display_name||null,contextDisplayName:t&&t.context_display_name||null,uniqueFilterTypes:t?n.uniq(n.values(t.filter_types_by_key)):[],attachmentIds:e.related_activity_keys||[],paths:s.getPathsByFqPath(t&&t.context_display_path||"",e.viewing_user.id,!0),order:r(e.activity_key),idType:e.id_type,resourceId:e.resource_id,scl:e.scl,isMounted:e.is_mounted,perNodeMetadata:e.per_node_metadata}}catch(t){return n.defer(()=>o.errorActions.recentActivityParseError(e.activity_key,t)),null}}})),define("modules/clean/react/home/recents/models/utils",["require","exports","tslib","lodash","modules/clean/browse_uri_interface","modules/clean/react/home/recents/recent_activity_constants","modules/clean/viewer"],(function(e,t,i,n,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getActionTypeLocalizedString=t.getRecentItemActionType=t.getExtension=t.compareRecentItems=t.getPathsByFqPath=t.isMountedRecentItem=t.extractAttachmentIds=t.shouldShowThumbnailsForRecentItem=t.shouldShowThumbnailsForSkeletonData=void 0,n=i.__importStar(n);const{PHOTOS:r,VIDEOS:c,VISUAL_NOTES:l}=s.RECENT_EVENT_FILTER_TYPE,d=[r,c,l];function m(e,t){return!!(e>1&&t.every(e=>d.indexOf(e)>=0))}function u(e){switch(e.type){case s.RECENT_EVENT_TYPES.FILE_PRIVATE_VIEW:case s.RECENT_EVENT_TYPES.FILE_SHARED_VIEW:case s.RECENT_EVENT_TYPES.PAPER_VIEW:return s.RecentItemActionType.OPENED;case s.RECENT_EVENT_TYPES.FILE_EDIT:case s.RECENT_EVENT_TYPES.PAPER_EDIT:return s.RecentItemActionType.EDITED;default:return s.RecentItemActionType.ADDED}}t.shouldShowThumbnailsForSkeletonData=function(e){const t=n.values(e.filter_types_by_key);return m(t.length,n.uniq(t))},t.shouldShowThumbnailsForRecentItem=function(e){return m(e.attachmentIds.length,e.uniqueFilterTypes)},t.extractAttachmentIds=function(e){return n.map(e,"id")},t.isMountedRecentItem=function(e){return!1!==e.isMounted},t.getPathsByFqPath=function(e,t,i=!1){const s=a.Viewer.get_viewer().get_user_by_id(t);"/"===e&&(e="");const r=[],c=e.split("/");for(i||c.pop();c.length;){let e=n.last(c),t=c.join("/");1===c.length&&""===e&&(e=a.Viewer.get_root_name(s),t="");const i=o.browse_uri_for_fq_path(s,t).toString();r.push({name:e||"",url:i}),c.pop()}return r.reverse()},t.compareRecentItems=function(e,t){return t.when-e.when||e.order-t.order||t.type-e.type},t.getExtension=function(e){const t=e.split(".");return t.length<2?"":"."+t.slice(-1)[0].replace(/\n$/,"").toLowerCase()},t.getRecentItemActionType=u;const h={[s.RecentItemActionType.OPENED]:s.I18N.OPENED,[s.RecentItemActionType.EDITED]:s.I18N.EDITED,[s.RecentItemActionType.ADDED]:s.I18N.ADDED};t.getActionTypeLocalizedString=function(e){return h[u(e)]}})),define("modules/clean/react/home/recents/recent_activity_client_utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isPaperRecentItem=t.isSFJRecentItem=t.getPayload=void 0,t.getPayload=function(e){if("ok"===e.status)return e.payload;throw new Error(`Payload not okay: ${JSON.stringify(e)}`)},t.isSFJRecentItem=e=>void 0!==e.activity_key,t.isPaperRecentItem=e=>void 0!==e.time})),define("modules/clean/react/home/recents/recent_activity_constants",["require","exports","tslib","modules/constants/python","modules/core/i18n"],(function(e,t,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnsureAttachmentsPurpose=t.ActionScope=t.ActionType=t.I18N=t.RecentItemActionType=t.MAX_ENSURE_ATTACHMENT_LOAD_ATTACHMENTS_ATTEMPTS=t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI=t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI=t.PaperRecentItemTypes=t.PaperRecentItemAction=t.SHOW_MORE_THUMBNAIL_ROW_INCREMENT=t.MAX_INITIAL_THUMBNAIL_ATTACHMENTS=t.SHOW_MORE_DOC_ATTACHMENT_INCREMENT=t.MAX_INITIAL_DOC_ATTACHMENTS=t.REMOVE_PENDING_ACTIVITY_KEYS=t.ADD_PENDING_ACTIVITY_KEYS=t.REFRESH_RECENT_ACTIVITIES=t.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY=t.RECEIVE_RAW_RECENT_ACTIVITIES=t.RECEIVE_PAPER_RECENT_ITEMS=t.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO=t.RECEIVE_CAN_OPEN_INFO=t.RAW_RELATED_ACTIVITY_PARSE_ERROR=t.RAW_RECENT_ACTIVITY_PARSE_ERROR=t.DELETE_FILES_ROLLBACK=t.DELETE_FILES_PENDING=t.DELETE_FILES_COMMIT=t.ARCHIVE_PAPER_DOCUMENT_ROLLBACK=t.ARCHIVE_PAPER_DOCUMENT_PENDING=t.ARCHIVE_PAPER_DOCUMENT_COMMIT=t.RECENT_EVENT_FILTER_TYPE=t.RECENT_EVENT_TYPES=void 0,n=i.__importStar(n),t.RECENT_EVENT_TYPES=n.RECENT_EVENT_TYPES,t.RECENT_EVENT_FILTER_TYPE=n.RECENT_EVENT_FILTER_TYPE,t.ARCHIVE_PAPER_DOCUMENT_COMMIT="ARCHIVE_PAPER_DOCUMENT_COMMIT",t.ARCHIVE_PAPER_DOCUMENT_PENDING="ARCHIVE_PAPER_DOCUMENT_PENDING",t.ARCHIVE_PAPER_DOCUMENT_ROLLBACK="ARCHIVE_PAPER_DOCUMENT_ROLLBACK",t.DELETE_FILES_COMMIT="DELETE_FILES_COMMIT",t.DELETE_FILES_PENDING="DELETE_FILES_PENDING",t.DELETE_FILES_ROLLBACK="DELETE_FILES_ROLLBACK",t.RAW_RECENT_ACTIVITY_PARSE_ERROR="RAW_RECENT_ACTIVITY_PARSE_ERROR",t.RAW_RELATED_ACTIVITY_PARSE_ERROR="RAW_RELATED_ACTIVITY_PARSE_ERROR",t.RECEIVE_CAN_OPEN_INFO="RECEIVE_CAN_OPEN_INFO",t.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO="RECEIVE_FILE_IN_ROOT_COLLECTION_INFO",t.RECEIVE_PAPER_RECENT_ITEMS="RECEIVE_PAPER_RECENT_ITEMS",t.RECEIVE_RAW_RECENT_ACTIVITIES="RECEIVE_RAW_RECENT_ACTIVITIES",t.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY="RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY",t.REFRESH_RECENT_ACTIVITIES="REFRESH_RECENT_ACTIVITIES",t.ADD_PENDING_ACTIVITY_KEYS="ADD_PENDING_ACTIVITY_KEYS",t.REMOVE_PENDING_ACTIVITY_KEYS="REMOVE_PENDING_ACTIVITY_KEYS",t.MAX_INITIAL_DOC_ATTACHMENTS=3,t.SHOW_MORE_DOC_ATTACHMENT_INCREMENT=10,t.MAX_INITIAL_THUMBNAIL_ATTACHMENTS=8,t.SHOW_MORE_THUMBNAIL_ROW_INCREMENT=4,(function(e){e.CREATED="CREATE",e.OPENED="VIEW",e.EDITED="EDIT"})(t.PaperRecentItemAction||(t.PaperRecentItemAction={})),t.PaperRecentItemTypes={DOCUMENT:"DOCUMENT",FOLDER:"FOLDER",PROJECT:"PROJECT"},t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI=10,t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI=100,t.MAX_ENSURE_ATTACHMENT_LOAD_ATTACHMENTS_ATTEMPTS=1,(function(e){e.OPENED="OPENED",e.EDITED="EDITED",e.ADDED="ADDED"})(t.RecentItemActionType||(t.RecentItemActionType={})),t.I18N={OPENED:o.intl.formatMessage({id:"xPH1sd",defaultMessage:"Opened"}),EDITED:o.intl.formatMessage({id:"l46MMy",defaultMessage:"Edited"}),ADDED:o.intl.formatMessage({id:"toc0wl",defaultMessage:"Added"})},(function(e){e.COMMENT="comment",e.DELETE="delete",e.DOWNLOAD="download",e.HIDE="hide",e.OPEN="open",e.OPEN_DIR="open_dir",e.OPEN_PATH="open_path",e.PAPER_ARCHIVE="paper_archive",e.PAPER_OPEN="paper_open",e.PAPER_SHARE="paper_share",e.REPORT_JUNK="report_junk",e.SHARE="share",e.SHARE_COLLECTION="share_collection",e.UNITY_OPEN="unity_open",e.VERSIONS="versions",e.VIEW_FILE="view",e.VIEW_SHARED_LINK="view_shared_link",e.VIEW_IN_FOLDER="view_in_folder",e.COLLAPSE="collapse",e.UNCOLLAPSE="uncollapse"})(t.ActionType||(t.ActionType={})),(function(e){e.SINGLE="single",e.SUBSET="subset",e.AGGREGATION="aggregation"})(t.ActionScope||(t.ActionScope={})),(function(e){e.RECENTS_JSON_CONTINUATION="handleAndLogRecentsJson",e.SHARE_FILE="shareFile",e.PREVIEW_RECENT_ITEM="previewRecentItem",e.OPEN_FILE="openFile",e.DOWNLOAD_FILES="downloadFiles",e.OPEN_VERSIONS="openVersions",e.PROMPT_AND_DELETE_ATTACHMENTS="promptAndDeleteAttachments",e.LOAD_REMAINING_ATTACHMENTS="loadRemainingAttachments"})(t.EnsureAttachmentsPurpose||(t.EnsureAttachmentsPurpose={}))})),define("modules/clean/react/home/recents/recent_activity_dispatcher",["require","exports","flux"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recentActivityDispatcher=void 0,t.recentActivityDispatcher=new i.Dispatcher})),define("modules/clean/react/home/recents/recent_activity_federated_model",["require","exports","modules/clean/react/home/recents/recent_activity_constants"],(function(e,t,i){"use strict";function n(e){return e.paperRecentItem.type===i.PaperRecentItemTypes.DOCUMENT}function o(e){return n(e)&&e.paperRecentItem.shareUrl||""}Object.defineProperty(t,"__esModule",{value:!0}),t.FederatedRecentItem=t.equalsPaperRecentItem=t.getPaperShareUrl=t.isPaperProject=t.isPaperDocument=void 0,t.isPaperDocument=n,t.isPaperProject=function(e){return e.paperRecentItem.type===i.PaperRecentItemTypes.PROJECT},t.getPaperShareUrl=o,t.equalsPaperRecentItem=function(e,t){return e.paperRecentItem.id===t.id&&e.paperRecentItem.type===t.type};t.FederatedRecentItem=class{constructor(e){this.paperRecentItem=e}isShareable(){return n(this)&&Boolean(o(this))}isArchiveable(){return n(this)&&Boolean(this.paperRecentItem.isEditable)}hasMenuActions(){return this.isArchiveable()}getIdTypePair(){return{id:this.paperRecentItem.resource_id,type:this.paperRecentItem.id_type}}getStarredStatus(){return{starred:this.paperRecentItem.isFavorite,idTypePair:this.getIdTypePair()}}getIcon(){switch(this.paperRecentItem.display_type){case"PAPER_DOCUMENT":return"paper_doc";case"PAPER_FOLDER":return"folder";case"PAPER_PUBLIC_FOLDER":return"folder_team";case"PAPER_PROJECT":return"paper_project";default:return"file"}}getDisplayType(){return this.paperRecentItem.display_type}getIsDir(){return!1}getFolderPath(){return[""].concat(this.paperRecentItem.path.map(e=>e.name)).join("/")}getFqPath(){return`${this.getFolderPath()}/${this.paperRecentItem.name}`}getActivityKey(){return`paper_id_${this.paperRecentItem.id}`}getUrl(){return this.paperRecentItem.url}}})),define("modules/clean/react/home/recents/recent_activity_logger_utils",["require","exports","tslib","modules/clean/web_timing_logger"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onLogFirstAction=t.canLogFirstAction=t.reset=t.getRecentsLoggingData=void 0,n=i.__importStar(n);let o=!1,s=!1;t.getRecentsLoggingData=function(){if(!s){const e=n.start_time();if(e)return s=!0,{isFullPage:!0,startTime:e}}return{isFullPage:!1,startTime:Date.now()}},t.reset=function(){s=!1,o=!1},t.canLogFirstAction=function(){return!o},t.onLogFirstAction=function(){o=!0}})),define("modules/clean/react/home/recents/recent_activity_stream",["require","exports","tslib","lodash","modules/clean/react/home/recents/models/utils"],(function(e,t,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMergedRecentItems=t.RecentActivityStream=void 0,n=i.__importStar(n);class s{constructor(e,t){this.sortedRecentItems=e,this.hasMore=t,this.activityKeyToRecentItem={},e.forEach(e=>{this.activityKeyToRecentItem[e.id]=e}),this.oldestTimeForOtherStream=this.getOldestItemTimeForOtherStreams()}getOldestItemTimeForOtherStreams(){return this.hasMore&&this.sortedRecentItems.length&&this.sortedRecentItems[this.sortedRecentItems.length-1].when||0}getRecentItems(){return this.sortedRecentItems.slice()}getRecentItemByActivityKey(e){return this.activityKeyToRecentItem[e]||null}getStreamWithoutActivityKey(e){return new s(this.sortedRecentItems.filter(t=>t.id!==e),this.hasMore)}getItemsAfter(e){if(this.oldestTimeForOtherStream<e){const t=[];for(const i of this.sortedRecentItems){if(i.when<e)break;t.push(i)}return t}return this.sortedRecentItems}}t.RecentActivityStream=s,t.getMergedRecentItems=function(e){const t=e.filter(Boolean),i=n.max(t.map(e=>e.oldestTimeForOtherStream));return[].concat(...t.map(e=>e.getItemsAfter(i))).sort(o.compareRecentItems)}})),define("modules/clean/react/home/recents/recent_activity_text_helper",["require","exports","modules/clean/em_string","modules/core/i18n"],(function(e,t,i,n){"use strict";function o(e,t){return n.intl.formatMessage({id:"650lWu",defaultMessage:"{count, plural, one{{name} and {count} other} other{{name} and {count} others}}"},{count:t,name:e})}Object.defineProperty(t,"__esModule",{value:!0}),t.snippetList=void 0,t.snippetList=function(e,t,s={}){const a=Math.max(Math.floor(s.totalCount||0),e.length);if(1===a)return i.Emstring.em_snippet(e[0],t);{const s=e[0],r=a-1;let c=o(s,r);if(new i.Emstring(c).length>t){const e=Math.floor(t-new i.Emstring(o("",r)).length)-1;c=e<3?n.intl.formatMessage({id:"aNHFm3",defaultMessage:"{count, plural, one{{count} other} other{{count} others}}"},{count:a}):o(i.Emstring.em_snippet(s,e),r)}let l="",d=1;for(;d<e.length&&(d+=1,l=e.slice(0,d).join(", "),d<a&&(l=o(l,a-d)),new i.Emstring(l).length<t);)c=l;return c}}})),define("modules/clean/react/home/recents/store_utils",["require","exports","tslib","modules/clean/react/home/store","modules/clean/react/home/recents/recent_activity_dispatcher","modules/clean/react/home/recents/recent_activity_logger_utils","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/models/utils","modules/clean/react/home/recents/recent_activity_client_utils"],(function(e,t,i,n,o,s,a,r,c){"use strict";function l(e,t){return i.__awaiter(this,void 0,void 0,(function*(){try{return yield t()}catch(t){throw e().then(({logRequestFailed:e})=>e(n.getUserId(),t)),t}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.handleRetrievePaperRecentsPromise=t.logErrorAndRethrowAsync=t.handleAndLogRecentsJsonPromise=void 0,t.handleAndLogRecentsJsonPromise=function(e,t,d=!0){try{const m=s.getRecentsLoggingData(),{recent_activities:u,cursor:h,encrypted:_,use_assistant_service:p}=c.getPayload(t),E=n.getUserId(),T=[],g=[];return u.forEach(e=>{c.isPaperRecentItem(e)?T.push(e):c.isSFJRecentItem(e)&&g.push(e)}),p&&o.recentActivityDispatcher.dispatch({type:a.RECEIVE_PAPER_RECENT_ITEMS,items:T,hasMore:!1,userId:E}),o.recentActivityDispatcher.dispatch({type:a.RECEIVE_RAW_RECENT_ACTIVITIES,rawRecentActivities:g,cursor:h||"",encrypted:_||"",userId:E}),l(e,()=>i.__awaiter(this,void 0,void 0,(function*(){let t=[];g.forEach(e=>{if(e.skeleton_data&&e.related_activity_keys){const i=r.shouldShowThumbnailsForSkeletonData(e.skeleton_data)?a.MAX_INITIAL_THUMBNAIL_ATTACHMENTS:a.MAX_INITIAL_DOC_ATTACHMENTS;t=t.concat(...e.related_activity_keys.slice(0,i))}}),yield(yield e()).ensureAttachments(t,a.EnsureAttachmentsPurpose.RECENTS_JSON_CONTINUATION);let i=!1,n=0;g.forEach(({skeleton_data:e})=>{e&&(n+=e.num_related_activities||0,(e.num_related_activities||0)>1&&(i=!0))}),e().then(({logRecentsLoaded:e})=>e(E,m,{is_paginated:!d,contains_aggregation:i,item_count:n}))})))}catch(t){throw e().then(({logRequestFailed:e})=>e(n.getUserId(),t)),t}},t.logErrorAndRethrowAsync=l,t.handleRetrievePaperRecentsPromise=function(e,t,i=!0){const s=n.getUserId(),r=c.getPayload(t);if(!r.use_assistant_service){const t=i&&r.has_more;o.recentActivityDispatcher.dispatch({type:a.RECEIVE_PAPER_RECENT_ITEMS,items:r.items,hasMore:t,userId:s}),t&&e().then(({loadPaperRecentItems:e})=>e(!1))}}})),define("modules/clean/react/home/recents/stores/attachment_store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/constants","lodash","modules/clean/react/home/resource/store","modules/clean/flux/flux_store","modules/clean/react/home/recents/actions/error_actions","modules/clean/react/home/recents/stores/flux_utils","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/recent_activity_dispatcher","modules/clean/react/home/recents/models/attachment","modules/core/assert"],(function(e,t,i,n,o,s,a,r,c,l,d,m,u,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAttachmentStore=t.AttachmentStore=void 0,s=i.__importStar(s);class _ extends r.FluxStore{constructor(e,t={}){super(e),this.onCommit=e=>{delete this.transactionHistory[e.transactionId]},this._onDeleteFilesPending=e=>{const t=[];for(const i of e.attachmentIds)i in this.attachmentIdToAttachment&&(t.push(this.attachmentIdToAttachment[i]),delete this.attachmentIdToAttachment[i]);this.transactionHistory[e.transactionId]={deletedAttachments:t},l.emitChangeIfNeeded(this,!!t.length)},this._onDeleteFilesRollback=e=>{const t=this.transactionHistory[e.transactionId];h.assert(!!t,`Unable to find data for transaction with id: ${e.transactionId}`),t.deletedAttachments.forEach(e=>this.attachmentIdToAttachment[e.id]=e),l.emitChangeIfNeeded(this,!!t.deletedAttachments.length)},this.pendingActivityKeys=[],this.attachmentIdToEncryptedToken={},this.attachmentIdToAttachment={},(t.attachments||[]).forEach(e=>{this.attachmentIdToAttachment[e.id]=e,t.encryptedToken&&(this.attachmentIdToEncryptedToken[e.id]=t.encryptedToken)}),this.transactionHistory={}}areSomeActivityKeysPending(e){return!!s.intersection(this.pendingActivityKeys,e).length}getById(e){return this.attachmentIdToAttachment[e]||null}getByIds(e){return s.values(s.pick(this.attachmentIdToAttachment,e))}getByFqPath(e){return this.getAll().find(t=>t.fqPath===e)||null}getAll(){return s.values(this.attachmentIdToAttachment)}groupIdsByEncryptedToken(e){return s.groupBy(e.filter(e=>e in this.attachmentIdToEncryptedToken),e=>this.attachmentIdToEncryptedToken[e])}__onDispatch(e){switch(e.type){case d.ADD_PENDING_ACTIVITY_KEYS:this.onAddPendingActivityKeys(e);break;case d.REMOVE_PENDING_ACTIVITY_KEYS:this.onRemovePendingActivityKeys(e);break;case d.DELETE_FILES_COMMIT:this.onCommit(e);break;case d.DELETE_FILES_PENDING:this._onDeleteFilesPending(e);break;case d.DELETE_FILES_ROLLBACK:this._onDeleteFilesRollback(e);break;case d.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case d.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case d.RECEIVE_CAN_OPEN_INFO:this.onReceiveCanOpenInfo(e);break;case d.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:this._onReceiveFileInRootCollectionInfo(e)}}mutateAttachmentInNsIdPath(e,t){if(e&&e.indexOf(":")>=0){const[i,n]=e.split(":"),o=this.getAll().find(e=>e.nsId===Number(i)&&e.nsPath===n)||null;if(o){const e=l.getMutatedOrOriginal(o,t);if(e!==o)return this.attachmentIdToAttachment[o.id]=e,!0}}return!1}updatePendingActivityKeys(e,t){const i=this.pendingActivityKeys.length;if(t){const t=this.pendingActivityKeys.concat(...e);this.pendingActivityKeys=s.uniq(t)}else this.pendingActivityKeys=s.without(this.pendingActivityKeys,...e);l.emitChangeIfNeeded(this,i!==this.pendingActivityKeys.length)}onAddPendingActivityKeys(e){this.updatePendingActivityKeys(e.activityKeys,!0)}onRemovePendingActivityKeys(e){this.updatePendingActivityKeys(e.activityKeys,!1)}onReceiveRawRecentActivities(e){const t=e.rawRecentActivities.map(u.createPartialAttachmentsFromRecentActivity),i=[].concat(...t).filter(e=>{const t=this.getById(e.id);return!t||!t.isLoaded});i.forEach(t=>{this.attachmentIdToAttachment[t.id]=t,this.attachmentIdToEncryptedToken[t.id]=e.encrypted}),l.emitChangeIfNeeded(this,!!i.length)}onReceiveRawRelatedActivitiesByKey(e){if(e.rawRelatedActivitiesByKey){const t=Object.keys(e.rawRelatedActivitiesByKey);this.updatePendingActivityKeys(t,!1);const i={};l.iterateAndEmitChangesIfNeeded(this,e.rawRelatedActivitiesByKey,(e,t)=>{try{const t=u.convertFileActivityToAttachmentItem(e);return t.previewInfo&&!t.previewInfo.is_dir&&(i[t.id]=t.previewInfo),this.attachmentIdToAttachment[t.id]=t,!0}catch(e){return s.defer(()=>c.errorActions.relatedActivityParseError(t,e)),!1}}),setTimeout(()=>{a.getHomeResourceStore(),n.Dispatcher.dispatch({type:o.HomeResourceStoreActionTypes.RECEIVED_RESOURCE_ID_TO_FILE,resourceIdToFile:i})})}}onReceiveCanOpenInfo(e){l.iterateAndEmitChangesIfNeeded(this,e.canOpenInfo,(e,t)=>this.mutateAttachmentInNsIdPath(t,{canOpen:e.is_locally_available}))}_onReceiveFileInRootCollectionInfo(e){l.iterateAndEmitChangesIfNeeded(this,e.fileInRootCollectionInfo,(e,t)=>this.mutateAttachmentInNsIdPath(t,{inRootCollection:e}))}}t.AttachmentStore=_;let p=null;t.getAttachmentStore=function(){return null===p&&(p=new _(m.recentActivityDispatcher)),p}})),define("modules/clean/react/home/recents/stores/flux_utils",["require","exports"],(function(e,t){"use strict";function i(e,t){t&&e.__emitChange()}Object.defineProperty(t,"__esModule",{value:!0}),t.getMutatedOrOriginal=t.emitChangeIfNeeded=t.iterateAndEmitChangesIfNeeded=void 0,t.iterateAndEmitChangesIfNeeded=function(e,t,n){let o=!1;Object.keys(t).forEach(e=>{n(t[e],e)&&(o=!0)}),i(e,o)},t.emitChangeIfNeeded=i,t.getMutatedOrOriginal=function(e,t){for(const i in t)if(t[i]!==e[i])return Object.assign(Object.assign({},e),t);return e}})),define("modules/clean/react/home/recents/stores/recent_activity_store",["require","exports","tslib","lodash","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/recents/models/federated_recent_item","modules/clean/react/home/recents/recent_activity_dispatcher","modules/clean/react/home/recents/models/recent_item","modules/clean/react/home/recents/models/utils","modules/clean/react/home/recents/stores/flux_utils","modules/clean/react/home/recents/stores/attachment_store","modules/clean/react/home/store","modules/core/assert","modules/clean/react/home/recents/recent_activity_stream","modules/clean/react/home/post_tti/api","modules/clean/viewer","modules/clean/react/home/constants","modules/clean/react/home/util/logging/availability_logger","modules/clean/react/home/recents/store_utils","modules/clean/flux/flux_store"],(function(e,t,i,n,o,s,a,r,c,l,d,m,u,h,_,p,E,T,g,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRecentActivityStore=t.RecentActivityStore=void 0,n=i.__importStar(n);class R extends I.FluxStore{constructor(e,t=[]){super(e),this.removeFileSyncItem=e=>{this.fileSyncRecentItemIdToRecentItem.hasOwnProperty(e.id)&&(delete this.fileSyncRecentItemIdToRecentItem[e.id],this.needsToRefreshFileSyncCache=!0)},this.addFileSyncItem=e=>{e!==this.fileSyncRecentItemIdToRecentItem[e.id]&&(this.fileSyncRecentItemIdToRecentItem[e.id]=e,this.needsToRefreshFileSyncCache=!0)},this.fileSyncRecentItemIdToRecentItem={},this.fileSyncCursor=null,this.fileSyncTransactionIdToRestoreData={},this.didReceiveRawRecentActivities=!!t.length,t.forEach(this.addFileSyncItem),this.fileSyncCache={items:t},this.needsToRefreshFileSyncCache=!1;const i=m.getHomeStore().getSectionLoadingPreference(E.ConditionalSections.PAPER_RECENTS)===E.ConditionalSectionLoadingPreference.POST_TTI;this.paperStream=i?new h.RecentActivityStream([],!1):null,this.didRecievePaperItems=i,this.paperActivityKeyToPendingArchiving={},this.cachedFederatedRecentItems=[],this.cachedFederatedTruncatedRecentItems=[],this.federatedRecentItemsCountMax=o.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI,this.cachedProcessedRecentItems=null,_.waitForHomeTTI().then(()=>{this.federatedRecentItemsCountMax=o.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI,this.didTruncateRecentItems()&&(this.cacheTruncatedFederatedRecentItems(),this.cachedProcessedRecentItems=null)}),d.getAttachmentStore(),T.getHomeAvailabilityLogger().handlePrefetch(E.HomePrefetchTypes.RECENTS_JSON,e=>g.handleAndLogRecentsJsonPromise(_.waitForHomeTTI,e))}getSortedFileSyncRecentItems(){return this.fileSyncCache.sortedItems||(this.fileSyncCache.sortedItems=this.fileSyncCache.items.slice().sort(c.compareRecentItems)),this.fileSyncCache.sortedItems}__onDispatch(e){this.fileSyncHandler(e)||this.paperHandler(e)}fileSyncHandler(e){switch(e.type){case o.DELETE_FILES_COMMIT:this.onDeleteCommit(e);break;case o.DELETE_FILES_PENDING:this.onDeleteFilesPending(e);break;case o.DELETE_FILES_ROLLBACK:this.onDeleteFilesRollback(e);break;case o.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case o.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case o.RAW_RELATED_ACTIVITY_PARSE_ERROR:this.onRawRelatedActivityParseError(e);break;case o.REFRESH_RECENT_ACTIVITIES:this.onRefreshRecentActivities();break;default:return!1}return this.updateFileSyncCache(!0),!0}paperHandler(e){switch(e.type){case o.RECEIVE_PAPER_RECENT_ITEMS:this.onReceivePaperRecentItems(e.items,e.hasMore,e.userId);break;case o.ARCHIVE_PAPER_DOCUMENT_PENDING:this.onArchivePaperDocumentPending(e.activityKey);break;case o.ARCHIVE_PAPER_DOCUMENT_COMMIT:this.onArchivePaperDocumentCommit(e.activityKey);break;case o.ARCHIVE_PAPER_DOCUMENT_ROLLBACK:this.onArchivePaperDocumentRollback(e.activityKey);break;default:return}this.__emitChange()}updateFileSyncCache(e){this.needsToRefreshFileSyncCache?(this.fileSyncCache={items:n.values(this.fileSyncRecentItemIdToRecentItem)},this.clearFederatedCache(),this.needsToRefreshFileSyncCache=!1,l.emitChangeIfNeeded(this,e)):l.emitChangeIfNeeded(this,!this.cachedProcessedRecentItems)}onDeleteCommit(e){delete this.fileSyncTransactionIdToRestoreData[e.transactionId]}onReceiveRawRecentActivities(e){l.emitChangeIfNeeded(this,!this.didReceiveRawRecentActivities&&!e.rawRecentActivities.length),this.didReceiveRawRecentActivities=!0;const t=!this.fileSyncCache.items.length,i=[],s={};if(e.rawRecentActivities.forEach(a=>{if(!a.viewing_user||a.viewing_user.id!==e.userId)return;const c=r.convertRecentActivityToRecentItem(a);if(c&&(c.uniqueFilterTypes.indexOf(o.RECENT_EVENT_FILTER_TYPE.JUNK)<0||c.uniqueFilterTypes.indexOf(o.RECENT_EVENT_FILTER_TYPE.ALL)>=0))if(i.push(a),t)this.fileSyncRecentItemIdToRecentItem[c.id]=c;else if(!s[c.id]){s[c.id]=c;const e=this.fileSyncCache.items.find(e=>e.id!==c.id&&e.contextDisplayName===c.contextDisplayName);if(e){n.intersection(e.attachmentIds,c.attachmentIds).length>0&&(this.removeFileSyncItem(e),this.updateFileSyncCache(!1))}const t=this.fileSyncRecentItemIdToRecentItem[c.id];this.updateFileSyncItem(c,{fqPath:t&&t.fqPath||void 0,paths:t&&t.paths||c.paths})}}),_.waitForHomeTTI().then(e=>e.fetchStarredStatus(i)),this.updateFileSyncCache(!1),!t){const e={};this.getSortedFileSyncRecentItems().forEach(t=>{if(t.attachmentIds.length>0){const i=Object.keys(e).length;t.attachmentIds.forEach(t=>e[t]=!0),i===Object.keys(e).length&&this.removeFileSyncItem(t)}})}this.fileSyncCursor=e.cursor,this.needsToRefreshFileSyncCache=!0}onReceiveRawRelatedActivitiesByKey(e){this.waitForAttachmentStoreDispatcher();const t=Object.keys(e.rawRelatedActivitiesByKey||{});t.length&&this.clearFederatedCache(),this.getFileSyncRecentItemsByAttachmentIds(t).forEach(({id:e})=>{const t=this.fileSyncRecentItemIdToRecentItem[e];if(!t)return;const i=t.attachmentIds;if(!i||!i.length)return;const n=d.getAttachmentStore().getById(i[0]);if(!n||!n.isLoaded)return;let o=n.fqPath||"";i.slice(1).forEach(e=>{const t=d.getAttachmentStore().getById(e);if(!t.isLoaded)return;const i=t.fqPath||"";i.split("/").length<o.split("/").length&&(o=i)});const s=o.split("/"),a=s[s.length-2];this.updateFileSyncItem(t,{fqPath:o,paths:c.getPathsByFqPath(o,t.viewingUserId),contextDisplayName:a||t.contextDisplayName}),n.displayType||(n.displayType=t.displayType)})}onRawRelatedActivityParseError(e){this.getFileSyncRecentItemsByAttachmentIds(n.map(e.errors,"activityKey")).forEach(this.removeFileSyncItem)}onDeleteFilesPending(e){this.waitForAttachmentStoreDispatcher();const t=this.deleteAttachments(e.attachmentIds);t&&(this.fileSyncTransactionIdToRestoreData[e.transactionId]=t)}onDeleteFilesRollback(e){this.waitForAttachmentStoreDispatcher();const t=this.fileSyncTransactionIdToRestoreData[e.transactionId];u.assert(!!t,`Unable to find data for transaction with id: ${e.transactionId}`),delete this.fileSyncTransactionIdToRestoreData[e.transactionId],this.rollbackDelete(t)}onRefreshRecentActivities(){this.getUnprocessedRecentItems(),this.didReceiveRawRecentActivities=!1,this.didRecievePaperItems=!1}deleteAttachments(e){let t=null;if(e.length){const i=this.getFileSyncRecentItemsByAttachmentIds([e[0]])[0];if(i){const o=n.difference(i.attachmentIds,e);this.updateFileSyncItem(i,{attachmentIds:o}),t={deletedAttachmentIds:e,item:i},0===o.length&&this.removeFileSyncItem(i)}}return t}rollbackDelete(e){let t,i=this.fileSyncRecentItemIdToRecentItem[e.item.id];i?t=i.attachmentIds:(i=e.item,t=[]),this.updateFileSyncItem(i,{attachmentIds:n.uniq(t.concat(...e.deletedAttachmentIds))})}getCachedAttachmentIdToIdToFileSyncItem(){return this.fileSyncCache.attachmentIdToIdToItem||(this.fileSyncCache.attachmentIdToIdToItem={},this.fileSyncCache.items.forEach(e=>e.attachmentIds.forEach(t=>{this.fileSyncCache.attachmentIdToIdToItem[t]?this.fileSyncCache.attachmentIdToIdToItem[t][e.id]=e:this.fileSyncCache.attachmentIdToIdToItem[t]={[e.id]:e}}))),this.fileSyncCache.attachmentIdToIdToItem}getFileSyncRecentItemsByAttachmentIds(e){const t=this.getCachedAttachmentIdToIdToFileSyncItem(),i={};return e.forEach(e=>{t.hasOwnProperty(e)&&n.values(t[e]).forEach(e=>i[e.id]=e)}),n.values(i)}waitForAttachmentStoreDispatcher(){this.getDispatcher().waitFor([d.getAttachmentStore().getDispatchToken()])}updateFileSyncItem(e,t){this.addFileSyncItem(l.getMutatedOrOriginal(e,t))}onArchivePaperDocumentPending(e){this.paperActivityKeyToPendingArchiving[e]=!0}onArchivePaperDocumentCommit(e){this.deletePendingArchive(e),this.paperStream=this.paperStream.getStreamWithoutActivityKey(e),this.clearFederatedCache()}onArchivePaperDocumentRollback(e){this.deletePendingArchive(e)}deletePendingArchive(e){this.paperActivityKeyToPendingArchiving[e]&&delete this.paperActivityKeyToPendingArchiving[e]}onReceivePaperRecentItems(e,t,i){this.didRecievePaperItems=!0;const n=p.Viewer.get_viewer().get_user_by_id(i),o=e.map((e,t)=>s.createRecentItemFromPaperRecentItem(e,n,t));this.paperStream=new h.RecentActivityStream(o,t),_.waitForHomeTTI().then(t=>t.setStarredStatusOfPaperRecentItems(e)),this.clearFederatedCache()}clearFederatedCache(){this.cachedFederatedRecentItems&&this.didReceiveItemsFromAllStreams()&&(this.__emitChange(),this.cachedFederatedRecentItems=null,this.cachedFederatedTruncatedRecentItems=null,this.cachedProcessedRecentItems=null)}cacheTruncatedFederatedRecentItems(){this.cachedFederatedRecentItems?this.cachedFederatedTruncatedRecentItems=this.cachedFederatedRecentItems.slice(0,this.federatedRecentItemsCountMax):this.getUnprocessedRecentItems()}getUnprocessedRecentItems(){if(null===this.cachedFederatedRecentItems){const e=[this.paperStream,new h.RecentActivityStream(this.getSortedFileSyncRecentItems(),!!this.fileSyncCursor)];this.cachedFederatedRecentItems=h.getMergedRecentItems(e),this.cacheTruncatedFederatedRecentItems()}return this.cachedFederatedTruncatedRecentItems}getFileSyncCursor(){return this.fileSyncCursor}canArchiveActivityKey(e){if(this.paperStream&&!this.paperActivityKeyToPendingArchiving[e]){const t=this.paperStream.getRecentItemByActivityKey(e);return!(!t||!t.federatedRecentItem.isArchiveable())}return!1}didReceiveItemsFromAllStreams(){return this.didRecievePaperItems&&this.didReceiveRawRecentActivities}getRecentItems(){return null===this.cachedProcessedRecentItems&&(this.cachedProcessedRecentItems=this.getUnprocessedRecentItems()),{items:this.cachedProcessedRecentItems}}didTruncateRecentItems(){return!!(this.cachedFederatedRecentItems&&this.cachedFederatedTruncatedRecentItems&&this.cachedFederatedTruncatedRecentItems.length<this.cachedFederatedRecentItems.length)}}t.RecentActivityStore=R;let f=null;t.getRecentActivityStore=function(){return null===f&&(f=new R(a.recentActivityDispatcher)),f}})),define("modules/clean/react/home/recents/utils/events",["require","exports","tslib","lodash","react-dom","modules/clean/react/home/recents/recent_activity_constants","modules/clean/react/home/util/logging/activity_logger","modules/clean/react/home/resource_id_types"],(function(e,t,i,n,o,s,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logFederatedItemEvent=t.logEvent=void 0,n=i.__importStar(n),o=i.__importStar(o);const c=e=>e?Array.prototype.indexOf.call(e.parentNode.childNodes,e):0,l=(e,t,i,n)=>e===s.ActionScope.AGGREGATION?i.props.recentItem?0:t+1:e===s.ActionScope.SUBSET?n.classList.contains("recents-item")?0:1:0,d=(e,t,i,a,d)=>{const m=(e=>n.filter(e,e=>!!e.fqPath))(i),u=(e=>n.map(e,e=>e.fqPath))(m),h=o.findDOMNode(t),_=((e,t)=>1===e?s.ActionScope.SINGLE:t.length===e?s.ActionScope.AGGREGATION:s.ActionScope.SUBSET)(a,u),p=((e,t)=>{const i=e[t];return i&&i.previewInfo?i.previewInfo.icon:""})(i,d||0);return{actionTaken:e,scope:_,itemNumber:c(h),fileDetails:((e,t,i,n)=>{if(e===s.ActionScope.AGGREGATION||t===s.ActionType.COLLAPSE||t===s.ActionType.UNCOLLAPSE)return{};const o=i[n];if(!o)return{};for(const e of["PAPER","EXTERNAL"])if(o.displayType&&o.displayType.indexOf(e)>=0)return{idType:void 0,resourceId:void 0};return{idType:r.HOME_RESOURCE_ID_TYPE.FQ_PATH,resourceId:o.fqPath,displayType:o.displayType,isDir:o.isDir}})(_,e,m,d||0),sprite:p,subgroupPosition:l(_,d||0,t,h)}};t.logEvent=function(e,t,i,n,o,s){const r=d(e,t,i,n,o);return a.homeActivityLogger.logRecentsAction(r.actionTaken,r.scope,r.itemNumber,r.sprite,r.fileDetails.displayType||"",!!r.fileDetails.isDir,r.subgroupPosition,r.fileDetails.idType,r.fileDetails.resourceId,s)},t.logFederatedItemEvent=function(e,t,i){const n=o.findDOMNode(t),r=i.getIdTypePair();return a.homeActivityLogger.logRecentsAction(e,s.ActionScope.SINGLE,c(n),i.getIcon(),i.getDisplayType(),i.getIsDir(),l(s.ActionScope.SINGLE,0,t,n),r.type,r.id)}})),define("modules/clean/react/home/resource/store",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/clean/react/starred/constants","modules/clean/react/starred/id_type_pair","modules/clean/flux/flux_store"],(function(e,t,i,n,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHomeResourceStore=t.HomeResourceStore=void 0;class r extends a.FluxStore{constructor(){super(i.Dispatcher),this.pendingPreviewResourceId=null,this.resourceIdToFile={},this.fileToPreview=null,this.resourceIdToEquivalentResourceId={}}getFileToPreview(){return this.fileToPreview}emitIfPendingFileExists(){if(null!==this.pendingPreviewResourceId){const e=this.resourceIdToEquivalentResourceId[this.pendingPreviewResourceId]||this.pendingPreviewResourceId;this.fileToPreview=this.resourceIdToFile[this.pendingPreviewResourceId]||this.resourceIdToFile[e]||null,null!==this.fileToPreview&&(this.pendingPreviewResourceId=null,this.__emitChange())}}onRequestPreview(e){this.pendingPreviewResourceId=e,this.emitIfPendingFileExists()}onReceivedResourceIdToFile(e){this.resourceIdToFile=Object.assign(Object.assign({},this.resourceIdToFile),e),this.emitIfPendingFileExists()}onStarredSetStatus(e){e.forEach(e=>{if(e.canonicalIdTypePair){const t=s.idTypePairToString(e.idTypePair),i=s.idTypePairToString(e.canonicalIdTypePair);t!==i&&(this.resourceIdToEquivalentResourceId[i]=t,this.resourceIdToEquivalentResourceId[t]=i)}}),this.emitIfPendingFileExists()}__onDispatch(e){const t=e.action;switch(t.type){case n.HomeResourceStoreActionTypes.REQUEST_PREVIEW:this.onRequestPreview(t.resourceId);break;case n.HomeResourceStoreActionTypes.RECEIVED_RESOURCE_ID_TO_FILE:this.onReceivedResourceIdToFile(t.resourceIdToFile);break;case o.StarredActionTypes.SET_STATUS:this.onStarredSetStatus(t.starredStatuses)}}}t.HomeResourceStore=r;let c=null;t.getHomeResourceStore=function(){return null===c&&(c=new r),c}})),define("modules/clean/react/home/roots/home_access_main",["require","exports","tslib","react","classnames","modules/clean/react/home/constants","modules/clean/react/home/store","modules/clean/react/home/util/conditional_components","modules/clean/react/home/recents/components/recent_activity_container","modules/clean/react/home/util/logging/availability_logger"],(function(e,t,i,n,o,s,a,r,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HomeAccessMain=void 0,n=i.__importDefault(n),o=i.__importDefault(o);class d extends n.default.PureComponent{constructor(e){super(e),this.outerFrame=e=>{this.element=e},this.updateWidth=()=>{this.setState({containerWidth:this.getWidth()})},this.onResize=()=>{window.requestAnimationFrame?window.requestAnimationFrame(this.updateWidth):setTimeout(this.updateWidth,250)},this.onHomeStoreUpdate=()=>this.setState(this.getStateFromStore()),this.state=this.getStateFromStore(),this.removeStoreListeners=a.getHomeStore().addListener(this.onHomeStoreUpdate)}componentDidMount(){this.updateWidth(),window.addEventListener("resize",this.onResize)}componentWillUnmount(){this.removeStoreListeners&&this.removeStoreListeners()}getStateFromStore(){const e=a.getHomeStore(),t=e.getPreTTIProps(),i=this.getHomeTeamFlags(t.expHomeSurfaceExistingTeams);return{sectionVisibility:e.getSectionVisibility(),canRenderAllHomeSections:e.canRenderAllHomeSections(),canRenderItems:e.canRenderItems(),containerWidth:this.getWidth(),pageType:e.getPageType(location.pathname),expHomeSurfaceExistingTeamsProps:i,useStarredActionBar:"ON"===t.homeStarredActionBar}}getHomeTeamFlags(e){return{showTeamsOnHomepageExperiment:(null==e?void 0:e.showTeamsOnHomepageExperiment)||!1,showTeamsLoadingState:(null==e?void 0:e.showTeamsLoadingState)||!1,numberOfTeams:(null==e?void 0:e.numberOfTeams)||0}}getWidth(){let e=1;return this.element&&this.element.getBoundingClientRect&&(e=this.element.getBoundingClientRect().width||1),e}render(){const{canRenderAllHomeSections:e,sectionVisibility:t,canRenderItems:i,pageType:a,expHomeSurfaceExistingTeamsProps:d,containerWidth:m}=this.state,{now:u}=this.props;if(e){const e=o.default({"home-access-sections":!0}),h=i,_=n.default.createElement(r.ConditionalRecommendedMembersView,{key:"recommended-members-view",isHiddenByUser:!t[s.HomeSections.RECOMMENDED_MEMBERS],canRenderItems:h,containerWidth:m}),p=n.default.createElement(r.ConditionalSuggestView,{key:"suggest-view",isHiddenByUser:!t[s.HomeSections.SUGGEST],containerWidth:m,canRenderItems:h,homeAvailabilityLogger:l.getHomeAvailabilityLogger()}),E=n.default.createElement(r.ConditionalStarredView,{key:"starred-view",isHiddenByUser:!t[s.HomeSections.STARRED],canRenderItems:h,pageType:a,useStarredActionBar:this.state.useStarredActionBar}),T=n.default.createElement(c.RecentActivityContainer,{key:"recent-activity-view",now:u,canRenderItems:h,isHiddenByUser:!t[s.HomeSections.RECENTS],showHeader:"HOME"===a,fullItemView:!0,showAll:"RECENTS"===a}),g=n.default.createElement(r.ConditionalTeamsView,{key:"teams-view",isHiddenByUser:!t[s.HomeSections.TEAMS],canRenderItems:h,showTeamsLoadingState:d.showTeamsLoadingState,showTeamsOnHomepageExperiment:d.showTeamsOnHomepageExperiment,numberOfTeams:Number(d.numberOfTeams)}),I=[n.default.createElement(r.ConditionalHomeInlineContentPromptView,{key:"prompt-view",canRenderItems:h}),g,_,p,T,E];return n.default.createElement("div",{className:"home",ref:this.outerFrame},n.default.createElement("main",{className:"home-access",role:"main"},n.default.createElement("div",{className:e,ref:"main"},I)))}return n.default.createElement("div",{ref:this.outerFrame})}}t.HomeAccessMain=d,d.displayName="HomeAccessMain"})),define("modules/clean/react/home/roots/home_access_web",["require","exports","tslib","dropbox/proto/js_init_data/home_web/home_access_web","modules/clean/flux/dispatcher","modules/clean/history","modules/clean/react/home/constants","modules/clean/react/home/post_tti/api","modules/clean/react/home/recents/stores/recent_activity_store","modules/clean/react/home/resource/store","modules/clean/react/home/roots/home_access_main","modules/clean/react/home/roots/sidebar","modules/clean/react/home/store","modules/clean/react/home/util/conditional_api","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/maestro/layout/header","modules/clean/react/maestro/layout/search","modules/clean/react/snackbar","modules/clean/react/snackbar_manager","modules/clean/web_timing_logger","modules/core/exception","modules/core/i18n","proto_utils/unpack","react","modules/constants/global_file_upload","react-intl","classnames"],(function(e,t,i,n,o,s,a,r,c,l,d,m,u,h,_,p,E,T,g,I,R,f,S,y,A,P,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RootComponent=t.HomeAccessWeb=void 0,s=i.__importDefault(s),I=i.__importStar(I),y=i.__importDefault(y),v=i.__importDefault(v);class C extends y.default.PureComponent{constructor(e){super(e),this.intervalHandle=null,this.snackbarManager=y.default.createRef(),this.closeFileViewerAsNeeded=e=>(t,i)=>{!i.preview&&e.isShown()&&e.close()},this.renderSidebar=e=>y.default.createElement(m.HomeSidebar,{isPostTTI:this.state.isPostTTI,responsive:e}),I.log_js_modules_application_code_start();const{preTtiProps:t,initialRole:i,initialSectionVisibility:n,sectionToConditionalData:o}=e;C.initializeHomeStores(i,n,o,t||a.DEFAULT_PRE_TTI_PROPS),this.state={now:new Date,isPostTTI:!1}}static initializeHomeStores(e,t,i,n){_.homeTimingLogger.activate(),u.getHomeStore();const s={role:e,sectionVisibility:t,preTTIProps:n,sectionToConditionalData:i};o.Dispatcher.dispatch({type:a.HomeActionTypes.INITIALIZE_STORE,payload:s}),l.getHomeResourceStore(),c.getRecentActivityStore(),h.waitForStarred(e=>e.getStarredResourceStore())}componentDidMount(){T.Snackbar.manager=this.snackbarManager.current,r.waitForHomeTTIWithProps().then(({imports:e,props:t})=>{this.setState({isPostTTI:!0}),this.intervalHandle=setInterval(()=>this.setState({now:new Date}),6e4),e.homeAccessWebComponentDidMount(t.maybeRenderTeamAdminModals)}),new Promise((t,i)=>{e(["modules/clean/react/file_viewer/controller"],t,i)}).then(i.__importStar).then(e=>s.default.add_callback(location.pathname,this.closeFileViewerAsNeeded(e)))}componentWillUnmount(){null!=this.intervalHandle&&clearInterval(this.intervalHandle)}getHomePageType(){return u.getHomeStore().getPageType(location.pathname)}render(){const{now:e}=this.state;let t="";switch(this.getHomePageType()){case"RECENTS":t=f.intl.formatMessage({id:"a0FTw9",defaultMessage:"Recents"});break;case"STARRED":t=f.intl.formatMessage({id:"X0i16w",defaultMessage:"Starred"});break;case"HOME":t=f.intl.formatMessage({id:"taNFWh",defaultMessage:"Home"})}return y.default.createElement(P.RawIntlProvider,{value:f.intl},y.default.createElement("div",{id:"page-content"},y.default.createElement(E.SearchChrome,{user:u.getUser(),embeddedAppRegion:y.default.createElement(d.HomeAccessMain,{now:e}),titleRegion:y.default.createElement(p.MaestroHeaderTitle,null,t),actionSidebarRegion:this.renderSidebar,searchBarProps:{searchVariant:"full-page"},wideSecondarySidebar:!0,chromeClass:"dig2--enabled",useMaestroPortal:!0,sidebarClass:v.default({"maestro-secondary-sidebar-full-width":"CONSOLIDATE_BUTTON"===A.FILE_UPLOAD_VARIANT})})),y.default.createElement(g.SnackbarManager,{ref:this.snackbarManager,getParentElement:g.SnackbarManager.getEmbeddedAppPagelet,useDigSnackbars:!0}),y.default.createElement("div",{id:"react-file-viewer"}))}}t.HomeAccessWeb=C,C.displayName="HomeAccessWeb",t.RootComponent=e=>{const t=S.unpackProto(e.encodedProto,n.home_web.HomeWebPageletProps),{webTimingLoggerServerContext:o}=t,s=i.__rest(t,["webTimingLoggerServerContext"]);return o?I.initialize({log_time_to_interactive:!0},o):R.reportException({err:new Error("Missing WebTimingLogger server context"),severity:"non-critical"}),y.default.createElement(C,Object.assign({},s))}})),define("modules/clean/react/home/roots/sidebar",["require","exports","tslib","classnames","lodash","react","dig-components/icons/src","modules/clean/css","modules/clean/react/actions_menu/view","modules/clean/react/browse/constants","modules/clean/react/file_uploader/file_uploader","modules/clean/react/continuous_onboarding/continuous_onboarding_loader","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/home/modals/async_home_modals","modules/clean/react/home/post_tti/api","modules/clean/react/home/recents/actions/recent_activity_actions","modules/clean/react/home/store","modules/clean/react/home/util/logging/activity_logger","modules/clean/sharing/wizard/async_wizard_modals","modules/clean/web_user_action_events","modules/clean/web_user_action_logger","modules/constants/global_file_upload","modules/core/i18n","modules/core/cancelable_promise"],(function(e,t,i,n,o,s,a,r,c,l,d,m,u,h,_,p,E,T,g,I,R,f,S,y,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HomeSidebar=void 0,n=i.__importDefault(n),o=i.__importStar(o),s=i.__importDefault(s);class P extends s.default.PureComponent{constructor(e){super(e),this.onHomeStoreUpdate=()=>{this.setState({isFileViewerOpen:T.getHomeStore().getIsFileViewerOpen()})},this.handleCreateNewFile=()=>{g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_CREATE_NEW_FILE)},this.handleUploadFiles=()=>{d.FileUploaderController.handleUploadButtonClick(!1),g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_UPLOAD_FILES)},this.handleUploadFolder=()=>{d.FileUploaderController.handleUploadButtonClick(!0),g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_UPLOAD_FOLDER)},this.handleCreateSharedFolder=()=>i.__awaiter(this,void 0,void 0,(function*(){f.WebUserActionLog.log(T.getUserId(),R.WebUserActionLogEvent.NEW_SHARED_FOLDER_CLICK,{origin:l.CREATE_FOLDER_ACTION_ORIGIN_TYPE.HOME_NEW_FOLDER_MODAL}),I.asyncShowShareAFolderWizardModal(T.getUser(),e=>{g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_NEW_SHARED_FOLDER,e)})})),this.handleCreateFolder=()=>i.__awaiter(this,void 0,void 0,(function*(){_.asyncShowNewFolderModal({user:T.getUser(),origin:l.CREATE_FOLDER_ACTION_ORIGIN_TYPE.HOME_NEW_FOLDER_MODAL,onShowModal:e=>{g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_NEW_FOLDER,e)}})})),this.handleCreatePaperDoc=()=>{u.HomeActions.createPaperDocInNewTab(T.getUserId()),g.homeActivityLogger.logClickRightMenu(h.LoggingTypes.CLICK_CREATE_PAPER_DOC)},this.handleContinuousOnboardingChange=e=>{this.setState({isContinuousOnboardingOpen:e})},this.handleCreateAutomatedFolderModal=()=>{_.asyncShowCreateAutomatedFolderModal(this.getPath(),T.getUser())},this.onFileUploadComplete=o.throttle(E.refreshRecentItems,3500,{leading:!1,trailing:!0}),this.state={newFileMenuPostTTI:void 0,showLegacyCreatePaperButton:!1,isFileViewerOpen:T.getHomeStore().getIsFileViewerOpen(),isContinuousOnboardingOpen:!1,showFlowsAutomatedFolderButton:!1},this.removeStoreListeners=T.getHomeStore().addListener(this.onHomeStoreUpdate)}componentDidMount(){const e=this.isUploadAllowed();e&&d.FileUploaderController.setUser(T.getUser()),this.cancelablePromise=A.makeCancelable(p.waitForHomeTTIWithProps()),this.cancelablePromise.then(({props:t,imports:n})=>i.__awaiter(this,void 0,void 0,(function*(){e&&(d.FileUploaderController.loadCoreComponent(),r.require_css("/static/css/upload-vfl1NdGHp.css"));const{uploaderPostTTIExperiments:i,showLegacyCreatePaperButton:o,permissionsAtUploadModalProps:{autoTeamGroupId:s},expFlowsAutomatedFolderUI:a}=t,c="OFF"!==S.FILE_UPLOAD_VARIANT&&"CONTROL"!==S.FILE_UPLOAD_VARIANT,l=yield n.getNewFileMenu(t,c);this.setState({uploaderPostTTIExperiments:i,newFileMenuPostTTI:l,showFlowsAutomatedFolderButton:a,showLegacyCreatePaperButton:o,autoTeamGroupId:s})})))}componentWillUnmount(){var e;null===(e=this.cancelablePromise)||void 0===e||e.cancel(),this.removeStoreListeners&&this.removeStoreListeners()}getPath(){const{is_cdm_member:e,cdm_tmf_path:t}=T.getUser();return e?t:"/"}isLeftNavHidden(){const{responsive:e}=this.props;return e&&e.isResponsive&&!e.isMatchedLarge&&!e.isMatchedMedium}isUploadAllowed(){return!("OFF"!==S.FILE_UPLOAD_VARIANT&&"CONTROL"!==S.FILE_UPLOAD_VARIANT)||this.isLeftNavHidden()}isCreateAllowed(){return"CONSOLIDATE_BUTTON"!==S.FILE_UPLOAD_VARIANT||this.isLeftNavHidden()}render(){const e=y.intl.formatMessage({id:"8/w9ir",defaultMessage:"Create new file"}),t={buttonVariant:"OFF"!==S.FILE_UPLOAD_VARIANT&&"CONTROL"!==S.FILE_UPLOAD_VARIANT?"secondary":"primary",displayName:e,className:"action-create-file-primary-pretti",handleClick:this.handleCreateNewFile,subItems:void 0},i={displayName:y.intl.formatMessage({id:"Qayhb5",defaultMessage:"Upload files"}),popoverMenuName:y.intl.formatMessage({id:"bObFEu",defaultMessage:"Files"}),handleClick:this.handleUploadFiles,className:"action-upload-files",iconName:"upload-file",icon:a.UploadFileLine,key:"upload-files"},o={displayName:y.intl.formatMessage({id:"53oUlv",defaultMessage:"Upload folder"}),popoverMenuName:y.intl.formatMessage({id:"MLqiSW",defaultMessage:"Folder"}),handleClick:this.handleUploadFolder,className:"action-upload-folder",iconName:"upload-folder",icon:a.UploadFolderLine,key:"upload-folder"},r={displayName:y.intl.formatMessage({id:"+hJZUF",defaultMessage:"Create Paper doc"}),iconName:"new-paper-doc",icon:a.PaperDocLine,className:"action-new-paper-doc",handleClick:this.handleCreatePaperDoc},l=[];let d;d=this.state.newFileMenuPostTTI?this.state.newFileMenuPostTTI:t;const u=this.isUploadAllowed();u&&(l.push(i),l.push(o));const h=this.isCreateAllowed();if(h){const e={displayName:y.intl.formatMessage({id:"pxGZm3",defaultMessage:"New folder"}),iconName:"new-folder",icon:a.FolderLine,className:"action-new-folder",handleClick:this.handleCreateFolder,key:"new-folder"};l.push(e);const t={displayName:y.intl.formatMessage({id:"J9ZdWw",defaultMessage:"New shared folder"}),iconName:"new-shared-folder",icon:a.AddFolderLine,className:"action-new-shared-folder",handleClick:this.handleCreateSharedFolder,key:"new-shared-folder"};if(l.push(t),this.state.showLegacyCreatePaperButton&&l.push(r),this.state.showFlowsAutomatedFolderButton){const e={displayName:y.intl.formatMessage({id:"SGjV5E",defaultMessage:"New automated folder"}),iconName:"new-folder",icon:a.AutomationLine,className:"action-new-automated-folder",handleClick:this.handleCreateAutomatedFolderModal,key:"new-automated-folder"};l.push(e)}}const _=T.getUserId();return s.default.createElement("div",{className:"home-access-sidebar"},s.default.createElement("div",{className:n.default("home-access-sidebar__content",{"home-access-sidebar__content--hidden":this.state.isContinuousOnboardingOpen,"home-access-sidebar__with-top-margin":!this.isUploadAllowed()}),"aria-hidden":this.state.isContinuousOnboardingOpen},!this.state.isFileViewerOpen&&u&&s.default.createElement(p.LazyFileUploader,{autoTeamGroupId:this.state.autoTeamGroupId,isPostTTI:Boolean(this.props.isPostTTI),onFileUploadComplete:this.onFileUploadComplete,uploaderPostTTIExperiments:this.state.uploaderPostTTIExperiments,user:T.getUser()}),s.default.createElement(c.ActionsMenu,{responsive:this.props.responsive,primaryMenuItems:h?[d]:void 0,secondaryMenuItems:l,popoverTriggerLabel:y.intl.formatMessage({id:"w81jal",defaultMessage:"Actions"})})),s.default.createElement(m.ContinuousOnboardingLoadable,{userId:_,onExpandChange:this.handleContinuousOnboardingChange}))}}t.HomeSidebar=P,P.displayName="HomeSidebar"})),define("modules/clean/react/home/starred/starred_empty_layout",["require","exports","tslib","react","modules/clean/react/home/starred/starred_empty_state","modules/clean/react/home/starred/starred_layout"],(function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarredEmptyLayout=void 0,n=i.__importDefault(n),t.StarredEmptyLayout=({isHiddenByUser:e,pageType:t})=>n.default.createElement(s.StarredLayout,{starredComponent:o.StarredEmptyState,isHiddenByUser:e,itemModels:[],canShowSpinner:!1,hasMore:!1,hasLoadedInitial:!1,showAll:"STARRED"===t,showHeader:"HOME"===t,pageType:t})})),define("modules/clean/react/home/starred/starred_empty_state",["require","exports","tslib","react","modules/clean/react/components/section/section_empty_text","modules/core/i18n"],(function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarredEmptyState=void 0,n=i.__importDefault(n),t.StarredEmptyState=function(){return n.default.createElement(o.SectionEmptyText,{message:s.intl.formatMessage({id:"bFX0L5",defaultMessage:"When you star items, they’ll show up here for easy access."}),learnMoreLink:"/help/desktop-web/star-doc-file-folder"})}})),define("modules/clean/react/home/starred/starred_layout",["require","exports","tslib","react","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/react/components/section/section_header","modules/clean/react/home/store","modules/clean/react/home/util/logging/activity_logger","modules/core/i18n"],(function(e,t,i,n,o,s,a,r,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarredLayout=t.STARRED_HEADER_TITLE=void 0,n=i.__importDefault(n),t.STARRED_HEADER_TITLE=l.intl.formatMessage({id:"Nd85dl",defaultMessage:"Starred"});class d extends n.default.PureComponent{constructor(){super(...arguments),this.onChangeVisibility=()=>{const e=this.props.isHiddenByUser;o.HomeActions.setSectionVisibility(r.getUserId(),{".tag":"starred"},e),c.homeActivityLogger.logShowHideSection(s.HomeSections.STARRED,!e)}}render(){const e=this.props,{isHiddenByUser:o,starredComponent:s}=e,r=i.__rest(e,["isHiddenByUser","starredComponent"]),c=s;return n.default.createElement("section",{className:"home-access-section"},"HOME"===r.pageType&&n.default.createElement(a.SectionHeader,{title:t.STARRED_HEADER_TITLE,ueName:"starred",isHidden:o,onToggleHidden:this.onChangeVisibility}),!o&&n.default.createElement(c,Object.assign({},r)))}}t.StarredLayout=d,d.displayName="StarredLayout"})),define("modules/clean/react/home/store",["require","exports","tslib","lodash","modules/clean/flux/dispatcher","modules/clean/flux/flux_store","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/home/constants","modules/clean/react/home/util/logging/availability_logger_common","modules/clean/viewer","modules/core/assert","modules/core/exception","modules/clean/active_user"],(function(e,t,i,n,o,s,a,r,c,l,d,m,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBlockingSection=t.isHomeSection=t.getRole=t.getUserId=t.getUser=t.getHomeStore=t.PrivateHomeStoreClass=void 0,n=i.__importStar(n);class h extends s.FluxStore{constructor(){super(o.Dispatcher),this.handledPrefetches=[],this.activeTabId=r.HomeTabId.STARRED,this.canRenderItems=()=>!!this.pendingPreTTIPrefetches&&!this.pendingPreTTIPrefetches.length,this.thumbStore=new a.GenericThumbStore,this.sectionToDidLoadSynchronously={},this.sectionToPendingCallbacks={},this.preTTIProps=r.DEFAULT_PRE_TTI_PROPS}getRole(){var e;return this.role||(null===(e=this.getUser())||void 0===e?void 0:e.role)}getUser(){return this.user||u.getActiveUser()}getThumbStore(){return this.thumbStore}getSectionVisibility(){return this.sectionVisibility}getPreTTIProps(){return this.preTTIProps}getPostTTIPropsPromise(){return this.postTTIPropsPromise}getActiveTabId(){return this.activeTabId}getActiveVariants(){return this.preTTIProps.activeVariants}getActiveVariant(e){const t=this.getActiveVariants();return t&&t[e]}getPageType(e){switch(e){case"/recents":case"/edison_test/recents":return"RECENTS";case"/starred":return"STARRED";default:return"HOME"}}executeWhenSectionIsReady(e,t,i){const n=this.getSectionLoadingPreference(e);return n===r.ConditionalSectionLoadingPreference.DO_NOT_LOAD?null:n===r.ConditionalSectionLoadingPreference.IMMEDIATE||this.getSectionLoadingMode(e)!==r.ConditionalSectionLoadingMode.UNKNOWN?i(!0):(t&&(this.sectionToPendingCallbacks[e]?this.sectionToPendingCallbacks[e].push(i):this.sectionToPendingCallbacks[e]=[i]),null)}getSectionLoadingPreference(e){if(this.sectionToExtendedConditionalData){const t=this.sectionToExtendedConditionalData[e];return t?t.isPostTti?r.ConditionalSectionLoadingPreference.POST_TTI:r.ConditionalSectionLoadingPreference.IMMEDIATE:r.ConditionalSectionLoadingPreference.DO_NOT_LOAD}return r.ConditionalSectionLoadingPreference.UNKNOWN}getSectionLoadingMode(e){return this.sectionToExtendedConditionalData&&this.sectionToExtendedConditionalData[e]?this.sectionToExtendedConditionalData[e].loadingMode:r.ConditionalSectionLoadingMode.UNKNOWN}getIsFileViewerOpen(){return this.isFileViewerOpen}canRenderAllHomeSections(){return this.sectionToExtendedConditionalData?n.values(this.sectionToExtendedConditionalData).every(e=>!e.isBlocking||(!!e.isPostTti||e.loadingMode!==r.ConditionalSectionLoadingMode.UNKNOWN)):(this.role||m.reportStack("Called canRenderAllHomeSections before initialization",{severity:m.SEVERITY.NONCRITICAL}),!0)}setSectionVisibility({section:e,visible:t}){this.sectionVisibility[e]!==t&&(this.sectionVisibility=Object.assign(Object.assign({},this.sectionVisibility),{[e]:t}))}setSectionLoadingMode(e,t){const i=this.getExtendedConditionalData(e);i&&(this.sectionToExtendedConditionalData[e]=Object.assign(Object.assign({},i),{loadingMode:t}))}getExtendedConditionalData(e){return this.sectionToExtendedConditionalData&&this.sectionToExtendedConditionalData[e]}onPrefetchReceivedData({homePrefetchType:e}){this.handledPrefetches.push(e),this.pendingPreTTIPrefetches&&(this.pendingPreTTIPrefetches=n.without(this.pendingPreTTIPrefetches,e),this.pendingPreTTIPrefetches.length||this.__emitChange())}onInitializeStore({role:e,sectionVisibility:t,preTTIProps:i,sectionToConditionalData:o}){this.role=e,this.sectionVisibility=t,this.user=l.Viewer.get_viewer().get_user_by_role(e),d.assert(!!this.user,`Could not find user for role ${e}`),this.preTTIProps=i||this.preTTIProps,this.pendingPreTTIPrefetches=n.without([r.HomePrefetchTypes.RECENTS_JSON].concat(n.compact(n.map(c.HOME_PREFETCH_TYPE_TO_INFO,({section:e},t)=>{if(o){const i=o[e];if(i&&!i.isPostTti)return t}return null}))),...this.handledPrefetches),this.sectionToExtendedConditionalData=n.mapValues(o,(e,t)=>Object.assign(Object.assign({},e),{loadingMode:r.ConditionalSectionLoadingMode.UNKNOWN,isBlocking:I(t)})),Object.keys(this.sectionToDidLoadSynchronously).forEach(e=>{(0,this.sectionToDidLoadSynchronously[e])(this.getSectionLoadingPreference(e))&&this.setSectionLoadingMode(e,r.ConditionalSectionLoadingMode.SYNCHRONOUS)}),this.sectionToDidLoadSynchronously={}}onDeclareConditionalSection({section:e,didInitializeSynchronously:t}){this.sectionToExtendedConditionalData?m.reportStack("declared conditional section too late",{severity:m.SEVERITY.CRITICAL,exc_extra:{section:e}}):this.sectionToDidLoadSynchronously[e]?m.reportStack("Re-declared a conditional section",{severity:m.SEVERITY.CRITICAL,exc_extra:{section:e}}):this.sectionToDidLoadSynchronously[e]=t}onLoadedAsyncConditionalSection({section:e}){const t=this.getExtendedConditionalData(e);t&&this.setSectionLoadingMode(e,t.isPostTti?r.ConditionalSectionLoadingMode.POST_TTI:r.ConditionalSectionLoadingMode.ASYNCHRONOUS_PRE_TTI),(this.sectionToPendingCallbacks[e]||[]).forEach(e=>e(!1)),this.sectionToPendingCallbacks[e]=[]}onSetTabId({activeTabId:e}){this.activeTabId=e}onSetPostTTIPropsPromise({postTTIPropsPromise:e}){this.postTTIPropsPromise=e}__onDispatch(e){const t=e.action;switch(t.type){case r.HomeActionTypes.INITIALIZE_STORE:this.onInitializeStore(t.payload),this.__emitChange();break;case r.HomeActionTypes.SET_TAB_ID:this.onSetTabId(t.payload),this.__emitChange();break;case r.HomeActionTypes.SET_POST_TTI_PROPS_PROMISE:this.onSetPostTTIPropsPromise(t.payload),this.__emitChange();break;case r.HomeActionTypes.HOME_PREFETCH_RECEIVED_DATA:this.onPrefetchReceivedData(t.payload);break;case r.HomeActionTypes.SET_SECTION_VISIBILITY:this.setSectionVisibility(t.payload),this.__emitChange();break;case r.HomeActionTypes.DECLARE_CONDITIONAL_SECTION:this.onDeclareConditionalSection(t.payload),this.__emitChange();break;case r.HomeActionTypes.LOADED_ASYNC_CONDITIONAL_SECTION:this.onLoadedAsyncConditionalSection(t.payload),this.__emitChange();break;case r.HomeActionTypes.OPEN_FILE_VIEWER:this.isFileViewerOpen=!0,this.__emitChange();break;case r.HomeActionTypes.CLOSE_FILE_VIEWER:this.isFileViewerOpen=!1,this.__emitChange()}}}t.PrivateHomeStoreClass=h;let _=null;function p(){return null===_&&(_=new h),_}function E(){return p().getUser()}t.getHomeStore=p,t.getUser=E,t.getUserId=function(){return E().id},t.getRole=function(){return E().role};const T=(function(e){const t={};for(const i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t})(r.HomeSections);function g(e){return!!T[e]}function I(e){return g(e)}t.isHomeSection=g,t.isBlockingSection=I}));var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/home/util/conditional_api",["require","exports","modules/clean/react/home/store","modules/clean/react/home/constants"],(function(e,t,i,n){"use strict";function o(e,n=!0,o,s,a){return t.sectionToConditionalInterface[o]?e(t.sectionToConditionalInterface[o]):i.getHomeStore().executeWhenSectionIsReady(o,n,i=>{if(i&&!t.sectionToConditionalInterface[o])try{t.sectionToConditionalInterface[o]=s()}catch(e){}return t.sectionToConditionalInterface[o]?e(t.sectionToConditionalInterface[o]):(n&&a().then(i=>{t.sectionToConditionalInterface[o]=i,e(i)}),null)})}Object.defineProperty(t,"__esModule",{value:!0}),t.waitForStarred=t.waitForSection=t.sectionToConditionalInterface=void 0,t.sectionToConditionalInterface={},t.waitForSection=o,t.waitForStarred=function(t,i=!0){return o(t,i,n.HomeSections.STARRED,()=>e("modules/clean/react/home/starred/conditional_interface"),()=>new Promise((t,i)=>{e(["modules/clean/react/home/starred/conditional_interface"],t,i)}).then(__importStar))}})),define("modules/clean/react/home/util/conditional_components",["require","exports","tslib","react","modules/clean/react/home/constants","modules/clean/react/home/util/conditional","modules/clean/react/home/starred/starred_empty_layout","modules/clean/react/content_suggestions/suggest_loading","modules/clean/react/home/post_tti/api","modules/clean/react/components/css"],(function(e,t,i,n,o,s,a,r,c,l){"use strict";function d(e){return e&&{componentClass:e.StarredView,initPrefetch:e.getStarredResourceStore}}Object.defineProperty(t,"__esModule",{value:!0}),t.ConditionalRecommendedMembersView=t.ConditionalHomeInlineContentPromptView=t.ConditionalTeamsView=t.ConditionalSuggestView=t.ConditionalStarredView=void 0,n=i.__importDefault(n),t.ConditionalStarredView=s.homeConditionalSection({section:o.HomeSections.STARRED,syncLoader:()=>d(e("modules/clean/react/home/starred/conditional_interface")),asyncLoader:()=>new Promise((t,i)=>{e(["modules/clean/react/home/starred/conditional_interface"],t,i)}).then(i.__importStar).then(e=>d(e)),loading:e=>n.default.createElement(a.StarredEmptyLayout,Object.assign({},e))}),t.ConditionalSuggestView=s.homeConditionalSection({section:o.HomeSections.SUGGEST,syncLoader:()=>null,asyncLoader:()=>i.__awaiter(void 0,void 0,void 0,(function*(){const{initPrefetch:e,HomeSuggest:t}=yield c.waitForHomeTTI();return{componentClass:t,initPrefetch:e}})),loading:e=>n.default.createElement(r.SuggestLoading,Object.assign({},e))}),t.ConditionalTeamsView=s.homeConditionalSection({section:o.HomeSections.TEAMS,syncLoader:()=>null,asyncLoader:()=>i.__awaiter(void 0,void 0,void 0,(function*(){const{initPrefetchHomeTeams:e,HomeTeams:t}=yield c.waitForHomeTTI();return{componentClass:l.requireCssWithComponent(t,["/static/css/home_access/teams-vflbQR75a.css"]),initPrefetch:e}})),loading:e=>null}),t.ConditionalHomeInlineContentPromptView=s.homeConditionalSection({section:o.HomeSections.PROMPT,syncLoader:()=>null,asyncLoader:()=>i.__awaiter(void 0,void 0,void 0,(function*(){const{initPrefetchHomeInlineContentPrompt:e,HomeInlineContentPrompt:t}=yield c.waitForHomeTTI();return{componentClass:l.requireCssWithComponent(t,["/static/css/upsell/home_inline_content-vflD-aNTQ.css"]),initPrefetch:e}})),loading:e=>null}),t.ConditionalRecommendedMembersView=s.homeConditionalSection({section:o.HomeSections.RECOMMENDED_MEMBERS,syncLoader:()=>null,asyncLoader:()=>i.__awaiter(void 0,void 0,void 0,(function*(){const{initPrefetchRecommendedMembers:e,RecommendedMembers:t}=yield c.waitForHomeTTI();return{componentClass:l.requireCssWithComponent(t,["/static/css/team_success/home_recommended_members/recommended_members-vflhB8ElQ.css"]),initPrefetch:e}})),loading:e=>null})})),define("modules/clean/react/home/util/conditional",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/home/post_tti/api","modules/clean/react/home/store","modules/clean/react/home/constants","modules/clean/react/home/util/logging/timing_logger","modules/core/exception","modules/clean/flux/dispatcher"],(function(e,t,i,n,o,s,a,r,c,l,d){"use strict";function m(e){return e?(e.initPrefetch(),e.componentClass):null}Object.defineProperty(t,"__esModule",{value:!0}),t.homeConditionalSection=t.IS_PROD=void 0,n=i.__importDefault(n),t.IS_PROD=!0,t.homeConditionalSection=function(e){const{section:u,syncLoader:h,asyncLoader:_,loading:p}=e;let E=null,T=r.ConditionalSectionLoadingPreference.UNKNOWN;return a.getHomeStore(),d.Dispatcher.dispatch({type:r.HomeActionTypes.DECLARE_CONDITIONAL_SECTION,payload:{section:u,didInitializeSynchronously:e=>{if(T=e,e===r.ConditionalSectionLoadingPreference.UNKNOWN)return!1;if(e===r.ConditionalSectionLoadingPreference.DO_NOT_LOAD)return a.isHomeSection(u)&&c.homeTimingLogger.logSkippedSection(u),!1;const t=e===r.ConditionalSectionLoadingPreference.POST_TTI;if(t)a.isHomeSection(u)&&c.homeTimingLogger.logSkippedSection(u);else{try{E=m(h())}catch(e){}if(E)return!0}const l=!t&&a.isBlockingSection(u),g=()=>i.__awaiter(this,void 0,void 0,(function*(){t&&(yield s.waitForHomeTTI());const e=m(yield _());return l&&(E=e),d.Dispatcher.dispatch({type:r.HomeActionTypes.LOADED_ASYNC_CONDITIONAL_SECTION,payload:{section:u}}),e}));if(l)g();else{const e=p;E=o.Loadable({loader:g,loading:e?t=>t.canRenderItems?"function"==typeof e?n.default.createElement(e,Object.assign({},t)):e:null:void 0})}return!1}}}),e=>((T===r.ConditionalSectionLoadingPreference.UNKNOWN||!E&&T===r.ConditionalSectionLoadingPreference.IMMEDIATE&&a.isBlockingSection(u)&&t.IS_PROD)&&l.reportStack("Premature render",{severity:l.SEVERITY.CRITICAL,exc_extra:{section:u,loadingPreference:T,isBlockingSection:a.isBlockingSection(u)}}),E?n.default.createElement(E,Object.assign({},e)):null)}})),define("modules/clean/react/home/util/logging/activity_logger",["require","exports","modules/clean/react/home/api","modules/clean/react/home/store","modules/clean/react/home/constants"],(function(e,t,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.homeActivityLogger=t.HomeActivityLogger=void 0;class s{logClickShowAll(e,t){return i.logHomeActivity({eventName:o.LoggingTypes.CLICK_SHOW_ALL,role:n.getHomeStore().getRole(),extra:{component_name:e,should_show_all:t,home_page_type:n.getHomeStore().getPageType(location.pathname)}})}logHomePageShown(){return i.logHomeActivity({eventName:o.LoggingTypes.HOME_PAGE_SHOWN,role:n.getHomeStore().getRole(),extra:{url:a(),home_page_type:n.getHomeStore().getPageType(location.pathname)}})}logStarredShown(e,t,s){return i.logHomeActivity({eventName:o.LoggingTypes.STARRED_SHOWN,role:n.getHomeStore().getRole(),extra:{num_items:e,is_hidden:!1,has_hidden_rows:t,has_more:s,url:a(),home_page_type:n.getHomeStore().getPageType(location.pathname)}})}logRecentsShown(e,t){return i.logHomeActivity({eventName:o.LoggingTypes.RECENTS_SHOWN,role:n.getHomeStore().getRole(),extra:{num_items:e,is_hidden:t,url:a(),home_page_type:n.getHomeStore().getPageType(location.pathname)}})}logShowHideSection(e,t){return i.logHomeActivity({eventName:t?o.LoggingTypes.HIDE_SECTION:o.LoggingTypes.UNHIDE_SECTION,role:n.getHomeStore().getRole(),extra:{section_name:e,home_page_type:n.getHomeStore().getPageType(location.pathname)}})}logRecentsAction(e,t,s,a,r,c,l,d,m,u){const h={action_taken:e,scope:t,display_type:r,is_dir:c,item_number:s,sprite:a,subgroup_position:l,home_page_type:n.getHomeStore().getPageType(location.pathname),component_name:u};return d&&m&&(h.id_type=d,h.resource_id=m),i.logHomeActivity({eventName:o.LoggingTypes.RECENTS_ITEM_ACTION,role:n.getHomeStore().getRole(),extra:h})}logOpenStarredItem(e,t,s){return i.logHomeActivity({eventName:o.LoggingTypes.OPEN_STARRED_ITEM,role:n.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,position:s,home_page_type:n.getHomeStore().getPageType(location.pathname)}})}logUndoUnstarItem(e,t,s){return i.logHomeActivity({eventName:o.LoggingTypes.UNDO_UNSTAR_ITEM,role:n.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,position:s,home_page_type:n.getHomeStore().getPageType(location.pathname)}})}logClickStarOverflowShare(e,t,s){return i.logHomeActivity({eventName:o.LoggingTypes.CLICK_STAR_OVERFLOW_SHARE,role:n.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,position:s,home_page_type:n.getHomeStore().getPageType(location.pathname)}})}logClickRightMenu(e,t){return i.logHomeActivity({eventName:e,role:n.getHomeStore().getRole(),extra:{modalSessionId:t,home_page_type:n.getHomeStore().getPageType(location.pathname)}})}logCreateNewFile(e){return i.logHomeActivity({eventName:e,role:n.getHomeStore().getRole(),extra:{home_page_type:n.getHomeStore().getPageType(location.pathname)}})}}function a(){return-1!==location.host.indexOf("dropbox.com")?location.pathname:"unknown"}t.HomeActivityLogger=s,t.homeActivityLogger=new s})),define("modules/clean/react/home/util/logging/availability_logger_common",["require","exports","modules/clean/react/home/constants"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withHomePrefix=t.isPendingPrefetch=t.HOME_PREFETCH_TYPE_TO_INFO=void 0;const n=[i.ConditionalSectionLoadingPreference.IMMEDIATE,i.ConditionalSectionLoadingPreference.POST_TTI];t.HOME_PREFETCH_TYPE_TO_INFO={[i.HomePrefetchTypes.RETRIEVE_STARRED]:{fragment:"retrieve_starred",handle:"__REGISTER_RETRIEVE_STARRED_PRELOAD_HANDLER",section:i.HomeSections.STARRED,conditionalSection:i.HomeSections.STARRED},[i.HomePrefetchTypes.RECENTS_JSON]:{fragment:"recents/json",handle:"__REGISTER_RECENTS_PRELOAD_HANDLER",section:i.HomeSections.RECENTS,conditionalSection:i.HomeSections.RECENTS},[i.HomePrefetchTypes.RETRIEVE_PAPER_RECENTS]:{fragment:"retrieve_paper_recents",handle:"__REGISTER_PAPER_RECENTS_PRELOAD_HANDLER",section:i.HomeSections.RECENTS,conditionalSection:i.ConditionalSections.PAPER_RECENTS},[i.HomePrefetchTypes.GET_SUGGESTED]:{fragment:"get_suggested",handle:"__REGISTER_SUGGEST_GRID_PRELOAD_HANDLER",section:i.HomeSections.SUGGEST,conditionalSection:i.HomeSections.SUGGEST,isOptional:!0}},t.isPendingPrefetch=function(e,{success:t,info:i}){return void 0===t&&(!i.isOptional||n.indexOf(e.getSectionLoadingPreference(i.conditionalSection))>=0)},t.withHomePrefix=function(e){return`home_${e}`}})),define("modules/clean/react/home/util/logging/availability_logger",["require","exports","tslib","lodash","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/clean/web_timing_logger","modules/clean/react/home/store","modules/core/exception","modules/clean/react/home/util/prefetch_handler","modules/clean/react/home/util/logging/availability_logger_common","modules/clean/react/home/post_tti/api"],(function(e,t,i,n,o,s,a,r,c,l,d,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHomeAvailabilityLogger=t.HomeAvailabilityLogger=void 0,n=i.__importStar(n);class u{constructor(){this.didLog=!1,this.sectionToTTData={},this.sectionToTTI={},this.sectionToIsSkipped={},this.typeToExecutionData=n.mapValues(d.HOME_PREFETCH_TYPE_TO_INFO,e=>({info:e,homeTiming:{}}))}logPrefetch(e,t){const i=this.typeToExecutionData[e];if(void 0===i.success){const n={type:s.HomeActionTypes.HOME_PREFETCH_RECEIVED_DATA,payload:{homePrefetchType:e}};i.homeTiming.asynchronous?o.Dispatcher.dispatch(n):r.getHomeStore().__onDispatch({action:n}),i.success=t,this.pendingPrefetchesCount&&this.pendingPrefetchesCount--,this.logIfPossible()}}logIfPossible(){!this.didLog&&void 0!==this.pendingPrefetchesCount&&this.pendingPrefetchesCount<=0&&(m.waitForHomeTTI().then(({logHomeAvailability:e})=>e({typeToExecutionData:this.typeToExecutionData,sectionToTTData:this.sectionToTTData,sectionToTTI:this.sectionToTTI,sectionToIsSkipped:this.sectionToIsSkipped})),this.didLog=!0)}logTTData(e){this.sectionToTTData.hasOwnProperty(e)||(this.sectionToTTData[e]=a.time_since_start(),this.logIfPossible())}logTTI(e,t,i){if(!this.sectionToTTI.hasOwnProperty(e)&&(this.sectionToTTI[e]=a.time_since_start(),this.sectionToIsSkipped[e]=Number(t),i)){this.pendingPrefetchesCount=0;const e=r.getHomeStore();n.map(this.typeToExecutionData,t=>{d.isPendingPrefetch(e,t)&&this.pendingPrefetchesCount++}),this.logIfPossible()}}handlePrefetch(e,t){const{handle:i,conditionalSection:n}=d.HOME_PREFETCH_TYPE_TO_INFO[e],o=()=>this.handlePrefetchImpl(e,i,t);r.getHomeStore().getSectionLoadingPreference(n)===s.ConditionalSectionLoadingPreference.POST_TTI?m.waitForHomeTTI().then(o):o()}handlePrefetchImpl(e,t,i){const o=l.getPrefetchHandler(t),s=this.typeToExecutionData[e],{homeTiming:r,didInvoke:d}=s,m=t=>{c.reportStack(`prefetch for ${e} failed`,{severity:c.SEVERITY.CRITICAL,exc_extra:{error:t,type:e},silent:!0}),this.logPrefetch(e,!1)};if(o){if(!d){s.didInvoke=!0,r.register_prefetch_callback=a.time_since_start();const t=t=>{try{r.json_parse_start=a.time_since_start();const o=JSON.parse(t);r.json_parse_end=a.time_since_start(),r.json_string_size=16*t.length,n.isEqual(o,{})?m("payload is {}"):(this.logPrefetch(e,!0),r.payload_processing_start=a.time_since_start(),i(o),r.payload_processing_end=a.time_since_start())}catch(e){m(e)}};r.asynchronous=l.handlePrefetch(o,t,m)?0:1}}else m("no prefetch handler")}}t.HomeAvailabilityLogger=u;let h=null;t.getHomeAvailabilityLogger=function(){return h=h||new u,h}})),define("modules/clean/react/home/util/logging/timing_component",["require","exports","tslib","react","modules/clean/react/home/util/logging/timing_logger"],(function(e,t,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timingComponent=void 0,n=i.__importDefault(n),t.timingComponent=function(e,t){return class extends n.default.PureComponent{logTTIIfCanRenderItems(){return this.props.canRenderItems&&o.homeTimingLogger.logTTI(t)}componentDidMount(){this.logTTIIfCanRenderItems();const e=this.refs.wrapped,t=e.componentDidUpdate;e.componentDidUpdate=()=>{this.logTTIIfCanRenderItems(),t&&t.call(e)}}render(){return n.default.createElement(e,Object.assign({ref:"wrapped"},this.props))}}}})),define("modules/clean/react/home/util/logging/timing_logger",["require","exports","tslib","modules/clean/js_client_stopwatch","lodash","modules/clean/web_timing_logger","modules/clean/react/home/util/logging/timing_state","modules/clean/react/home/util/logging/activity_logger","modules/core/exception","modules/clean/react/home/util/logging/availability_logger","modules/clean/react/home/util/logging/availability_logger_common"],(function(e,t,i,n,o,s,a,r,c,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.homeTimingLogger=t._HomeTimingLogger=void 0,o=i.__importStar(o),s=i.__importStar(s);const m=o.once(r.homeActivityLogger.logHomePageShown);class u{constructor(){this.timingStates=new a.HomeTimingStates,this.activate=o.once(()=>n.JSStopwatch.create_stopwatch_if_not_exist("home_access_tti"))}validateActivated(e,t){return!!n.JSStopwatch.stopwatch_exists("home_access_tti")||(c.reportStack(`Did not activate when ${e} before logging ${t}`,{severity:c.SEVERITY.NONCRITICAL}),!1)}logTTData(e){if(this.validateActivated(e,a.HomeTimingState.TTDATA)){if(this.timingStates.progressState(e,a.HomeTimingState.TTDATA))return this.timingStates.haveAllSectionsReachedState(a.HomeTimingState.TTDATA)&&s.log_js_modules_fetched_data_required_for_tti(),l.getHomeAvailabilityLogger().logTTData(e),!0}return!1}logSkippedSection(e){this.activate(),this.logTTData(e),this.logTTI(e,!0)}logTTI(e,t=!1){if(this.validateActivated(e,a.HomeTimingState.TTI)){if(this.timingStates.progressState(e,a.HomeTimingState.TTI)){m(),n.JSStopwatch.recordTrace(d.withHomePrefix(e),{stopwatchName:"home_access_tti"});const i=this.timingStates.haveAllSectionsReachedState(a.HomeTimingState.TTI);return i&&(s.mark_time_to_interactive(),n.JSStopwatch.flush_current_data()),l.getHomeAvailabilityLogger().logTTI(e,t,i),!0}}return!1}}t._HomeTimingLogger=u,t.homeTimingLogger=new u})),define("modules/clean/react/home/util/logging/timing_state",["require","exports","tslib","lodash","modules/clean/react/home/constants"],(function(e,t,i,n,o){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),t.HomeTimingStates=t.HomeTimingState=void 0,n=i.__importStar(n),(function(e){e[e.INIT=0]="INIT",e[e.TTDATA=1]="TTDATA",e[e.TTI=2]="TTI"})(s=t.HomeTimingState||(t.HomeTimingState={}));t.HomeTimingStates=class{constructor(){this.homeSectionToState={},n.values(o.HomeSections).forEach(e=>this.homeSectionToState[e]=s.INIT)}progressState(e,t){return this.homeSectionToState[e]+1===t&&(this.homeSectionToState[e]=t,!0)}haveAllSectionsReachedState(e){return n.every(this.homeSectionToState,t=>t>=e)}}})),define("modules/clean/react/home/util/post_tti_components",["require","exports","tslib","react","modules/clean/react/home/post_tti/api","modules/clean/react/home/recents/components/pending_attachment_list_view"],(function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PostTTIStarredItemFileActions=t.PostTTIRecentsActivityFileActions=t.PostTTIRecentActivityImageAttachments=void 0,n=i.__importStar(n),t.PostTTIRecentActivityImageAttachments=o.PostHomeTTIComponent({displayName:"PostTTIRecentActivityImageAttachments",preTTIRenderer:({attachments:e})=>n.createElement(s.PendingAttachmentListView,{count:e.length}),getPostTTIRenderer:({AttachmentListView:e,Dimensions:t})=>({attachments:i})=>n.createElement(t,{className:"recents-item__attachments"},({width:t})=>n.createElement(e,{attachments:i,width:t}))}),t.PostTTIRecentsActivityFileActions=o.PostHomeTTIComponent({displayName:"PostTTIRecentsActivityFileActions",getPostTTIRenderer:({RecentActivityFileActionPost:e})=>({recentItem:t,attachments:i})=>n.createElement(e,{recentItem:t,attachments:i})}),t.PostTTIStarredItemFileActions=o.PostHomeTTIComponent({displayName:"PostTTIStarredItemFileActions",getPostTTIRenderer:({StarredItemFileActionPost:e})=>({starredItem:t,user:i})=>n.createElement(e,{starredItem:t,user:i})})})),define("modules/clean/react/home/util/prefetch_handler",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handlePrefetch=t.getPrefetchHandler=void 0,t.getPrefetchHandler=function(e){return window[e]},t.handlePrefetch=function(e,t,i){const n=e.getDataIfAvailable();if(n){const{error:e,payload:o}=n;e?i(e):t(o)}else e(t,i);return Boolean(n)}})),define("modules/clean/react/home/util/resource_icon",["require","exports","tslib","react","spectrum/file_icon/index","spectrum/icon_content/index","modules/clean/filetypes","modules/clean/react/async/loadable","modules/clean/react/home/constants","modules/clean/react/icon/folder_icon","modules/clean/web_timing_logger"],(function(e,t,i,n,o,s,a,r,c,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HomeResourceIcon=void 0,n=i.__importDefault(n);const m=r.Loadable({loader:()=>i.__awaiter(void 0,void 0,void 0,(function*(){yield d.waitForTTI();const{ShortcutsFileIcon:t}=yield new Promise((t,i)=>{e(["modules/clean/react/icon/shortcuts_icon"],t,i)}).then(i.__importStar);return t}))});class u extends n.default.PureComponent{renderIcon(){const{displayType:e,shortcutUrlForIcon:t,icon:i,isLarge:r}=this.props,d=l.getDigIcon(i);if(d)return d;if(c.DisplayTypeToResourceType[e]===c.FILE_RESOURCE_TYPE){if(t){const e={type:a.FileTypes.FILE,icon:"dlink"};return n.default.createElement(m,{file:e,shortcutUrlForIcon:t,variant:r?"large":"small"})}return n.default.createElement(o.FileIcon,{path:this.props.fileName,variant:r?"large":"small"})}{let t=c.DisplayTypeToIconName[e]||c.DisplayTypeToIconName.FOLDER;return r&&(t=t.replace("small","large")),n.default.createElement(s.IconContent,{name:t})}}render(){return n.default.createElement("span",{className:this.props.className},this.renderIcon())}}t.HomeResourceIcon=u,u.displayName="HomeResourceIcon"})),define("modules/clean/react/home/util/show_hide_link",["require","exports","tslib","react","dig-components/buttons","dig-components/icons","dig-components/icons/src","modules/core/i18n"],(function(e,t,i,n,o,s,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShowHideLink=void 0,n=i.__importDefault(n),t.ShowHideLink=({onClick:e,isExpanded:t,hiddenItemCount:i,canLoadMore:c})=>{let l=r.intl.formatMessage({id:"s+pc7h",defaultMessage:"Show {number} more"},{number:i});return t?l=r.intl.formatMessage({id:"EFRGA8",defaultMessage:"Collapse section"}):i<=0?l=r.intl.formatMessage({id:"JZEdSO",defaultMessage:"Show more"}):c&&(l=r.intl.formatMessage({id:"w9jP5U",defaultMessage:"Show {number}+ more"},{number:i})),n.default.createElement("div",{className:"show-hide-link__container"},n.default.createElement(o.Button,{onClick:e,variant:"transparent",hasNoUnderline:!0,"data-testid":"show-hide-link__container",withIconLeft:n.default.createElement(s.UIIcon,{src:t?a.ChevronUpLine:a.ChevronDownLine})},l))},t.ShowHideLink.displayName="ShowHideLink"})),define("modules/clean/react/starred/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarredSource=t.IdTypes=t.StarredActionTypes=t.StarredLoadingState=void 0,t.StarredLoadingState={LOADING:"LOADING",LOAD_SUCCESS:"LOAD_SUCCESS",LOAD_FAILED:"LOAD_FAILED"},t.StarredActionTypes={LOADING:"STARRED_LOADING",SET_STATUS:"STARRED_SET_STATUS",LOAD_FAILURE:"STARRED_LOAD_FAILURE"},t.IdTypes={ENCODED_FILE_OBJ_ID:"ENCODED_FILE_OBJ_ID",EXTERNAL_RESOURCE_ID:"EXTERNAL_RESOURCE_ID",PAPER_ID_PATH:"PAPER_ID_PATH",FQ_PATH:"FQ_PATH"},(function(e){e.HOME_STARRED="HOME_STARRED",e.HOME_RECENTS="HOME_RECENTS",e.BROWSE="BROWSE",e.FILE_VIEWER="FILE_VIEWER",e.SUGGESTED_STARS="SUGGESTED_STARS",e.HOME_TASKS="HOME_TASKS"})(t.StarredSource||(t.StarredSource={}))})),define("modules/clean/react/starred/id_type_pair",["require","exports","tslib","modules/clean/filepath/filepath","modules/clean/react/home/resource_id_types"],(function(e,t,i,n,o){"use strict";function s(e){return!!e.file_id}function a(e){return!!e.pad_id}function r(e){return!!e.folder_id}function c(e){return!!e.fq_path}function l(e){return!!e.filename}Object.defineProperty(t,"__esModule",{value:!0}),t.itemNameFromStarrableItem=t.idTypePairFromStarrableItem=t.idTypePairToString=void 0,n=i.__importStar(n),t.idTypePairToString=function(e){return e.type+":"+e.id},t.idTypePairFromStarrableItem=function(e){return s(e)||l(e)?{id:e.file_id,type:o.HOME_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID}:a(e)?{id:e.pad_id,type:o.HOME_RESOURCE_ID_TYPE.PAPER_DOCUMENT_ID}:r(e)?{id:e.folder_id,type:o.HOME_RESOURCE_ID_TYPE.PAPER_FOLDER_ID}:c(e)?{id:e.fq_path,type:o.HOME_RESOURCE_ID_TYPE.FQ_PATH}:e},t.itemNameFromStarrableItem=function(e){return s(e)||c(e)?n.filename(e.fq_path):a(e)?e.title:r(e)?e.name:l(e)?e.filename:e}})),define("dropbox/proto/js_init_data/home_web/home_access_web",["require","exports","tslib","protobufjs/minimal","dropbox/proto/js_init_data/web_timing_logger/web_timing_logger"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.home_web=void 0;const o=(n=i.__importStar(n)).Reader,s=n.Writer,a=n.util,r=n.roots.default||(n.roots.default={});var c;t.default=r,t.home_web=r.home_web=((c=r.home_web||{}).HomeSurfaceExistingTeamsProps=(function(e){function e(e){if(e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.showTeamsOnHomepageExperiment=!1,e.prototype.showTeamsLoadingState=!1,e.prototype.numberOfTeams=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.showTeamsOnHomepageExperiment&&Object.hasOwnProperty.call(e,"showTeamsOnHomepageExperiment")&&t.uint32(8).bool(e.showTeamsOnHomepageExperiment),null!=e.showTeamsLoadingState&&Object.hasOwnProperty.call(e,"showTeamsLoadingState")&&t.uint32(16).bool(e.showTeamsLoadingState),null!=e.numberOfTeams&&Object.hasOwnProperty.call(e,"numberOfTeams")&&t.uint32(24).int64(e.numberOfTeams),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));let i=void 0===t?e.len:e.pos+t,n=new r.home_web.HomeSurfaceExistingTeamsProps;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.showTeamsOnHomepageExperiment=e.bool();break;case 2:n.showTeamsLoadingState=e.bool();break;case 3:n.numberOfTeams=e.int64();break;default:e.skipType(7&t)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/home_web.HomeSurfaceExistingTeamsProps"},e})(c.HomeSurfaceExistingTeamsProps||{}),c.PreTTIGateProps=(function(e){function e(e){if(this.activeVariants={},e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.isPaperEnabledForUser=!1,e.prototype.activeVariants=a.emptyObject,e.prototype.expHomeSurfaceExistingTeams=null,e.prototype.homeStarredActionBar="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.isPaperEnabledForUser&&Object.hasOwnProperty.call(e,"isPaperEnabledForUser")&&t.uint32(8).bool(e.isPaperEnabledForUser),null!=e.activeVariants&&Object.hasOwnProperty.call(e,"activeVariants"))for(let i=Object.keys(e.activeVariants),n=0;n<i.length;++n)t.uint32(18).fork().uint32(10).string(i[n]).uint32(18).string(e.activeVariants[i[n]]).ldelim();return null!=e.expHomeSurfaceExistingTeams&&Object.hasOwnProperty.call(e,"expHomeSurfaceExistingTeams")&&r.home_web.HomeSurfaceExistingTeamsProps.encode(e.expHomeSurfaceExistingTeams,t.uint32(114).fork()).ldelim(),null!=e.homeStarredActionBar&&Object.hasOwnProperty.call(e,"homeStarredActionBar")&&t.uint32(170).string(e.homeStarredActionBar),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));let i,n,s=void 0===t?e.len:e.pos+t,c=new r.home_web.PreTTIGateProps;for(;e.pos<s;){let t=e.uint32();switch(t>>>3){case 1:c.isPaperEnabledForUser=e.bool();break;case 2:{c.activeVariants===a.emptyObject&&(c.activeVariants={});let t=e.uint32()+e.pos;for(i="",n="";e.pos<t;){let t=e.uint32();switch(t>>>3){case 1:i=e.string();break;case 2:n=e.string();break;default:e.skipType(7&t)}}c.activeVariants[i]=n;break}case 14:c.expHomeSurfaceExistingTeams=r.home_web.HomeSurfaceExistingTeamsProps.decode(e,e.uint32());break;case 21:c.homeStarredActionBar=e.string();break;default:e.skipType(7&t)}}return c},e.getTypeUrl=function(){return"type.googleapis.com/home_web.PreTTIGateProps"},e})(c.PreTTIGateProps||{}),c.SectionToConditionalData=(function(e){function e(e){if(e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.isPostTti=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=s.create()),null!=e.isPostTti&&Object.hasOwnProperty.call(e,"isPostTti")&&t.uint32(8).bool(e.isPostTti),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));let i=void 0===t?e.len:e.pos+t,n=new r.home_web.SectionToConditionalData;for(;e.pos<i;){let t=e.uint32();switch(t>>>3){case 1:n.isPostTti=e.bool();break;default:e.skipType(7&t)}}return n},e.getTypeUrl=function(){return"type.googleapis.com/home_web.SectionToConditionalData"},e})(c.SectionToConditionalData||{}),c.HomeWebPageletProps=(function(e){function e(e){if(this.initialSectionVisibility={},this.sectionToConditionalData={},e)for(let t=Object.keys(e),i=0;i<t.length;++i)null!=e[t[i]]&&(this[t[i]]=e[t[i]])}return e.prototype.initialRole="",e.prototype.initialSectionVisibility=a.emptyObject,e.prototype.sectionToConditionalData=a.emptyObject,e.prototype.webTimingLoggerServerContext=null,e.prototype.preTtiProps=null,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=s.create()),null!=e.initialRole&&Object.hasOwnProperty.call(e,"initialRole")&&t.uint32(10).string(e.initialRole),null!=e.initialSectionVisibility&&Object.hasOwnProperty.call(e,"initialSectionVisibility"))for(let i=Object.keys(e.initialSectionVisibility),n=0;n<i.length;++n)t.uint32(18).fork().uint32(10).string(i[n]).uint32(16).bool(e.initialSectionVisibility[i[n]]).ldelim();if(null!=e.sectionToConditionalData&&Object.hasOwnProperty.call(e,"sectionToConditionalData"))for(let i=Object.keys(e.sectionToConditionalData),n=0;n<i.length;++n)t.uint32(26).fork().uint32(10).string(i[n]),r.home_web.SectionToConditionalData.encode(e.sectionToConditionalData[i[n]],t.uint32(18).fork()).ldelim().ldelim();return null!=e.webTimingLoggerServerContext&&Object.hasOwnProperty.call(e,"webTimingLoggerServerContext")&&r.web_timing_logger.WebTimingLoggerServerContext.encode(e.webTimingLoggerServerContext,t.uint32(34).fork()).ldelim(),null!=e.preTtiProps&&Object.hasOwnProperty.call(e,"preTtiProps")&&r.home_web.PreTTIGateProps.encode(e.preTtiProps,t.uint32(42).fork()).ldelim(),t},e.decode=function(e,t){e instanceof o||(e=o.create(e));let i,n,s=void 0===t?e.len:e.pos+t,c=new r.home_web.HomeWebPageletProps;for(;e.pos<s;){let t=e.uint32();switch(t>>>3){case 1:c.initialRole=e.string();break;case 2:{c.initialSectionVisibility===a.emptyObject&&(c.initialSectionVisibility={});let t=e.uint32()+e.pos;for(i="",n=!1;e.pos<t;){let t=e.uint32();switch(t>>>3){case 1:i=e.string();break;case 2:n=e.bool();break;default:e.skipType(7&t)}}c.initialSectionVisibility[i]=n;break}case 3:{c.sectionToConditionalData===a.emptyObject&&(c.sectionToConditionalData={});let t=e.uint32()+e.pos;for(i="",n=null;e.pos<t;){let t=e.uint32();switch(t>>>3){case 1:i=e.string();break;case 2:n=r.home_web.SectionToConditionalData.decode(e,e.uint32());break;default:e.skipType(7&t)}}c.sectionToConditionalData[i]=n;break}case 4:c.webTimingLoggerServerContext=r.web_timing_logger.WebTimingLoggerServerContext.decode(e,e.uint32());break;case 5:c.preTtiProps=r.home_web.PreTTIGateProps.decode(e,e.uint32());break;default:e.skipType(7&t)}}return c},e.getTypeUrl=function(){return"type.googleapis.com/home_web.HomeWebPageletProps"},e})(c.HomeWebPageletProps||{}),c)}));
//# sourceMappingURL=pkg-home.min.js-vflEHbOPi.map