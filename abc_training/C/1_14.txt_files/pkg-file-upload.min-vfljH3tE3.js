define("modules/clean/react/file_uploader/api",["require","exports","tslib","modules/clean/csrf","modules/clean/react/browse/crypto_subtle_digest","modules/clean/react/file_uploader/constants","modules/core/uri","modules/clean/react/file_uploader/api_v2_client","modules/clean/react/file_uploader/api_helper"],(function(e,t,o,s,r,i,a,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadBlock=t.commitBlocksBatch=t.commitBlocks=void 0,t.commitBlocks=function(e,t,o,r,n,d,c){return new Promise((u,p)=>{try{const p={_subject_uid:e.toString(),dest:t,name:o,overwrite:"1",reported_total_size:r.toString(),t:s.readCsrfToken()||"",client_root_ns_id:d.toString()};c>0&&(p.last_modified=c.toString());const h=new a.URI({scheme:"https",authority:"www.dropbox.com",path:"/commit_web_upload_by_token",query:p}),m=new XMLHttpRequest;m.withCredentials=!0;const _=()=>{let e;return e=507===m.status?l.getErrorOnStatus507(m):0===m.status?i.UploadErrorType.CONNECTION_ERROR:i.UploadErrorType.COMMIT_HTTP_ERROR,{type:e}};return m.onreadystatechange=()=>{if(m.readyState===XMLHttpRequest.DONE)if(200===m.status){const e=JSON.parse(m.responseText);"complete"===e.status?u(l.ok({})):u(l.err({type:i.UploadErrorType.HTTP_ERROR,message:e.error,method:"commitBlocks/request.onreadystatechange"}))}else u(l.err(_()))},m.open("POST",h.toString(),!0),m.setRequestHeader("Content-Type","application/octet-stream"),m.send(JSON.stringify(n)),m}catch(e){return void u(l.err({type:i.UploadErrorType.HTTP_ERROR,message:e.message,method:"commitBlocks/try-catch"}))}})},t.commitBlocksBatch=function(e,t,o){return new Promise((s,r)=>{const a={};o.map(e=>{a[e.id]=e});const d=[];n.commitWebUploadTokenBatch(e,t).then(e=>{var t,o;null===(t=e.completed)||void 0===t||t.forEach(e=>{d.push({uploadItem:a[e.local_identifier],status:{isError:!1}})}),null===(o=e.failed)||void 0===o||o.forEach(e=>{const t=e.status.status;let o=i.UploadErrorType.COMMIT_HTTP_ERROR;if("failure"===t[".tag"]){o=(function(e){var t;switch(null===(t=e.failure_reason)||void 0===t?void 0:t[".tag"]){case"invalid_argument":return i.UploadErrorType.COMMIT_INVALID_ARGS;case"too_large_file":case"too_many_blocks":return i.UploadErrorType.FILE_SIZE_ERROR;case"no_write_permission":return i.UploadErrorType.PERMISSIONS_AT_UPLOAD_ERROR;case"insufficient_quota":return i.UploadErrorType.OVER_QUOTA_ERROR;case"file_ignored":return i.UploadErrorType.IGNORED;case"others":default:return i.UploadErrorType.COMMIT_HTTP_ERROR}})(t)}d.push({uploadItem:a[e.local_identifier],status:{isError:!0,error:{type:o,method:"commitWebUploadTokenBatch"}}})}),s(l.ok(d))}).catch(e=>{s(l.err({type:i.UploadErrorType.HTTP_ERROR,message:e.toString(),method:"commitWebUploadTokenBatch/try-catch"}))})})},t.uploadBlock=(e,t,n,d,c)=>new Promise(u=>o.__awaiter(void 0,void 0,void 0,(function*(){try{let o;if(r.windowHasCryptoSubtleDigest()){const e=yield l.hashBlob(d);if(e.isError)return u(e);o=e.result.hash}const p=new a.URI({scheme:"https",authority:"dl-web.dropbox.com",path:"/put_block_returning_token",query:{owner_id:e.toString(),_subject_uid:e.toString(),t:s.readCsrfToken()||"",reported_block_size:d.size.toString(),num_blocks:Math.ceil(n/d.size).toString(),ns_id_for_routing:t.toString()}}),h=new XMLHttpRequest;h.withCredentials=!0;const m=()=>{let e;return e=507===h.status?l.getErrorOnStatus507(h):0===h.status?i.UploadErrorType.CONNECTION_ERROR:i.UploadErrorType.UPLOAD_BLOCK_ERROR,{type:e}};return h.onreadystatechange=()=>{if(h.readyState!==XMLHttpRequest.DONE)return;if(0!==h.status&&200!==h.status)return u(l.err({type:i.UploadErrorType.HTTP_ERROR,message:`request status was ${h.status}`,method:"uploadBlock/request.onreadystatechange"}));const e=JSON.parse(h.responseText);return e.token?r.windowHasCryptoSubtleDigest()&&e.block_hash!==o?u(l.err({type:i.UploadErrorType.HASHES_NOT_EQUAL_ERROR})):void u(l.ok({token:e.token})):u(l.err({type:i.UploadErrorType.HTTP_ERROR,message:`no token in response, block hash:${e.block_hash}, request status:${h.status}`,method:"uploadBlock/request.onreadystatechange"}))},h.onerror=()=>{u(l.err(m()))},h.upload&&(h.upload.onprogress=c),h.onload=()=>{h.status>=400&&u(l.err(m()))},h.open("POST",p.toString(),!0),h.setRequestHeader("Content-Type","application/octet-stream"),h.send(d),h}catch(e){return void u(l.err({type:i.UploadErrorType.HTTP_ERROR,message:e.message,method:"uploadBlock/try-catch"}))}})))})),define("modules/clean/react/file_uploader/api_helper",["require","exports","tslib","modules/clean/react/browse/crypto_subtle_digest","modules/clean/react/file_uploader/constants"],(function(e,t,o,s,r){"use strict";function i(e){return{isError:!1,result:e}}function a(e){return{isError:!0,error:e}}function n(e){return e.replace(/\//g,"_").replace(/\+/g,"-")}function l(e){for(;e.endsWith("=");)e=e.slice(0,-1);return e}function d(e){return new Promise(t=>{const o=new FileReader;o.onloadend=function(e){if(!(null!==e&&e.target&&e.target.result instanceof ArrayBuffer))throw new Error;t(e.target.result)},o.readAsArrayBuffer(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorOnStatus507=t.hashBlob=t.blobToArrayBuffer=t.removeDigestPadding=t.urlSafeEncodeTranslation=t.err=t.ok=void 0,t.ok=i,t.err=a,t.urlSafeEncodeTranslation=n,t.removeDigestPadding=l,t.blobToArrayBuffer=d,t.hashBlob=function(e){return o.__awaiter(this,void 0,void 0,(function*(){let t;try{t=yield d(e)}catch(e){return a({type:r.UploadErrorType.FILE_READER_NULL_RESULT_ERROR})}try{const e=yield s.encryptArrayBuffer(t),o=l(n(btoa(String.fromCharCode.apply(null,new Uint8Array(e)))));return o?i({hash:o}):a({type:r.UploadErrorType.CLIENT_HASH_EMPTY_ERROR})}catch(e){return a({type:r.UploadErrorType.CLIENT_HASH_DIGEST_ERROR})}}))},t.getErrorOnStatus507=function(e){return"locked_team"===e.error?r.UploadErrorType.LOCKED_TEAM_ERROR:r.UploadErrorType.OVER_QUOTA_ERROR}})),define("modules/clean/react/file_uploader/api_v2_client",["require","exports","api_v2/user_client"],(function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commitWebUploadTokenBatch=void 0,t.commitWebUploadTokenBatch=function(e,t){const s={entries:t};return(new o.UserApiV2Client).ns("upload_backend").rpc("commit_web_upload_token_batch",s,{subjectUserId:e})}})),define("modules/clean/react/vault/vault_browse_root_async",["require","exports","tslib","react"],(function(e,t,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncVaultRoot=void 0,s=o.__importStar(s);const{lazy:r,Suspense:i}=s,a=r(()=>o.__awaiter(void 0,void 0,void 0,(function*(){const{VaultRoot:t}=yield new Promise((t,o)=>{e(["modules/clean/react/vault/vault_browse_root"],t,o)}).then(o.__importStar);return{default:t}})));t.AsyncVaultRoot=e=>s.createElement(i,{fallback:s.createElement("div",null)},s.createElement(a,Object.assign({},e)))})),define("modules/clean/react/browse/controller",["require","exports","tslib","lodash","react","react-router-dom","spectrum-sharing/utils/sharing_constants","modules/clean/analytics","modules/clean/css","modules/clean/em_string","modules/clean/filepath/filepath","modules/clean/filetypes","modules/clean/history","modules/clean/navigation","modules/clean/pagelet_logger","modules/clean/pagination_manager","modules/clean/react/app_actions/education/async_extensions_edu_modal","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/actions_navigate","modules/clean/react/browse/api","modules/clean/react/browse/browse_prefetch_loader","modules/clean/react/browse/browse_upload_provider","modules/clean/react/browse/browse_view","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/uri_helper","modules/clean/react/file_uploader/file_uploader","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/react/file_viewer/async_controller","modules/clean/react/file_viewer/toggle_browse_elements_util","modules/clean/react/files_view/constants","modules/clean/react/files_view/types","modules/clean/react/files_view/sort_types","modules/clean/react/snackbar","modules/clean/react/vault/constants","modules/clean/react/vault/lib/browse_utils","modules/clean/sharing/browse_exports","modules/clean/sharing/ui_notifications_util","modules/core/persistence/storage","modules/clean/upsell/prompt_event_emitter","modules/clean/web_timing_logger","modules/clean/web_user_action_events","modules/constants/python","modules/core/assert","modules/core/browser","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","react-redux","modules/clean/react/browse/async_extensions","modules/clean/react/browse/data/action_creators/index","modules/clean/react/browse/data/folder_overview_selectors","modules/clean/react/browse/data/selectors","modules/clean/react/files_view/data/selectors/files_view_selectors","modules/clean/react/files_view/data/selectors/instance_selectors","modules/clean/react/folder_overview/data/action_creators","modules/clean/web_user_action_logger","modules/core/transport/query_string_helpers","modules/clean/react/content_suggestions/suggestions_context","modules/clean/react/content_suggestions/gating","modules/clean/react/content_suggestions/api","modules/clean/react/edison/router_utils","modules/clean/react/content_suggestions/actions","modules/clean/react/edison/spa_timing_logger","modules/clean/react/content_suggestions/suggest_dws_prefetch_loader","modules/clean/user_survey/user_survey","modules/clean/sync_everything/constants"],(function(e,t,o,s,r,i,a,n,l,d,c,u,p,h,m,_,f,g,w,S,b,y,v,F,T,P,E,I,A,C,R,L,x,U,O,N,k,M,D,B,V,q,j,H,W,z,Q,G,K,Y,Z,X,J,$,ee,te,oe,se,re,ie,ae,ne,le,de,ce,ue,pe,he,me,_e,fe){"use strict";function ge(e){return!!e&&e.isShown()}function we(e){return s.pick(e,T.BrowseQueryArg.d,T.BrowseQueryArg.select,T.BrowseQueryArg.preview,T.BrowseQueryArg.activity,T.BrowseQueryArg.rewind,T.BrowseQueryArg.folder_history,T.BrowseQueryArg.from_desktop_client,T.BrowseQueryArg.preselected_for_showcase,T.BrowseQueryArg.folder_overview,T.BrowseQueryArg.unfollow_folder,T.BrowseQueryArg.manage_folder_subscription,T.BrowseQueryArg.highlight,T.BrowseQueryArg.naming_convention,T.BrowseQueryArg.tidy_up,T.BrowseQueryArg.automations,...T.FRAMEWORK_ARGS)}function Se(t){return o.__awaiter(this,void 0,void 0,(function*(){const s=E.getQueryArgs();if("manage"===s.automations&&!s.tidy_up&&!s.naming_convention&&t.autoFoldersEnabled&&t.isInsideFlowsEligibleFolder){const{asyncLaunchAddOrEditAutoFolderModal:s}=yield new Promise((t,o)=>{e(["modules/clean/react/flows/utils/folder_rules"],t,o)}).then(o.__importStar);s({fqPath:t.fqPath,nsId:t.nsId,user:t.user})}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedBrowseControllerElementWithRouter=t.ConnectedBrowseControllerElement=t.BrowseController=t.maybeShowAutoFolderModal=t.showTidyUpModalIfNeeded=t.showNamingConventionsModalIfNeeded=void 0,s=o.__importStar(s),r=o.__importDefault(r),c=o.__importStar(c),p=o.__importDefault(p),g=o.__importStar(g),b=o.__importStar(b),C=o.__importStar(C),j=o.__importStar(j),Q=o.__importStar(Q),G=o.__importStar(G),ee=o.__importStar(ee),te=o.__importStar(te),oe=o.__importStar(oe),se=o.__importStar(se),re=o.__importStar(re),ie=o.__importStar(ie),t.showNamingConventionsModalIfNeeded=(t,s,r,i)=>o.__awaiter(void 0,void 0,void 0,(function*(){if(E.getQueryArgs().naming_convention&&t){const[{showNamingConventionsModal:t},{NamingConventionOrigin:a}]=yield Promise.all([new Promise((t,o)=>{e(["modules/clean/react/naming_conventions/naming_conventions_modal"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["modules/clean/react/naming_conventions/types"],t,o)}).then(o.__importStar)]);t({currentUserId:s,targetPath:r,namespaceId:i,origin:a.from_desktop}),yield ae.WebUserActionLog.log(s,H.WebUserActionLogEvent.NAMING_CONVENTIONS_OPEN_MODAL,{ns_id:i,origin:a.from_desktop})}})),t.showTidyUpModalIfNeeded=(t,s,r,i,a,n,l,d)=>o.__awaiter(void 0,void 0,void 0,(function*(){if(E.getQueryArgs().tidy_up&&t){const[{showTidyUpModal:t},{TidySpecificActionSurfaceLogValue:c}]=yield Promise.all([new Promise((t,o)=>{e(["modules/clean/react/tidy_up/modal/tidy_up_modal"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["modules/clean/react/tidy_up/modal/types"],t,o)}).then(o.__importStar)]);t({currentUserId:s,targetPath:r,namespaceId:i,isRewindEnabled:n,features:a,actionSurface:H.ActionSurfaceLogValue.DESKTOP_ENTRYPOINT,subfolders:l,isInsideFlowsEligibleFolder:d}),yield ae.WebUserActionLog.log(s,H.WebUserActionLogEvent.TIDY_UP_OPEN_MODAL,{ns_id:i,origin:c.DESKTOP_ENTRYPOINT})}})),t.maybeShowAutoFolderModal=Se;class be extends r.default.Component{constructor(r){super(r),this.deferredCheckForMissingStarredData=s.noop,this.showEmailVerificationModalsIfNeeded=()=>o.__awaiter(this,void 0,void 0,(function*(){if(!(this.props.emailJustVerified||this.props.emailJustVerifiedAndChanged||this.props.sendVerificationEmail))return;const{EmailVerification:t}=yield new Promise((t,o)=>{e(["modules/clean/account/email"],t,o)}).then(o.__importStar);this.props.emailJustVerified?t.getForRole(this.props.user.role).show_verified_modal():this.props.emailJustVerifiedAndChanged?t.getForRole(this.props.user.role).show_verified_and_changed_modal():this.props.sendVerificationEmail&&t.getForRole(this.props.user.role).show_sent_modal()})),this.handlePostTTIPrefetchComplete=s=>o.__awaiter(this,void 0,void 0,(function*(){const r=s["exp-browse-post-tti-experiments"],i=s["exp-uploader-post-tti-experiments"],a=!!s["is-over-free-quota"],n=!!s["maybe-render-team-admin-modals"],l=!!s["has-excluded-ns-ids"],d=s["preferred-editors"],c=s["first-task-props"],u=s["mobile-web-invites"],p=s["family-member-count"],h=s["imm-experiments"],m=s["suggested-folders-to-move-info"],_=s["users-jtbd-interest-info"];r.expShouldShowNcctPaywall&&Q.redirect("/ncct-trial-end"),this.props.setBrowsePostTTIExperiments({browsePostTTIExperiments:r}),this.props.setBrowsePostTTIData({browsePostTTIData:{isOverFreeQuota:a,hasExcludedNsIds:l,uploaderPostTTIExperiments:i,preferredEditors:d,firstTaskProps:c,mobileWebInvites:u,familyMemberCount:p,immExperiments:h,suggestedFoldersToMoveInfo:m,usersJtbdInterestInfo:_}}),q.promptBufferedEventEmitter.on(q.Events.ON_PROMPT_INITIALIZED,t=>o.__awaiter(this,void 0,void 0,(function*(){if((!t||!t.didMainCampaignLoad()&&!t.didCampaignForUserEducationLoad())&&n){const{postTTINCCTReminderModal:t}=yield new Promise((t,o)=>{e(["modules/clean/react/ncct/post_tti_ncct_modal"],t,o)}).then(o.__importStar);t()}})));const{markClinkTooltipSeenAndHide:f,showClinkTooltip:g,TooltipType:w}=yield new Promise((t,o)=>{e(["modules/clean/react/growth/first_task/first_task"],t,o)}).then(o.__importStar),S=null==c?void 0:c.seen_desktop_tooltip,b=null==c?void 0:c.member_info;S?f():(void 0!==p&&p>1||b&&b.users.length>1)&&g(w.Members),yield t.showNamingConventionsModalIfNeeded(r.expNamingConventionsDesktopEntrypoint,this.props.userId,this.props.initFqPath,this.props.nsId),yield t.showTidyUpModalIfNeeded(r.expTidyUpDesktopEntrypoint,this.props.userId,this.props.initFqPath,this.props.nsId,r,this.props.browseExperiments.folderHistoryRollbacks,this.props.unsortedFiles.filter(e=>e.is_dir).toArray(),this.props.isInsideFlowsEligibleFolder),Se({autoFoldersEnabled:r.expFlowsAutomatedFolderUI,isInsideFlowsEligibleFolder:this.props.isInsideFlowsEligibleFolder,fqPath:this.props.initFqPath,nsId:this.props.nsId,user:this.props.user}),r.expEnableBackupWeb&&this.props.setBackupFolders(this.props.user),r.expTeamSpaceTeamTypesSprigSurvey&&_e.UserSurvey.addAttribute("launchTeamSpaceTeamTypesSurvey","true")})),this.handlePostTTIPrefetchError=e=>{G.reportException({err:new Error("failed to load post TTI experiments")})},this.handlePreviewAndShareModalsOnLoad=e=>{const t=this.getPathFromProps(),{user:o}=this.props,s=!!this.props.openPreview,r=!!this.props.showShareModal,i=this.props.sharePrefillEmail,a=i?i.split(","):void 0;if(s&&!e){Z.Notify.error(Y.intl.formatMessage({id:"D+KIIm",defaultMessage:"The file doesn’t exist"}));const{urlPrefix:e}=this.props,o=this.getUrlForFQPath(e,t),s=p.default.deconstruct_url().qargs;delete s.preview,p.default.replace_state(o,s)}e?(R.asyncOpenPreview({containerId:T.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[e],fileViewAction:W.FileViewActionType.CLICK,fileViewOrigin:W.FileViewOriginType.BROWSE,fileViewTarget:W.FileViewTargetType.PRIVATE,indexOfPreviewFile:0,user:o,onFileViewerDidMount:()=>{L.hideElementsBehindFileViewer(),this.props.setIsFileViewerShown({isShown:!0})},onFileViewerUnmount:()=>{L.showElementsBehindFileViewer(),this.props.setIsFileViewerShown({isShown:!1}),this.restoreUrlAfterFileViewClose()}}),r&&j.waitForTTI().then(()=>{this.mounted&&D.asyncShowPrefilledShareModal({user:o,sharePrefillEmails:a,content:e,setUrl:this.props.setUrl})})):r&&this.showShareModalForCurrentPath(a)},this.receiveStateFromStores=()=>{this.setState(this.getStateFromStores())},this.handleComponentTTI=e=>{var t;const o=null!==j.time_to_interactive(),s=(null===(t=this.browseLogger)||void 0===t?void 0:t.ttiLogged)&&"FilesViewController"===e;o||s?this.ajaxRequestWebTimer?(this.ajaxRequestWebTimer.markTimeToInteractive(),delete this.ajaxRequestWebTimer):s||he.markTimeToInteractive(!0):this.browseLogger&&this.browseLogger.componentReady(e)},this.getFileByFilename=e=>this.props.files.find(t=>c.filename(t.fq_path)===e)||null,this.toggleRewindIfNecessary=()=>{const e=E.getQueryArgs().activity||E.getQueryArgs().rewind;e&&!this.props.isRewindVisible&&this.props.showRewind(),!e&&this.props.isRewindVisible&&this.props.hideRewind()},this.toggleFolderHistoryIfNecessary=()=>{const e=E.getQueryArgs().folder_history;e&&!this.props.isFolderHistoryVisible&&this.props.showFolderHistoryPanel(),!e&&this.props.isFolderHistoryVisible&&this.props.hideFolderHistoryPanel()},this.showShareModalForCurrentPath=e=>{const{user:t}=this.props,o=this.getPathFromProps();j.waitForTTI().then(()=>{if(!this.mounted)return;const s=this.props.nsId,r=this.props.nsPath;D.asyncShowPrefilledShareModal({user:t,sharePrefillEmails:e,content:{fqPath:o,isFolder:!0,nsId:s&&r?s:null,targetNsId:s&&!r?s:null},setUrl:this.props.setUrl})})},this.handleMaestroNavigationAction=e=>{if(e.method!==h.NavigationMethod.REDIRECT)return!1;const t=X.URI.parse(e.url);return p.default.push_state(t.getPath(),we(t.getQuery())),!0},this.handleFileLocationChange=(e,t)=>{var o;e=`/${X.URI.decode(e)}`,this.ensureFileViewerIsOpenedOrClosedIfNeeded(t),this.toggleRewindIfNecessary(),this.toggleFolderHistoryIfNecessary();const s=!c.paths_are_equal(this.props.path,e);t.share&&!this.props.showShareModal&&this.showShareModalForCurrentPath();const r="1"===t.d!=!!this.props.shouldShowDeletedFiles;if(!(s||r||t.reload))return;t.reload&&(delete t.reload,this.props.setUrl({path:this.props.path,qargs:t})),this.props.setPath({path:e}),this.props.setLoadingState({loadingState:U.LoadingState.LOADING_FIRST_PAGE,path:e}),this.props.setShouldShowDeletedFiles({shouldShowDeletedFiles:"1"===t.d}),(null!==j.time_to_interactive()||(null===(o=this.browseLogger)||void 0===o?void 0:o.ttiLogged))&&this.ensureTimer("browse_ajax","browse_ajax_nav");const i=this.props.currentSort.sortDirection===O.SortDirection.ASCENDING,a="1"===t.d;this.loadPathApi2({path:e,sortIsAscending:i,includeDeleted:a,hasPathChanged:s})},this.sortType=()=>x.SortIsFilename.includes(this.props.currentSort.sortField)?{".tag":"files_by_name"}:this.props.currentSort.sortField===O.SortField.MODIFIED?{".tag":"files_by_modified"}:{".tag":"files_by_size"},this.loadPathApi2=({path:e,sortIsAscending:t,includeDeleted:s,hasPathChanged:r})=>o.__awaiter(this,void 0,void 0,(function*(){try{const o=yield b.loadPath2({userId:this.props.user.id,path:e,sortType:this.sortType(),sortIsAscending:t,includeDeleted:s,rootNsId:fe.isBackupBrowse()?this.props.nsId:void 0});this.ajaxRequestWebTimer&&(this.ajaxRequestWebTimer.fetchedDataRequiredForTTI(),this.ajaxRequestWebTimer.end()),this.handleFileLocationChangeSuccess(e,o,r)}catch(t){const o=(function(e){let t="";return void 0!==e.status&&("auth_failed"===e.status[".tag"]?t=Y.intl.formatMessage({id:"8nB2Fu",defaultMessage:"Not authorized to browse {path}."},{path:e.path}):"rate_limited"===e.status[".tag"]?t=Y.intl.formatMessage({id:"2NDCop",defaultMessage:"Too many attempts. Try again later."}):"invalid_path"===e.status[".tag"]?t=Y.intl.formatMessage({id:"o19fmC",defaultMessage:"Unsupported path provided {path}."},{path:e.path}):"folder_not_found"===e.status[".tag"]?t=Y.intl.formatMessage({id:"VZE6IM",defaultMessage:"The folder ‘{path}’ doesn’t exist."},{path:e.path}):"folder_is_deleted"===e.status[".tag"]&&(t=Y.intl.formatMessage({id:"qZpUNY",defaultMessage:"The folder ‘{path}’ is deleted."},{path:e.path}))),t})(t.error);o?N.Snackbar.fail(o,"browse"):(G.reportException({err:t,force:!0,severity:G.SEVERITY.CRITICAL,tags:["browse","component:browse"],exc_extra:Object.assign({},t)}),N.Snackbar.fail(Y.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}),"browse")),c.paths_are_equal(e,"/")?this.props.setLoadingState({path:e,loadingState:U.LoadingState.LOAD_ERROR}):this.props.setUrl({path:"/"})}})),this.handleFileLocationChangeSuccess=(e,t,o)=>{if(this.props.setIsRewindButtonEnabled({path:e,userId:this.props.user.id,userSkuHasRewind:!!this.browseExperiments.folderHistoryRollbacks}),this.props.setFolderMemberCounts({contentId:String(t.context.currentNSID),userId:this.props.user.id}),!E.getQueryArgs().query)if(o&&this.props.handleFolderOverviewPrefetch(Object.assign(Object.assign({},t.folderOverview),{path:e,componentNamespace:T.BrowseFolderOverviewComponentNamespace})),this.props.setPath({path:e}),this.props.setMountPoints({mountPoints:t.mountPoints}),t.hasMore){this.props.setPathData({path:e,files:[],context:t.context,paginatedTotalNumFiles:t.paginatedTotalNumFiles,currentFolderInfo:t.currentFolderInfo?P.File.fromApiV2Object(t.currentFolderInfo):void 0}),_.PaginationManager.create({firstPage:{items:t.items,has_more_items:!0,next_request_voucher:t.nextRequestVoucher},keyName:"sjid",userID:this.props.user.id,newDataAvailableCallback:(t,o)=>{const s=t.areAllItemsReady()?U.LoadingState.LOADED:U.LoadingState.LOADING_REMAINING_PAGES;this.props.appendFiles({path:e,files:o.map(e=>"object"==typeof e.type?P.File.fromApiV2Object(e):P.File.fromServerObject(e))}),this.props.setLoadingState({path:e,loadingState:s}),t.areAllItemsReady()&&t.stopAutoFetching()},fetchNextFn:y.apiV2FetchNextFn}).startAutoFetching()}else this.props.setPathData({path:e,files:t.items.map(e=>"object"==typeof e.type?P.File.fromApiV2Object(e):P.File.fromServerObject(e)),paginatedTotalNumFiles:t.paginatedTotalNumFiles,context:t.context,currentFolderInfo:t.currentFolderInfo?P.File.fromApiV2Object(t.currentFolderInfo):void 0}),this.props.setLoadingState({loadingState:U.LoadingState.LOADED,path:e})},this.getPathFromProps=()=>this.props.initFqPath||"/",this.markTTVIfNeeded=()=>{!this.hasTTVBeenLogged&&this.mounted&&this.state.hasPrefetchLoaded&&(he.markTimeToView(),this.hasTTVBeenLogged=!0)},this.handleFileListUpdated=()=>{ge(this.state.fileViewerController)?this.props.files.isEmpty()?this.state.fileViewerController.close():this.state.fileViewerController.updateFiles(this.props.files.toJS()):this.ensureFileViewerIsOpenedOrClosedIfNeeded(E.getQueryArgs()),this.prefetchPreviewData(this.props.files.toArray(),this.props.user)},this.handleOnNavigateToFileOrFolder=(e,t={})=>{const{actionSource:o}=t;this.props.hideRewind();const s=window.pageYOffset;this.completeNavigateToFileOrFolder(e,o,()=>{window.scrollTo({top:s})})},this.completeNavigateToFileOrFolder=(e,t,o)=>{const{vaultApi:s,vaultLoggingTypes:r}=this.state,{user:i,viewer:a,viewType:l,rightRailCollapsed:d}=this.props,{ns_id:p,sjid:h,file_id:m,fq_path:_,bytes:f,ext:w,request_id:b}=e;g.logOpenRow({uid:i.id,entity_type:e.is_dir?"folder":"file",source:"list_browse",view_type:l,file_nsid:p,file_sjid:h,file_id:m,file_name:c.filename(e.fq_path),file_path:_,file_size:f,file_type:e.type,file_extension:w,request_id:b,action_source:t,vaultApi:s,vaultLoggingTypes:r,rightRailState:d?"collapsed":"opened"}),e.type===u.FileTypes.TEAM_SHARED_FOLDER&&n.TeamsWebActionsLogger.log("clicked_team_folder_web",{team_id:a.team_id}),S.browseNavigateActions.navigateToFileOrFolder({file:e,onFileViewerUnmount:o,fileViewAction:W.FileViewActionType.CLICK,skipFileViewerRouting:ue.shouldUseReactRouter(),performSpaRouting:ue.shouldUseReactRouter()})},this.uploadAjaxInterceptor={interceptUploadPrecheck:e=>e,interceptUpload:(e,t)=>{let o=t.ns_id_for_routing;if(!o){const t=this.props.mountPoints,{rootNSID:s}=this.props.browseContext;z.assert(null!=t,"mountPoints is null"),z.assert(null!=s,"rootNSID is null"),o=C.getNsId(t,s,e.dest)}return Object.assign(Object.assign({},t),{ns_id_for_routing:o,ns_id:o})}},this.fileViewerIsShown=()=>ge(this.state.fileViewerController),this.ensureFileViewerClosedIfNotPreviewing=e=>{e&&!e.preview&&ge(this.state.fileViewerController)&&this.state.fileViewerController.close()},this.prefetchPreviewData=(e,t)=>{this.state.fileViewerController&&this.state.fileViewerController.prewarmPreviewData(e,t)},this.ensureFileViewerIsOpenedOrClosedIfNeeded=e=>{if(e.preview&&!ge(this.state.fileViewerController)){const t=this.getFileByFilename(e.preview);t&&S.browseNavigateActions.navigateToFileOrFolder({file:t,skipFileViewerRouting:ue.shouldUseReactRouter()})}else!e.preview&&ge(this.state.fileViewerController)&&this.state.fileViewerController.close()},this.getLearnMoreLinkHandler=()=>{window.open("/help/business/unsynced-team-folder","_blank")},A.uploaderStore.add_change_listener(this.receiveStateFromStores),this.state=Object.assign(Object.assign({},this.getStateFromStores()),{hasPrefetchLoaded:!1})}get browseExperiments(){return this.props.browseExperiments}UNSAFE_componentWillMount(){const{urlPrefix:e,user:t,viewer:o}=this.props,s=this.props.shareLink,r=!!this.props.openPreview,i=this.getPathFromProps();this.browseLogger=new m.PageletLogger("browse",["FilesViewController"],!0,{view_type:this.props.viewType.toLowerCase()}),s||r||(function(e){const t=E.getQueryArgs();p.default.replace_state(e,we(t))})(this.getUrlForFQPath(e,i));const a=o.get_users().map(e=>e.id);V.UserLocalStorage.clearOtherUsers(a);const n=new y.BrowsePrefetchLoader({user:t,path:i,fqPathsToSelect:this.props.selectFqPaths},{onPrefetchComplete:e=>{if(this.setState({hasPrefetchLoaded:!0}),e.isError())this.handlePreviewAndShareModalsOnLoad(null);else{this.handlePreviewAndShareModalsOnLoad(e.fromPreviewFileInfo());const t=e.fromCurrentFolderFileInfo();t?this.props.handleFolderOverviewPrefetch(Object.assign(Object.assign({},t),{path:i,componentNamespace:T.BrowseFolderOverviewComponentNamespace})):this.props.addFolderOverviewLoadedComponent({componentNamespace:T.BrowseFolderOverviewComponentNamespace,component:"draftjs"})}he.markFetchedDataRequiredForTTI(),this.markTTVIfNeeded()},onPrefetchError:e=>{if(M.isInsideVault(i)){const e=void 0===Q.get_hash()?"":"#"+Q.get_hash();Q.redirect(k.VAULT_URL+e)}else this.setState({hasPrefetchLoaded:!0}),G.reportException({err:e||new Error("Failed to prefetch browse data"),severity:"user-error",exc_extra:{path:i}}),this.props.setUrl({path:""}),this.props.setLoadingState({loadingState:U.LoadingState.LOAD_ERROR,path:i}),this.handleFileLocationChange("",{})},onLoadComplete:()=>{},onPostTTIPrefetchComplete:this.handlePostTTIPrefetchComplete,onPostTTIPrefetchError:this.handlePostTTIPrefetchError},{onInitializeEverything:w.browseActions.initializeEverything,onAddFilesAndSetLoadingState:w.browseActions.addFilesAndSetLoadingState});n.isPrefetching()&&n.handlePrefetch();for(const e of T.browseSidebarNavigationCommandIds)h.navigationActionDispatcher.handle(this.handleMaestroNavigationAction,{actionId:e});ue.shouldUseReactRouter()||p.default.add_callback(e,this.handleFileLocationChange,!0)}componentDidMount(){this.mounted=!0;const t=this.getPathFromProps(),{user:r}=this.props,i=this.props.shareLink,n=!!this.props.openPreview,u=this.props.fromSclSyncModal;if(this.props.setIsRewindButtonEnabled({path:t,userId:this.props.user.id,userSkuHasRewind:this.browseExperiments.folderHistoryRollbacks}),this.props.setFolderMemberCounts({contentId:String(this.props.nsId),userId:this.props.user.id}),u&&(r.is_cdm_member?(function(e){const t=Y.intl.formatMessage({id:"7sFPiN",defaultMessage:"Added “{folder_name}” <a>Learn More</a>"},{folder_name:d.Emstring.em_snippet(c.filename(e),a.SNIPPET_SIZES.FILENAME),a:e=>`<a href="/help/business/team-space-overview#acceptfolder">${e}</a>`});Z.Notify.success(new K.HTML(t))})(t):(function(e){Z.Notify.success(Y.intl.formatMessage({id:"YYLxxv",defaultMessage:"{file_name} added to your Dropbox."},{file_name:c.filename(e)}))})(t)),this.props.showShareSuccessSnackbar){const e=c.filename(t);B.showInBandShareSuccessSnackbar(e)}this.shouldShowUnsyncNotification()&&this.showUnsyncNotification(),i&&!n&&r.is_cdm_member&&(function(e){const t=c.parent_dir(e);"/"!==t&&Z.Notify.success(Y.intl.formatMessage({id:"nZ/TMQ",defaultMessage:"Folder is in {path}"},{path:d.Emstring.em_snippet(t,22)}))})(t),this.toggleRewindIfNecessary(),this.toggleFolderHistoryIfNecessary(),this.markTTVIfNeeded(),be.mountFileViewerTarget(),j.waitForTTI().then(()=>{l.require_css("/static/css/main_browse_post_tti-vflsAr2Ev.css");const t=([[e,{SharedWithStore:t},{checkForMissingStarredData:o,StarredStore:r},i,a],[n,l,{BloodhoundContactsV2:d},c,u,p],[h,m]])=>{if(!this.mounted)return;const{user:_,path:g,files:w}=this.props,S=w.toArray();t.initializeWith({path:g,files:S}),o({items:S,user:_});const b=r.addListener(()=>{this.setState({starredState:r.getLoadingStates()})});this.deferredCheckForMissingStarredData=()=>s.defer(()=>{o({items:this.props.files.toArray(),user:_})}),this.removeStarredStoreListener=()=>{b()},d.getOrCreateForUser(_),this.setState({fileViewerController:e,vaultApi:h,vaultLoggingTypes:m}),this.props.setArePostTTIModulesLoaded({arePostTTIModulesLoaded:!0}),this.showEmailVerificationModalsIfNeeded(),this.prefetchPreviewData(w.toArray(),_);const y=this.props.shouldOpenExtensionsEduModal;y&&f.asyncShowExtensionsEduModal(_.id,y)};t.perfName="browse_post_tti",Promise.all([Promise.all([new Promise((t,o)=>{e(["modules/clean/react/file_viewer/controller"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["modules/clean/react/browse/shared_with"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["modules/clean/react/starred/browse_exports"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["modules/clean/react/file_modal_controller"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["modules/clean/sharing/share_modal_util"],t,o)}).then(o.__importStar)]),Promise.all([new Promise((t,o)=>{e(["modules/clean/sharing/ui_util"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["modules/clean/sharing/wizard/wizard_modals"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["modules/clean/contacts/bloodhound_contacts_v2"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["modules/clean/unity_browse_interface"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["modules/clean/unity/features"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["modules/clean/unity/check_file_cache"],t,o)}).then(o.__importStar)]),Promise.all([new Promise((t,o)=>{e(["modules/clean/react/vault/lib/api"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["vault/common/logging-types"],t,o)}).then(o.__importStar)])]).then(t)})}UNSAFE_componentWillUpdate(e,t){e.files.equals(this.props.files)||s.defer(this.handleFileListUpdated)}componentDidUpdate(e){if(e.loadingState===U.LoadingState.LOADING_FIRST_PAGE&&this.props.loadingState!==e.loadingState&&this.markTTVIfNeeded(),e.files!==this.props.files&&this.deferredCheckForMissingStarredData(),ue.shouldUseReactRouter()&&e.location&&this.props.location&&(e.location.pathname!==this.props.location.pathname||e.location.search!==this.props.location.search)){const e=new RegExp(`^${this.props.urlPrefix}/|^${this.props.urlPrefix}|^/`),t=this.props.location.pathname.replace(e,"");this.handleFileLocationChange(t,ne.parseQueryString(this.props.location.search))}}componentWillUnmount(){this.removeStarredStoreListener&&this.removeStarredStoreListener(),be.unmountFileViewerTarget(),A.uploaderStore.remove_change_listener(this.receiveStateFromStores),q.promptBufferedEventEmitter.reset(),this.mounted=!1}getStateFromStores(){return{isDraggingInternalFiles:I.FileUploaderController.isDraggingInternalFiles(),isDraggingExternalFiles:I.FileUploaderController.isDraggingExternalFiles(),isUploadModalOpen:I.FileUploaderController.isUploadModalOpen()}}restoreUrlAfterFileViewClose(){let e;const{urlPrefix:t}=this.props,o=this.getUrlForFQPath(t,this.props.path);e=this.props.openPreview?s.omit(E.getQueryArgs(),T.BrowseQueryArg.preview,T.BrowseQueryArg.select):{},p.default.replace_state(o,e)}getUrlForFQPath(e,t){const{backupFolderPath:o}=this.props;return e===fe.BACKUP_BROWSE_ROOT&&null!==o&&(t=t.substr(t.indexOf(o))),e+("/"===t?"":X.URI.encode_parts(t))}ensureTimer(e,t){this.ajaxRequestWebTimer&&this.ajaxRequestWebTimer.getContextName()!==e&&(this.ajaxRequestWebTimer.abort(),j.delete_timer(this.ajaxRequestWebTimer.getContextName()),this.ajaxRequestWebTimer=void 0),this.ajaxRequestWebTimer?this.ajaxRequestWebTimer.restart():(j.delete_timer(e),this.ajaxRequestWebTimer=j.get_timer(e),this.ajaxRequestWebTimer.initialize({requireTTI:!0,requireTTV:!1,url:t}))}shouldShowUnsyncNotification(){return this.props.shouldShowUnsyncNotification}showUnsyncNotification(){N.Snackbar.show(r.default.createElement(N.Snackbar,{variant:"generic",title:Y.intl.formatMessage({id:"Imk9XS",defaultMessage:"Do you also need this on your computer?"}),timeoutDelayMs:1e5,actionButtonText:Y.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),closeButtonText:Y.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),onActionClick:this.getLearnMoreLinkHandler,id:"browse-unsync"}))}render(){const{isUploadModalOpen:e,starredState:t,isDraggingExternalFiles:o,isDraggingInternalFiles:s}=this.state,{browseContext:i,selection:a,selectedFiles:n,browsePostTTIExperiments:l,canDisplayFolderSizes:d,clickFolderHistoryTimestamp:c,clickRewindTimestamp:u,extensionsFeatureFlags:p,files:h,hideRewind:m,hideFolderHistoryPanel:_,showFolderHistoryPanel:f,isQueryingFolderSizes:g,isRewindVisible:w,isFolderHistoryVisible:S,loadingState:b,paginatedTotalNumFiles:y,path:T,setUrl:P,shouldShowDeletedFiles:E,showRewind:I,user:A,viewType:C,viewTypeColumns:R,sharingServiceInfo:L,shouldShowVaultEmptyState:x,shouldShowFamilyEmptyState:U,pinnedItems:O,emptyFolder:N,browsePostTTIData:k,setHideFilesAndSidebar:M,shouldHideFilesAndSidebar:D,clearSelection:B,rightRailCollapsed:V,unsortedFiles:q,isInsideFlowsEligibleFolder:j,isInsideBackupFolder:H,backupFolderPath:W,currentFolderInfo:z}=this.props,Q=r.default.createElement(v.BrowseUploadProvider,{user:A},r.default.createElement(F.BrowseView,{userVersionHistoryLength:this.props.userVersionHistoryLength,onNavigateToFileOrFolder:this.handleOnNavigateToFileOrFolder,clickRewindTimestamp:u,clickFolderHistoryTimestamp:c,context:i,encryptionOptions:this.props.encryptionOptions,ensureFileViewerClosedIfNotPreviewing:this.ensureFileViewerClosedIfNotPreviewing,files:h,handleComponentTTI:this.handleComponentTTI,isDraggingExternalFiles:o,isDraggingInternalFiles:s,isFileViewerShown:this.fileViewerIsShown,isFolderHistoryVisible:S,isRewindVisible:w,isUploadModalOpen:e,isInsideBackupFolder:H,backupFolderPath:W,loadingState:b,path:T,selectedFiles:n,selection:a,shouldOpenUploadModal:this.props.shouldOpenUploadModal,shouldShowDeletedFiles:E,starredState:t,totalNumItems:y,uploadAjaxInterceptor:this.uploadAjaxInterceptor,user:A,viewType:C,canDisplayFolderSizes:d,columns:R[C],viewTypeColumns:R,isQueryingFolderSizes:g,nsId:this.props.nsId,browseExperiments:this.browseExperiments,browsePostTTIExperiments:l,browsePostTTIData:k,onShowRewind:I,onCloseRewind:m,onCloseFolderHistoryPanel:_,onShowFolderHistoryPanel:f,extensionsFeatureFlags:p,sharingServiceInfo:L,shouldShowVaultEmptyState:x,shouldShowFamilyEmptyState:U,pinnedItems:O,onSetUrl:P,emptyFolder:N,setHideFilesAndSidebar:M,shouldHideFilesAndSidebar:D,clearSelection:B,rightRailCollapsed:V,showPlusPlusSetupModal:this.props.showPlusPlusSetupModal,isSmbPersonalization:this.props.isSmbPersonalization,hasLinkedMobile:this.props.hasLinkedMobile,unsortedFiles:q,isInsideFlowsEligibleFolder:j}));return z&&!H&&de.isBrowseSuggestionsEnabled(this.browseExperiments.browseContentSuggestionsVariant)?r.default.createElement(le.SuggestionsContextProvider,{user:A,fetchSuggestedItemsInFolder:ce.fetchSuggestedItemsInFolder,source:"browse",trackDismissSuggestedItem:ce.trackDismissSuggestedItem,openSuggestedItem:pe.createOpenSuggestedItemFromBrowseFn(this.handleOnNavigateToFileOrFolder),openSuggestedParent:pe.createOpenSuggestedParentFromBrowseFn(e=>{P({path:e})},A),folderPathString:T,prefetchSuggestedItems:me.prefetchSuggestions},Q):Q}}t.BrowseController=be,be.mountFileViewerTarget=()=>{let e=document.getElementById(T.BROWSE_FILE_VIEWER_ELEMENT_ID);e||(e=document.createElement("div"),e.id=T.BROWSE_FILE_VIEWER_ELEMENT_ID,document.body.insertBefore(e,document.body.children[0]))},be.unmountFileViewerTarget=()=>{const e=document.getElementById(T.BROWSE_FILE_VIEWER_ELEMENT_ID);e&&document.body.removeChild(e)},be.displayName="BrowseController";const ye={appendFiles:ee.appendFiles,setIsRewindButtonEnabled:ee.setIsRewindButtonEnabled,hideRewind:ee.hideRewind,showRewind:ee.showRewind,hideFolderHistoryPanel:ee.hideFolderHistoryPanel,showFolderHistoryPanel:ee.showFolderHistoryPanel,setBrowsePostTTIExperiments:ee.setBrowsePostTTIExperiments,setBrowsePostTTIData:ee.setBrowsePostTTIData,setLoadingState:ee.setLoadingState,setMountPoints:ee.setMountPoints,setPath:ee.setPath,setPathData:ee.setPathData,setShouldShowDeletedFiles:ee.setShouldShowDeletedFiles,setUrl:ee.setUrl,setArePostTTIModulesLoaded:ee.setArePostTTIModulesLoaded,setIsFileViewerShown:ee.setIsFileViewerShown,handleFolderOverviewPrefetch:ie.handlePrefetch,addFolderOverviewLoadedComponent:ie.addLoadedComponent,setHideFilesAndSidebar:ee.setHideFilesAndSidebar,clearSelection:ee.clearSelection,setFolderMemberCounts:ee.setFolderMemberCounts,setBackupFolders:ee.setBackupFolders},ve=J.connect(e=>{const{context:t,sortedFilesWithFolderSizes:o,isFolderHistoryVisible:s,path:r,selection:i,selectedFiles:a,shouldShowDeletedFiles:n,isRewindVisible:l,urlPrefix:d,canDisplayFolderSizes:c,isQueryingFolderSizes:u,user:p,viewer:h,browsePostTTIExperiments:m,mountPoints:_,clickRewindTimestamp:f,clickFolderHistoryTimestamp:g,sortOrder:w,browsePostTTIData:S,shouldHideFilesAndSidebar:b,isRightRailCollapsed:y,isSelectedBackupFolder:v,isInsideBackupFolder:F,backupFolderPath:P,unsortedFiles:E,isInsideFlowsEligibleFolder:I,getCurrentFolderInfo:A,browseLoadingState:C}=oe,{paginatedTotalNumFiles:R,folderOverviewPinnedItems:L,shouldShowVaultEmptyState:x,shouldShowFamilyEmptyState:U}=te,{viewTypeColumns:O}=se,{selectViewType:N}=re;return $.asyncExtensions.init(),{files:o(e),paginatedTotalNumFiles:R(e),loadingState:C(e),path:r(e),shouldShowDeletedFiles:n(e),isFolderHistoryVisible:s(e),isRewindVisible:l(e),clickRewindTimestamp:f(e),clickFolderHistoryTimestamp:g(e),urlPrefix:d(e),canDisplayFolderSizes:c(e),viewTypeColumns:O(e),isQueryingFolderSizes:u(e),user:p(e),viewer:h(e),currentSort:w(e),browsePostTTIExperiments:m(e),browseContext:t(e),selection:i(e),selectedFiles:a(e),mountPoints:_(e),viewType:N(e,{instanceId:T.BROWSE_FILES_VIEW_ID}),sharingServiceInfo:$.asyncExtensions.sharingServiceInfo(e),extensionsFeatureFlags:$.asyncExtensions.getFeatureFlags(e),pinnedItems:L(e),emptyFolder:0===o(e).count(),shouldShowVaultEmptyState:x(e),shouldShowFamilyEmptyState:U(e),browsePostTTIData:S(e),shouldHideFilesAndSidebar:b(e),rightRailCollapsed:y(e),isSelectedBackupFolder:v(e),isInsideBackupFolder:F(e),backupFolderPath:P(e),unsortedFiles:E(e),isInsideFlowsEligibleFolder:I(e),currentFolderInfo:A(e)}},ye);t.ConnectedBrowseControllerElement=ve(be),t.ConnectedBrowseControllerElementWithRouter=i.withRouter(t.ConnectedBrowseControllerElement)})),define("modules/clean/react/file_uploader/store",["require","exports","tslib","immutable","modules/clean/flux/base_store","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/team_access_levels_definition","modules/clean/react/file_uploader/utils","modules/core/assert","modules/core/exception"],(function(e,t,o,s,r,i,a,n,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploaderStore=t.UploaderStoreClass=void 0,s=o.__importStar(s);class c extends r.Store{_init(){this._path="/",this._hasPermissionToUploadToFolder=!0,this._folderNsId=null,this._user=null,this._fileList=s.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._inlineStatusShouldBeDismissed=!1,this._isMovingIntoVault=!1,this._isPermissionsAtUploadModalOpen=!1,this._numSecondsLeft=0,this._currentFileNumSecondsLeft=0,this._confirmedFSWs=[],this._confirmedFSWBatchIds=[],this._hasOverquotaError=!1,this._allUploadsComplete=!1,this._teamAccessLevelsDefinition=new a.TeamAccessLevelsDefinition,this._targetSurface="none"}fileList(){return this._fileList}currentUpload(){const e=this._currentUploadId;if(!e)return null;const t=this._fileList.get(e);return t||null}uploadById(e){let t;return e&&(t=this._fileList.get(e)),t||void 0}numSecondsLeft(){return this._numSecondsLeft}currentFileNumSecondsLeft(){return this._currentFileNumSecondsLeft}isUploadCancelled(e){const t=this._fileList.get(e);return!!t&&t.status===i.FileStatusType.CANCELLED}inlineStatusShouldBeDismissed(){return this._inlineStatusShouldBeDismissed}isMovingIntoVault(){return this._isMovingIntoVault}isPermissionsAtUploadModalOpen(){return this._isPermissionsAtUploadModalOpen}path(){return this._path}folderNsId(){return this._folderNsId}hasPermissionToUploadToFolder(){return this._hasPermissionToUploadToFolder}user(){return this._user}nextUpload(){return this._fileList.find(e=>e.status===i.FileStatusType.PENDING)}numDraggingFiles(){return this._numDraggingFiles}isInternalTransfer(){return this._isInternalTransfer}isUploadInProgress(){return this._fileList.some(e=>e.status===i.FileStatusType.UPLOADING||e.status===i.FileStatusType.PENDING)}isUploadModalOpen(){return this._isUploadModalOpen}confirmedFSWs(){return this._confirmedFSWs}confirmedFSWBatchIds(){return this._confirmedFSWBatchIds}hasOverquotaError(){return this._hasOverquotaError}allUploadsComplete(){return this._allUploadsComplete}getTeamAccessLevelsDefinition(){return this._teamAccessLevelsDefinition}getTeamAccessLevel(e){return this._teamAccessLevelsDefinition.getTeamAccessLevel(e)}targetSurface(){return this._targetSurface}setUser({user:e}){this._user=e,this.emit_change()}setPath({path:e,hasPermissionToUploadToFolder:t=!0,isMovingIntoVault:o=!1,targetSurface:s="none"}){this._path=e,this._hasPermissionToUploadToFolder=t,this._confirmedFSWs=[],this._isMovingIntoVault=o,this._targetSurface=s,this.emit_change()}setFolderNsId({folderNsId:e}){this._folderNsId=e}setHasOverquotaError({hasOverquotaError:e}){this._hasOverquotaError=e,this.emit_change()}addTeamAccessLevel({path:e,accessLevel:t}){this._teamAccessLevelsDefinition=this._teamAccessLevelsDefinition.addTeamAccessLevel(e,t),this.emit_change()}resetTeamAccessLevels(){this._teamAccessLevelsDefinition=new a.TeamAccessLevelsDefinition,this.emit_change()}queueUploads({files:e}){const t={};for(const o of e)t[o.uploadId]=o;this._fileList=this._fileList.merge(t),this.emit_change()}readyUploads({files:e}){for(const t of e)this._fileList=this._fileList.update(t.uploadId,e=>e.set("status",i.FileStatusType.PENDING));this.emit_change()}handleAllUploadsComplete(){this._allUploadsComplete=!0,this.emit_change()}startUpload({file:e,allowParallelUpload:t}){t||l.assert(null==this.currentUpload(),"can't start an unload while one is ongoing"),l.assert(null!=e,"missing file to upload"),l.assert(this._fileList.get(e.uploadId)===e,"failed to find file in file list"),this._fileList.get(e.uploadId)&&(this._fileList=this._fileList.update(e.uploadId,e=>e.set("status",i.FileStatusType.UPLOADING)),this._currentUploadId=t?null:e.uploadId,this._allUploadsComplete=!1),this.emit_change()}completeUpload({uploadId:e,allowParallelUpload:t}){const o=this._fileList.get(e);o&&((e!==this._currentUploadId&&!t||o.status!==i.FileStatusType.UPLOADING)&&d.reportStack("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:o.toString(),fileListLength:this._fileList.count(),uploadId:e,currentUploadId:this._currentUploadId}}),this._fileList=this._fileList.update(e,e=>e.set("status",i.FileStatusType.COMPLETE))),this._currentUploadId=null,this.emit_change()}cancelUploads({files:e}){for(const t of e)this._fileList=this._fileList.update(t.uploadId,(function(e){return e.status===i.FileStatusType.SET_PERMISSIONS||e.status===i.FileStatusType.PENDING||e.status===i.FileStatusType.UPLOADING?e.set("status",i.FileStatusType.CANCELLED):e})),t.uploadId===this._currentUploadId&&(this._currentUploadId=null);this.emit_change()}setCurrentUploadProgress({percentComplete:e,numSecondsLeft:t}){const o=this._currentUploadId;o&&(this._fileList=this._fileList.update(o,t=>t.set("percentUploaded",e)),void 0!==t&&(this._numSecondsLeft=t)),this.emit_change()}handleUploadError({uploadId:e,errorType:t,errorMessage:o,allowParallelUpload:s}){const r=this._fileList.get(e);r&&(r.uploadId===this._currentUploadId||s||d.reportStack("Error reported for file upload that is not the current upload",{exc_extra:{file:r.toString(),fileListLength:this._fileList.count(),uploadId:e,currentUploadId:this._currentUploadId,errorType:t,errorMessage:o}}),this._fileList=this._fileList.update(r.uploadId,e=>e.set("status",i.FileStatusType.FAILED).set("errorType",t).set("errorMessage",o))),this._currentUploadId=null,this.emit_change()}setNumDraggingFiles({numDraggingFiles:e,isInternalTransfer:t=!1}){this._numDraggingFiles=e,this._isInternalTransfer=t,this.emit_change()}setIsUploadModalOpen({isUploadModalOpen:e}){this._isUploadModalOpen=e,this.emit_change()}setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:e}){this._inlineStatusShouldBeDismissed=e,this.emit_change()}setIsPermissionsAtUploadModalOpen({isPermissionsAtUploadModalOpen:e}){this._isPermissionsAtUploadModalOpen=e,this.emit_change()}addNewFailedFile({file:e,errorType:t,errorMessage:o}){null==e.uploadId&&(e=e.set("uploadId",n.generateUploadId())),e=e.set("status",i.FileStatusType.FAILED).set("errorType",t).set("errorMessage",o),this._fileList=this._fileList.set(e.uploadId,e),this.emit_change()}confirmFSW({fswIds:e,batchId:t}){e.forEach(e=>{this._confirmedFSWs.includes(e)||this._confirmedFSWs.push(e)}),this._confirmedFSWBatchIds.includes(t)||this._confirmedFSWBatchIds.push(t)}setUploadProgress({uploadId:e,percentComplete:t,numSecondsLeft:o}){if(e&&(this._fileList=this._fileList.update(e,e=>e.set("percentUploaded",t)),void 0!==o&&(this._numSecondsLeft=o),t>0&&t<100)){this._fileList.get(e)&&(this._fileList=this._fileList.update(e,e=>e.set("status",i.FileStatusType.UPLOADING)))}this.emit_change()}setFileUploadTimeLeft({uploadId:e,numSecondsLeft:t}){e&&(this._fileList=this._fileList.update(e,e=>e.set("numSecondsLeft",t)),this.emit_change())}_new_payload(e){const{action:t}=e;switch(t.type){case i.UploaderActionType.SET_USER:this.setUser(t.data);break;case i.UploaderActionType.SET_PATH:this.setPath(t.data);break;case i.UploaderActionType.SET_FOLDER_NS_ID:this.setFolderNsId(t.data);break;case i.UploaderActionType.QUEUE_UPLOADS:this.queueUploads(t.data);break;case i.UploaderActionType.READY_UPLOADS:this.readyUploads(t.data);break;case i.UploaderActionType.START_UPLOAD:this.startUpload(t.data);break;case i.UploaderActionType.COMPLETE_UPLOAD:this.completeUpload(t.data);break;case i.UploaderActionType.ALL_UPLOADS_COMPLETE:this.handleAllUploadsComplete();break;case i.UploaderActionType.CANCEL_UPLOADS:this.cancelUploads(t.data);break;case i.UploaderActionType.SET_CURRENT_UPLOAD_PROGRESS:this.setCurrentUploadProgress(t.data);break;case i.UploaderActionType.UPLOAD_ERROR:this.handleUploadError(t.data);break;case i.UploaderActionType.SET_NUM_DRAGGING_FILES:this.setNumDraggingFiles(t.data);break;case i.UploaderActionType.SET_IS_UPLOAD_MODAL_OPEN:this.setIsUploadModalOpen(t.data);break;case i.UploaderActionType.SET_INLINE_STATUS_SHOULD_BE_DISMISSED:this.setInlineStatusShouldBeDismissed(t.data);break;case i.UploaderActionType.ADD_NEW_FAILED_FILE:this.addNewFailedFile(t.data);break;case i.UploaderActionType.CONFIRM_FSW:this.confirmFSW(t.data);break;case i.UploaderActionType.SET_HAS_OVERQUOTA_ERROR:this.setHasOverquotaError(t.data);break;case i.UploaderActionType.SET_IS_PERMISSIONS_AT_UPLOAD_MODAL_OPEN:this.setIsPermissionsAtUploadModalOpen(t.data);break;case i.UploaderActionType.ADD_TEAM_ACCESS_LEVEL:this.addTeamAccessLevel(t.data);break;case i.UploaderActionType.RESET_TEAM_ACCESS_LEVELS:this.resetTeamAccessLevels();break;case i.UploaderActionType.SET_UPLOAD_PROGRESS:this.setUploadProgress(t.data);break;case i.UploaderActionType.SET_FILE_UPLOAD_TIME_LEFT:this.setFileUploadTimeLeft(t.data)}}}t.UploaderStoreClass=c,t.uploaderStore=new c})),define("modules/clean/react/browse/components/file_breadcrumb",["require","exports","tslib","react","dig-components/breadcrumb","modules/clean/filepath/filepath","modules/clean/viewer","modules/clean/browse_uri_interface","modules/clean/pnm/utils"],(function(e,t,o,s,r,i,a,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileBreadcrumb=void 0,s=o.__importStar(s),i=o.__importStar(i),t.FileBreadcrumb=s.memo(e=>{var{path:t,size:d,user:c,useFullPath:u,isForCurrentPath:p,setUrl:h}=e,m=o.__rest(e,["path","size","user","useFullPath","isForCurrentPath","setUrl"]);const _=i.normalize(t),f=a.Viewer.get_root_name(c),g=i.parent_dirs(_).reverse();return g.unshift(""),u&&""!==_&&g.push(_),s.createElement(r.Breadcrumb,Object.assign({size:d,isRootOverflow:!0},m),g.map((e,t)=>{const o=p&&t===g.length-1,a=o?void 0:n.browse_uri_for_fq_path(c,e).toString(),d=o?void 0:(function(e,t){return o=>{0===o.button&&(o.altKey||o.ctrlKey||o.metaKey||o.shiftKey)||(o.preventDefault(),t(e))}})(e,h);return s.createElement(r.Breadcrumb.Link,{key:i.filename(e,f),href:a,isCurrentPath:o,onClick:d,className:"file-breadcrumb-link"},l.getDisplayedFilename(i.filename(e,f)))}))}),t.FileBreadcrumb.displayName="FileBreadcrumb"})),define("modules/clean/sync_everything/components/backup_breadcrumb",["require","exports","tslib","react","react-intl","dig-components/breadcrumb","modules/clean/filepath/filepath","modules/clean/browse_uri_interface","modules/clean/pnm/utils","modules/core/browser"],(function(e,t,o,s,r,i,a,n,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackupBreadcrumb=void 0,s=o.__importStar(s),a=o.__importStar(a),d=o.__importStar(d);const c="https://www.dropbox.com/backup/all?_source=breadcrumb";function u(e,t){return o=>{0===o.button&&(o.altKey||o.ctrlKey||o.metaKey||o.shiftKey)||(o.preventDefault(),t(e))}}t.BackupBreadcrumb=s.memo(e=>{var{basePath:t,path:p,size:h,user:m,useFullPath:_,isForCurrentPath:f,setUrl:g}=e,w=o.__rest(e,["basePath","path","size","user","useFullPath","isForCurrentPath","setUrl"]);const S=a.normalize(a.parent_dir(t)),b=a.normalize(p).replace(S,""),y=a.parent_dirs(b).reverse().map(e=>S+e);return _&&""!==b&&y.push(S+b),s.createElement(i.Breadcrumb,Object.assign({size:h,isRootOverflow:!0},w),s.createElement(i.Breadcrumb.Link,{key:"breadcrumb-backup",href:c,isCurrentPath:!1,onClick:u(c,d.redirect),className:"file-breadcrumb-link"},s.createElement(r.FormattedMessage,{id:"96Ymix",defaultMessage:"Backups"})),y.map((e,t)=>{const o=f&&t===y.length-1,r=o?void 0:n.browse_uri_for_fq_path(m,e).toString(),d=o?void 0:u(e,g);return s.createElement(i.Breadcrumb.Link,{key:a.filename(e),href:r,isCurrentPath:o,onClick:d,className:"file-breadcrumb-link"},l.getDisplayedFilename(a.filename(e)))}))}),t.BackupBreadcrumb.displayName="BackupBreadcrumb"})),define("modules/clean/react/file_uploader/upload_kit_provider",["require","exports","tslib","react","modules/clean/filepath/filepath","modules/clean/react/file_uploader/actions_adapter","modules/clean/react/file_uploader/api","modules/clean/react/file_uploader/parallel_scheduler_with_batch_commit","modules/clean/react/file_uploader/processors","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/react/upload_kit/uploader/context"],(function(e,t,o,s,r,i,a,n,l,d,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploadKitProvider=void 0,s=o.__importDefault(s),r=o.__importStar(r),a=o.__importStar(a);class p extends s.default.Component{constructor(){super(...arguments),this.allProcessedFiles=[],this.onBeforeUpload=e=>new Promise(t=>{i.ActionsAdapter.emit("beforeUpload",{uploadItems:e,beforeUploadComplete:({items:e})=>{t(e)}})}),this.onFilesAdded=(e,t)=>new Promise(o=>{i.ActionsAdapter.emit("filesAdded",{uploadItems:e,allUploadItems:t,filesAddedComplete:o,chooseDestination:this.props.chooseDestination})}),this.processFiles=(e,t)=>o.__awaiter(this,void 0,void 0,(function*(){let o;t.forEach(({item:e,error:t})=>{i.ActionsAdapter.emit("error",{user:this.props.user,uploadItem:e,errorType:i.convertValidationError(t),loggingOnly:!0})});try{o=this.props.processFiles?yield this.props.processFiles(e,t):yield l.processFiles(e,t)}catch(e){o=[]}return this.allProcessedFiles=[...this.allProcessedFiles,...o],o=yield this.onFilesAdded(o,this.allProcessedFiles),o=yield this.onBeforeUpload(o),this.allProcessedFiles=[],{items:o,errors:t}})),this.nsIdForRouting=e=>{if(this.props.nsIdForRouting)return this.props.nsIdForRouting(e);const t=d.uploaderStore.path(),o=d.uploaderStore.folderNsId();return""===r.normalize(t)?this.props.user.root_ns_id:null!==o?o:this.props.user.root_ns_id},this.uploadBlock=(e,t,s)=>o.__awaiter(this,void 0,void 0,(function*(){const o=t=>{s&&s(t.loaded),i.ActionsAdapter.emit("uploadProgress",{uploadItem:e})};i.ActionsAdapter.emit("blockUploadStart",{blob:t});let r=0;const{response:n,retryCount:l}=yield c.promiseWithRetries(()=>a.uploadBlock(this.props.user.id,this.nsIdForRouting(e),e.bytes,t,o),2);if(r+=l,n.isError)throw i.ActionsAdapter.emit("error",{uploadItem:e,errorType:n.error.type,user:this.props.user,errorMessage:n.error.message,errorMethodSource:n.error.method,totalRetryCount:r}),new Error;return i.ActionsAdapter.emit("blockUploadEnd",{blob:t,totalRetryCount:r}),n.result.token})),this.commitBlocksBatchAPIV2=e=>o.__awaiter(this,void 0,void 0,(function*(){if(e.length>3){const t=e.map(({info:e,tokens:t})=>({file_name:r.filename(e.destPath),destination:c.getDestinationDir(e.parentPath||"",e.destPath),file_size:e.bytes,block_tokens:t,local_identifier:e.id}));let o=0;const{response:s,retryCount:n}=yield c.promiseWithRetries(()=>a.commitBlocksBatch(this.props.user.id,t,e.map(e=>e.info)),2);o+=n;const l=[];return s.isError?e.map(({info:e,tokens:t})=>{i.ActionsAdapter.emit("error",{uploadItem:e,errorType:s.error.type,user:this.props.user,errorMessage:s.error.message,errorMethodSource:s.error.method,totalRetryCount:o,useBatchCommit:!0}),l.push({filePath:e.destPath,success:!1})}):s.result.forEach(e=>{e.status.isError?(i.ActionsAdapter.emit("error",{uploadItem:e.uploadItem,errorType:e.status.error.type,user:this.props.user,errorMessage:e.status.error.message,errorMethodSource:e.status.error.method,totalRetryCount:o,useBatchCommit:!0}),l.push({filePath:e.uploadItem.destPath,success:!1})):(i.ActionsAdapter.emit("fileUploaded",{uploadItem:e.uploadItem,totalRetryCount:o,useBatchCommit:!0}),l.push({filePath:e.uploadItem.destPath,success:!0}))}),Promise.resolve(l)}{const t=[];for(const{info:o,tokens:s}of e){let e=0;const{response:n,retryCount:l}=yield c.promiseWithRetries(()=>{var e;return a.commitBlocks(this.props.user.id,c.getDestinationDir(o.parentPath||"",o.destPath),r.filename(o.destPath),o.bytes,s,this.props.user.root_ns_id,null!==(e=o.file.lastModified)&&void 0!==e?e:0)},2);e+=l,n.isError?(i.ActionsAdapter.emit("error",{uploadItem:o,errorType:n.error.type,user:this.props.user,errorMessage:n.error.message,errorMethodSource:n.error.method,totalRetryCount:e,useBatchCommit:!0}),t.push({filePath:o.destPath,success:!1})):(i.ActionsAdapter.emit("fileUploaded",{uploadItem:o,totalRetryCount:e,useBatchCommit:!0}),t.push({filePath:o.destPath,success:!0}))}return Promise.resolve(t)}}))}render(){return s.default.createElement(u.UploadProvider,{userId:this.props.user.id,selectMultiple:!0,onChoose:this.props.onChoose,onChooseDropboxFile:this.props.onChooseDropboxFile,processFiles:this.processFiles,commitBlocksBatch:this.commitBlocksBatchAPIV2,uploadBlock:this.uploadBlock,maxFileSize:524288e5,startUploadOnAdd:!0,Scheduler:n.ParallelUploadSchedulerWithBatchCommit},this.props.children)}}t.UploadKitProvider=p,p.displayName="UploadKitProvider"})),define("modules/clean/react/file_uploader/actions_adapter",["require","exports","tslib","eventemitter3","modules/clean/filepath/filepath","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/constants","modules/clean/react/upload_kit/lib/types"],(function(e,t,o,s,r,i,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.convertValidationError=t.convertUploadItem=t.ActionsAdapter=void 0,s=o.__importDefault(s),r=o.__importStar(r);const l=new s.default;t.ActionsAdapter={emit(e,t){l.emit(e,t)},on:(e,t)=>l.on(e,t),removeAllListeners(){l.removeAllListeners()},eventNames:()=>l.eventNames()},t.convertUploadItem=function({bytes:e,destPath:t,id:o,parentPath:s,bytesUploaded:n},l={}){var d;const c=null===(d=i.uploaderStore.user())||void 0===d?void 0:d.id,u=r.parent_dir(t),p=r.normalize(s)+r.normalize(u);return new a.FileUpload(Object.assign({uploadId:o,dest:p,name:r.filename(t),size:e,userId:c,percentUploaded:e>0?Math.ceil(n/e*100):100},l))},t.convertValidationError=function(e){switch(e){case n.UploadErrorType.EmptyFile:return a.UploadErrorType.EMPTY_OR_FOLDER;case n.UploadErrorType.IgnoredFile:return a.UploadErrorType.IGNORED;case n.UploadErrorType.OverMaxFileSize:return a.UploadErrorType.FILE_SIZE_ERROR;case n.UploadErrorType.PointerFile:case n.UploadErrorType.TemporaryFile:return a.UploadErrorType.INVALID_EXTENSION;case n.UploadErrorType.CloudDoc:case n.UploadErrorType.Unknown:default:return a.UploadErrorType.GENERIC}}}));var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,o,s){void 0===s&&(s=o),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,s){void 0===s&&(s=o),e[s]=t[o]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t};define("modules/clean/react/growth/invite_facepile_loader",["require","exports","modules/clean/react/async/loadable"],(function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InviteFacepileLoadable=void 0;const s={loader:()=>new Promise((t,o)=>{e(["modules/clean/react/growth/invite_facepile"],t,o)}).then(__importStar).then(({InviteFacepile:e})=>e)};t.InviteFacepileLoadable=o.Loadable(s)})),define("modules/clean/react/file_uploader/team_access_levels_definition",["require","exports","modules/clean/filepath/filepath"],(function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TeamAccessLevelsDefinition=void 0;class s{constructor(e){this.teamAccessLevelsDefinition=e||[]}hasDefinitions(){return!!this.teamAccessLevelsDefinition.length}addTeamAccessLevel(e,t){const o=this.teamAccessLevelsDefinition.filter(t=>t.path!==e);return new s([...o,{path:e,accessLevel:t}])}getTeamAccessLevel(e){if(!this.teamAccessLevelsDefinition.length)return null;const t=this.teamAccessLevelsDefinition.reduce((t,s)=>{const r=o.inSubDirectory(s.path,e)||o.paths_are_equal(s.path,e);if(!t)return r?s:null;const i=o.normalize(t.path),a=o.normalize(s.path),n=i.length<a.length;return r&&n?s:t},null);return t?t.accessLevel:null}}t.TeamAccessLevelsDefinition=s})),define("modules/clean/react/file_uploader/processors",["require","exports","tslib","modules/clean/react/upload_kit/lib/processors","modules/clean/filepath/filepath","modules/clean/react/file_uploader/utils","modules/clean/react/upload_kit/lib/types"],(function(e,t,o,s,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processFiles=void 0,t.processFiles=function(e,t){return o.__awaiter(this,void 0,void 0,(function*(){return e=s.resolveDuplicates(e),yield(function(e,t){return o.__awaiter(this,void 0,void 0,(function*(){e.length&&(yield i.showInvalidFileWarning(e.map(({item:e,error:t})=>({name:r.filename(e.destPath),validationError:t})),t,!0))}))})(t,0===e.length),(function(e){o.__awaiter(this,void 0,void 0,(function*(){e.forEach(e=>{e.file instanceof File&&!a.isChooserFile(e.file)&&!a.isWebkitFile(e.file)&&(e.file.webkitRelativePath="/")})}))})(e),e}))}})),define("modules/clean/react/family/family_browse_root_async",["require","exports","tslib","react"],(function(e,t,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncFamilyRoot=void 0,s=o.__importStar(s);const{lazy:r,Suspense:i}=s,a=r(()=>o.__awaiter(void 0,void 0,void 0,(function*(){const{FamilyBrowseRoot:t}=yield new Promise((t,o)=>{e(["modules/clean/react/family/family_browse_root"],t,o)}).then(o.__importStar);return{default:t}})));t.AsyncFamilyRoot=e=>s.createElement(i,{fallback:s.createElement("div",null)},s.createElement(a,Object.assign({},e)))})),define("modules/clean/react/browse/browse_view",["require","exports","tslib","classnames","immutable","react","modules/clean/browse_uri_interface","modules/clean/react/browse/action_logger","modules/clean/react/browse/browse_async_modules","modules/clean/react/browse/browse_files_view","modules/clean/react/browse/uri_helper","modules/clean/react/family/family_browse_root_async","modules/clean/react/file_uploader/file_uploader","modules/clean/react/files_view/types","modules/clean/react/files_view/view_type","modules/clean/react/folder_subscriptions/customization/async_customization_modal","modules/clean/react/folder_subscriptions/follow/async_folder_unfollower","modules/clean/react/plusplus/loadables","modules/clean/react/vault/vault_browse_root_async","modules/clean/web_timing_logger","modules/core/i18n","modules/clean/react/flows/components/flows_browse_root_async","modules/clean/react/browse/components/file_breadcrumb","modules/clean/react/browse/browse_view_mode_toggle","modules/clean/web_user_action_events","modules/clean/react/files_view/util","modules/clean/react/browse/selection_indicator","modules/clean/user_survey/user_survey","modules/clean/filepath/filepath","dig-components/typography","modules/clean/filepath/filepath","modules/clean/sync_everything/components/backup_breadcrumb","modules/clean/react/browse/tidy_up_actions","modules/clean/react/browse/data/store","modules/clean/react/browse/data/selectors","modules/clean/react/edison/spa_chrome","modules/clean/react/edison/router_utils"],(function(e,t,o,s,r,i,a,n,l,d,c,u,p,h,m,_,f,g,w,S,b,y,v,F,T,P,E,I,A,C,R,L,x,U,O,N,k){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseView=void 0,s=o.__importDefault(s),r=o.__importStar(r),i=o.__importDefault(i),n=o.__importStar(n),R=o.__importStar(R),O=o.__importStar(O);class M extends i.default.PureComponent{constructor(e){super(e),this.vaultEmptyContentSlot=i.default.createRef(),this.vaultContentSlot=i.default.createRef(),this.vaultLockButtonSlot=i.default.createRef(),this.handleUploadButtonClick=e=>{p.FileUploaderController.setPath(this.props.path),p.FileUploaderController.handleUploadButtonClick(e)},this.handleShowFileUploader=()=>{p.FileUploaderController.setPath(this.props.path),p.FileUploaderController.showModal()},this.isInTeamSpaceRoot=()=>this.props.context.isInsideMyTeamFolderTree&&this.props.context.isCurrentlyInRoot,this.isModifiedFamilyRoomFacepile=()=>this.props.context.isInsideFamilySharedFolder,this.showFamilyRoomFacepileEnhancements=()=>this.props.context.isInsideFamilySharedFolder,this.isFirstTaskEmptyState=()=>this.props.browsePostTTIData.firstTaskProps.is_eligible_team&&this.isInTeamSpaceRoot()&&1===this.props.totalNumItems,this.setHideFilesAndSidebar=e=>{this.props.setHideFilesAndSidebar({shouldHideFilesAndSidebar:e})},this.setContentSlot=e=>{this.setState({contentSlot:e}),this.vaultContentSlot.current=e},this.setEmptyContentSlot=e=>{this.setState({emptyContentSlot:e}),this.vaultEmptyContentSlot.current=e},this.renderFilesViewController=(e,t)=>this.props.loadingState===h.LoadingState.LOAD_ERROR?i.default.createElement(i.default.Suspense,{fallback:i.default.createElement("div",null,b.intl.formatMessage({id:"zD5i93",defaultMessage:"Something went wrong on our end."}))},i.default.createElement(D,null)):i.default.createElement(d.BrowseFilesView,{responsive:e,contentSlot:this.setContentSlot,emptyContentSlot:this.setEmptyContentSlot,isFirstTaskEmptyState:this.isFirstTaskEmptyState(),initialTotalNumItems:this.state.initialTotalNumItems,handleShowFileUploader:this.handleShowFileUploader,handleUploadButtonClick:this.handleUploadButtonClick,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isUploadModalOpen:this.props.isUploadModalOpen,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,isFileViewerShown:this.props.isFileViewerShown,handleComponentTTI:this.props.handleComponentTTI,starredState:this.props.starredState,initialHideState:this.state.initialHideState,uploadAjaxInterceptor:this.props.uploadAjaxInterceptor,isActive:!!t,isRightRailEnabled:!0}),this.renderSidebar=e=>this.props.shouldHideFilesAndSidebar?null:i.default.createElement(l.AsyncBrowseRightRail,{responsive:e,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,isCollapsed:this.props.rightRailCollapsed}),this.renderTitle=()=>e=>{const{context:t,path:o,user:r,selectedFiles:a,rightRailCollapsed:n,isInsideBackupFolder:d,backupFolderPath:c}=this.props,u=this.isModifiedFamilyRoomFacepile(),p=!e.isResponsive||e.isMatchedLarge,h=u&&n,m=this.showFamilyRoomFacepileEnhancements(),_=d&&c?i.default.createElement(L.BackupBreadcrumb,{path:o,basePath:c,size:m?"small":"standard",user:r,useFullPath:!0,isForCurrentPath:!0,setUrl:this.setUrl,className:s.default({"browse-title-file-pathbar":!m}),key:o}):i.default.createElement(v.FileBreadcrumb,{path:o,size:m?"small":"standard",user:r,useFullPath:!0,isForCurrentPath:!0,setUrl:this.setUrl,className:s.default({"browse-title-file-pathbar":!m}),key:o});return i.default.createElement(i.default.Fragment,null,i.default.createElement("div",{className:s.default("brws-file-pathbar-row",{"family-brws-file-pathbar-row":m}),onClick:this.clearSelection},t.isInsideVaultFolder&&i.default.createElement("div",{ref:this.vaultLockButtonSlot}),m&&i.default.createElement("div",{className:"browse-title-file-pathbar"},i.default.createElement(C.Title,{className:"family-browse-title"},R.filename(o)),_),!m&&_,i.default.createElement("div",{className:"brws-selection-view-mode-container"},!m&&i.default.createElement(E.SelectionIndicator,{responsive:e,selectedFilesCount:a.size,rightRailCollapsed:n,isInFamilyFolder:t.isInFamilySharedFolder}),!u&&i.default.createElement(F.BrowseViewModeToggle,{user:r}),h&&i.default.createElement("div",{className:"family-room-sharing-view"},i.default.createElement(l.AsyncBrowseSharingView,{useCompactMode:!p})))))},this.setUrl=e=>{if(""===e){const e=U.getStoreForBrowse().getState();O.postTTIExperiments(e)&&O.postTTIExperiments(e).expTidyUpBrowse&&O.context(e).isCurrentPathWriteable()&&setTimeout(()=>{"/"===O.path(U.getStoreForBrowse().getState())&&x.promptTidyUp(O.user(e).id,"",O.context(e).currentNSID)},5e3)}this.props.onSetUrl({path:e})},this.clearSelection=e=>{P.shouldClickDeselect(e,!0)&&this.props.clearSelection({actionSource:T.ActionSourceValue.WHITESPACE})},this.state={searchBarProps:this.getCurrentSearchBarProps(this.props),initialTotalNumItems:this.props.totalNumItems||1,initialHideState:!!this.props.isSmbPersonalization,hideFilesAndSidebar:!1,highlight:null,contentSlot:null,emptyContentSlot:null}}UNSAFE_componentWillReceiveProps(e){e.path!==this.props.path&&this.setState({searchBarProps:this.getCurrentSearchBarProps(e)})}componentDidMount(){return o.__awaiter(this,void 0,void 0,(function*(){yield S.waitForTTI(),p.FileUploaderController.loadCoreComponent(),this.props.shouldOpenUploadModal&&this.handleShowFileUploader(),n.logPageView(this.getPageViewerBrowseLoadedData()),I.UserSurvey.trackEvent("folder_viewed","browse")}))}componentDidUpdate(e){void 0!==this.props.browsePostTTIExperiments.expPersonalizedFirstPaths&&this.state.initialHideState&&this.setState({initialHideState:!1}),this.props.loadingState===h.LoadingState.LOADED&&e.loadingState===h.LoadingState.LOADING_FIRST_PAGE&&(n.logBrowseLoaded(this.getPageViewerBrowseLoadedData()),this.setState({initialTotalNumItems:this.props.totalNumItems}))}getCurrentFolderType(){const{context:e,user:t}=this.props;if(e.isInsideVaultFolder)return"vault";if(t.is_cdm_member){if("/"===e.currentFQPath&&e.currentNSID===e.rootNSID)return"root";if(e.isCurrentlyInRoot)return"team_member_folder"}else if(e.isCurrentlyInRoot)return"root";return e.isInsideTeamFolderTree?"team_shared_folder":e.isInsideSharedFolder&&""===e.currentNSPath?"shared_folder":"folder"}getPageViewerBrowseLoadedData(){const{context:e,user:t,viewType:o,rightRailCollapsed:s}=this.props,r=e.currentFQPath.split("/").filter(e=>!!e).length,i=t.is_cdm_member&&(A.paths_are_equal(t.cdm_tmf_path,e.currentFQPath)||A.inSubDirectory(t.cdm_tmf_path,e.currentFQPath)),n=s?"collapsed":"opened";return 0===r?{uid:t.id,view_type:o,url:a.get_browse_root(t),folder_type:this.getCurrentFolderType(),right_sidebar_state:n}:{uid:t.id,view_type:o,url:a.get_browse_root(t)+"/*",folder_type:this.getCurrentFolderType(),right_sidebar_state:n,navigation_depth:r,is_under_tmf:i}}getCurrentSearchBarProps(e){return{searchVariant:"full-page",currentPath:e.path}}render(){const{user:e,clickRewindTimestamp:t,clickFolderHistoryTimestamp:o,context:r,handleComponentTTI:a,isRewindVisible:n,isFolderHistoryVisible:d,browsePostTTIExperiments:{expVaultAutoLockWeb:p,expAutoPDFConversionBackend:h,expFlowsAutoUnzipLambda:m,expFlowsAutomatedFolderUI:S},browsePostTTIData:b,browseExperiments:{folderHistoryRollbacks:v,plusPlusEnabled:F},showPlusPlusSetupModal:T,path:P,onCloseRewind:E,onCloseFolderHistoryPanel:I,userVersionHistoryLength:A,shouldShowVaultEmptyState:C,shouldShowFamilyEmptyState:R}=this.props,L=s.default("exp-details-pane-variants",{"mobile-web-invites":b.mobileWebInvites}),x=s.default(L,"dig2--enabled","browse-view--chrome","browse-right-rail--v2");return i.default.createElement("div",{className:L},i.default.createElement(l.AsyncRewindPanel,{clickBrowseButtonTimestampMs:t,user:e,fromDesktopClient:"true"===c.getQueryArgs().from_desktop_client,browseContext:r,close:E,isVisible:n,expFolderHistoryRollbacks:v||!1,userVersionHistoryLength:A}),i.default.createElement(l.AsyncFolderHistoryPanel,{folderFQPath:r.currentFQPath,clickFolderHistoryButtonInBrowseTimestampMs:o,close:I,isVisible:d,user:e,userVersionHistoryLength:A}),F?i.default.createElement(g.AsyncPlusPlusSetupModal,{userId:e.id,forceShow:T}):null,r.isInsideVaultFolder&&i.default.createElement(w.AsyncVaultRoot,{contentSlot:this.vaultContentSlot,vaultEmptyContentSlot:this.vaultEmptyContentSlot,lockButtonSlot:this.vaultLockButtonSlot,handleComponentTTI:a,shouldShowVaultEmptyState:C,encryptionOptions:this.props.encryptionOptions,expVaultAutoLockWeb:p,setHideFilesAndSidebar:this.setHideFilesAndSidebar,path:P,user:e}),(h||m||S)&&i.default.createElement(y.AsyncFlowsRoot,{user:e,path:P}),r.isInFamilySharedFolder&&i.default.createElement(u.AsyncFamilyRoot,{user:e,path:P,contentSlot:this.state.contentSlot,emptyContentSlot:this.state.emptyContentSlot,shouldShowFamilyEmptyState:R,setHideFilesAndSidebar:this.setHideFilesAndSidebar}),c.getQueryArgs().unfollow_folder&&i.default.createElement(f.AsyncFolderUnfollower,null),i.default.createElement(_.AsyncCustomizationModal,{path:r.currentFQPath}),i.default.createElement(N.ChromeWrapper,{user:e,titleRegion:this.renderTitle(),titleClass:"page-header__title-overflow",embeddedAppRegion:this.renderFilesViewController,actionSidebarRegion:this.renderSidebar,searchBarProps:this.state.searchBarProps,chromeClass:x,useMaestroPortal:!0,useRightRailOutsideSearch:!0,useRightRail:k.shouldUseReactRouter()}))}}t.BrowseView=M,M.defaultProps={selectedFiles:r.OrderedMap(),viewType:m.ViewType.List},M.displayName="BrowseView";const D=i.default.lazy(()=>o.__awaiter(void 0,void 0,void 0,(function*(){const{ErrorComponent:t}=yield new Promise((t,o)=>{e(["modules/clean/react/browse/components/post_tti/error"],t,o)}).then(o.__importStar);return{default:t}})))})),define("modules/clean/react/browse/browse_prefetch_loader",["require","exports","tslib","modules/core/assert","modules/clean/react/files_view/types","modules/clean/react/browse/models","modules/clean/pagination_manager","modules/clean/web_timing_logger","modules/clean/react/browse/api","modules/clean/react/browse/browse_server_response_helper"],(function(e,t,o,s,r,i,a,n,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowsePrefetchLoader=t.apiV2FetchNextFn=void 0,n=o.__importStar(n),l=o.__importStar(l),t.apiV2FetchNextFn=(e,t,o)=>l.loadPath2Continue(e,o).then(e=>{const o=new Array;for(const r of e.paginated_file_info){s.assert(void 0!==r.file_info,"file_info is undefined");const e=r.file_info;e.fq_path=t+e.fq_path,o.push(i.File.fromApiV2Object(e))}return{next_request_voucher:e.next_request_voucher||null,has_more_items:e.has_more||!1,items:o}});t.BrowsePrefetchLoader=class{constructor({user:e,path:o,fqPathsToSelect:i},{onPrefetchComplete:l,onPrefetchError:c,onLoadComplete:u,onPostTTIPrefetchComplete:p,onPostTTIPrefetchError:h},{onInitializeEverything:m,onAddFilesAndSetLoadingState:_},f=window){this.isPrefetching=()=>!!this.browsePreloadHandler&&!!this.firstPagePreloadHandler,this.handlePrefetch=()=>{s.assert(this.isPrefetching(),"trying to handle prefetching and think we aren't prefetching at the same time.  something is wrong"),this.browsePreloadHandler(this.handlePrefetchDataSuccess,this.onPrefetchError),n.waitForTTI().then(()=>{this.postTTIPreloadHandler(this.handlePostTTIDataSuccess,this.onPostTTIPrefetchError)})},this.handlePostTTIDataSuccess=e=>{let t=void 0;try{t=JSON.parse(e)}catch(e){return void this.onPostTTIPrefetchError(e)}t?this.onPostTTIPrefetchComplete(t):this.onPostTTIPrefetchError()},this.handlePrefetchDataSuccess=e=>{const t=new d.BrowseContextServerResponse;if(t.init(e),t.isError())return void this.onPrefetchError();const o=t.fromServerBrowseContext(),s=t.fromServerNsidToMountPoint(),r=t.fromTeamFolders(),i=t.fromCurrentFolderFile();this.firstPagePreloadHandler(e=>{this.handleFirstPagePrefetchDataSuccess(e,t,s,r,i,o)},this.onPrefetchError)},this.handleFirstPagePrefetchDataSuccess=(e,t,o,s,i,a)=>{const n=new d.BrowseGetNextServerResponse;if(n.init(e),n.isError())return void this.onPrefetchError();const l=n.fromPrefetchFiles(),c=n.fromPaginatedTotalNumFiles(),u=n.fromLoadingState(),p=n.fromNextRequestVoucher();this.onInitializeEverything({path:this.path,files:u===r.LoadingState.LOADING_REMAINING_PAGES?[]:l,paginatedTotalNumFiles:c,context:a,mountPoints:o,fqPathsToSelect:this.fqPathsToSelect,loadingState:u,teamFolders:s,currentFolderInfo:i}),u===r.LoadingState.LOADING_REMAINING_PAGES?this.initializePaginationManager(c,l,!0,p):this.onLoadComplete(),this.onPrefetchComplete(t)},this.initializePaginationManager=(e,o=[],s=!0,i="")=>{const l=a.PaginationManager.create({firstPage:{items:o,has_more_items:s,next_request_voucher:i},keyName:"sjid",userID:this.user.id,newDataAvailableCallback:(t,o)=>{const s=t.areAllItemsReady(),i=s?r.LoadingState.LOADED:r.LoadingState.LOADING_REMAINING_PAGES;this.onAddFilesAndSetLoadingState({path:this.path,files:o,paginatedTotalNumFiles:e,loadingState:i}),s&&(t.stopAutoFetching(),this.onLoadComplete())},fetchNextFn:t.apiV2FetchNextFn});n.waitForTTI().then(()=>l.startAutoFetching())},this.user=e,this.path=o,this.fqPathsToSelect=i,this.onPrefetchComplete=l,this.onPrefetchError=c,this.onLoadComplete=u,this.onPostTTIPrefetchComplete=p,this.onPostTTIPrefetchError=h,this.onInitializeEverything=m,this.onAddFilesAndSetLoadingState=_,this.browsePreloadHandler=f.__REGISTER_BROWSE_PRELOAD_HANDLER,this.firstPagePreloadHandler=f.__REGISTER_BROWSE_FIRST_PAGE_PRELOAD_HANDLER,this.postTTIPreloadHandler=f.__REGISTER_BROWSE_POST_TTI_PRELOAD_HANDLER}}})),define("modules/clean/react/browse/browse_server_response_helper",["require","exports","modules/clean/react/browse/models","modules/core/notify","modules/clean/react/files_view/types"],(function(e,t,o,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maybeNotifyErrorResponse=t.BrowseGetNextServerResponse=t.BrowseContextServerResponse=void 0;t.BrowseContextServerResponse=class{init(e){try{const t=JSON.parse(e);let o;o=t.context?new a:new n,o.init(t),this.browseContextResponse=o}catch(t){i(e)}}isError(){return!this.browseContextResponse}fromServerBrowseContext(){return this.browseContextResponse.fromServerBrowseContext()}fromServerNsidToMountPoint(){return this.browseContextResponse.fromServerNsidToMountPoint()}fromTeamFolders(){return this.browseContextResponse.fromTeamFolders()}fromCurrentFolderFileInfo(){return this.browseContextResponse.fromCurrentFolderFileInfo()}fromCurrentFolderFile(){return this.browseContextResponse.fromCurrentFolderFile()}fromPreviewFileInfo(){return this.browseContextResponse.fromPreviewFileInfo()}};function i(e){if(0===e.indexOf("err:")){const t=e.substr("err:".length);s.Notify.error(t)}}t.BrowseGetNextServerResponse=class{init(e){try{const t=JSON.parse(e);let o;o=t.total_count?new l:new d,o.init(t),this.browseGetNextResponse=o}catch(t){i(e)}}isError(){return!this.browseGetNextResponse}fromPrefetchFiles(){return this.browseGetNextResponse.fromPrefetchFiles()}fromPaginatedTotalNumFiles(){return this.browseGetNextResponse.fromPaginatedTotalNumFiles()}fromLoadingState(){return this.browseGetNextResponse.fromLoadingState()}fromNextRequestVoucher(){return this.browseGetNextResponse.fromNextRequestVoucher()}},t.maybeNotifyErrorResponse=i;class a{init(e){this.browseContextResponse=e}fromServerBrowseContext(){const e=this.browseContextResponse.context;return o.BrowseContext.fromApiV2Object(e)}fromServerNsidToMountPoint(){let e={};const t=this.browseContextResponse.context;if(t.ns_id_infos){e=t.ns_id_infos.filter(e=>!!e&&!!e.mount_point&&!!e.ns_id).reduce((e,t)=>Object.assign(Object.assign({},e),{[t.ns_id.toString()]:t.mount_point}),{})}return e}fromTeamFolders(){let e=[];const t=this.browseContextResponse.context;return t.team_folders_js_info&&(e=t.team_folders_js_info.map(o.File.fromApiV2Object)),e}fromCurrentFolderFileInfo(){let e=void 0;const t=this.browseContextResponse.folder_info;return t&&t.file_info&&(e=t.file_info),e}fromCurrentFolderFile(){const e=this.fromCurrentFolderFileInfo();if(e)return o.File.fromApiV2Object(e)}fromPreviewFileInfo(){const e=this.browseContextResponse.context;return(null==e?void 0:e.preview_file_info)?o.File.fromApiV2Object(null==e?void 0:e.preview_file_info):null}}class n{init(e){this.browseContextResponse=e}fromServerBrowseContext(){const e=this.browseContextResponse;return o.BrowseContext.fromServerObject(e)}fromServerNsidToMountPoint(){return this.browseContextResponse.ns_id_to_mount_point}fromTeamFolders(){let e=[];const t=this.browseContextResponse;return t.team_folders_js_info&&(e=t.team_folders_js_info.map(o.File.fromAnyFileObject)),e}fromCurrentFolderFileInfo(){let e=void 0;const t=this.browseContextResponse;return t.folder_info&&(e=t.folder_info),e}fromCurrentFolderFile(){const e=this.fromCurrentFolderFileInfo();if(e)return o.File.fromApiV2Object(e)}fromPreviewFileInfo(){const e=this.browseContextResponse;return e.preview_file_info?o.File.fromAnyFileObject(e.preview_file_info):null}}class l{init(e){this.browseGetNextResponse=e}fromPrefetchFiles(){let e;return e=this.browseGetNextResponse.paginated_file_info.map(e=>e.file_info).filter(e=>!!e),e.map(o.File.fromApiV2Object)}fromPaginatedTotalNumFiles(){var e;return null!==(e=this.browseGetNextResponse.total_count)&&void 0!==e?e:0}fromLoadingState(){return this.browseGetNextResponse.has_more?r.LoadingState.LOADING_REMAINING_PAGES:r.LoadingState.LOADED}fromNextRequestVoucher(){var e;return null!==(e=this.browseGetNextResponse.next_request_voucher)&&void 0!==e?e:""}}class d{init(e){this.browseGetNextResponse=e}fromPrefetchFiles(){const e=this.browseGetNextResponse.file_info,t=this.browseGetNextResponse.first_page;return t?t.items.map(o.File.fromAnyFileObject):e?e.map(o.File.fromAnyFileObject):[]}fromPaginatedTotalNumFiles(){const e=this.browseGetNextResponse.file_info,t=this.browseGetNextResponse.first_page;return t?t.total_num_items:e?e.length:0}fromLoadingState(){const e=this.browseGetNextResponse.file_info;return this.browseGetNextResponse.first_page?r.LoadingState.LOADING_REMAINING_PAGES:e?r.LoadingState.LOADED:r.LoadingState.LOADING_FIRST_PAGE}fromNextRequestVoucher(){var e;const t=this.browseGetNextResponse.first_page;return t&&null!==(e=t.next_request_voucher)&&void 0!==e?e:""}}})),define("modules/clean/react/browse/browse_invite_experiment_utils",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFirstTaskPage=t.isInSplitTmfTsdTeamFolder=t.isLetMembersInviteEligible=t.shouldShowFacePile=void 0,t.shouldShowFacePile=e=>{const{selectedFiles:o,showInviteSidePanel:s}=e,r=o&&0!==o.size;return(s||t.isFirstTaskPage(e)||t.isInSplitTmfTsdTeamFolder(e)||t.isLetMembersInviteEligible(e))&&!r},t.isLetMembersInviteEligible=({browsePostTTIExperiments:e,context:t})=>!!e.expLetMembersInviteData&&(e.expLetMembersInviteData.shouldShowLetMembersInviteCta&&t.isInsideTeamFolderTree&&t.isCurrentlyInRoot),t.isInSplitTmfTsdTeamFolder=({browseExperiments:e,context:t})=>!!e&&e.splitTmfTsd&&"/Team Files"===t.currentFQPath,t.isFirstTaskPage=({browsePostTTIExperiments:e,browsePostTTIData:t,context:o})=>t.firstTaskProps.is_eligible_team&&o.isInsideTeamFolderTree&&o.isCurrentlyInRoot})),define("modules/clean/react/browse/browse_upload_provider",["require","exports","tslib","react","react-redux","modules/clean/react/browse/data/selectors","modules/clean/react/file_uploader/upload_kit_provider","modules/clean/react/file_uploader/utils","modules/core/assert"],(function(e,t,o,s,r,i,a,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseUploadProvider=t.UnconnectedBrowseUploadProvider=void 0,s=o.__importDefault(s),i=o.__importStar(i),n=o.__importStar(n);class d extends s.default.Component{constructor(){super(...arguments),this.onChoose=e=>o.__awaiter(this,void 0,void 0,(function*(){return e.map(e=>[e,{parentPath:this.props.context.currentFQPath}])})),this.onChooseDropboxFile=e=>o.__awaiter(this,void 0,void 0,(function*(){return e.map(e=>[e,{parentPath:this.props.context.currentFQPath}])})),this.nsIdForRouting=e=>{const t=""===this.props.context.currentFQPath,o=n.getDestinationDir(e.parentPath||"",e.destPath);return t?this.props.user.root_ns_id:(l.assert(null!=this.props.mountPoints,"mountPoints is null"),l.assert(null!=this.props.context.rootNSID,"rootNSID is null"),n.getNsId(this.props.mountPoints,this.props.context.rootNSID,o))}}render(){return s.default.createElement(a.UploadKitProvider,{user:this.props.user,nsIdForRouting:this.nsIdForRouting,onChoose:this.onChoose,onChooseDropboxFile:this.onChooseDropboxFile,chooseDestination:this.props.chooseDestination},this.props.children)}}t.UnconnectedBrowseUploadProvider=d,d.displayName="UnconnectedBrowseUploadProvider",t.BrowseUploadProvider=r.connect(e=>({context:i.context(e),mountPoints:i.mountPoints(e)}))(d)})),define("modules/clean/react/browse/browse",["require","exports","tslib","react","react-intl","react-redux","dropbox/proto/js_init_data/browse_web/browse_web","dropbox/proto/js_init_data/web_timing_logger/web_timing_logger","proto_utils/unpack","modules/clean/bug_reporting/routing","modules/clean/react/browse/controller","modules/clean/react/browse/data/action_creators/index","modules/clean/react/browse/data/store","modules/clean/react/files_view/data/action_creators","modules/clean/react/files_view/data/store","modules/clean/react/files_view/sort_types","modules/clean/react/files_view/view_type","modules/clean/react/folder_overview/data/action_creators","modules/clean/react/maestro_nav/folder_explorer/data/store","modules/clean/viewer","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/i18n","modules/clean/react/folder_overview/data/store","modules/clean/tagging/experiments","modules/clean/react/edison/router_utils","modules/clean/react/edison/spa_timing_logger","modules/clean/react/snackbar_manager","modules/clean/react/snackbar"],(function(e,t,o,s,r,i,a,n,l,d,c,u,p,h,m,_,f,g,w,S,b,y,v,F,T,P,E,I,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RootComponent=t.BrowseApp=t.AsyncBoltHandler=void 0,s=o.__importStar(s),u=o.__importStar(u),h=o.__importStar(h),g=o.__importStar(g),b=o.__importStar(b);const C=()=>s.default.createElement(s.default.Fragment,null,s.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.file_actions",componentName:"File Actions"}),s.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.right_rail",componentName:"Right Rail"}),s.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.folder_overview",componentName:"Folder Overview"}),s.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.sync_everything",componentName:"Features to Try row"}),s.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"desktop.unknown",componentName:"Desktop App"}),s.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.browse_web",componentName:"Browse"}),s.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.search_web",componentName:"Search"}),s.default.createElement(d.RegisterComponentWithBugReporter,{componentId:"web.upload_web",componentName:"Upload"}));t.AsyncBoltHandler=s.default.lazy(()=>o.__awaiter(void 0,void 0,void 0,(function*(){yield b.waitForTTI();const{ConnectedBoltHandler:t}=yield new Promise((t,o)=>{e(["modules/clean/react/browse/bolt/handler"],t,o)}).then(o.__importStar);return{default:t}})));class R extends s.default.PureComponent{constructor(e){var t;super(e),E.markApplicationStart(),m.getStoreForFilesView(),w.getStoreForFolderExplorer(),this.reduxStore=p.getStoreForBrowse(),P.shouldUseReactRouter()&&this.reduxStore.dispatch(u.handleAppCleanup());const o=S.Viewer.get_viewer(),s=o.get_user_by_id(e.userId),r=y.is_supported_mobile_browser()?void 0:f.ViewType.CondensedList;this.reduxStore.dispatch(h.loadViewTypes({user:s,defaultViewType:r})),this.reduxStore.dispatch(h.loadViewTypeColumns({user:s})),this.reduxStore.dispatch(u.setPath({path:e.initFqPath||"/"})),T.isTagsColumnOnBrowseEnabled(null===(t=e.browseExperiments)||void 0===t?void 0:t.manualTagging)||this.reduxStore.dispatch(h.filterOutColumns([_.SortField.TAGS])),this.reduxStore.dispatch(u.appInit({props:e,user:s,viewer:o})),F.getStoreForFolderOverview().dispatch(g.initializeUserInteractionState(!0))}render(){const e=P.shouldUseReactRouter()?s.default.createElement(c.ConnectedBrowseControllerElementWithRouter,Object.assign({},this.props)):s.default.createElement(c.ConnectedBrowseControllerElement,Object.assign({},this.props));return s.default.createElement(i.Provider,{store:this.reduxStore},s.default.createElement(r.RawIntlProvider,{value:v.intl},s.default.createElement(s.default.Fragment,null,e,s.default.createElement(s.default.Suspense,{fallback:s.default.createElement(s.default.Fragment,null)},s.default.createElement(t.AsyncBoltHandler,null)),s.default.createElement(C,null))))}}t.BrowseApp=R,R.displayName="BrowseApp",t.RootComponent=e=>{const t=l.unpackProto(e.encodedProto,a.browse_web.BrowseWebPageProps),{webTimingLoggerServerContext:r}=t,i=o.__rest(t,["webTimingLoggerServerContext"]),d=s.useRef(null);return s.useEffect(()=>{A.Snackbar.manager=d.current}),b.initialize({log_time_to_view:!0,log_time_to_interactive:!0},l.unpackProto(r,n.web_timing_logger.WebTimingLoggerServerContext)),s.default.createElement(s.default.Fragment,null,s.default.createElement(R,Object.assign({},i)),s.default.createElement(I.SnackbarManager,{ref:d,getParentElement:I.SnackbarManager.getEmbeddedAppPagelet,useDigSnackbars:!0}))}})),define("modules/clean/react/browse/browse_view_mode_toggle",["require","exports","tslib","modules/clean/react/browse/action_logger","modules/clean/react/files_view/util","react","typescript/component_libraries/retrieval-components/src/view-mode-toggle/index","react-redux","modules/clean/react/browse/data/action_creators/index","modules/clean/react/files_view/data/selectors/instance_selectors","modules/clean/react/browse/constants"],(function(e,t,o,s,r,i,a,n,l,d,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseViewModeToggle=void 0,s=o.__importStar(s),i=o.__importDefault(i),t.BrowseViewModeToggle=i.default.memo(({user:e,className:t})=>{const o=n.useDispatch(),u=n.useSelector(e=>d.selectViewType(e,{instanceId:c.BROWSE_FILES_VIEW_ID})),p=i.default.useCallback((t,i)=>{const a=r.viewTypeFromViewMode(t);i.stopPropagation(),s.logSwitchViewType({uid:e.id,isSearchMode:!1,viewType:a}),o(l.setViewType(a))},[o,e]);return i.default.createElement(a.ViewModeToggle,{className:t,currentMode:r.viewModeFromViewType(u),onSelection:p})}),t.BrowseViewModeToggle.displayName="BrowseViewModeToggle"})),define("modules/clean/pagination_manager",["require","exports","tslib","modules/clean/deprecated_ajax/ajax","modules/core/i18n","modules/core/notify","modules/clean/react/snackbar"],(function(e,t,o,s,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PaginationManager=t.LegacyFetchNextFn=t.BasePaginationManager=void 0,s=o.__importStar(s);class n{constructor(e){this.hasMoreItems=e}areAllItemsReady(){return!this.hasMoreItems}invalidateHasMore(){this.hasMoreItems=!0}addDataToAjax(e){}}class l{constructor(e){this.handleNextPageSuccess=e=>{this.nextRequestVoucher=e.next_request_voucher,this.mode.hasMoreItems=e.has_more_items,this.autoFetching&&this.fetchNext(),this.addPage(e.items)},this.newDataCallback=e.newDataAvailableCallback,this.autoFetching=!1,this.mode=e.mode,this.keyName=e.keyName,this.items={},this.pages=[],this.nextRequestVoucher=e.firstPage.next_request_voucher,this.userID=e.userID,this.fqPathPrefix=e.fqPathPrefix?"/"+e.fqPathPrefix:"",this.addPage(e.firstPage.items),this.fetchNextFn=e.fetchNextFn}areAllItemsReady(){return this.mode.areAllItemsReady()}addPage(e){const t=[],o=[];for(const s of e){const e=s[this.keyName];if(null==e)return void i.Notify.warning(r.intl.formatMessage({id:"xlabvw",defaultMessage:"Invalid server response"}));null==this.items[e]&&(this.items[e]=s,o.push(s),t.push(e))}this.pages.push(t),this.newDataCallback(this,o)}startAutoFetching(){this.autoFetching=!0,this.fetchNext()}stopAutoFetching(){this.autoFetching=!1}reSync(e=!1){e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]);const t=this.autoFetching&&this.mode.areAllItemsReady();this.mode.invalidateHasMore(),t&&this.startAutoFetching()}fetchNext(){if(this.mode.areAllItemsReady())return;const e={};this.nextRequestVoucher&&(e.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(e),this.fetchNextFn(this.nextRequestVoucher||"",this.fqPathPrefix,this.userID).then(e=>{this.handleNextPageSuccess(e)}).catch(()=>{a.Snackbar.fail(r.intl.formatMessage({id:"bLA3rA",defaultMessage:"There was a problem completing this request."}),"browse")})}loadedPageCount(){return this.pages.length}getLoadedPage(e){const t=this.pages[e];return null==t?null:t.map(e=>this.items[e])}getLastLoadedPage(){return this.getLoadedPage(this.loadedPageCount()-1)}}t.BasePaginationManager=l,t.LegacyFetchNextFn=(e,t)=>(o,r,i)=>{const a={};return o&&(a.voucher=o),new Promise((o,n)=>{s.WebRequest({url:e,data:a,dataType:"text",subject_user:i,success:(e,s)=>{o(t(s,r))},error:n})})};class d extends l{constructor(e){super(Object.assign(Object.assign({},e),{mode:new n(e.firstPage.has_more_items)}))}static create(e){return new d(e)}}t.PaginationManager=d})),define("modules/clean/react/plusplus/loadables",["require","exports","tslib","modules/clean/react/async/loadable"],(function(e,t,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncPlusPlusSetupModal=void 0,t.AsyncPlusPlusSetupModal=s.Loadable({loader:()=>o.__awaiter(void 0,void 0,void 0,(function*(){const{PlusPlusSetupModal:t}=yield new Promise((t,o)=>{e(["modules/clean/react/plusplus/setup_modal"],t,o)}).then(o.__importStar);return t}))}),t.AsyncPlusPlusSetupModal.displayName="AsyncPlusPlusSetupModal"})),define("modules/clean/react/browse/actions_navigate",["require","exports","tslib","modules/clean/cloud_docs/open_with_utils","modules/clean/cloud_docs/preferred_editor_utils","modules/clean/cloud_docs/types","modules/clean/file_operations/notifications","modules/clean/filetypes","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/data/action_creators/index","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/store","modules/clean/react/browse/models","modules/clean/react/file_viewer/async_controller","modules/clean/react/file_viewer/toggle_browse_elements_util","modules/clean/pnm/utils","modules/clean/react/plusplus/logging","modules/clean/react/plusplus/file_actions","modules/clean/react/vault/constants","modules/constants/python","modules/core/browser","modules/clean/react/browse/tidy_up_actions","modules/clean/history_singleton","modules/clean/react/files_view/util","modules/clean/react/browse/naming_conventions_actions"],(function(e,t,o,s,r,i,a,n,l,d,c,u,p,h,m,_,f,g,w,S,b,y,v,F,T,P,E,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.browseNavigateActions=void 0,a=o.__importStar(a),l=o.__importStar(l),d=o.__importStar(d),u=o.__importStar(u),h=o.__importStar(h),F=o.__importStar(F);t.browseNavigateActions=new class{constructor(){this.setUrl=({path:e,qargs:t,expandedBlade:o,forceExpandRightRail:s})=>{this.reduxStore.dispatch(u.setUrl({path:e,qargs:t,expandedBlade:o,forceExpandRightRail:s}))},this.onRestore=(e,t,o)=>{d.restoreFiles({files:t,userId:e,onSuccess:()=>{a.notifyRestoreSuccess(t)},isSearchMode:o})},this.doRestoreFilesWithUnifiedTrashModal=({files:e})=>{const t=h.user(this.reduxStore.getState()),o=h.context(this.reduxStore.getState());l.showUnifiedTrashModal({userId:t.id,context:o,files:e,onRestore:(e,t)=>{this.onRestore(e,t,!1)}})},this.reduxStore=m.getStoreForBrowse()}reloadCurrentPath(){this.setUrl({path:h.path(this.reduxStore.getState()),qargs:{reload:!0}})}navigateToFileOrFolder({file:e,shouldFocusComment:t=!1,activeCommentThreadId:o,onFileViewerUnmount:s,fileViewAction:i=v.FileViewActionType.CLICK,fileViewOrigin:a=v.FileViewOriginType.BROWSE,skipFileViewerRouting:d=!1,performSpaRouting:c=!1}){const u=h.user(this.reduxStore.getState()),p=h.context(this.reduxStore.getState());if(e.isDeleted)this.doRestoreFilesWithUnifiedTrashModal({files:[e]});else{if(w.isSupportedLinkNodeClickAction(e.per_node_metadata))return void b.handleLinkNodeAction(e.per_node_metadata,e=>{S.logProductAnalytics(u.id,"web","select",e,"files_main_bar")});if(e.is_dir)if(e.type===n.FileTypes.VAULT_FOLDER)F.redirect(y.VAULT_URL);else if(_.File.isNoAccessSharedFolder(e))l.showNoAccess(u,e.fq_path,p);else{const t=h.browsePostTTIExperiments(m.getStoreForBrowse().getState()),o=t.expTidyUpBrowse,s="V1"===t.expOEXNamingConventionsGrowth;(o||s)&&p.isCurrentPathWriteable()&&setTimeout(()=>{h.context(this.reduxStore.getState()).currentFQPath===e.fq_path&&(o&&s?0===Math.floor(2*Math.random())?T.promptTidyUp(u.id,e.fq_path,e.ns_id).then(t=>{!1===t&&I.promptNamingConventions(u.id,e.fq_path,e.ns_id)}):I.promptNamingConventions(u.id,e.fq_path,e.ns_id).then(t=>{!1===t&&T.promptTidyUp(u.id,e.fq_path,e.ns_id)}):o?T.promptTidyUp(u.id,e.fq_path,e.ns_id):s&&I.promptNamingConventions(u.id,e.fq_path,e.ns_id))},5e3),this.setUrl({path:e.fq_path})}else{const n=()=>{this.openPreviewForBrowseFile({file:e,shouldFocusComment:t,activeCommentThreadId:o,user:u,fileViewAction:i,fileViewOrigin:a,onFileViewerUnmount:s,skipFileViewerRouting:d,performSpaRouting:c})},{preferredEditors:l}=h.browsePostTTIData(this.reduxStore.getState());!t&&l&&r.hasPreferredEditorSupport(e)?r.openInPreferredEditor(u,e,l,n,{fileViewAction:i,fileViewOrigin:a}):n()}}}openPreviewForBrowseFile({file:e,shouldFocusComment:t,activeCommentThreadId:o,user:r,fileViewAction:a,fileViewOrigin:n,onFileViewerUnmount:l,shouldFocusApproval:d,skipFileViewerRouting:m,performSpaRouting:_}){const w=h.context(this.reduxStore.getState()),{isOverFreeQuota:S,hasExcludedNsIds:b}=h.browsePostTTIData(this.reduxStore.getState());let y=p.getIndexOfFile(e,this.reduxStore.getState());const F=y<0?[e]:h.sortedFilesWithFolderSizes(this.reduxStore.getState()).toArray();if(y<0?y=0:F[y]=e,e.is_cloud_doc)s.openCloudDoc(e,r,a===v.FileViewActionType.SEARCH?i.WebSearchSource:i.WebBrowseSource);else{let s;const i=()=>{g.showElementsBehindFileViewer(),this.reduxStore.dispatch(u.setIsFileViewerShown({isShown:!1})),l&&l(),s&&s.focus()},p=()=>{s=document.querySelector(":focus"),g.hideElementsBehindFileViewer(),this.reduxStore.dispatch(u.setIsFileViewerShown({isShown:!0}))},h=m?()=>{const e=P.getBrowserHistory(),{location:t}=e,o=new URLSearchParams(t.search);o.delete("preview"),e.replace(`${t.pathname}?${o.toString()}`)}:void 0;f.asyncOpenPreview({containerId:c.BROWSE_FILE_VIEWER_ELEMENT_ID,files:F,indexOfPreviewFile:y,shouldFocusComment:t,activeCommentThreadId:o,user:r,onFileViewerDidMount:p,onFileViewerUnmount:i,fileViewAction:a,fileViewOrigin:n,fileViewTarget:v.FileViewTargetType.PRIVATE,browseContext:w,browseExceptions:{hasExcludedNsIds:b,isOverFreeQuota:S},shouldFocusApproval:d,skipFileViewerRouting:m,onCloseViewer:h}).then(()=>{if(_){const t=P.getBrowserHistory(),{location:o}=t,s=new URLSearchParams(o.search);s.append("preview",E.getFilename(e)),t.push(`${o.pathname}?${s.toString()}`)}})}}}})),define("modules/clean/react/app_actions/education/async_extensions_edu_modal",["require","exports","tslib","react","modules/clean/react/components/modal"],(function(e,t,o,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.asyncShowExtensionsEduModal=void 0,s=o.__importDefault(s),t.asyncShowExtensionsEduModal=function(t,i){return new Promise(t=>o.__awaiter(this,void 0,void 0,(function*(){const{AppActionsEduModal:a}=yield new Promise((t,o)=>{e(["modules/clean/react/app_actions/education/edu_modal_component"],t,o)}).then(o.__importStar);r.Modal.showInstance(s.default.createElement(a,{appName:i})),t()})))}})),define("modules/clean/react/folder_subscriptions/follow/async_folder_unfollower",["require","exports","tslib","react"],(function(e,t,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncFolderUnfollower=void 0;const r=(s=o.__importDefault(s)).default.lazy(()=>o.__awaiter(void 0,void 0,void 0,(function*(){const{FolderUnfollower:t}=yield new Promise((t,o)=>{e(["modules/clean/react/folder_subscriptions/follow/folder_unfollower"],t,o)}).then(o.__importStar);return{default:t}})));t.AsyncFolderUnfollower=()=>s.default.createElement(s.default.Suspense,{fallback:null},s.default.createElement(r,null))})),define("modules/clean/react/folder_subscriptions/customization/async_customization_modal",["require","exports","tslib","modules/clean/react/async/loadable"],(function(e,t,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCustomizationModal=void 0,t.AsyncCustomizationModal=s.Loadable({displayName:"AsyncCustomizationModal",loader:()=>o.__awaiter(void 0,void 0,void 0,(function*(){const{CustomizationModalController:t}=yield new Promise((t,o)=>{e(["modules/clean/react/folder_subscriptions/customization/customization_modal_controller"],t,o)}).then(o.__importStar);return t}))})})),define("modules/clean/react/flows/components/flows_browse_root_async",["require","exports","tslib","react"],(function(e,t,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncFlowsRoot=void 0,s=o.__importStar(s);const{lazy:r,Suspense:i}=s,a=r(()=>o.__awaiter(void 0,void 0,void 0,(function*(){const{FlowsRoot:t}=yield new Promise((t,o)=>{e(["modules/clean/react/flows/components/flows_browse_root"],t,o)}).then(o.__importStar);return{default:t}})));t.AsyncFlowsRoot=e=>s.createElement(i,{fallback:s.createElement("div",null)},s.createElement(a,Object.assign({},e)))})),define("modules/clean/react/file_uploader/parallel_scheduler_with_batch_commit",["require","exports","tslib","modules/clean/react/upload_kit/scheduler/types","modules/constants/web_parallel_upload_size"],(function(e,t,o,s,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParallelUploadSchedulerWithBatchCommit=t.CHUNK_SIZE=t.COMMIT_REQUEST_BATCH_SIZE=t.MAX_PARALLEL_COMMIT_REQUESTS=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=void 0,t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS=r.PARALLEL_UPLOAD_SIZE,t.MAX_PARALLEL_COMMIT_REQUESTS=1,t.COMMIT_REQUEST_BATCH_SIZE=100,t.CHUNK_SIZE=4194304;class i extends s.UploadScheduler{constructor(e){super(e),this.itemQueue=new Map,this.commitQueue=[],this.availableBlockRequests=t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS,this.availableCommitRequests=t.MAX_PARALLEL_COMMIT_REQUESTS,this.onCompleteSubscribers=[],this.handleUploadBlocks=e.handleUploadBlocks,this.handleCommitBlocks=e.handleCommitBlocks,this.handleProgress=e.handleProgress,this.handleItemExit=e.handleItemExit}itemExit(e,t){const o=this.itemQueue.get(e);o&&(o.status=t,this.itemQueue.delete(e),this.handleItemExit(o.info,t))}dispenseChunkData(){if(!this.currentFileChunkReader||this.currentFileChunkReader.isEmpty()||!this.isItemUploading(this.currentFileChunkReader.item.destPath)){const e=Array.from(this.itemQueue.values()).find(e=>"Queued"===e.status&&e.file.size>0);if(!e)return null;this.currentFileChunkReader=new a(e),e.status="Uploading"}const e=this.currentFileChunkReader.getNextChunk();if(!e)return null;const t=this.currentFileChunkReader.item,o=t.blockTokens.length;return t.blockTokens.push(""),{item:t,chunk:e,blockIndex:o}}commitNext(){return o.__awaiter(this,void 0,void 0,(function*(){if(0===this.availableCommitRequests)return;if(0===this.commitQueue.length)return void(this.isUploading()||this.fireComplete());this.availableCommitRequests--;const e=[],o=[];let s=t.COMMIT_REQUEST_BATCH_SIZE;for(;s>0&&this.commitQueue.length>0;){const t=this.commitQueue.shift(),r=this.itemQueue.get(t);if(!r)continue;const{info:i,blockTokens:a,destPath:n}=r;e.push({info:i,tokens:a}),o.push(n),s--}try{(yield this.handleCommitBlocks(e)).forEach(e=>{this.itemExit(e.filePath,e.success?"Completed":"Error")})}catch(e){o.forEach(e=>{this.itemExit(e,"Error")})}this.availableCommitRequests++,this.commitNext()}))}queueCommit(e){this.commitQueue.push(e),this.commitNext()}uploadNextBlock(){return o.__awaiter(this,void 0,void 0,(function*(){if(this.availableBlockRequests<=0)return;const e=this.dispenseChunkData();if(!e)return void(this.isUploading()||this.fireComplete());const{item:t,chunk:o,blockIndex:s}=e;let r=0;const i=e=>{if(this.isItemUploading(t.destPath)){const s=Math.min(o.size,t.file.size),i=Math.min(e,s),a=Math.max(i-r,0);r+=a;const n=Math.min(t.totalBytesUploaded+a,t.file.size);t.totalBytesUploaded=n,this.handleProgress(t.info,n)}};this.availableBlockRequests--;try{const e=yield this.handleUploadBlocks(t.info,o,i);this.isItemUploading(t.destPath)&&(i(o.size),t.blockTokens[s]=e,n(t)&&(t.status="Committing",this.queueCommit(t.destPath)))}catch(e){this.itemExit(t.destPath,"Error")}this.availableBlockRequests++,this.uploadNextBlock()}))}addFile(e,t,s){return o.__awaiter(this,void 0,void 0,(function*(){this.itemQueue.set(t,{file:e,destPath:t,status:"Queued",bytesUploaded:0,info:s,blockTokens:[],totalBytesUploaded:0}),this.isUploading()&&this.startUploading()}))}startUploading(){return o.__awaiter(this,void 0,void 0,(function*(){const e=this.onComplete(),t=this.availableBlockRequests;for(let e=0;e<t;e++)this.uploadNextBlock();return e}))}cancelFile(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=this.itemQueue.get(e);t&&!n(t)&&this.itemExit(e,"Cancelled")}))}stopUploading(){this.itemQueue.forEach(({destPath:e})=>{this.cancelFile(e)})}isQueueEmpty(){return 0===this.itemQueue.size}isItemUploading(e){const t=this.itemQueue.get(e);return Boolean(t&&"Uploading"===t.status)}isUploading(){return this.availableBlockRequests<t.MAX_PARALLEL_BLOCK_UPLOAD_REQUESTS||this.availableCommitRequests<t.MAX_PARALLEL_COMMIT_REQUESTS}fireComplete(){for(;this.onCompleteSubscribers.length>0;){const e=this.onCompleteSubscribers.shift();e&&e()}}onComplete(){return new Promise(e=>{this.onCompleteSubscribers.push(e)})}}t.ParallelUploadSchedulerWithBatchCommit=i;class a{constructor(e){this.currentOffset=0,this.item=e}getNextChunk(){if(this.isEmpty())return null;const e=this.item.file.slice(this.currentOffset,t.CHUNK_SIZE+this.currentOffset);return this.currentOffset+=t.CHUNK_SIZE,e}isEmpty(){return this.item.file.size<=this.currentOffset}}const n=({blockTokens:e,file:o})=>{if(e.every(e=>""!==e)){const s=Math.ceil(o.size/t.CHUNK_SIZE);return e.length===s}return!1}})),define("modules/clean/react/browse/tidy_up_actions",["require","exports","tslib","react","modules/clean/react/snackbar","modules/core/i18n","modules/clean/web_user_action_logger","modules/clean/web_user_action_events","react-intl","modules/clean/pap/analytics_client"],(function(e,t,o,s,r,i,a,n,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.snackbarTitle=t.promptTidyUp=t.snackbarCloseActionButtonText=t.snackbarActionButtonText=t.snackbarId=t.millisecondSnackbarTimeout=void 0,s=o.__importDefault(s);t.millisecondSnackbarTimeout=1e4,t.snackbarId="tidyup-feature-growth",t.snackbarActionButtonText=i.intl.formatMessage({id:"V4/4Hh",defaultMessage:"Open Organize"}),t.snackbarCloseActionButtonText=i.intl.formatMessage({id:"cK/p7/",defaultMessage:"Dismiss"}),t.promptTidyUp=function(t,s,r){return o.__awaiter(this,void 0,void 0,(function*(){const{dismissSnackbar:i,getNumAddedFilesAndFolders:a,shouldShowSnackbar:n}=yield new Promise((t,o)=>{e(["modules/clean/react/tidy_up/api_v2"],t,o)}).then(o.__importStar),{openTidyUpModal:l}=yield new Promise((t,o)=>{e(["modules/clean/react/tidy_up/feature_growth"],t,o)}).then(o.__importStar);if(!(yield n(t)))return!1;const d=yield a(t,s);if(d.num_added_files>=5||d.num_added_folders>=2){return u(t,r,()=>l(s,t,r,"from_snackbar"),()=>i(t)),!0}return!1}))};const c=l.defineMessages({DEFAULT:{id:"1uNp68",defaultMessage:"It looks like you’ve added multiple files to this folder recently – organize them with our new folder organization tools."}});t.snackbarTitle=i.intl.formatMessage(c.DEFAULT);const u=(i,l,c,u)=>o.__awaiter(void 0,void 0,void 0,(function*(){r.Snackbar.show(s.default.createElement(r.Snackbar,{actionButtonText:t.snackbarActionButtonText,onActionClick:c,closeButtonText:t.snackbarCloseActionButtonText,onCloseClick:u,timeoutDelayMs:t.millisecondSnackbarTimeout,title:t.snackbarTitle,variant:"generic",id:t.snackbarId})),a.WebUserActionLog.log(i,n.WebUserActionLogEvent.FEATURE_DISCOVERY_SNACKBAR_SHOW,{ns_id:l,trigger:"bulk_upload",feature:"tidy_up"});const{pap_events:p}=yield new Promise((t,o)=>{e(["dropbox/proto/pap_events/tidyup/shown_tidyup_growth_snackbar"],t,o)}).then(o.__importStar);d.logEvent(p.tidyup.Shown_TidyupGrowthSnackbar.create({actionSurface:n.ActionSurfaceLogValue.FEATURE_GROWTH,tidyupFeatureDiscoveryTrigger:p.tidyup.Shown_TidyupGrowthSnackbar.TidyupFeatureDiscoveryTrigger.BULK_UPLOAD_TIDYUP_FEATURE_DISCOVERY_TRIGGER}))}))})),define("modules/clean/react/browse/naming_conventions_actions",["require","exports","tslib","react","modules/clean/react/snackbar","modules/core/i18n","modules/clean/web_user_action_logger","modules/clean/web_user_action_events","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/store","react-intl","modules/clean/react/browse/data/action_creators/index","modules/clean/react/naming_conventions/types"],(function(e,t,o,s,r,i,a,n,l,d,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openNamingConventionsModal=t.promptNamingConventions=t.snackbarCloseActionButtonText=t.snackbarActionButtonText=t.snackbarId=t.millisecondSnackbarTimeout=void 0,s=o.__importDefault(s),l=o.__importStar(l),u=o.__importStar(u),t.millisecondSnackbarTimeout=1e4,t.snackbarId="naming-conventions-feature-growth",t.snackbarActionButtonText=i.intl.formatMessage({id:"ghdSnP",defaultMessage:"Show me"}),t.snackbarCloseActionButtonText=i.intl.formatMessage({id:"3ps1+a",defaultMessage:"Dismiss"}),t.promptNamingConventions=function(s,r,i){return o.__awaiter(this,void 0,void 0,(function*(){const{shouldShowSnackbar:c,snackbarDismissed:u}=yield new Promise((t,o)=>{e(["modules/clean/react/naming_conventions/api_v2"],t,o)}).then(o.__importStar),p={".tag":"date_open",source_path:r},{should_show:h}=yield c(s,p);if(!h)return!1;const m=d.getStoreForBrowse().getState();if(l.path(m)===r){return a.WebUserActionLog.log(s,n.WebUserActionLogEvent.FEATURE_DISCOVERY_SNACKBAR_SHOW,{ns_id:i,trigger:"folder_open_with_dates",feature:"naming_conventions"}),_(()=>t.openNamingConventionsModal(r,s,i),()=>u(s)),!0}return!1}))};const h=c.defineMessages({DEFAULT:{id:"MsPjEI",defaultMessage:"This folder has some files with dates in them. Did you know you can set up naming conventions in Dropbox?"}}),m=i.intl.formatMessage(h.DEFAULT),_=(e,o)=>{r.Snackbar.show(s.default.createElement(r.Snackbar,{actionButtonText:t.snackbarActionButtonText,onActionClick:e,closeButtonText:t.snackbarCloseActionButtonText,onCloseClick:o,timeoutDelayMs:t.millisecondSnackbarTimeout,title:m,variant:"complete",id:t.snackbarId}))};t.openNamingConventionsModal=(s,i,c)=>{r.Snackbar.close(t.snackbarId);const h=d.getStoreForBrowse(),m=h.getState();l.path(m)!==s&&h.dispatch(u.setUrl({path:s})),a.WebUserActionLog.log(i,n.WebUserActionLogEvent.NAMING_CONVENTIONS_OPEN_MODAL,{ns_id:c,origin:p.NamingConventionOrigin.from_open_snackbar}),new Promise((t,o)=>{e(["modules/clean/react/naming_conventions/naming_conventions_modal"],t,o)}).then(o.__importStar).then(({showNamingConventionsModal:e})=>e({currentUserId:i,targetPath:s,namespaceId:c,origin:p.NamingConventionOrigin.from_open_snackbar}))}})),define("modules/clean/react/naming_conventions/types",["require","exports"],(function(e,t){"use strict";var o,s,r;Object.defineProperty(t,"__esModule",{value:!0}),t.TextDataState=t.LearnMoreLink=t.NamingConventionModal=t.NamingConventionOrigin=t.emptyNamingConventionParameters2=t.defaultNamingConventionsParametersData=t.emptyNamingConventionParameters=t.defaultNamingConventionParameters=t.ConsistentSeparatorSelection=t.DateFormatSelection=t.NamingConventionML=t.NamingConventionAutomation=t.NamingConventionType=t.APIRequestState=void 0,(function(e){e[e.IN_PROGRESS=0]="IN_PROGRESS",e[e.FAILED=1]="FAILED",e[e.SUCCEEDED=2]="SUCCEEDED"})(t.APIRequestState||(t.APIRequestState={})),(function(e){e.none="none",e.by_date="start_with_date",e.by_title_casing="capitalize_all_initials",e.by_consistent_separators="change_all_separators",e.by_parent_folder_name="include_parent_folder_name",e.by_keyword="end_with_keyword",e.original_snippet="original_snippet"})(o=t.NamingConventionType||(t.NamingConventionType={})),t.NamingConventionAutomation="automation",t.NamingConventionML="ml",(function(e){e.yyyy_mm="yyyy_mm",e.yyyy_mm_dd="yyyy_mm_dd",e.yyyy_abbr_dd="yyyy_abbr_dd",e.yyyymmdd="yyyymmdd"})(s=t.DateFormatSelection||(t.DateFormatSelection={})),(function(e){e.spaces="spaces",e.underscores="underscores",e.dashes="dashes"})(r=t.ConsistentSeparatorSelection||(t.ConsistentSeparatorSelection={})),t.defaultNamingConventionParameters={selectedRules:[o.by_date],dateFormatSelection:s.yyyy_mm_dd,consistentSeparatorSelection:r.spaces,mlFilenameParsing:!1,data:{keyword:""}},t.emptyNamingConventionParameters={selectedRules:[],dateFormatSelection:s.yyyy_mm_dd,consistentSeparatorSelection:r.spaces,mlFilenameParsing:!1,data:{keyword:""}},t.defaultNamingConventionsParametersData={uploadDateInfo:{dateFormatSelection:s.yyyy_mm_dd,mlFilenameParsing:!0},creationDateInfo:{dateFormatSelection:s.yyyy_mm_dd,mlFilenameParsing:!0},consistentSeparatorSelection:r.spaces,keyword:""},t.emptyNamingConventionParameters2={componentList:[],capitalizeAllInitials:!1,changeAllSeparators:!1,data:t.defaultNamingConventionsParametersData},(function(e){e.from_desktop="from_desktop",e.from_menu="from_menu",e.from_upload_snackbar="from_upload_snackbar",e.from_rename_snackbar="from_rename_snackbar",e.from_open_snackbar="from_open_snackbar"})(t.NamingConventionOrigin||(t.NamingConventionOrigin={})),(function(e){e.rule_selection_page="rule_selection_page",e.automation_change_warning_page="automation_change_warning_page",e.automation_delete_warning_page="automation_delete_warning_page"})(t.NamingConventionModal||(t.NamingConventionModal={})),(function(e){e.ml="https://help.dropbox.com/en-us/files-folders/sort-preview/naming-conventions"})(t.LearnMoreLink||(t.LearnMoreLink={})),(function(e){e.empty="empty",e.invalid="invalid",e.valid="valid",e.lengthError="lengthError"})(t.TextDataState||(t.TextDataState={}))})),define("modules/clean/react/plusplus/file_actions",["require","exports","tslib","modules/clean/pnm/constants","modules/clean/pnm/utils","modules/clean/react/plusplus/constants","modules/core/browser"],(function(e,t,o,s,r,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLinkNodeEventObject=t.handleLinkNodeAction=t.openPasswords=void 0,a=o.__importStar(a),t.openPasswords=()=>{a.redirect(i.PASSWORDS_POST_SETUP_URL)},t.handleLinkNodeAction=(i,a)=>o.__awaiter(void 0,void 0,void 0,(function*(){const{openBackupsModal:n,setupPasswords:l,setupVault:d}=yield new Promise((t,o)=>{e(["modules/clean/react/plusplus/setup_actions"],t,o)}).then(o.__importStar);switch(r.getLinkNodeAction(i)){case s.BACKUP_PRE_SETUP_ACTION:null==a||a("backup_set_up"),n();break;case s.PASSWORDS_PRE_SETUP_ACTION:null==a||a("passwords_set_up"),l();break;case s.PASSWORDS_POST_SETUP_ACTION:null==a||a("passwords_open"),t.openPasswords();break;case s.VAULT_PRE_SETUP_ACTION:null==a||a("vault_set_up"),d()}})),t.getLinkNodeEventObject=function(e){switch(r.getLinkNodeAction()){case s.BACKUP_PRE_SETUP_ACTION:return"backup_set_up";case s.PASSWORDS_PRE_SETUP_ACTION:return"passwords_set_up";case s.PASSWORDS_POST_SETUP_ACTION:return"passwords_open";case s.VAULT_PRE_SETUP_ACTION:return"vault_set_up"}return null}})),define("modules/clean/react/edison/spa_timing_logger",["require","exports","tslib","modules/clean/web_timing_logger"],(function(e,t,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markTimeToInteractive=t.markTimeToView=t.markFetchedDataRequiredForTTI=t.markApplicationStart=t.isClientSideNavigation=t.FILES_SPA_TIMER=void 0,s=o.__importStar(s),t.FILES_SPA_TIMER="files_spa_timer",t.isClientSideNavigation=()=>null!==s.time_to_interactive();const r=e=>{const o=t.isClientSideNavigation()||e;return{usingSpaTimer:o,timer:o?s.get_timer(t.FILES_SPA_TIMER):s.get_timer()}};t.markApplicationStart=e=>{const{usingSpaTimer:t,timer:o}=r(e);t||o.applicationStart()},t.markFetchedDataRequiredForTTI=e=>{const{usingSpaTimer:t,timer:o}=r(e);t||o.fetchedDataRequiredForTTI()},t.markTimeToView=e=>{r(e).timer.markTimeToView()},t.markTimeToInteractive=e=>{const{usingSpaTimer:t,timer:o}=r(e);o.markTimeToInteractive(),t&&o.end()}})),define("modules/clean/react/edison/spa_chrome",["require","exports","tslib","classnames","react","modules/clean/react/edison/router_utils","modules/clean/react/maestro/layout/chrome","modules/clean/react/maestro/layout/search"],(function(e,t,o,s,r,i,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChromeWrapper=void 0,s=o.__importDefault(s),r=o.__importDefault(r),t.ChromeWrapper=e=>{if(i.shouldUseReactRouter()){const{chromeClass:t}=e,i=o.__rest(e,["chromeClass"]);return r.default.createElement(a.MaestroChrome,Object.assign({},i,{chromeClass:s.default({"maestro-chrome--right-rail":e.useRightRailOutsideSearch},t)}))}return r.default.createElement(n.SearchChrome,Object.assign({searchBarProps:{searchVariant:"full-page"}},e))}}));
//# sourceMappingURL=pkg-file-upload.min.js-vflsYgW1z.map