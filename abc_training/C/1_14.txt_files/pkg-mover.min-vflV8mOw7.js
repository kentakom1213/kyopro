define("modules/clean/react/fileops_actions",["require","exports","tslib","react","dig-components/typography","spectrum-sharing/utils/sharing_constants","modules/clean/browse_uri_interface","modules/clean/em_string","modules/clean/file_operations/notifications","modules/clean/filepath/filepath","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/browse/api","modules/clean/react/browse/data/action_creators/index","modules/clean/react/browse/data/store","modules/clean/react/browse/models","modules/clean/react/files_view/file_actions/api_v2","modules/clean/react/files_view/file_actions/file_from_metadata","modules/clean/react/files_view/file_actions/rollback","modules/clean/react/snackbar","modules/clean/sharing/browse_exports","modules/clean/undo","modules/clean/viewer","modules/clean/web_user_action_events","modules/core/i18n","modules/core/notify","modules/core/browser","modules/clean/react/browse/data/selectors","modules/clean/react/tidy_up/api_v2","modules/clean/react/tidy_up/feature_growth"],(function(e,t,o,s,a,r,i,n,l,d,c,u,h,m,f,g,_,p,S,E,v,C,b,M,w,F,y,L,O,k){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showBatchCompletedSnackbar=t.nestedNamespaceSnackbars=t.getBatchUndoHandler=t.moveFiles=t.moveFiles_LEGACY=t.copyFiles_v2=t.copyFiles=void 0,s=o.__importDefault(s),l=o.__importStar(l),d=o.__importStar(d),c=o.__importStar(c),h=o.__importStar(h),m=o.__importStar(m),_=o.__importStar(_),L=o.__importStar(L);const I="view_only_access_error",A="off_team_owner_error",P="owner_only_manage_membership_error",N="team_space_owner_only_manage_membership_error",T="team_space_only_on_team_sharing_error",D="ns_have_mounted_children_ns_error";t.copyFiles=e=>e.useApiV2?U(e):x(e);const x=e=>{const{files:o,newPath:s,checkFSWs:a,onSuccess:r,onRequestNotSent:i,onUndo:n,user:d,dataApi:u=h}=e;!u.copyFiles({files:o,newPath:s,checkFSWs:a,userId:d.id,onSuccess:({newFiles:a,changesets:i,failureDetails:u})=>{if(u){const o=()=>{t.copyFiles(Object.assign(Object.assign({},e),{checkFSWs:!1}))};c.showFileSystemWarningsModal({fsws:u,onFinalAccept:o,confirmText:w.intl.formatMessage({id:"r3T3xT",defaultMessage:"Copy"})})}else r&&r(a),l.notifyCopySuccess(o.length,d,i,s,()=>{n&&n()})}})&&i&&i()},R=(e,t)=>o=>s.default.createElement(a.Link,{hasNoUnderline:!0,inverse:!0,href:i.browse_uri_for_fq_path(e,t).toString()},s.default.createElement("strong",null,o));function U(t){return o.__awaiter(this,void 0,void 0,(function*(){const{files:s,newPath:a,onError:r,onUndo:i,onSuccess:n,user:l,isLockedVaultFolder:c,isPasteAction:u,synchronousSingleFileActions:h}=t;if(c)return Promise.all([new Promise((t,o)=>{e(["modules/clean/react/vault/lib/api"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["vault/common/logging-types"],t,o)}).then(o.__importStar)]).then(([{logProductAnalyticsEvent:e},{AnalyticsEventActionSurface:t,AnalyticsEventAction:o,AnalyticsEventObject:s}])=>e({actionSurface:t.BROWSE,eventAction:o.SELECT,eventObject:s.COPY_INTO_LOCKED_VAULT})),void E.Snackbar.fail(w.intl.formatMessage({id:"MAy8Kw",defaultMessage:"Please unlock your Vault before attempting to add to this folder."}),"browse-action");const m=d.filename(a),f=R(l,a),g={sync:e=>w.intl.formatMessage({id:"Xq8RFm",defaultMessage:"{count, plural, one{Copying {count} item...} other{Copying {count} items...}}"},{count:e}),undo:w.intl.formatMessage({id:"X8FnSw",defaultMessage:"Undoing copy..."}),undoFail:w.intl.formatMessage({id:"oYs0zq",defaultMessage:"Couldn’t undo copy."}),undoComplete:w.intl.formatMessage({id:"zgCNlD",defaultMessage:"Copy undone."}),failure:e=>w.intl.formatMessage({id:"0OnruC",defaultMessage:"{count, plural, one{Couldn’t copy {count} item to <link>{folderName}</link>.} other{Couldn’t copy {count} items to <link>{folderName}</link>.}}"},{count:e,folderName:m,link:f}),partialSuccess:(e,t)=>w.intl.formatMessage({id:"QA6Uk4",defaultMessage:"{count, plural, one{Copied {succesfully_copied_files} out of {count} item to <link>{folderName}</link>.} other{Copied {succesfully_copied_files} out of {count} items to <link>{folderName}</link>.}}"},{count:t,succesfully_copied_files:e,folderName:m,link:f}),success:e=>w.intl.formatMessage({id:"c5FpTz",defaultMessage:"{count, plural, one{Copied {count} item to <link>{folderName}</link>.} other{Copied {count} items to <link>{folderName}</link>.}}"},{count:e,folderName:m,link:f})},p={sync:e=>w.intl.formatMessage({id:"xegVmx",defaultMessage:"{count, plural, one{Pasting {count} item...} other{Pasting {count} items...}}"},{count:e}),undo:w.intl.formatMessage({id:"xkxhEq",defaultMessage:"Undoing paste..."}),undoFail:w.intl.formatMessage({id:"biijKe",defaultMessage:"Couldn’t undo paste."}),undoComplete:w.intl.formatMessage({id:"gevTNB",defaultMessage:"Paste undone."}),failure:e=>w.intl.formatMessage({id:"fJ21+e",defaultMessage:"{count, plural, one{Couldn’t paste {count} item.} other{Couldn’t paste {count} items.}}"},{count:e}),partialSuccess:(e,t)=>w.intl.formatMessage({id:"o9R5u2",defaultMessage:"{count, plural, one{Pasted {succesfully_copied_files} out of {count} item.} other{Pasted {succesfully_copied_files} out of {count} items.}}"},{count:t,succesfully_copied_files:e}),success:e=>w.intl.formatMessage({id:"TIeF91",defaultMessage:"{count, plural, one{Pasted {count} item.} other{Pasted {count} items.}}"},{count:e})},S=u?p:g;E.Snackbar.sync(S.sync(s.length),!0,"browse-action"),G(yield _.copyFiles(s,a,l.id,{checkFSWs:!1,synchronousSingleFileActions:Boolean(h)}),l,s,a,{successLogAction:M.WebUserActionLogEvent.COPY_REQUEST_SUCCESS,failedLogAction:M.WebUserActionLogEvent.COPY_REQUEST_FAIL,undoingLogAction:M.WebUserActionLogEvent.COPY_UNDO,undoFailedLogAction:M.WebUserActionLogEvent.COPY_UNDO_REQUEST_FAIL,undoSuccessLogAction:M.WebUserActionLogEvent.COPY_UNDO_REQUEST_SUCCESS,undoingSnackbarText:S.undo,undoFailedSnackbarText:S.undoFail,undoSuccessSnackbarText:S.undoComplete,getFailureSnackbarText:S.failure,getPartialSuccessSnackbarText:S.partialSuccess,getSuccessSnackbarText:S.success},n,i,r)}))}function B(t){return o.__awaiter(this,void 0,void 0,(function*(){const{path:s,files:a,newPath:r,onError:i,onUndo:n,onSuccess:l,user:c,dataApiV2:u=_,checkFSWs:h,isLockedVaultFolder:m,extra:f,synchronousSingleFileActions:g,expEnableSharingNSF:p=!1}=t;if(m)return Promise.all([new Promise((t,o)=>{e(["modules/clean/react/vault/lib/api"],t,o)}).then(o.__importStar),new Promise((t,o)=>{e(["vault/common/logging-types"],t,o)}).then(o.__importStar)]).then(([{logProductAnalyticsEvent:e},{AnalyticsEventActionSurface:t,AnalyticsEventAction:o,AnalyticsEventObject:s}])=>e({actionSurface:t.BROWSE,eventAction:o.SELECT,eventObject:s.MOVE_INTO_LOCKED_VAULT})),void E.Snackbar.fail(w.intl.formatMessage({id:"fDvKfJ",defaultMessage:"Please unlock your Vault before attempting to add to this folder."}),"browse-action");if(void 0!==s&&d.paths_are_equal(s,r))return void E.Snackbar.fail(w.intl.formatMessage({id:"V6/bVk",defaultMessage:"Those files already exist in that folder."}),"browse-action");E.Snackbar.sync(w.intl.formatMessage({id:"ENlS4s",defaultMessage:"{count, plural, one{Moving {count} item...} other{Moving {count} items...}}"},{count:a.length}),!0,"browse-action");const S=yield u.moveFiles(a,r,c.id,{allowOwnershipTransfer:p,checkFSWs:h,synchronousSingleFileActions:Boolean(g)}),v=d.filename(r),C=R(c,r);G(S,c,a,r,{successLogAction:M.WebUserActionLogEvent.MOVE_REQUEST_SUCCESS,failedLogAction:M.WebUserActionLogEvent.MOVE_REQUEST_FAIL,undoingLogAction:M.WebUserActionLogEvent.MOVE_UNDO,undoFailedLogAction:M.WebUserActionLogEvent.MOVE_UNDO_REQUEST_FAIL,undoSuccessLogAction:M.WebUserActionLogEvent.MOVE_UNDO_REQUEST_SUCCESS,undoingSnackbarText:w.intl.formatMessage({id:"BDPPA/",defaultMessage:"Undoing move..."}),undoFailedSnackbarText:w.intl.formatMessage({id:"ENMVb1",defaultMessage:"Couldn’t undo move."}),undoSuccessSnackbarText:w.intl.formatMessage({id:"O7CH0I",defaultMessage:"Move undone."}),getFailureSnackbarText:(e,{isNestedNamespaceError:t}={})=>t?w.intl.formatMessage({id:"U2agKj",defaultMessage:"{count, plural, one{Couldn’t move {count} item to <link>{folderName}</link>.} other{Couldn’t move {count} items to <link>{folderName}</link>.}} Shared folders can’t be moved to other shared folders."},{count:e,folderName:v,link:C}):w.intl.formatMessage({id:"aWWTan",defaultMessage:"{count, plural, one{Couldn’t move {count} item to <link>{folderName}</link>.} other{Couldn’t move {count} items to <link>{folderName}</link>.}}"},{count:e,folderName:v,link:C}),getPartialSuccessSnackbarText:(e,t,{isNestedNamespaceError:o}={})=>o?w.intl.formatMessage({id:"v6wzJx",defaultMessage:"{count, plural, one{Moved {succesfully_moved_files} out of {count} item to <link>{folderName}</link>.} other{Moved {succesfully_moved_files} out of {count} items to <link>{folderName}</link>.}} Shared folders can’t be moved to other shared folders."},{count:t,succesfully_moved_files:e,folderName:v,link:C}):w.intl.formatMessage({id:"VgRH6k",defaultMessage:"{count, plural, one{Moved {succesfully_moved_files} out of {count} item to <link>{folderName}</link>.} other{Moved {succesfully_moved_files} out of {count} items to <link>{folderName}</link>.}}"},{count:t,succesfully_moved_files:e,folderName:v,link:C}),getSuccessSnackbarText:e=>w.intl.formatMessage({id:"315R6Z",defaultMessage:"{count, plural, one{Moved {count} item to <link>{folderName}</link>.} other{Moved {count} items to <link>{folderName}</link>.}}"},{count:e,folderName:v,link:C}),extra:f},l,n,i,t)}))}function H(e,t,o,a,i){const l=b.Viewer.get_viewer().team_name;let u=!1;"is_cdm_member"in e&&e.is_cdm_member&&d.inSubDirectory(e.cdm_tmf_path,a)&&(u=!0);const h=(function(e,t,o,a,i){const l=w.intl.formatMessage({id:"gVzSq7",defaultMessage:"You don’t have permission to move some of these items. Try moving items individually."});let d=null;const c=(e=>0===e.length?"":_.getFilenameFromActionInfo(e[0]))(a);t===A?d=1===a.length?null==o?w.intl.formatMessage({id:"eqzXgU",defaultMessage:"The owner of <strong>{file_name}</strong> is a member of another team."},{file_name:n.Emstring.em_snippet(c,r.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):w.intl.formatMessage({id:"F7A+9f",defaultMessage:"The owner of <strong>{file_name}</strong> isn’t a member of {team_name}."},{team_name:o,file_name:n.Emstring.em_snippet(c,r.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):null==o?w.intl.formatMessage({id:"1mkOQ2",defaultMessage:"The owner of some of these shared folders is a member of another team."}):w.intl.formatMessage({id:"kXptr+",defaultMessage:"The owner of some of these shared folders isn’t a member of {team_name}."},{team_name:o}):t===P?d=1===a.length?"is_cdm_member"in e&&e.is_cdm_member&&!i?w.intl.formatMessage({id:"rLKsQF",defaultMessage:"Only the owner of <strong>{file_name}</strong> can move it to the {team_name} team space."},{team_name:o,file_name:n.Emstring.em_snippet(c,r.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):w.intl.formatMessage({id:"Xkb8gG",defaultMessage:"Only the owner of <strong>{file_name}</strong> can move it to a team folder."},{file_name:n.Emstring.em_snippet(c,r.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):"is_cdm_member"in e&&e.is_cdm_member&&!i?w.intl.formatMessage({id:"Ic3QpQ",defaultMessage:"Only the owner can move some of these folders to the {team_name} team space."},{team_name:o}):w.intl.formatMessage({id:"AGXz3U",defaultMessage:"Only the owner can move some of these folders to a team folder."}):t===I?d=1===a.length?w.intl.formatMessage({id:"4nfaRz",defaultMessage:"You can only view <strong>{file_name}</strong>. Ask an owner or editor of the folder for access to edit it."},{file_name:n.Emstring.em_snippet(c,r.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):w.intl.formatMessage({id:"vSscn6",defaultMessage:"You can’t edit some of these folders. Ask an owner or editor of the folders for access to edit them."}):t===N||t===T?d=1===a.length?w.intl.formatMessage({id:"xYXgy4",defaultMessage:"If you need to move <strong>{file_name}</strong>, ask your admin to move it for you."},{file_name:n.Emstring.em_snippet(c,r.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):l:t===D&&(d=1===a.length?w.intl.formatMessage({id:"sFivS0",defaultMessage:"<strong>{file_name}</strong> has other shared folders inside it. Try moving each shared folder individually."},{file_name:n.Emstring.em_snippet(c,r.SNIPPET_SIZES.FILENAME),strong:e=>s.default.createElement("strong",{style:{fontWeight:500}},e)}):l);return d})(e,t,l,o,u);if(null==h)return void(i&&i());F.Notify.clear();const p=t===N||t===T||t===D,S=(function(e,t,o,s,a){if(t)return 1===s?w.intl.formatMessage({id:"MHxxzk",defaultMessage:"Can’t move out of the team space"}):w.intl.formatMessage({id:"XJI7dZ",defaultMessage:"Can’t move {num_of_files} items"},{num_of_files:s});return"is_cdm_member"in e&&e.is_cdm_member&&!a?w.intl.formatMessage({id:"S+fFwb",defaultMessage:"{count, plural, one{Can’t move shared folder to the {team_name} team space} other{Can’t move shared folders to the {team_name} team space}}"},{count:s,team_name:n.Emstring.em_snippet(o,r.SNIPPET_SIZES.DISPLAY_NAME)}):w.intl.formatMessage({id:"thmzHN",defaultMessage:"{count, plural, one{Can’t move shared folder to a team folder} other{Can’t move shared folders to a team folder}}"},{count:s})})(e,p,l,o.length,u);let E="";E=p?"/help/business/team-space-overview#out":"/help/business/team-space-overview#move";const C=1===o.length,M=o[0]instanceof g.File&&C&&!p?w.intl.formatMessage({id:"tHNeW4",defaultMessage:"See owner"}):void 0;c.showMoveErrorModal({title:S,content:h,learnMoreLink:E,buttonString:M,onClick:()=>{o[0]instanceof g.File&&v.asyncShowShareModal(e.id,o[0],{origin:r.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},({path:e,qargs:t})=>f.getStoreForBrowse().dispatch(m.setUrl({path:e,qargs:t})))}})}function V(e){return"failure"===e[".tag"]&&"relocation_error"===e.failure[".tag"]&&"cant_nest_shared_folder"===e.failure.relocation_error[".tag"]}function G(e,o,s,a,r,i,n,l,h){if(e.isError){if(E.Snackbar.close("browse-action"),l&&l(),h&&"to"===e.error[".tag"]&&"file_system_warnings"===e.error.to[".tag"]){const t=()=>B(Object.assign(Object.assign({},h),{checkFSWs:!1}));return void c.showFileSystemWarningsModal({fsws:e.error.to.details,onFinalAccept:t,confirmText:w.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})})}const t=()=>{E.Snackbar.fail(r.getFailureSnackbarText(s.length),"browse-action")};return H(o,e.error[".tag"],s,a,t),void u.logFileAction({uid:o.id,action:r.failedLogAction,num_files_selected:s.length,num_folders_selected:0,error_summary:e.error_summary,error:e.error[".tag"],jobId:e&&e.jobId,extra:r.extra})}const m=e.result.entries.filter(e=>"success"===e[".tag"]),g=m.length,_=s.length-g,S=W(e,o,r,n);if(t.showBatchCompletedSnackbar(s.length,g,_,r,S,{isNestedNamespaceError:e.result.entries.some(V)}),i){const e=[];m.forEach(t=>{if("file"===t.success[".tag"]||"folder"===t.success[".tag"]){const o=t.success,a=s.find(e=>"file_id"in e?e.file_id===o.id:"id"in e&&e.id===o.id);if(a){const t=p.fileFromMetadata(a,o);e.push(t)}}}),i([],e)}const v="is_cdm_member"in o&&"cdm_tmf_path"in o?o:b.Viewer.get_viewer().get_user_by_id(o.id),C=!v.is_cdm_member||d.paths_are_equal(v.cdm_tmf_path,null==h?void 0:h.path)||d.inSubDirectory(v.cdm_tmf_path,null==h?void 0:h.path)?"personal":"team",M=!v.is_cdm_member||d.paths_are_equal(v.cdm_tmf_path,a)||d.inSubDirectory(v.cdm_tmf_path,a)?"personal":"team",F=Object.assign(Object.assign({},r.extra),{original_ultimate_parent:C,new_ultimate_parent:M});if((function(e,t,o,s,a,r){let i=a,n=0,l=void 0;const d=t.entries.filter(e=>"success"===e[".tag"]);d&&(i=d.filter(e=>"file"===e.success[".tag"]).length,n=d.filter(e=>"folder"===e.success[".tag"]).length);const c=t.entries.filter(e=>"failure"===e[".tag"]);c&&c.length>0&&(l=c[0].failure[".tag"]);u.logFileAction({uid:o,action:e,num_files_selected:i,num_folders_selected:n,jobId:s,error_summary:l,extra:r})})(r.successLogAction,e.result,o.id,e.jobId,s.length,F),void 0!==h&&0===_&&g>0){const e=f.getStoreForBrowse().getState(),t=L.postTTIExperiments(e);if(t.expTidyUpBrowse&&t.expTidyMoveFeatureGrowth){a.substring(0,a.lastIndexOf("/"))===h.path&&O.shouldShowMoveSnackbar(o.id,a,g).then(t=>{t&&setTimeout(()=>{k.showTidyUpMoveSnackbar(h.path,o.id,L.context(e).currentNSID)},5e3)})}}}function W(e,t,s,a){return!e.isError&&e.result.changeset_data&&e.result.changeset_data.length>0?()=>o.__awaiter(this,void 0,void 0,(function*(){E.Snackbar.close("browse-action"),u.logFileAction({uid:t.id,action:s.undoingLogAction,num_files_selected:e.result.entries.length,num_folders_selected:0,extra:s.extra}),S.rollback({changeset_data:e.result.changeset_data,userId:t.id,onSuccess:()=>{E.Snackbar.complete(s.undoSuccessSnackbarText,"browse-action"),u.logFileAction({uid:t.id,action:s.undoSuccessLogAction,num_files_selected:e.result.entries.length,num_folders_selected:0}),a&&a(!0)}})})):void 0}function q(){y.open_tab("https://help.dropbox.com/files-folders/share/shared-folder-differences#move_shared_folder")}t.copyFiles_v2=U,t.moveFiles_LEGACY=e=>{const{path:o,files:s,newPath:a,checkFSWs:r,onSuccess:i,onRequestNotSent:n,onUndo:d,user:u,dataApi:m=h}=e,f=({newFiles:o,changesets:r,failureDetails:n})=>{if(n){const o=()=>{t.moveFiles_LEGACY(Object.assign(Object.assign({},e),{checkFSWs:!1}))};c.showFileSystemWarningsModal({fsws:n,onFinalAccept:o,confirmText:w.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})})}else l.notifyMoveSuccess(s.length,u,r,a,()=>{d&&d()}),i&&i(o)};!m.moveFiles({path:o,files:s,newPath:a,checkFSWs:r,userId:u.id,onSuccess:f,onError:e=>{"This will result in losing ownership of these folders."===e?(F.Notify.clear(),c.showConfirmOwnershipTransferModal(()=>{m.moveFiles({path:o,files:s,newPath:a,userId:u.id,onSuccess:f,allowOwnershipTransfer:!0})})):H(u,e,s,a)},allowOwnershipTransfer:!1})&&n&&n()},t.moveFiles=B,t.getBatchUndoHandler=W,t.nestedNamespaceSnackbars={showPartialSuccess:(e,t)=>t?(C.setHandleUndo(t),E.Snackbar.show(s.default.createElement(E.Snackbar,{title:e,variant:"complete",actionButtonText:w.intl.formatMessage({id:"OfxyEk",defaultMessage:"Undo"}),onActionClick:t,closeButtonText:w.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onCloseClick:q,timeoutDelayMs:5e3,id:"browse-action"}))):E.Snackbar.show(s.default.createElement(E.Snackbar,{closeButtonText:w.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),actionButtonText:w.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onActionClick:q,timeoutDelayMs:5e3,title:e,variant:"complete",id:"browse-action"})),showFailure:e=>E.Snackbar.show(s.default.createElement(E.Snackbar,{closeButtonText:w.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),actionButtonText:w.intl.formatMessage({id:"N4y79U",defaultMessage:"Learn More"}),onActionClick:q,timeoutDelayMs:5e3,title:e,variant:"fail",id:"browse-action"}))},t.showBatchCompletedSnackbar=(e,o,s,a,r,i={})=>{if(o>0&&s>0){const s=a.getPartialSuccessSnackbarText(o,e,i);i.isNestedNamespaceError?t.nestedNamespaceSnackbars.showPartialSuccess(s,r):r?(C.setHandleUndo(r),E.Snackbar.completeWithUndo(s,r,"browse-action")):E.Snackbar.complete(s,"browse-action")}else if(o>0){const e=a.getSuccessSnackbarText(o);r?(C.setHandleUndo(r),E.Snackbar.completeWithUndo(e,r,"browse-action")):E.Snackbar.complete(e,"browse-action")}else{const e=a.getFailureSnackbarText(s,i);i.isNestedNamespaceError?t.nestedNamespaceSnackbars.showFailure(e):E.Snackbar.fail(e,"browse-action")}}})),define("modules/clean/react/folder_dialog/api",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_as_promised_jquery","api_v2/user_client","modules/clean/react/folder_dialog/constants","modules/core/exception"],(function(e,t,o,s,a,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFolderSuggestion=t.getFolderContentsAPIv2=t.getFolderContents=t.getFolderContentsWithCache=void 0,s=o.__importStar(s);const n={};function l(e,t){const o={folder:t};return s.WebRequestOref({url:"/browse_util/tree_view_folders",type:"POST",subject_user:e,data:o,dataType:"json",skipNotifyError:!0})}t.getFolderContentsWithCache=function(e,t){return(!n[t]||Date.now()-n[t].timestamp>r.CACHE_TTL_MS)&&(n[t]={folderContents:l(e,t),timestamp:Date.now()}),n[t].folderContents},t.getFolderContents=l,t.getFolderContentsAPIv2=function(e,t,s,r){return o.__awaiter(this,void 0,void 0,(function*(){const o=new a.UserApiV2Client;try{const a=yield o.ns("files").rpc("list_subfolders",{path:t,max_height:s,limit_sub_folder_count:r},{subjectUserId:e}),i=[];return(a.subfolder_entries||[]).forEach(e=>{const t=e.folder_metadata;let o=!1,s=!1,a=0;t.sharing_info&&(o=t.sharing_info.read_only||!!t.sharing_info.no_access,s=!!t.sharing_info.no_access,void 0!==t.sharing_info.shared_folder_id&&(a=parseInt(t.sharing_info.shared_folder_id,10))),i.push({path:t.path_display||"",has_subdirs:e.has_subfolders||!1,icon:t.icon||"",read_only:o||!1,contained_ns:e.contained_ns||0,target_ns:a,no_access:s})}),i}catch(e){throw i.reportException({err:e.raw?new Error(e.raw.responseBody):e,severity:"non-critical",tags:["js:browse"]}),e}}))},t.getFolderSuggestion=function(e,t,o){return(new a.UserApiV2Client).ns("ml").rpc("get_folder_suggestion",{paths:t,action:o},{subjectUserId:e})}})),define("modules/clean/react/folder_dialog/constants",["require","exports","modules/core/i18n"],(function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CACHE_TTL_MS=t.DEFAULT_REVISION_ID=t.FOLDER_INPUT_HEIGHT=t.FOLDER_SUGGESTION_HEIGHT=t.LOADING_MIN_TIME=t.DIALOG_BODY_PADDING=t.PATH_BREADCRUMB_HEIGHT=t.DIALOG_ACTIONS_HEIGHT=t.DIALOG_HEAD_HEIGHT=t.errorDialogProps=t.FolderPickerLoadingState=t.Operation=t.ACCESS_LEVEL=t.TEAM_MEMBER=t.MAX_FOLDER_NAME_LENGTH=t.INVALID_FOCUS_INDEX=t.SUGGESTED_LOCATION_KEY_SCOPE=t.KEY_SCOPE=void 0,t.KEY_SCOPE="folder_picker_keyboard_selection",t.SUGGESTED_LOCATION_KEY_SCOPE="suggested_location_keyboard_selection",t.INVALID_FOCUS_INDEX=-1,t.MAX_FOLDER_NAME_LENGTH=20,t.TEAM_MEMBER="team_member",(function(e){e[e.ACCESS=0]="ACCESS",e.LIMITED_ACCESS="locked",e.LIMITED_ACCESS_VAULT="vault",e.NO_ACCESS="no_access"})(t.ACCESS_LEVEL||(t.ACCESS_LEVEL={})),(function(e){e[e.COPY=0]="COPY",e[e.MOVE=1]="MOVE",e[e.UPLOAD=2]="UPLOAD",e[e.EXPORT_LEGAL_HOLD=3]="EXPORT_LEGAL_HOLD"})(t.Operation||(t.Operation={})),(function(e){e[e.LOADING=0]="LOADING",e[e.ERROR=1]="ERROR",e[e.LOADED=2]="LOADED"})(t.FolderPickerLoadingState||(t.FolderPickerLoadingState={})),t.errorDialogProps={primaryAction:o.intl.formatMessage({id:"BCyGLk",defaultMessage:"Try again"}),secondaryAction:o.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}),title:o.intl.formatMessage({id:"v3oTv1",defaultMessage:"Something went wrong on our end"}),ariaLabel:"",open:!0,variant:"regular"},t.DIALOG_HEAD_HEIGHT=64,t.DIALOG_ACTIONS_HEIGHT=64,t.PATH_BREADCRUMB_HEIGHT=40,t.DIALOG_BODY_PADDING=26,t.LOADING_MIN_TIME=200,t.FOLDER_SUGGESTION_HEIGHT=89,t.FOLDER_INPUT_HEIGHT=93,t.DEFAULT_REVISION_ID="0000000000000000",t.CACHE_TTL_MS=3e3})),define("modules/clean/react/folder_dialog/folder_picker",["require","exports","tslib","classnames","lodash","keymaster","react","react-dom","spectrum/button/index","spectrum/dimensions/index","spectrum/icon_arrow/index","spectrum/icon_content/index","spectrum/icon_global/index","spectrum/media_table/index","spectrum/table/index","spectrum/table/table_head_cell","spectrum/tooltip/index","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath/filepath","modules/clean/react/components/css","modules/clean/react/folder_dialog/constants","modules/clean/react/icon/folder_icon","modules/clean/react/image","modules/clean/react/path_breadcrumbs","modules/clean/react/selectable_list","modules/clean/static_urls","modules/core/exception","modules/core/i18n"],(function(e,t,o,s,a,r,i,n,l,d,c,u,h,m,f,g,_,p,S,E,v,C,b,M,w,F,y,L,O){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FolderPicker=t.FolderPickerRow=void 0,s=o.__importDefault(s),a=o.__importStar(a),r=o.__importDefault(r),i=o.__importDefault(i),n=o.__importStar(n),L=o.__importStar(L);let k="";class I extends i.default.Component{constructor(){super(...arguments),this.handleClick=()=>{this.props.onClick(this.props.folder,this.props.index)},this.handleMouseOver=()=>{this.props.onMouseOver(this.props.folder)},this.handleMouseLeave=()=>{this.props.onMouseLeave()}}render(){const{folder:e,isSelected:t,isFocused:a,index:r}=this.props,n=S.Emstring.em_snippet(E.filename(e.path),C.MAX_FOLDER_NAME_LENGTH),l=[i.default.createElement(m.MediaCell,{key:n,icon:i.default.createElement(u.IconContent,{name:e.icon,disabled:!e.isClickable}),title:n}),i.default.createElement(m.MediaCell,{key:"has_subdirs",className:"folder-picker__right-arrow",icon:e.hasSubfolders&&e.isClickable?i.default.createElement(c.IconArrow,{name:"right"}):void 0})];let d={className:s.default({folder_picker_row:!0,read_only:!e.isClickable,focused:a,selected:t}),variant:t?"selected":"default"};e.isClickable&&(d=Object.assign(Object.assign({},d),{onClick:this.handleClick,onMouseOver:this.handleMouseOver,onMouseLeave:this.handleMouseLeave}));const{ref:h}=d,f=o.__rest(d,["ref"]),g=t?O.intl.formatMessage({id:"apGvjm",defaultMessage:"{folder} (selected)"},{folder:n}):n;return i.default.createElement(m.MediaRow,Object.assign({role:"option",id:`folder_picker_row_${r}`,"aria-label":g,"aria-selected":t},f),l)}}t.FolderPickerRow=I,I.displayName="FolderPickerRow";class A extends i.default.Component{constructor(e){super(e),this.preloadErrorImages=()=>{const e=new Image;e.src=y.static_url("/static/images/illustration_catalog/dropbox_somethings_not_working-vfl2QXPxi.png"),e.srcset=y.static_url("/static/images/illustration_catalog/dropbox_somethings_not_working@2x-vflkcbmXv.png")+" 2x"},this.setStatus=(e,t)=>{e!==this.state.loadingState&&(this.cancelStatusTimeout(),t?this.setState({loadingState:e,loadingStateShown:e}):(this.setState({loadingState:e}),this.statusTimeout=setTimeout(()=>{this.setState({loadingStateShown:e})},C.LOADING_MIN_TIME)))},this.cancelStatusTimeout=()=>{void 0!==this.statusTimeout&&clearTimeout(this.statusTimeout),this.statusTimeout=void 0},this.unFocusRows=()=>{this.setState({focusIndex:C.INVALID_FOCUS_INDEX})},this.setPathWithErrorHandling=e=>{this.setPath(e).catch(this.handleError)},this.handleError=e=>{this.props.onError(e),this.props.onFolderSelected(),this.setStatus(C.FolderPickerLoadingState.ERROR)},this.canInstantlySetPath=e=>{if(this.cachedFolders.has(E.normalize(e).toLowerCase())&&this.cachedFolders.has(E.normalize(E.parent_dir(e)).toLowerCase()))return!0;if(this.cachedFolders.has(E.normalize(E.parent_dir(e)).toLowerCase())){const t=a.find(this.cachedFolders.get(E.normalize(E.parent_dir(e)).toLowerCase()),t=>t.path===e);if(t&&!t.hasSubfolders)return!0}return!1},this.setPath=(e,t)=>o.__awaiter(this,void 0,void 0,(function*(){const{onFolderSelected:o,onDataLoaded:s,user:r}=this.props;let i,n,l=[],d=!1;this.setState({loadingPath:e});const c=this.canInstantlySetPath(e);if(this.setStatus(C.FolderPickerLoadingState.LOADING,!0),c||o(void 0,void 0,void 0,void 0,!0),E.paths_are_equal(e,"/"))l=yield this.fetchFolderContents("/"),d=this.canSelectRoot(),i=r.root_ns_id;else{const t=yield this.fetchFolderContents(E.parent_dir(e)),o=a.find(t,t=>E.paths_are_equal(t.path,e));if(!o)throw new Error("Could not find folder in API response");n=o.isLockedVaultFolder,i=o.nsId,d=o.isSelectable,l=o.hasSubfolders?yield this.fetchFolderContents(e):yield this.fetchFolderContents(E.parent_dir(e)),o.hasSubfolders&&0===l.length&&(o.hasSubfolders=!1,l=yield this.fetchFolderContents(E.parent_dir(e)),yield this.fetchFolderContents(E.parent_dir(E.parent_dir(e))))}c||s(e),this.setStatus(C.FolderPickerLoadingState.LOADED,c),this.setState({path:e,folders:l,focusIndex:t?C.INVALID_FOCUS_INDEX:this.getFolderIndex(l,e),isFolderSuggestionSelected:!1}),d||this.props.forceFolderSelectedCallback?o(e,i,void 0,n):o(void 0,void 0)})),this.setupKeyboardShortcuts=()=>{k=r.default.getScope(),k!==C.KEY_SCOPE&&r.default.setScope(C.KEY_SCOPE),r.default("up",C.KEY_SCOPE,this.handleFocusPrevious),r.default("down",C.KEY_SCOPE,this.handleFocusNext),r.default("left",C.KEY_SCOPE,this.handleSelectParent),r.default("right",C.KEY_SCOPE,this.handleSelectCurrentFolder),r.default("space",C.KEY_SCOPE,this.handleSelectCurrentFolder),r.default("enter",C.KEY_SCOPE,this.handleSelect)},this.cleanupKeyboardShortcuts=()=>{r.default.clearScope(C.KEY_SCOPE),k&&r.default.setScope(k),r.default.resetFilter()},this.setupSuggestedLocationKeyboardShortcuts=()=>{k=r.default.getScope(),k!==C.SUGGESTED_LOCATION_KEY_SCOPE&&r.default.setScope(C.SUGGESTED_LOCATION_KEY_SCOPE);const{folderSuggestion:e}=this.state;e&&r.default("enter",C.SUGGESTED_LOCATION_KEY_SCOPE,()=>this.handleFolderSuggestionClick(e))},this.cleanupSuggestedLocationKeyboardShortcuts=()=>{r.default.clearScope(C.SUGGESTED_LOCATION_KEY_SCOPE),k&&r.default.setScope(k),r.default.resetFilter()},this.getUrlForBreadcrumb=()=>"#",this.getAccessLevel=e=>e.icon.endsWith(C.ACCESS_LEVEL.NO_ACCESS)?C.ACCESS_LEVEL.NO_ACCESS:e.icon.endsWith(C.ACCESS_LEVEL.LIMITED_ACCESS_VAULT)?C.ACCESS_LEVEL.LIMITED_ACCESS_VAULT:e.icon.endsWith(C.ACCESS_LEVEL.LIMITED_ACCESS)||e.read_only?C.ACCESS_LEVEL.LIMITED_ACCESS:C.ACCESS_LEVEL.ACCESS,this.convertJsonFolderToFolder=e=>{const{canSelectReadonly:t}=this.props,{path:o,icon:s,has_subdirs:a,contained_ns:r}=e,i=this.getAccessLevel(e);return{path:o,icon:b.convertLegacyFolderIconToSpectrum(s,"small"),hasSubfolders:a,isSelectable:i===C.ACCESS_LEVEL.LIMITED_ACCESS_VAULT||i===C.ACCESS_LEVEL.ACCESS||i===C.ACCESS_LEVEL.LIMITED_ACCESS&&t,isClickable:i===C.ACCESS_LEVEL.LIMITED_ACCESS_VAULT||i===C.ACCESS_LEVEL.ACCESS||i===C.ACCESS_LEVEL.LIMITED_ACCESS&&(t||a),nsId:r,isLockedVaultFolder:i===C.ACCESS_LEVEL.LIMITED_ACCESS_VAULT&&e.read_only}},this.fetchFolderSuggestion=()=>o.__awaiter(this,void 0,void 0,(function*(){const{apiClient:e,user:t,onFetchFolderSuggestionSuccess:o}=this.props;try{const{path:s,prediction_id:a,suggest_id:r}=yield e.fetchFolderSuggestion(t.id);if(s){const e={path:s,predictionId:a};o([e],r),this.setState({folderSuggestion:e})}else o([],r);this.setState({isFolderSuggestionLoading:!1})}catch(e){const t=e.raw?e.raw.responseBody:"Received error response from folder suggestion API";L.reportException({err:new Error(t),tags:["folder_suggestion"],severity:L.SEVERITY.NONCRITICAL}),this.setState({isFolderSuggestionLoading:!1})}})),this.handleFolderHover=e=>{const{folders:t,focusIndex:o}=this.state,s=this.getFolderIndex(t,e.path);s!==o&&this.setState({focusIndex:s})},this.handleFolderClick=(e,t,o)=>{this.props.onRowClicked(e.path,t,!!o),this.setPathWithErrorHandling(e.path)},this.handleBreadcrumbClick=({path:e})=>{this.props.onBreadcrumbClicked(e),this.setPathWithErrorHandling(e)},this.handleFocusPrevious=()=>{this.hasNotLoaded||this.focusNeighboringItem(F.SelectDirection.PREV)},this.handleFocusNext=()=>{this.hasNotLoaded||this.focusNeighboringItem(F.SelectDirection.NEXT)},this.handleSelectParent=()=>{this.hasNotLoaded||this.setPathWithErrorHandling(E.parent_dir(this.state.path))},this.handleSelectCurrentFolder=()=>{const{focusIndex:e,folders:t,path:o}=this.state,s=this.getFolderIndex(t,o);this.hasNotLoaded||e===s||this.handleSelect()},this.handleSelect=()=>{if(this.hasNotLoaded)return;const{focusIndex:e,folders:t,path:o}=this.state;this.getFolderIndex(t,o)===e?this.props.onSuccess():this.handleFolderClick(t[e],e,!0)},this.handleTryAgainClick=()=>{this.cachedFolders.delete(E.normalize(this.state.loadingPath).toLowerCase()),this.cachedFolders.delete(E.parent_dir(this.state.loadingPath).toLowerCase()),this.setPathWithErrorHandling(this.state.loadingPath)},this.setTableRef=e=>{this.table=e?n.findDOMNode(e):void 0},this.handleFolderSuggestionClick=e=>{this.props.onFolderSuggestionClick(e),this.setState({isFolderSuggestionSelected:!0}),this.props.onFolderSelected(e.path,void 0,e.predictionId)},this.handleFolderSuggestionLocationClick=(e,t)=>{this.props.onFolderSuggestionLocationClick(t),this.setPathWithErrorHandling(e)},this.renderErrorMessage=()=>this.state.loadingStateShown!==C.FolderPickerLoadingState.ERROR?null:i.default.createElement("div",{className:"folder-picker__error"},i.default.createElement(M.Image,{src:y.static_url("/static/images/illustration_catalog/dropbox_somethings_not_working-vfl2QXPxi.png"),srcHiRes:y.static_url("/static/images/illustration_catalog/dropbox_somethings_not_working@2x-vflkcbmXv.png"),alt:""}),i.default.createElement("span",null,O.intl.formatMessage({id:"zD5i93",defaultMessage:"Something went wrong on our end."})),i.default.createElement(l.Button,{variant:"primary",onClick:this.handleTryAgainClick},O.intl.formatMessage({id:"BCyGLk",defaultMessage:"Try again"}))),this.renderLoadingMessage=()=>this.state.loadingStateShown===C.FolderPickerLoadingState.LOADING||this.state.isFolderSuggestionLoading?i.default.createElement("tr",{className:"folder-picker-loading"},i.default.createElement("td",null,i.default.createElement("span",{className:"folder-picker-view__loading-label"},O.intl.formatMessage({id:"9fef95",defaultMessage:"Loading your folders…"})))):null,this.renderFolders=()=>{if(this.hasNotLoaded)return null;const{focusIndex:e,loadingStateShown:t,isFolderSuggestionSelected:o}=this.state;return this.state.folders.map((s,a)=>i.default.createElement(I,{key:s.path,folder:s,index:a,isSelected:E.paths_are_equal(this.state.path,s.path)&&t===C.FolderPickerLoadingState.LOADED&&!o,isFocused:a===e,onClick:this.handleFolderClick,onMouseOver:this.handleFolderHover,onMouseLeave:this.unFocusRows}))},this.renderEmptyMessage=()=>this.hasNotLoaded?null:this.state.folders.length||!E.paths_are_equal(this.state.path,"/")?null:i.default.createElement("tr",{className:"folder-picker__empty-message"},i.default.createElement("td",{className:"u-font-center u-pad-top-xl"},i.default.createElement(M.Image,{src:y.static_url("/static/images/empty_states/folder-picker-vfl3_Hwxf.png"),srcHiRes:y.static_url("/static/images/empty_states/folder-picker@2x-vfl7Aum9o.png"),alt:""}),i.default.createElement("h2",{className:"u-pad-top-l"},O.intl.formatMessage({id:"wUZqfd",defaultMessage:"This is the only folder there is."})))),this.renderFolderSuggestion=()=>{const{folderSuggestion:e}=this.state;return this.state.loadingStateShown!==C.FolderPickerLoadingState.ERROR&&e&&e.path?this.renderFolderSuggestionTable(e):null},this.renderFolderSuggestionTable=e=>{const{isFolderSuggestionSelected:t}=this.state,o=s.default("brws-file-row folder-suggestion-row",{"brws-file-row-selected":t}),a=E.filename(e.path),r=t?O.intl.formatMessage({id:"hJeUi9",defaultMessage:"Suggested location: {folder} (selected)"},{folder:a}):O.intl.formatMessage({id:"N0ElEH",defaultMessage:"Suggested location: {folder}"},{folder:a});return i.default.createElement(f.Table,{className:"brws-files-view-list folder-suggestion-table",role:"presentation"},i.default.createElement(f.TableHead,null,i.default.createElement(g.TableHeadCell,{className:"brws-column-header-table-cell",role:"columnheader",scope:"col",tabIndex:0},this.renderFolderSuggestionHeadText(),this.renderFolderSuggestionHeadInfoIcon())),i.default.createElement(f.TableBody,{role:"listbox",onFocus:this.setupSuggestedLocationKeyboardShortcuts,onBlur:this.cleanupSuggestedLocationKeyboardShortcuts},i.default.createElement(m.CulledMediaRow,{className:o,topOffset:0,onClick:()=>this.handleFolderSuggestionClick(e),role:"option","aria-label":r,"aria-selected":t,tabIndex:0},({isHovered:t})=>this.renderFolderSuggestionRow(e,t))))},this.renderFolderSuggestionHeadText=()=>{const e=O.intl.formatMessage({id:"h/hLSy",defaultMessage:"Suggested location"});return i.default.createElement("span",null,e," ")},this.renderFolderSuggestionHeadInfoIcon=()=>{const e=O.intl.formatMessage({id:"5hFsVX",defaultMessage:"Based on previous activity and file type"});return i.default.createElement(_.Tooltip,{positioning:"above",tooltipContent:e},i.default.createElement(h.IconGlobal,{name:"help",className:"icon-help","aria-label":e}))},this.renderFolderSuggestionRow=(e,t)=>i.default.createElement(m.MediaCell,{className:"brws-file-name-cell folder-suggestion-name-cell",icon:this.renderFolderSuggestionIcon()},i.default.createElement("div",{className:"brws-file-name-cell-text brws-vertically-center"},this.renderFolderSuggestionTitle(e,t),this.renderFolderSuggestionSubtitle(e))),this.renderFolderSuggestionIcon=()=>i.default.createElement(u.IconContent,{className:"brws-file-name-cell-icon",name:"folder-small"}),this.renderFolderSuggestionTitle=(e,t)=>{const o=E.filename(e.path);return i.default.createElement(m.MediaCellText,{key:"title",highlight:t},i.default.createElement("div",{className:"brws-file-name-element"},i.default.createElement("span",null,o)))},this.renderFolderSuggestionSubtitle=e=>{const{user:t}=this.props,o=E.parent_dir(e.path),s=E.paths_are_equal(o,"/")?p.get_browse_root_name(t):o.slice(1),a=O.intl.formatMessage({id:"R7F8Tb",defaultMessage:"in {location}"},{location:s});return i.default.createElement(m.MediaCellText,{key:"subtitle",variant:"subtitle"},i.default.createElement("a",{role:"button",className:"brws-file-name-cell-location folder-suggestion-location",href:"#",onClick:t=>{t.stopPropagation(),t.preventDefault(),this.handleFolderSuggestionLocationClick(o,e)}},a))},this.cachedFolders=new Map,this.state={folders:[],focusIndex:C.INVALID_FOCUS_INDEX,loadingState:C.FolderPickerLoadingState.LOADING,loadingStateShown:C.FolderPickerLoadingState.LOADING,path:e.initialPath,loadingPath:e.initialPath,folderSuggestion:void 0,isFolderSuggestionLoading:!!e.showFolderSuggestion&&!!e.apiClient.fetchFolderSuggestion,isFolderSuggestionSelected:!1}}componentDidMount(){return o.__awaiter(this,void 0,void 0,(function*(){try{yield this.setPath(E.normalize(this.props.initialPath),this.props.skipFocusOnMount)}catch(e){this.handleError(e)}this.state.isFolderSuggestionLoading&&(yield this.fetchFolderSuggestion()),this.preloadErrorImages()}))}componentWillUnmount(){this.cancelStatusTimeout()}componentDidUpdate(e,t){if(this.state.loadingState!==C.FolderPickerLoadingState.LOADING&&t.loadingState===C.FolderPickerLoadingState.LOADING){const e=document.querySelector(".folder-picker-view");e&&!this.props.skipFocusOnMount&&e.focus()}}get hasNotLoaded(){return this.state.loadingStateShown!==C.FolderPickerLoadingState.LOADED||this.state.isFolderSuggestionLoading}canSelectRoot(){const{user:e,canSelectReadonly:t}=this.props;return t||!e.is_cdm_member||e.is_cdm_member&&"edit"===e.user_root_permissions}getFolderIndex(e,t){return a.findIndex(e,e=>E.paths_are_equal(e.path,t))}focusNeighboringItem(e){const{folders:t,focusIndex:o}=this.state,s=t.length;let a=o;e===F.SelectDirection.PREV&&o===C.INVALID_FOCUS_INDEX&&a++;for(let o=0;o<s;o++)if(e===F.SelectDirection.PREV?a=(a+s-1)%s:e===F.SelectDirection.NEXT&&(a=(a+1)%s),t[a].isClickable){this.setState({focusIndex:a});break}setTimeout(()=>this.scrollToFocused())}scrollToFocused(){if(!this.table)return;const e=this.table.getElementsByTagName("tbody").item(0);if(!e)return;const t=this.table.getElementsByClassName("focused").item(0);if(!t)return;const o=t.getBoundingClientRect().top,s=t.getBoundingClientRect().bottom,a=e.getBoundingClientRect().top,r=e.getBoundingClientRect().bottom;o<a||o>r?e.scrollTop+=o-a:s>r&&(e.scrollTop+=s-r)}fetchFolderData(e){return o.__awaiter(this,void 0,void 0,(function*(){const{apiClient:t,user:o}=this.props,s=(yield t.getFolderContents(o.id,e)).map(this.convertJsonFolderToFolder),a=o.cdm_tmf_path&&E.paths_are_equal(e,"/")?[...s.filter(e=>E.paths_are_equal(e.path,o.cdm_tmf_path)),...s.filter(e=>!E.paths_are_equal(e.path,o.cdm_tmf_path))]:s;return this.cachedFolders.set(E.normalize(e).toLowerCase(),a),a}))}fetchFolderContents(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=E.normalize(e);return this.cachedFolders.get(t.toLowerCase())||this.fetchFolderData(t)}))}renderTable(e){const{rootName:t}=this.props,{path:o,focusIndex:s}=this.state;if(!e||this.state.loadingStateShown===C.FolderPickerLoadingState.ERROR)return null;const a=e-C.PATH_BREADCRUMB_HEIGHT-(this.state.folderSuggestion?C.FOLDER_SUGGESTION_HEIGHT:0);return i.default.createElement(f.Table,{columnFlex:[9,1],className:"folder-picker-table",ref:this.setTableRef,role:"presentation"},i.default.createElement(f.TableHead,null,i.default.createElement(g.TableHeadCell,{className:"folder-picker__breadcrumbs"},i.default.createElement(w.PathBreadcrumbs,{firstBreadcrumbName:t,firstBreadcrumbAlt:t,getUrlForPath:this.getUrlForBreadcrumb,setUrl:this.handleBreadcrumbClick,path:o,size:w.PathBreadcrumbsSize.SMALL}))),i.default.createElement(f.TableBody,{tabIndex:0,role:"listbox","aria-activedescendant":`folder_picker_row_${s}`,className:"folder-picker-view",style:{height:a},onFocus:this.setupKeyboardShortcuts,onBlur:this.cleanupKeyboardShortcuts},this.renderLoadingMessage(),this.renderFolders(),this.renderEmptyMessage()))}render(){return i.default.createElement(d.Dimensions,{className:"folder-picker-container"},({height:e})=>i.default.createElement("div",{className:"folder-picker"},this.renderErrorMessage(),this.renderFolderSuggestion(),this.renderTable(e)))}}A.defaultProps={initialPath:"/",onSuccess:a.noop,onError:a.noop,onDataLoaded:a.noop,onRowClicked:a.noop,onBreadcrumbClicked:a.noop,onFetchFolderSuggestionSuccess:a.noop,onFolderSuggestionClick:a.noop,onFolderSuggestionLocationClick:a.noop},A.displayName="FolderPickerWithoutCSS",t.FolderPicker=v.requireCssWithComponent(A,["/static/css/browse/browse-vflZqGIkH.css","/static/css/react/folder_picker-vflqf-mgm.css","/static/css/scooter/scooter-scoped-vflpl9JSl.css","/static/css/dig-components/index.web-vflm67Rix.css"])})),define("modules/clean/react/folder_dialog/folder_dialog",["require","exports","tslib","react","dig-components/buttons","dig-components/typography","dig-components/modal","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/react/folder_dialog/api","modules/clean/react/folder_dialog/folder_picker","modules/clean/ux_analytics/utils","modules/clean/viewer","modules/clean/web_modal_activity_logger","modules/clean/web_timing_logger","modules/core/i18n"],(function(e,t,o,s,a,r,i,n,l,d,c,u,h,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FolderDialog=void 0,s=o.__importDefault(s),m=o.__importStar(m);class g extends s.default.PureComponent{constructor(e){super(e),this.close=()=>{this.setState({isOpen:!1}),c.dispatchModalClosed()},this.handleError=e=>{this.logger.log(n.ModalEventName.ERROR,{error:e.message}),this.props.onError(e)},this.handleSuccess=()=>{void 0!==this.state.path&&(this.logger.log(n.ModalEventName.SUCCESS),this.props.onSuccess(this.state.path,this.state.nsid),this.close())},this.handleCancel=()=>{this.props.onCancel(),this.close()},this.handleDataLoaded=e=>{this.logger.log(n.ModalEventName.DATA_LOADED,{path:e})},this.handleBreadcrumbClicked=e=>{this.logger.log(n.ModalEventName.BREADCRUMB_CLICKED,{path:e})},this.handleRowClicked=(e,t,o)=>{this.logger.log(n.ModalEventName.ROW_CLICKED,{path:e,index:t,is_keyboard:o})},this.handleReady=()=>{this.logger.log(n.ModalEventName.READY),c.dispatchModalOpened()},this.handleRequestClose=()=>{this.logger.log(n.ModalEventName.CLOSE),this.close()},this.handlePrimaryButtonClick=e=>{this.logger.log(n.ModalEventName.PRIMARY_CLICK,{path:e})},this.handleSecondaryButtonClick=()=>{this.logger.log(n.ModalEventName.SECONDARY_CLICK)},this.handleFolderSelected=(e,t)=>{this.setState({path:e,nsid:t})},this.handlePrimaryAction=()=>{this.handlePrimaryButtonClick(),this.handleSuccess()},this.handleSecondaryAction=()=>{this.handleSecondaryButtonClick(),this.handleCancel()},this.handleTertiaryAction=()=>{this.props.handleClickNewFolder&&this.props.handleClickNewFolder(this.state.path)},this.state={isOpen:!0}}componentDidMount(){this.logger=new h.WebModalActivityLogger(this.props.modalName),this.logger.log(n.ModalEventName.SHOW)}render(){const{title:e,user:t,initialPath:o,canSelectReadonly:n,handleClickNewFolder:c,useApiV2:h}=this.props,g={getFolderContents:this.props.getFolderContents?this.props.getFolderContents:h?l.getFolderContentsAPIv2:l.getFolderContents};return s.default.createElement(i.Modal,{onAfterOpen:this.handleReady,open:this.state.isOpen,onRequestClose:this.handleRequestClose,className:"folder-picker-modal"},s.default.createElement(i.Modal.Header,{hasBottomSpacing:"title-small"},s.default.createElement(r.Title,{size:"small"},e)),s.default.createElement(i.Modal.Body,{className:"folder-picker-container__fixed-height",id:this.props.modalId},s.default.createElement(d.FolderPicker,{apiClient:g,user:t,canSelectReadonly:!!n,rootName:u.Viewer.get_role_title(t)||f.intl.formatMessage({id:"rIir19",defaultMessage:"Dropbox"}),onFolderSelected:this.handleFolderSelected,onSuccess:this.handleSuccess,onError:this.handleError,onRowClicked:this.handleRowClicked,onBreadcrumbClicked:this.handleBreadcrumbClicked,onDataLoaded:this.handleDataLoaded,initialPath:o,webTimer:m.get_timer()})),s.default.createElement(i.Modal.Footer,null,c&&s.default.createElement(a.Button,{variant:"transparent",size:"small",onClick:this.handleTertiaryAction},f.intl.formatMessage({id:"eXL9sz",defaultMessage:"Create new folder"})),s.default.createElement(a.Button,{variant:"opacity",onClick:this.handleSecondaryAction},f.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),s.default.createElement(a.Button,{variant:"primary",onClick:this.handlePrimaryAction,disabled:void 0===this.state.path},this.props.primaryActionLabel)))}}t.FolderDialog=g,g.defaultProps={onError:()=>{},onCancel:()=>{}},g.displayName="FolderDialog"})),define("modules/clean/react/folder_dialog/move_dialog",["require","exports","tslib","lodash","react","dig-components/buttons","dig-components/modal","dig-components/typography","spectrum/button/index","spectrum/dimensions/index","modules/clean/filepath/filepath","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/components/css","modules/clean/react/folder_dialog/constants","modules/clean/react/folder_dialog/folder_picker","modules/clean/react/folder_dialog/utils","modules/clean/sharing/browse_exports","modules/clean/viewer","modules/core/i18n","modules/clean/react/dropins_v3/shared/search_input","modules/clean/react/dropins_v3/shared/culled_list","modules/clean/react/dropins_v3/shared/item_row","modules/clean/react/dropins_v3/file_browser/loading"],(function(e,t,o,s,a,r,i,n,l,d,c,u,h,m,f,g,_,p,S,E,v,C,b,M,w){"use strict";var F;Object.defineProperty(t,"__esModule",{value:!0}),t.MoveDialog=t.MoveDialogComponent=t.MoverUiState=void 0,s=o.__importStar(s),a=o.__importDefault(a),(function(e){e[e.Browse=1]="Browse",e[e.Search=2]="Search",e[e.SearchLoading=3]="SearchLoading"})(F=t.MoverUiState||(t.MoverUiState={}));class y extends a.default.Component{constructor(e){super(e),this.handleSuccess=()=>{const e=this.state.selectedPath,t=this.state.containedNsID,o=this.state.selectedPredictionId;if(this.isPrimaryButtonDisabled())return;const{onSuccess:s,apiClient:a,onError:r,onPrimaryButtonClick:i}=this.props;i(e,o),a.moveToFolder(e,t,this.state.isLockedVaultFolder).then(s,r)},this.handleCancelClick=()=>{const{onCancel:e,onSecondaryButtonClick:t}=this.props;t(),e()},this.handleFolderSelected=(e,t,o,s,a)=>{const{onFolderSelected:r}=this.props;r&&r(e,!!a),this.setState({selectedPath:e,containedNsID:t,selectedPredictionId:o,isLockedVaultFolder:s})},this.shouldShowFolderSuggestion=()=>{const{apiClient:e,entries:t,operation:o,showFolderSuggestion:s}=this.props;return!!s&&!!e.getFolderSuggestion&&(o===g.Operation.COPY||o===g.Operation.MOVE)&&!!t&&t.length>0},this.fetchFolderSuggestion=e=>o.__awaiter(this,void 0,void 0,(function*(){const{apiClient:t,entries:o,operation:s}=this.props,a=o.map(e=>e.fq_path),r=s===g.Operation.MOVE?"MOVE":"COPY";return yield t.getFolderSuggestion(e,a,r)})),this.handleCreateNewFolderClick=()=>{const{selectedPath:e}=this.state;if(void 0===e)return;this.handleCancelClick();const t=this.props.user,o=e=>{this.showMoveDialog(e)},s=()=>{this.showMoveDialog(e)};S.asyncShowCdmNewFolderModal({handleCreateFolder:({folderName:a})=>{h.browseActions.createFolderInNewFolderModal({folderName:a,isConfidential:!1,user:t,context:null,redirectOnSuccess:o,redirectOnCancel:s,fqPath:e,selectCreatedFolder:!1,origin:m.CREATE_FOLDER_ACTION_ORIGIN_TYPE.BROWSE_MOVE_DIALOG})},user:t,context:null,shouldSyncDefault:!1,shouldDisplaySyncSettings:!1,shouldDisplayAudienceInput:!1,redirectOnCancel:s})},this.showMoveDialog=e=>{const{operation:t,user:o,apiClient:s,entries:a,initialFolderSelection:r,onSuccess:i,onCancel:n,showFolderSuggestion:l,createNewFolderInMoveDialog:d,showMoveDialogOnRedirect:c}=this.props;c&&c({operation:t,modalName:t===g.Operation.MOVE?u.ModalName.MOVE:u.ModalName.COPY,user:o,apiClient:s,entries:a,initialFolderSelection:r,onSuccess:i,onCancel:n,showFolderSuggestion:l,createNewFolderInMoveDialog:d,initialFolderSelectionOnRedirect:e})},this.isPrimaryButtonDisabled=()=>{if(void 0===this.state.selectedPath)return!0;if(this.props.operation!==g.Operation.MOVE)return!1;return!!s.filter(this.props.entries,e=>"fq_path"in e&&(!(!e.is_dir||this.props.operation!==g.Operation.MOVE||!c.paths_are_equal(e.fq_path,this.state.selectedPath))||c.paths_are_equal(c.parent_dir(e.fq_path),this.state.selectedPath))).length},this.handleSearchQueryChange=s.debounce(e=>{""===e?this.setState({moverUiState:F.Browse,searchText:e,selectedSearchResult:""}):(this.setState({moverUiState:F.SearchLoading,searchText:e}),this.props.apiClient.search(this.props.user.id,e).then(e=>{this.setState({moverUiState:F.Search,searchResults:e.file_info})}))},1e3),this.renderSearchResultItem=e=>{const t=this.state.selectedSearchResult===e.fq_path,o=!!e.mount_access_perms&&0===e.mount_access_perms.length;return a.default.createElement("li",{key:e.fq_path,className:"dropins-mover-files-list-item"},a.default.createElement(M.ItemRow,{item:e,selected:t,disabled:o,showPath:!0,onClick:this.handleSearchResultSelected(e)}))},this.state={moverUiState:F.Browse,searchText:"",searchResults:[],selectedSearchResult:""}}handleSearchResultSelected(e){return()=>{this.setState({moverUiState:F.Browse,selectedSearchResult:e.fq_path})}}renderContent(){const{user:e,initialFolderSelection:t,webTimer:o,apiClient:s,onError:r,onDataLoaded:i,onBreadcrumbClicked:n,onRowClicked:l,onFetchFolderSuggestionSuccess:d,onFolderSuggestionClick:c,onFolderSuggestionLocationClick:u}=this.props,{moverUiState:h}=this.state,m=Object.assign(Object.assign({},s),{fetchFolderSuggestion:this.shouldShowFolderSuggestion()?this.fetchFolderSuggestion:void 0});return h===F.SearchLoading?a.default.createElement("div",{className:"dropins-mover-content"},a.default.createElement("div",{className:"dropins-mover-loading-container"},a.default.createElement(w.Loading,null))):h===F.Search?a.default.createElement(b.CulledList,{containerClassName:"dropins-mover-content",className:"dropins-mover-files-list",items:this.state.searchResults,listItemHeights:this.state.searchResults.map(()=>60),renderRow:this.renderSearchResultItem,webTimer:o}):a.default.createElement(_.FolderPicker,{user:e,apiClient:m,webTimer:o,initialPath:this.state.selectedSearchResult||t,rootName:E.Viewer.get_role_title(e)||v.intl.formatMessage({id:"rIir19",defaultMessage:"Dropbox"}),canSelectReadonly:!1,onFolderSelected:this.handleFolderSelected,onSuccess:this.handleSuccess,onError:r,showFolderSuggestion:this.shouldShowFolderSuggestion(),onFetchFolderSuggestionSuccess:d,onFolderSuggestionClick:c,onFolderSuggestionLocationClick:u,onDataLoaded:i,onBreadcrumbClicked:n,onRowClicked:l})}render(){const{apiClient:e,entries:t,operation:o,modalTitle:s,createNewFolderInMoveDialog:c,showFoldersOnly:u,useDigModal:h,showSearchBar:m}=this.props,{selectedPath:f}=this.state;if(h)return a.default.createElement(a.default.Fragment,null,!u&&a.default.createElement(i.Modal.Header,{hasBottomSpacing:"title-small"},a.default.createElement(n.Title,{size:"small"},p.createFolderPickerDialogTitle(t,o,s))),a.default.createElement(i.Modal.Body,{className:"folder-picker-container__fixed-height uxa-modal",id:this.props.modalId},this.renderContent()),!u&&a.default.createElement(i.Modal.Footer,null,c&&void 0!==f?a.default.createElement(r.Button,{onClick:this.handleCreateNewFolderClick,variant:"transparent",size:"small",id:"create-new-folder"},v.intl.formatMessage({id:"eXL9sz",defaultMessage:"Create new folder"})):null,a.default.createElement(r.Button,{variant:"opacity",onClick:this.handleCancelClick},v.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),a.default.createElement(r.Button,{variant:"primary",onClick:this.handleSuccess,disabled:this.isPrimaryButtonDisabled()},p.createFolderPickerDialogButtonLabel(o))));const _=a.default.createElement("div",{key:"header",className:"move_dialog-header mc-util-modal-header"},p.createFolderPickerDialogTitle(t,o,s)),S=a.default.createElement("div",{key:"footer",className:"move_dialog-actions mc-util-modal-actions"},c&&void 0!==f?a.default.createElement("div",null,a.default.createElement("a",{role:"button",href:"#",onClick:this.handleCreateNewFolderClick,id:"create-new-folder"},v.intl.formatMessage({id:"eXL9sz",defaultMessage:"Create new folder"}))):a.default.createElement("div",null),a.default.createElement("div",{className:"mc-util-modal-actions-buttons"},a.default.createElement(l.Button,{variant:"secondary",onClick:this.handleCancelClick},v.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"})),a.default.createElement(l.Button,{variant:"primary",onClick:this.handleSuccess,disabled:this.isPrimaryButtonDisabled()},p.createFolderPickerDialogButtonLabel(o))));return a.default.createElement(d.Dimensions,{className:"move_dialog mc-util-modal"},({height:t})=>[u?null:_,m&&e.search?a.default.createElement("div",{key:"search-input",className:"dropins-mover-search-input-container"},a.default.createElement(C.SearchInput,{onQueryChange:this.handleSearchQueryChange})):null,t&&a.default.createElement("div",{key:"body",className:"move_dialog-body mc-util-modal-body",style:{height:t-(g.DIALOG_HEAD_HEIGHT+g.DIALOG_ACTIONS_HEIGHT+g.DIALOG_BODY_PADDING)}},this.renderContent()),u?null:S])}}t.MoveDialogComponent=y,y.defaultProps={onPrimaryButtonClick:s.noop,onSecondaryButtonClick:s.noop,onError:s.noop,showFoldersOnly:!1,showSearchBar:!1},y.displayName="MoveDialogComponent",t.MoveDialog=f.requireCssWithComponent(y,["/static/css/react/move_dialog-vflt84lSc.css"])})),define("modules/clean/react/folder_dialog/utils",["require","exports","modules/core/i18n","modules/clean/react/folder_dialog/constants","modules/clean/filepath/filepath"],(function(e,t,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInitialFolderSelection=t.getModalId=t.createFolderPickerDialogButtonLabel=t.createFolderPickerDialogTitle=void 0,t.createFolderPickerDialogTitle=function(e,t,a){if(void 0!==a)return a;if(!e||0===e.length){if(t===s.Operation.MOVE)return o.intl.formatMessage({id:"wKPvYZ",defaultMessage:"Move to…"});if(t===s.Operation.COPY)return o.intl.formatMessage({id:"TCTlqi",defaultMessage:"Copy to…"});if(t===s.Operation.UPLOAD)return o.intl.formatMessage({id:"dMKLu2",defaultMessage:"Upload to…"});if(t===s.Operation.EXPORT_LEGAL_HOLD)return o.intl.formatMessage({id:"ra1icr",defaultMessage:"Export to…"})}let r="";const i=e?e.length:0;return t===s.Operation.MOVE?r=o.intl.formatMessage({id:"qeRA7T",defaultMessage:"{count, plural, one{Move {count} item to…} other{Move {count} items to…}}"},{count:i}):t===s.Operation.COPY?r=o.intl.formatMessage({id:"N4rDe0",defaultMessage:"{count, plural, one{Copy {count} item to…} other{Copy {count} items to…}}"},{count:i}):t===s.Operation.UPLOAD&&(r=o.intl.formatMessage({id:"bWKJBF",defaultMessage:"{count, plural, one{Upload {count} item to…} other{Upload {count} items to…}}"},{count:i})),r},t.createFolderPickerDialogButtonLabel=function(e){return e===s.Operation.COPY?o.intl.formatMessage({id:"r3T3xT",defaultMessage:"Copy"}):e===s.Operation.EXPORT_LEGAL_HOLD?o.intl.formatMessage({id:"8+T625",defaultMessage:"Export"}):o.intl.formatMessage({id:"ds25UH",defaultMessage:"Move"})},t.getModalId=function(e){switch(e){case s.Operation.MOVE:return"move-fileops-modal";case s.Operation.COPY:return"copy-fileops-modal";case s.Operation.UPLOAD:return"upload-fileops-modal";default:return""}},t.getInitialFolderSelection=function(e,t,o){if(void 0!==o)return o;if(e&&0!==e.length){const o=a.parent_dir(e[0].fq_path),s=e.length;for(let r=1;r<s;r++)if(o!==a.parent_dir(e[r].fq_path))return t;return o}return t}})),define("modules/clean/react/dropins_v3/mover/api_client",["require","exports","tslib","modules/clean/react/dropins_v3/shared/user_friendly_error","modules/clean/react/fileops_actions","modules/clean/cloud_docs/utils","modules/clean/react/dropins_v3/shared/ajax_error"],(function(e,t,o,s,a,r,i){"use strict";function n(e){return void 0!==e.cloud_doc_id}function l(e){return void 0!==e.id}function d(t,s,a){return o.__awaiter(this,void 0,void 0,(function*(){const i=r.replaceInvalidFilenameChars(s.name);return(yield(function(){return o.__awaiter(this,void 0,void 0,(function*(){const{UserApiV2Client:t}=yield new Promise((t,o)=>{e(["api_v2/user_client"],t,o)}).then(o.__importStar);return(new t).ns("cloud_docs")}))})()).rpc("alpha/dropin_move",{cloud_doc_id:s.cloud_doc_id,to_path:`${a}/${i}`},{subjectUserId:t.id})}))}function c(t,s){return o.__awaiter(this,void 0,void 0,(function*(){const a={"Dropbox-API-Path-Root":`{".tag": "root", "root": "${t.root_ns_id}"}`};return(yield(function(){return o.__awaiter(this,void 0,void 0,(function*(){const{UserApiV2Client:t}=yield new Promise((t,o)=>{e(["api_v2/user_client"],t,o)}).then(o.__importStar);return(new t).ns("files")}))})()).rpc("get_metadata_batch",{paths:s.map(e=>e.id)},{subjectUserId:t.id,headers:a})}))}function u(e,t,o){return Promise.all(t.map(t=>d(e,t,o)))}function h(e,t,r){return o.__awaiter(this,void 0,void 0,(function*(){if(0===t.length)return Promise.resolve([]);const o=c(e,t),i=yield o.then(e=>e.entries.map((e,o)=>{if(void 0!==e.path_lower)return{fq_path:e.path_lower,is_dir:t[o].is_dir};throw new s.UserFriendlyError("path_lower is undefined","Oops! Seems like the file does not exist!")})),n={user:e,path:"",files:i,newPath:r,checkFSWs:!0};return new Promise((e,t)=>{a.moveFiles_LEGACY(Object.assign(Object.assign({},n),{onSuccess:e,onRequestNotSent:t}))})}))}Object.defineProperty(t,"__esModule",{value:!0}),t.search=t.moveEntriesToFolder=t.entryIsFile=t.entryIsCloudDoc=void 0,a=o.__importStar(a),t.entryIsCloudDoc=n,t.entryIsFile=l,t.moveEntriesToFolder=function(e,t,o){const s=t.filter(e=>n(e)),a=t.filter(e=>l(e));return Promise.all([u(e,s,o),h(e,a,o)]).then(()=>{})},t.search=function(t,s){return(function(t,s){return o.__awaiter(this,void 0,void 0,(function*(){const a=yield new Promise((t,o)=>{e(["modules/clean/deprecated_ajax/ajax_jquery"],t,o)}).then(o.__importStar);return new Promise((e,o)=>{a.WebRequest({url:"/dropins/search",data:{query:s,include_files:!1},subject_user:t,success:e,error:(e,t,s)=>{o(s)}})}).then(JSON.parse,e=>Promise.reject(new i.AjaxError(e)))}))})(t,s)}})),define("modules/clean/react/dropins_v3/mover/host_site",["require","exports","modules/clean/react/dropins_v3/shared/host_site"],(function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HostSite=void 0;class s extends o.BaseHostSite{onSuccess(){this.sendMessage("success"),this.closeDialog()}onCancel(){this.sendMessage("cancel"),this.closeDialog()}onError(e){this.sendMessage("error",e.message),this.closeDialog()}onFolderSelected(e){this.sendMessage("folder_selected",{path:e})}}t.HostSite=s})),define("modules/clean/react/dropins_v3/mover/mover_page",["require","exports","tslib","react","modules/clean/react/components/css","modules/clean/react/folder_dialog/api","modules/clean/react/dropins_v3/mover/api_client","modules/clean/react/dropins_v3/mover/host_site","modules/clean/web_timing_logger","modules/core/notify","modules/clean/react/dropins_v3/mover/mover_parent","modules/clean/react/dropins_v3/shared/vortex_logger","modules/clean/react/dropins_v3/shared/timeout","modules/clean/viewer"],(function(e,t,o,s,a,r,i,n,l,d,c,u,h,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoverPage=void 0,s=o.__importDefault(s);class f extends s.default.Component{constructor(e){super(e),this.state={accountId:e.accountId,initialFolderSelection:e.initialFolderSelection,entries:null,showFoldersOnly:!!e.showFoldersOnly,showSearchBar:!!e.showSearchBar},this.vortexLogger=new u.VortexLogger(e.appKey,e.statPrefix),this.hostSite=new n.HostSite(e.origin,d.Notify),this.hostSite.listen({onState:e=>this.setState(e),onClose:()=>window.close()}),this.hostSite.ready()}render(){const e={moveEntriesToFolder:i.moveEntriesToFolder,getFolderContents:r.getFolderContents,search:i.search};return s.default.createElement("div",{className:"dropins-mover-page"},s.default.createElement(c.MoverParent,{viewer:m.Viewer.get_viewer(),hostSite:this.hostSite,apiClient:e,webTimer:l.get_timer(),vortexLogger:this.vortexLogger,timeout:h.timeout,accountId:this.state.accountId,entries:this.state.entries,initialFolderSelection:this.state.initialFolderSelection,showFoldersOnly:this.state.showFoldersOnly,showSearchBar:this.state.showSearchBar}))}}f.displayName="MoverPage",t.MoverPage=a.requireCssWithComponent(f,["/static/css/dropins_v3/mover/mover-vfl7gzMIP.css","/static/css/foundation-vfljLCXoa.css","/static/css/notify-vflZVEumu.css"])})),define("modules/clean/react/dropins_v3/mover/mover_parent",["require","exports","tslib","react","modules/clean/react/components/css","modules/clean/react/dropins_v3/shared/vortex_logger","modules/clean/react/folder_dialog/move_dialog","modules/clean/react/folder_dialog/constants","modules/clean/react/dropins_v3/mover/api_client"],(function(e,t,o,s,a,r,i,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoverParent=void 0,s=o.__importDefault(s);class d extends s.default.Component{constructor(){super(...arguments),this.handleSuccess=()=>{const{hostSite:e,timeout:t,vortexLogger:o}=this.props;r.logRateBeforeCallback(o,t,"move_success",()=>{e.onSuccess()})},this.handleCancel=()=>{const{hostSite:e,timeout:t,vortexLogger:o}=this.props;r.logRateBeforeCallback(o,t,"move_cancel",()=>{e.onCancel()})},this.handleError=e=>{const{hostSite:t,timeout:o,vortexLogger:s}=this.props;r.logRateBeforeCallback(s,o,"move_error",()=>{t.onError(e)})},this.handleFolderSelected=(e,t)=>{const{hostSite:o,timeout:s,vortexLogger:a}=this.props;t||r.logRateBeforeCallback(a,s,"move_folder_selection",()=>{o.onFolderSelected(e)})}}componentDidMount(){this.props.webTimer.waitForTTI().then(()=>{this.props.vortexLogger&&this.props.vortexLogger.logRate("page_start",1)})}getDialogProps(e){const{apiClient:t,entries:o,showFoldersOnly:s,initialFolderSelection:a,webTimer:r,showSearchBar:i}=this.props,d=o&&o.map(e=>l.entryIsCloudDoc(e)?{is_dir:!1}:{is_dir:e.is_dir}),c={getFolderContents:t.getFolderContents,moveToFolder:()=>Promise.resolve(),search:t.search};if(o&&o.length>0){const s=o;c.moveToFolder=o=>t.moveEntriesToFolder(e,s,o)}return{apiClient:c,user:e,initialFolderSelection:a,operation:n.Operation.MOVE,entries:d,webTimer:r,onSuccess:this.handleSuccess,onCancel:this.handleCancel,onError:this.handleError,onFolderSelected:this.handleFolderSelected,showFoldersOnly:s,showSearchBar:i}}render(){const{accountId:e,hostSite:t,viewer:o}=this.props,a=(function(e){if("string"!=typeof e.accountId)return new Error("accountId must be provided, and it must be a string");if(null!==e.entries){if(!(e.entries instanceof Array))return new Error("entries must be provided, and they must be an array");for(const t of e.entries)if(l.entryIsCloudDoc(t)){if("string"!=typeof t.cloud_doc_id)return new Error("cloud doc must have a cloud_doc_id of type string");if("string"!=typeof t.name)return new Error("cloud doc must have a name of type string")}else{if(!l.entryIsFile(t))return new Error("entry must be a file with field id or cloud doc with field cloud_doc_id");if("string"!=typeof t.id)return new Error("entry must have an id of type string");if("boolean"!=typeof t.is_dir)return new Error("file must have field is_dir of type boolean")}}if("string"!=typeof e.initialFolderSelection)return new Error("initialFolderSelection must be provided, and it must be a string");return null})(this.props);if(a)return this.props.hostSite.onError(a),null;const r=(function(e,t){const o=t.get_users(!1);for(const t of o)if(e===t.account_id)return t;return null})(e,o);return r?s.default.createElement("div",{className:"dropins-mover-parent"},s.default.createElement(i.MoveDialog,Object.assign({},this.getDialogProps(r)))):(t.onError(new Error("user with given accountId is not logged in")),null)}}d.displayName="Mover",t.MoverParent=a.requireCssWithComponent(d,["/static/css/dropins_v3/mover/mover-vfl7gzMIP.css","/static/css/foundation-vfljLCXoa.css","/static/css/notify-vflZVEumu.css"])})),define("modules/clean/avatar/list",["require","exports","tslib","classnames","react","modules/clean/avatar/overflow_count_pill","modules/clean/react/components/css"],(function(e,t,o,s,a,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=o.__importDefault(s),a=o.__importDefault(a),r=o.__importDefault(r);class n extends a.default.Component{constructor(){super(...arguments),this._defaultRenderOverflowCount=({overflowCount:e})=>a.default.createElement(r.default,{count:e,dimension:this.props.avatarDimension,key:`overflow_pill:${e}`,onClick:this.props.onOverflowCountClick}),this.getClassName=()=>s.default(["horizontal-avatar-list",this.props.className,this.props.animation?["animation","is-animated"]:null])}render(){let e=this.props.avatars,t=this.props.maxVisible,o=0;if(this.props.undisplayableCount&&(o+=this.props.undisplayableCount),(this.props.undisplayableCount||e.length>t)&&(t--,o+=e.length-t,e=e.slice(0,t)),o){const t=null!=this.props.overflowCountRenderer?this.props.overflowCountRenderer:this._defaultRenderOverflowCount;e.push(t({overflowCount:o,avatarArgs:{avatarDimension:this.props.avatarDimension,onAvatarClick:this.props.onOverflowCountClick,titleButtonDirection:"south"}}))}return a.default.createElement("div",{className:"c-facepile"},a.default.createElement("div",{className:this.getClassName()},e))}}n.displayName="HorizontalAvatarList",n.defaultProps={className:""},t.default=i.requireCssWithComponent(n,["/static/css/avatar_list-vflw5ujnY.css"])})),define("modules/clean/sharing/avatar_info",["require","exports","tslib","modules/core/user_i18n"],(function(e,t,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.apiInviteeMemberToAvatarInfo=t.apiGroupMemberToAvatarInfo=t.apiUserMemberToAvatarInfo=void 0,s=o.__importStar(s);const a=function(e){switch(e){case"reader":return"viewer";case"writer":return"editor";case"owner":return"owner";default:return"default"}};t.apiUserMemberToAvatarInfo=function(e){const t=e.displayName()||"",o=e.email()||"";return{access_type:a(e.access_type),display_name:t,familiar_name:null!=e.account?e.account.familiar_name:void 0,initials:null!=e.initials?e.initials:s.getInitials(t),photo_url:null!=e.account?e.account.profile_photo_url:void 0,user_id:e.memberId(),email:o,account_id:e.account_id}},t.apiGroupMemberToAvatarInfo=e=>({access_type:a(e.access_type),gid:e.memberId(),is_automatic:"team"===e.group_type,name:e.displayName(),num_users:e.member_count}),t.apiInviteeMemberToAvatarInfo=e=>({access_type:a(e.access_type),invitation_id:e.memberId(),email_or_fbname:e.displayName()})})),define("modules/clean/web_modal_activity_logger",["require","exports","tslib","modules/clean/logging/telemetry","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/search/store_helpers"],(function(e,t,o,s,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebModalActivityLogger=void 0,s=o.__importStar(s);t.WebModalActivityLogger=class{constructor(e){this.modalName=e,this.modalSessionId=r.generateRandomId(),this.logger=new s.HiveLogger}log(e,t){this.logger.log(new a.WebModalActivityRow(Object.assign({modal_name:this.modalName,modal_session_id:this.modalSessionId,event_name:e},t)))}}})),define("modules/clean/react/folder_overview/placeholder",["require","exports","tslib","react","spectrum/button/index","modules/clean/react/folder_overview/constants"],(function(e,t,o,s,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WrappedFolderOverviewPlaceholder=t.FolderOverviewPlaceholderExample=t.FolderOverviewPlaceholder=void 0,s=o.__importDefault(s),t.FolderOverviewPlaceholder=e=>{if(e.isReadOnly&&e.isInRightRail)return null;const o=e.isReadOnly?r.DESCRIPTION_PLACEHOLDER_READ_ONLY:e.isInRightRail?r.DESCRIPTION_PLACEHOLDER_RIGHT_RAIL:e.isSpace?r.DESCRIPTION_PLACEHOLDER_FOR_SPACE:r.DESCRIPTION_PLACEHOLDER;return s.default.createElement("div",{className:"folder-overview__description--placeholder",onClick:e.onClick},s.default.createElement("span",null,o),e.showExamples&&s.default.createElement(t.FolderOverviewPlaceholderExample,{showExamplesAsButton:e.showExamplesAsButton,onExampleButtonClick:e.onExampleButtonClick}))},t.FolderOverviewPlaceholder.displayName="FolderOverviewPlaceholder",t.FolderOverviewPlaceholderExample=e=>e.showExamplesAsButton?s.default.createElement(a.Button,{"aria-label":r.FOLDER_EXAMPLES_LINK_LABEL,onClick:e.onExampleButtonClick,className:"folder_overview__examples-button",variant:"secondary"},r.DESCRIPTION_PLACEHOLDER_EXAMPLES_BUTTON):s.default.createElement("a",{"aria-label":r.FOLDER_EXAMPLES_LINK_LABEL,href:r.FOLDER_EXAMPLES_LINK_URI,target:"_blank",rel:"noreferrer"},r.DESCRIPTION_PLACEHOLDER_EXAMPLES_BUTTON),t.FolderOverviewPlaceholderExample.displayName="FolderOverviewPlaceholderExample",t.WrappedFolderOverviewPlaceholder=e=>s.default.createElement("div",{className:"folder-overview__description folder-overview__placeholder folder-overview__fixed-toolbar"},s.default.createElement(t.FolderOverviewPlaceholder,{showExamples:e.showExamples,isReadOnly:e.isReadOnly,showExamplesAsButton:e.showExamplesAsButton,onClick:e.onClick})),t.WrappedFolderOverviewPlaceholder.displayName="WrappedFolderOverviewPlaceholder"}));
//# sourceMappingURL=pkg-mover.min.js-vflsabP3I.map