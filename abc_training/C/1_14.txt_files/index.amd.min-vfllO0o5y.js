define(["require","exports","tslib","react","classnames","typescript/libraries/comments2/src/components/annotation_rectangle_creation_layer/resize_handles","typescript/libraries/comments2/src/components/annotation_rectangle_creation_layer/utilities","typescript/libraries/comments2/src/components/raf_style/index","typescript/libraries/comments2/src/components/annotation_rectangle/index"],(function(e,t,n,s,r,a,o,i,c){"use strict";function l(e){const{x:t,y:n,width:s,height:r}=e;return{transform:`translate(${t}px, ${n}px)`,width:s,height:r}}Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationRectangleCreationLayer=void 0,s=n.__importStar(s),r=n.__importDefault(r);const h=e=>e.preventDefault();class d extends s.PureComponent{constructor(e){super(e),this.state={clickThreshold:o.Threshold.NotExceeded,internalPlacement:null},this.ref=null,this.rectangleRef=null,this.onDeltaStart=(e,t,n=!1)=>{if(o.pertainsToLeftClick(e)){this.disableDragSelect();const{clientX:s,clientY:r}=e,a=this.rectangleRef,i={x:s,y:r},c=n?Object.assign(Object.assign({},i),{width:0,height:0}):a&&o.clientRectToRectangle(a.getBoundingClientRect());c&&(this.attachListeners(),this.props.onRectChangeStart(n),this.setState({resizeDragMeta:{originPoint:i,deltaMovement:t,originRect:c}}))}},this.onDeltaChange=e=>{const{resizeDragMeta:t,clickThreshold:n}=this.state;if(!t||!this.rectCanChange(e))return;const{clientX:s,clientY:r}=e,{originPoint:a,deltaMovement:i,originRect:c}=t,l=o.calculateDelta(a,{x:s,y:r});n===o.Threshold.NotExceeded?(this.setState({clickThreshold:o.Threshold.Exceeded}),this.props.onRectChange(o.applyDelta(c,l,i),"drag"===i,!0)):this.props.onRectChange(o.applyDelta(c,l,i),"drag"===i)},this.onDeltaEnd=()=>{this.state.clickThreshold===o.Threshold.NotExceeded&&this.props.clearPlacement(),document.removeEventListener("selectstart",h),this.removeListeners(),this.props.onRectChangeEnd(),this.setState({resizeDragMeta:void 0,clickThreshold:o.Threshold.Ignore})},this.onRectangleMouseDown=e=>{e.currentTarget===e.target&&this.onDeltaStart(e,a.DragInitiator)},this.setRef=e=>{this.ref=e},this.setRectangleRef=e=>{this.rectangleRef=e},this.onLayerMouseDown=e=>{const t=e.target,n=o.isOnText(e)||o.isOnLink(e),s=this.rectangleRef&&this.rectangleRef.contains(t);n||s||(this.setState({clickThreshold:o.Threshold.NotExceeded}),this.onDeltaStart(e,a.Corner.BottomRight,!0))};this.resizer=[a.Edge.Top,a.Edge.Left,a.Edge.Right,a.Edge.Bottom,a.Corner.TopLeft,a.Corner.TopRight,a.Corner.BottomLeft,a.Corner.BottomRight].map(e=>s.createElement("div",{style:a.resizeStyles[e],key:e,className:a.resizeClasses[e],onMouseDown:t=>this.onDeltaStart(t,e)}));this.resizerV2=[a.Edge.Top,a.Edge.Left,a.Edge.Right,a.Edge.Bottom,a.Corner.TopLeft,a.Corner.TopRight,a.Corner.BottomLeft,a.Corner.BottomRight].map(e=>s.createElement("div",{style:a.resizeStylesV2[e],key:e,className:a.resizeClassesV2[e],onMouseDown:t=>this.onDeltaStart(t,e)}))}get className(){return r.default({"sc-annotation-rectangle-creation-layer":!0,"sc-annotation-rectangle-creation-layer__is-creating":!!this.state.resizeDragMeta})}get annotationClassName(){const{useV2Design:e}=this.props;return r.default("sc-annotation-rectangle-creation-draft",{"sc-annotation-rectangle-creation-draft-v1":!e,"sc-annotation-rectangle-creation-draft-v2":e})}attachListeners(){document.addEventListener("mousemove",this.onDeltaChange,!0),document.addEventListener("mouseup",this.onDeltaEnd)}removeListeners(){document.removeEventListener("mousemove",this.onDeltaChange),document.removeEventListener("mouseup",this.onDeltaEnd)}disableDragSelect(){document.addEventListener("selectstart",h)}rectCanChange(e){const{resizeDragMeta:t,clickThreshold:n}=this.state;return n!==o.Threshold.NotExceeded||t&&o.hasExceededThreshold(t.originPoint,e)}maybeRenderAnnotationDraft(){const{useV2Design:e,placement:t}=this.props;return t?s.createElement(i.RafStyle,{style:t},t=>t?s.createElement(s.Fragment,null,s.createElement("div",{ref:this.setRectangleRef,style:l(t),className:this.annotationClassName,onMouseDown:this.onRectangleMouseDown},e?this.resizerV2:this.resizer),e&&s.createElement(c.AnnotationCutoutOverlay,{placement:t})):null):null}render(){const{className:e,setRef:t,onLayerMouseDown:n}=this;return s.createElement("div",{ref:t,className:e,onMouseDown:n},this.props.children,this.maybeRenderAnnotationDraft())}}t.AnnotationRectangleCreationLayer=d,d.displayName="AnnotationRectangleCreationLayer"}));
//# sourceMappingURL=index.amd.min.js-vflkE5AbH.map