define(["require","exports","tslib","react","react-intl","react-redux","modules/clean/react/action_bar/file_actions/portable/utils","modules/core/i18n","dig-components/icons/src","dig-components/buttons","dig-components/tooltips","dig-components/icons","dig-components/menu","modules/core/browser_detection","modules/clean/react/extensions/split_share_button_component","modules/clean/react/extensions/data/store","spectrum-sharing/utils/sharing_constants","modules/clean/react/file_viewer/share_helpers","modules/clean/react/file_viewer/constants","typescript/libraries/file-viewer/src/app","modules/clean/file_store/utils","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/utils","modules/clean/sharing/api/client","modules/clean/sharing/access_level","modules/clean/react/file_viewer/sdk_file_viewer/utils","modules/clean/integrations/zoom_share_dialog/async_modal","modules/clean/react/action_bar/action_bar_strings","typescript/component_libraries/retrieval-components/src/simple-action-bar/action_bar_types","modules/clean/react/previews/sharing_plugin/copy_link_button"],(function(e,t,i,a,n,s,r,o,l,c,d,u,f,_,m,h,p,S,E,v,w,I,g,b,D,A,R,y,L){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeShareMetaserverLoader=t.DisabledShareButton=t.SHARE_PLUGIN_ID=void 0,a=i.__importDefault(a),S=i.__importStar(S),t.SHARE_PLUGIN_ID="SHARE";const N=n.defineMessage({id:"VzQ1nj",defaultMessage:"Ask the owner of this file for permission to share it with others"}),P=n.defineMessage({id:"JDi0M8",defaultMessage:"Share"});t.DisabledShareButton=()=>{const e=n.useIntl(),t=e.formatMessage(P),i=e.formatMessage(N),s=a.default.createElement(u.UIIcon,{src:l.ShareArrowLine});return a.default.createElement(d.Tooltip,{title:i,placement:"left"},a.default.createElement("span",{style:{display:"inline-block"},tabIndex:0},a.default.createElement(c.SplitButton,{variant:"primary",disabled:!0,renderMenu:({buttonProps:e})=>a.default.createElement(f.Menu.Wrapper,null,({getTriggerProps:t,getContentProps:i})=>a.default.createElement(a.default.Fragment,null,a.default.createElement(c.Button,Object.assign({"aria-label":"Show options"},e,t(),{disabled:!0})),a.default.createElement(f.Menu.Content,Object.assign({},i(),{placement:"bottom-end"}))))},s,t)))},t.DisabledShareButton.displayName="DisabledShareButton";t.makeShareMetaserverLoader=(e,n,c,d,f)=>()=>{const P=h.getStore(),T=c&&new g.FileShareApiClient({userId:c.id});return Promise.resolve(class{constructor(r){this.identifier=t.SHARE_PLUGIN_ID,this.lifecycle={previewDidInitialize:()=>i.__awaiter(this,void 0,void 0,(function*(){var t;const{file:i}=e(),a=w.isSharedFile(i),s=_.is_supported_mobile_browser();this.isMobile=s||window.innerWidth<801;const r=n===D.SDKPreviewSurface.SHARED_CONTENT_LINK||n===D.SDKPreviewSurface.SHARED_LINK;a&&!r&&T&&i.file_id!==(null===(t=this.metadata)||void 0===t?void 0:t.id)&&i.file_id!==this.lastFailedId&&(yield T.getMetadataAlpha({contentId:i.file_id}).then(e=>this.metadata=e).catch(()=>this.lastFailedId=i.file_id)),this.actionDefinitions.alwaysInOverflow=[this.actionToDisplay()]}))},this.titleBarUI={Component:()=>{const[i,r]=a.default.useState(void 0),[o,l]=a.default.useState(void 0),u=(()=>{const e=()=>v.calcResponsiveSize(window.innerWidth),[t,i]=a.default.useState(e());return a.default.useEffect(()=>{const t=()=>i(e());return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),t})(),_=n===D.SDKPreviewSurface.SHARED_CONTENT_LINK||n===D.SDKPreviewSurface.SHARED_LINK,h=!!i&&i.access_type!==b.ACCESS_LEVEL.WRITER;if(!c||n===D.SDKPreviewSurface.VERSION_HISTORY)return!c&&_&&f&&d&&(f.doesContainRlKey||f.doesContainShmodelLink)?a.default.createElement("div",{className:"share-button-container"},a.default.createElement(L.CopyLinkButton,{file:e(),parsedLink:f,linkAccessLevel:h?"viewer":"editor"})):null;const g=e().file,R=w.isSharedFile(g);if(R&&!_&&T&&g.file_id!==(null==i?void 0:i.id)&&g.file_id!==o&&T.getMetadataAlpha({contentId:g.file_id}).then(e=>r(e)).catch(()=>l(g.file_id)),_||R&&h)return d&&f&&(f.doesContainRlKey||f.doesContainShmodelLink)?a.default.createElement("div",{className:"share-button-container"},a.default.createElement(L.CopyLinkButton,{file:e(),user:c,parsedLink:f,variant:"primary",linkAccessLevel:h?"viewer":"editor"})):a.default.createElement(t.DisabledShareButton,null);const N=w.isBrowseFile(g)?g.fq_path:"",C=w.isBrowseFile(g)?g.icon:"",M=I.isCloudDoc(g),O=I.getType(g),K=Object.assign(Object.assign({},g),{icon:C,fq_path:N,is_cloud_doc:M,type:O});return a.default.createElement(s.Provider,{store:P},a.default.createElement(m.SplitShareButton,{files:[K],user:c,variant:"primary",onShowShare:()=>{S.share(g,c,null,p.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE),this.context.logUserAction({action:E.UserAction.Share,context:E.UserActionContext.TitleBarMain})},onPresentInZoom:()=>((e,t)=>{A.asyncShowModal(t.id,e,"file-viewer-modal-overlay")})(g.file_id,c),showLeftDigIcon:u===y.ResponsiveSize.DESKTOP}))}},this.context=r}get actionDefinitions(){return{alwaysInOverflow:[this.actionToDisplay()]}}shareDefinition(e){const{file:t}=e,i=n===D.SDKPreviewSurface.SHARED_CONTENT_LINK||n===D.SDKPreviewSurface.SHARED_LINK,s=w.isSharedFile(t),d=!!this.metadata&&this.metadata.access_type!==b.ACCESS_LEVEL.WRITER,f=i||s&&d;return r.makePluginActionDefinition({label:o.intl.formatMessage(R.SHARE_ACTION_STRING),disabled:f?{disabled:!0,tooltipMessage:o.intl.formatMessage(N)}:{disabled:!1},icon:a.default.createElement(u.UIIcon,{src:l.ShareArrowLine}),action:()=>{c&&(S.share(t,c,null,p.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE),this.context.logUserAction({action:E.UserAction.Share,context:E.UserActionContext.TitleBarMain}))}})}actionToDisplay(){return c&&this.isMobile&&n!==D.SDKPreviewSurface.VERSION_HISTORY?[this.shareDefinition(e())]:[]}})}}));
//# sourceMappingURL=loader.min.js-vfld74SD8.map