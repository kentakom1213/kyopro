define(["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","api_v2/user_client","modules/core/browser","modules/core/browser_detection","modules/clean/sharing/api/client","modules/constants/file_viewer","modules/clean/file_store/utils","modules/clean/viewer","modules/clean/react/paper/paper_log","modules/core/i18n","lodash","modules/core/notify","modules/clean/react/sign_in/utils","modules/clean/react/size_class/utils","modules/clean/react/sticky_position"],(function(e,t,o,n,i,r,s,a,l,d,c,p,u,f,_,m,g,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPaperExperimentsPostTTI=t.openFileInPaper=t.createPaperAccountAndRedirect=t.getCalloutMessage=t.getCalloutTitle=t.shouldShowCTADescription=t.getCTATextDescription=t.getCTAText=t.fileSupportsCopyToPaper=t.fileSupportsEmbedToPaper=t.shouldShowOpenInPaper=t.getCalloutPosition=t.getOpenInPaperButtonVariant=t.fileSizeWithinExperimentLimits=t.OpenInPaperButtonVariant=void 0,n=o.__importStar(n),r=o.__importStar(r),l=o.__importStar(l),f=o.__importStar(f);const P=["VARIANT_A","VARIANT_B1","VARIANT_B2","VARIANT_B3","VARIANT_B4","ON"],T=["BUTTON","DROPDOWN","ELLIPSIS"],x=["docx"],A=["jpg","jpeg","png","pdf","xls","xlsx","mp4","mov","pptx","ppt","zip","rar","mp3"];var b;function C(e){const{file:t,user:o,sharedLink:n}=e;return!!t&&((k(t)&&P.includes(l.OPEN_IN_PAPER_VARIANT)||I(t)&&T.includes(l.EMBED_TO_PAPER_VARIANT))&&!c.Viewer.get_viewer().is_assume_user_session&&!s.is_mobile_or_tablet()&&!s.msie&&(!o&&!!n||!!o&&!o.is_paper_disabled))}function I(e){const t=d.getExtension(e);return!!t&&A.includes(t)}function k(e){const t=d.getExtension(e);return!!t&&(x.includes(t)&&e.bytes<20971520)}function M(e){const{file:t,sharedLink:o,contUrl:i,successCallback:r,errorCallback:s,extension:a,_tk:l,oqa:d,fromModal:c}=e;n.WebRequest({url:"/paper/sign_request_data",data:{path:t.file_id,sharedLink:o,cont_url:i,extension:a,_tk:l,oqa:d,fromModal:c},success:r,error:s})}(function(e){e[e.Off=1]="Off",e[e.Control=2]="Control",e[e.Button=3]="Button",e[e.Dropdown=4]="Dropdown",e[e.Ellipsis=5]="Ellipsis"})(b=t.OpenInPaperButtonVariant||(t.OpenInPaperButtonVariant={})),t.fileSizeWithinExperimentLimits=function(e,t){let o=51200;return"CONTROL"===t?o=20971520:"ONE_HUNDRED_KB"===t?o=102400:"FIFTY_KB"===t&&(o=51200),e.bytes<=o},t.getOpenInPaperButtonVariant=function(e){const{file:t,sharedLink:o}=e;return C(e)?k(t)?o?b.Button:b.Dropdown:b.Ellipsis:b.Off},t.getCalloutPosition=function(e){return e===b.Dropdown||e===b.Ellipsis?h.StickyPosition.BOTTOM_LEFT:h.StickyPosition.BOTTOM},t.shouldShowOpenInPaper=C,t.fileSupportsEmbedToPaper=I,t.fileSupportsCopyToPaper=k,t.getCTAText=function(e){let t=u.intl.formatMessage({id:"MhNU0E",defaultMessage:"Copy to Paper"});return I(e)&&(t=u.intl.formatMessage({id:"V4x10U",defaultMessage:"Add to Paper doc"})),t},t.getCTATextDescription=function(e){return u.intl.formatMessage({id:"8pL0xd",defaultMessage:"Collect ideas and connect all kinds of files in a single doc."})},t.shouldShowCTADescription=function(e,t){return!g.isSmallerThanLarge(t)&&I(e)},t.getCalloutTitle=function(e){return I(e)?u.intl.formatMessage({id:"xy84ul",defaultMessage:"Bring it all together"}):u.intl.formatMessage({id:"mUQPVD",defaultMessage:"Bring this doc to life"})},t.getCalloutMessage=function(e){return I(e)?u.intl.formatMessage({id:"JidWf/",defaultMessage:"Add this file to a Paper doc to collect ideas and organize your thoughts."}):u.intl.formatMessage({id:"jrZxPR",defaultMessage:"Copy to Paper and make changes or ask for feedback."})},t.createPaperAccountAndRedirect=M,t.openFileInPaper=function(e){const{file:t,user:o,fromModal:n}=e;if(!o)return void r.redirect(m.getSignInAndContinueUrl());const i=window.open("","_blank"),s=()=>{i&&i.close(),_.Notify.error(u.intl.formatMessage({id:"HBov4l",defaultMessage:"Canâ€™t copy file to Paper"}))},l=e.sharedLink?e.sharedLink:"",c=e.sharedLink?"shared_file_actions":"mounted_file_actions",f=d.getExtension(t);p.paperLog(p.PaperEventTypes.CTA_CLICK,{source:c,cta:"open_in_paper_button",extension:f});const g={file:t,sharedLink:l,contUrl:"/create-doc-from-dropbox-file",extension:f,successCallback:e=>{i?r.redirect(e,i):r.redirect(e)},errorCallback:s,_tk:"dropbox_web_copy_from_previews",oqa:f,fromModal:n};if(k(t))M(g);else if(g._tk="dropbox_web_embed_from_previews",!l&&o){const e=new a.FileShareApiClient({userId:o.id});e.sharedLinkInfo({fileIdOrPath:t.file_id}).then(o=>{const n=o[0];n?(g.sharedLink=n.url,g.contUrl="/dropbox-file-embed",M(g)):e.createSharedLink({fileIdOrPath:t.file_id}).then(e=>{g.sharedLink=e.url,g.contUrl="/dropbox-file-embed",M(g)}).catch(e=>{s&&s()})}).catch(e=>{s&&s()})}else g.contUrl="/dropbox-file-embed",M(g)};const O=f.once(()=>new i.UserApiV2Client);t.getPaperExperimentsPostTTI=function(e){return o.__awaiter(this,void 0,void 0,(function*(){return O().ns("paper_post_tti").rpc("paper_experiments",{},{subjectUserId:e.id}).then(e=>e.experiments)}))}}));
//# sourceMappingURL=utils.min.js-vflE2GhRq.map