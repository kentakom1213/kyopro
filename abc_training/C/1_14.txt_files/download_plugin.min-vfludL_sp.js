define(["require","exports","tslib","react","modules/core/i18n","dig-components/menu","dig-components/buttons","dig-components/icons/src","dig-components/icons","dig-components/tooltips","modules/clean/react/action_bar/action_bar_strings","modules/clean/react/action_bar/file_actions/portable/utils","modules/clean/react/action_bar/file_actions/portable/download","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/utils","modules/clean/file_store/utils","modules/clean/react/share_download/util","modules/clean/react/file_viewer/sdk_file_viewer/download_utils"],(function(e,t,o,n,i,l,a,s,c,r,d,u,f,m,p,_,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeDownloadActionLoader=t.DOWNLOAD_ACTION_PLUGIN_ID=void 0,n=o.__importDefault(n),t.DOWNLOAD_ACTION_PLUGIN_ID="DOWNLOAD_ACTION",t.makeDownloadActionLoader=(e,t,o,l,a,r)=>()=>Promise.resolve(class{constructor(e){this.lifecycle={previewWillInitialize:()=>{this.actionDefinitions.atTopLevelIfSpace=this.actionToDisplay,this.actionDefinitions.alwaysInOverflow=[this.actionToDisplay]}},this.actionDefinitions={atTopLevelIfSpace:this.actionToDisplay,alwaysInOverflow:[this.actionToDisplay]},this.context=e}get actionToDisplay(){const{file:t}=e();return!m.isLiveFile(t)||m.isPnmLinkNodeSelected(t)||m.isCloudDoc(t)?[]:p.isSharedFile(t)?[this.sharedDownloadButtonDefinition()]:[this.downloadButtonDefinition]}get downloadButtonDefinition(){return u.makePluginActionDefinition({label:i.intl.formatMessage(d.DOWNLOAD_ACTION_STRING),icon:n.default.createElement(c.UIIcon,{src:s.DownloadLine}),action:()=>{this.context.logUserAction({action:"download",context:"title_bar_open_split_button"});const{file:t}=e();f.downloadSingleFile({href:t.href,source:"PREVIEWS",isFswm:p.isSharedFile(t)})}})}sharedDownloadButtonDefinition(){return D({downloadAllowed:_.isDownloadAllowed(l),downloadAction:()=>{this.context.logUserAction({action:"download",context:"title_bar_download_split_button"});const{file:o}=e();w.downloadActiveFile(o,t,a,r,this.context.logUserAction)},saveACopyToDropboxAction:()=>{const{file:n}=e();w.saveToDropbox(n,e=>this.context.logUserAction({action:e,context:"title_bar_download_split_button"}),t,o,a)},getActiveFile:e,user:t,shareToken:o,encryptionOptions:a})}});const D=({downloadAction:e,saveACopyToDropboxAction:t,shareToken:o,downloadAllowed:f})=>{const m=n.default.createElement(c.UIIcon,{src:s.DownloadLine}),p=i.intl.formatMessage(d.DOWNLOAD_ACTION_STRING),_=e=>{e.menuItem.handler()},w=t=>{t.preventDefault(),t.stopPropagation(),e()},D=t=>{"Enter"===t.key&&(t.preventDefault(),t.stopPropagation(),e())},g=u.getCustomActionOverflowItem({icon:m,label:p,action:e});let b=null;o&&(b=u.getCustomActionOverflowItem({icon:n.default.createElement(c.UIIcon,{src:s.DropboxLine}),label:i.intl.formatMessage({id:"WiS7tZ",defaultMessage:"Save a copy to Dropbox"}),action:()=>{t()}}));const A=n.default.createElement(n.default.Fragment,null,g,b),h=({buttonProps:e})=>n.default.createElement(l.Menu.Wrapper,{onSelection:_},({getTriggerProps:t,getContentProps:o})=>n.default.createElement(n.default.Fragment,null,n.default.createElement(a.Button,Object.assign({"aria-label":"Show options"},e,t(),{disabled:!f})),n.default.createElement(l.Menu.Content,Object.assign({},o(),{placement:"bottom-end"}),n.default.createElement(l.Menu.Segment,null,A)))),I=e=>n.default.createElement(r.Tooltip,{title:i.intl.formatMessage({id:"3IQVpL",defaultMessage:"You do not have permission to download this file"})},n.default.createElement("div",null,e)),v=n.default.createElement(l.Menu.Submenu,{disabled:!f,withTriggerContent:p,withLeftAccessory:m},n.default.createElement(l.Menu.Segment,null,A));return{renderButton:e=>{const t=n.default.createElement(a.SplitButton,{onClick:w,onKeyPress:D,variant:"opacity",renderMenu:h,disabled:!f},!e&&m,p);return f?t:I(t)},overflowItem:f?v:I(v)}}}));
//# sourceMappingURL=download_plugin.min.js-vflJFefvH.map