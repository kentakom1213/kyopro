define(["require","exports","tslib","react","react-dom","classnames","dig-components/icons","dig-components/icons/src","dig-components/buttons","typescript/libraries/file-viewer/src/preview_audio_video/helper/thumbnails_helper","typescript/libraries/file-viewer/src/css/toolbar_v2.css","typescript/libraries/file-viewer/src/hooks/useStabilizedCallback"],(function(e,t,a,i,n,r,l,o,s,d,m,u){"use strict";function c(e){var t;switch(null===(t=e.annotation)||void 0===t?void 0:t.type){case"audio":case"video":return e.annotation.time/100;default:return}}function h(e){const t=isNaN(e)||!isFinite(e)?0:e,a=Math.round(t%60),i=Math.floor(t/60)%60,n=Math.floor(t/3600);return{hours:0!==n?""+n:"",minutes:0!==n||0!==i?""+i:"",seconds:""+a}}function f(e,t){const a=h(e),i=h(t),n=i.hours,r=a.hours.padStart(i.hours.length,"0"),l=""===i.minutes?"0":i.minutes.padStart(2,"0"),o=a.minutes.padStart(l.length,"0"),s=i.seconds.padStart(2,"0"),d=a.seconds.padStart(2,"0");return n?{formattedTime:`${r}:${o}:${d}`,formattedDuration:`${n}:${l}:${s}`}:{formattedTime:`${o}:${d}`,formattedDuration:`${l}:${s}`}}Object.defineProperty(t,"__esModule",{value:!0}),t.VideoThumbnails=t.VideoThumbnailsComponent=t.formatTime=t.getTimeForThread=void 0,i=a.__importStar(i),r=a.__importDefault(r),m=a.__importStar(m),t.getTimeForThread=c,t.formatTime=f;var p;(function(e){e.Requesting="requesting",e.Failed="failed",e.ImageLoaded="image_loaded"})(p||(p={})),t.VideoThumbnailsComponent=({vttUrl:e,onScrubberThumbnailsLoaded:t,duration:a,lastHighlightedThread:n,openThreadInRightRail:h})=>{const b=i.useRef([]),[g,v]=i.useState(p.Requesting),[T,S]=i.useState(0),[E,_]=i.useState(0),[C,N]=i.useState(),[V,$]=i.useState(0),y=i.useRef(null),M=n&&c(n),I=void 0!==M&&Math.abs(V-M)<.5,F=u.useStabilizedCallback(e=>{n&&I&&(null==h||h(n),e.stopPropagation())});i.useEffect(()=>{d.loadVtt(e).then(e=>{b.current=e,e&&e.length>0&&d.preloadThumbImage(e[0]).then(()=>{v(p.ImageLoaded),null==t||t(!0)}).catch(()=>{null==t||t(!1),v(p.Failed)})}).catch(()=>{null==t||t(!1),v(p.Failed)})},[e,t]);const L=u.useStabilizedCallback(e=>{const t=e.currentTarget.getBoundingClientRect(),i=t.width,n=e.clientX-t.left,r=Math.min(Math.max(n,0),i)/i*a;if(_(t.width),S(e.clientX-t.left),$(r),b.current){const e=b.current.find(e=>e.startTime<=r&&e.endTime>=r);e&&N(d.parseVttCue(e))}});i.useEffect(()=>{const e=y.current;if(e)return e.addEventListener("click",F),()=>e.removeEventListener("click",F)},[F,y]);const{imageUrl:w,imageX:R,imageY:k,imageWidth:q,imageHeight:x}=C||{},H=g===p.Failed?80:128,z=g===p.ImageLoaded?{background:`url("${w}") no-repeat -${R}px -${k}px`,width:q,height:x}:g===p.Failed?{display:"none"}:{},B=Math.min(Math.max(0,T-H/2),E-H),D={left:B},P={left:T-(B+H/2)},{formattedTime:U}=f(V,a);return i.default.createElement("div",{className:m.thumbnailHolder,onMouseMove:L},i.default.createElement("div",{className:r.default(m.thumbnailWrapper,{[m.thumbnailHolderComment]:I,[m.thumbnailLoadError]:g===p.Failed}),style:D,ref:y},i.default.createElement("div",{className:m.thumbnailImage,style:z},g===p.Requesting?i.default.createElement("div",{className:"c-loader"}):null),I&&i.default.createElement("div",{className:m.commentIconHolder},i.default.createElement(s.IconButton,{className:r.default(m.regularButton),variant:"transparent",size:"small",inverse:!0},i.default.createElement(l.UIIcon,{src:o.CommentLine}))),i.default.createElement("div",{className:m.thumbnailTime}," ",U," "),i.default.createElement("div",{className:m.timeLine,style:P})))},t.VideoThumbnailsComponent.displayName="VideoThumbnailsComponent",t.VideoThumbnailsComponent.displayName="VideoThumbnailsComponent",t.VideoThumbnails=e=>{var{container:r}=e,l=a.__rest(e,["container"]);return n.createPortal(i.default.createElement(t.VideoThumbnailsComponent,Object.assign({},l)),r)},t.VideoThumbnails.displayName="VideoThumbnails"}));
//# sourceMappingURL=video_thumbnails_v2.amd.min.js-vflTeSryq.map