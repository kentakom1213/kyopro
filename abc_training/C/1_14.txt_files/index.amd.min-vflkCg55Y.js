define(["require","exports","tslib","react","classnames","typescript/libraries/comments2/src/components/annotation_highlight_draft/index","typescript/libraries/comments2/src/components/annotation_highlight_creation_layer/utilities","typescript/libraries/comments2/src/components/add_annotation_highlight_button/index"],(function(e,t,n,i,o,s,h,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationHighlightCreationLayer=void 0,i=n.__importStar(i),o=n.__importDefault(o);const r={x:-100,y:-100};class l extends i.PureComponent{constructor(){super(...arguments),this.ref=null,this.isMouseDown=!1,this.hasSelectionChanged=!1,this.state={selectionRects:null},this.handleMouseDown=()=>{this.isMouseDown=!0,this.hasSelectionChanged=!1},this.handleMouseUp=()=>{this.isMouseDown&&this.hasSelectionChanged&&this.refreshSelection(),this.isMouseDown=!1},this.handleSelectionChange=()=>{const{onCursorHighlightChange:e}=this.props;this.isMouseDown?this.hasSelectionChanged||(e(null),this.hasSelectionChanged=!0):this.refreshSelection()},this.refreshSelection=()=>{const{onCursorHighlightChange:e}=this.props;if(this.textIsSelected){const t=h.getTextSelectionRange(),n=h.getClientRects(t),i=t.getBoundingClientRect();this.setState({selectionRects:n}),e({rangeRects:n,boundingRect:i,isInContainer:this.selectionIsInContainer,size:a.BUTTON_SIZE,margin:a.BUTTON_MARGIN})}else e(null)},this.addAnnotationHighlight=()=>{const{selectionRects:e}=this.state;e&&this.props.onTextHighlightChange(e)},this.setRef=e=>{this.ref=e}}get className(){return o.default("sc-annotation-highlight-creation-layer")}get buttonPosition(){return this.props.placement.button||r}textClientRectHasSize(e){if(e.isCollapsed)return!1;const t=e.getRangeAt(0).getBoundingClientRect();return 0!==t.width&&0!==t.height}get selectionIsInContainer(){const e=window.getSelection();if(null==e)return!1;const{focusNode:t,anchorNode:n}=e,{ref:i}=this;return Boolean(i&&t&&h.containsNode(i,t)&&n&&h.containsNode(i,n))}get textIsSelected(){const e=window.getSelection();if(!e)return!1;const t=e.toString();return!(""===t||"\n"===t||!this.textClientRectHasSize(e))}componentDidMount(){document.addEventListener("selectionchange",this.handleSelectionChange),document.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("mouseup",this.handleMouseUp)}componentWillUnmount(){document.removeEventListener("selectionchange",this.handleSelectionChange),document.removeEventListener("mousedown",this.handleMouseDown),document.removeEventListener("mouseup",this.handleMouseUp)}onButtonMouseDown(e){e.stopPropagation()}render(){const{buttonPosition:e,className:t}=this,{placement:{highlight:n},useV2Design:o}=this.props;return i.createElement("div",{ref:this.setRef,className:t},this.props.children,n&&s.renderAnnotationHighlightDraft(n),i.createElement(a.AddAnnotationHighlightButton,{position:e,isVisible:!!this.props.buttonPosition,onClick:this.addAnnotationHighlight,onMouseDown:this.onButtonMouseDown,useV2Design:o}))}}t.AnnotationHighlightCreationLayer=l,l.displayName="AnnotationHighlightCreationLayer"}));
//# sourceMappingURL=index.amd.min.js-vflPVIcLN.map