define(["require","exports","typescript/libraries/file-viewer/src/zoom/actions","api_v2/redux/sharing","api_v2/redux/users","api_v2/redux/zoom","api_v2/redux/integrations","typescript/component_libraries/deep-integrations/src/instrumentation/constants","typescript/libraries/file-viewer/src/core/data/actions"],(function(e,t,o,i,s,r,n,a,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zoomLoggingMiddleware=t.addingInviteeMiddleware=t.profileServiceMiddleware=t.getMeetingsForFileMiddleware=t.getFileMembersForZoomMiddleware=t.zoomSidebarMiddleware=void 0,t.zoomSidebarMiddleware=({dispatch:e,getState:t})=>i=>s=>{if(s.type===c.Action.OpenSidebar){const i=s.payload.fileViewerId,r=t();r.modes[i]&&"zoom"===r.modes[i].sidebar.selectedControlId&&o.fetchZoomSettings(e)}else s.type===c.Action.ChangeMode&&"zoom"===s.payload.mode&&o.fetchZoomSettings(e);i(s)},t.getFileMembersForZoomMiddleware=({dispatch:e})=>t=>r=>{if(r.type===o.Action.FetchFileMembers){const{payload:t}=r;e(i.listFileMembersAction({arg:{file:t.fileId}}))}else if(r.type===i.Action.ListFileMembersResult||r.type===i.Action.ListFileMembersContinueResult){const{payload:t,error:o}=r;!o&&t.result&&(e(s.getAccountBatchAction({arg:{account_ids:t.result.users.map(e=>e.user.account_id)}})),t.result.cursor&&e(i.listFileMembersContinueAction({arg:{cursor:t.result.cursor}})))}return t(r)},t.getMeetingsForFileMiddleware=({dispatch:e})=>t=>o=>{if(o.type===r.Action.ListZoomMeetingsForFileResult){const{payload:t,error:i}=o;if(i)console.error(i);else if(t.result){const o={};t.result.zoom_meetings.forEach(e=>{e.invitees.forEach(e=>o[e]=!0),o[e.host_dropbox_account_id]=!0});const i=Object.keys(o);e(s.getAccountBatchAction({arg:{account_ids:i}})),t.result.cursor&&e(r.listZoomMeetingsForFileAction({arg:{file_id:t.arg.file_id,cursor:t.result.cursor}}))}else console.error("could not find result from payload of ListZoomMeetingsForFileResultAction")}return t(o)},t.profileServiceMiddleware=function(e){return({dispatch:t,getState:i})=>{const s=e=>{const s=i(),r=s.serviceInfo&&"fulfilled"===s.serviceInfo.state&&s.serviceInfo.value.connection_state[".tag"];let a;for(const t of e)"zoom"===t.service_type[".tag"]&&(a=t.connection_state[".tag"]);r&&a&&a!==r&&t(n.getUserSettingsAction({arg:{fetch_external_settings:[{".tag":"zoom"}]}})),t(o.listServicesResult({serviceInfo:e}))};return t=>i=>{switch(i.type){case o.Action.AuthService:e&&e.authService(i.payload.serviceId);break;case o.Action.SubscribeListServices:e&&e.subscribe(s);break;case o.Action.UnsubscribeListServices:e&&e.unsubscribe()}return t(i)}}},t.addingInviteeMiddleware=function(e){let t=!1;return({dispatch:i})=>{const s=e=>i(o.updateAddingInviteeSuggestions({suggestions:e}));return i=>r=>e?(r.type===o.Action.QueryAddingInviteeSuggestions?t?e.querySuggestions(r.payload.query):console.error("should subscribe to invitee suggestion change first"):r.type===o.Action.SubscribeInviteeSuggestionsChange?t?console.error("already subscribed to invitee suggestion change first"):(e.subscribeSuggestionsChange(s),t=!0):r.type===o.Action.UnsubscribeInviteeSuggestionsChange&&(t?(e.unSubscribeSuggestionsChange(),t=!1):console.error("have not subscribed to invitee suggestion change")),i(r)):i(r)}},t.zoomLoggingMiddleware=function(e){return({dispatch:t,getState:i})=>s=>r=>{if(r.type===o.Action.LogZoomEvent)e&&e.logZoomEvent(r.payload.event);else if(r.type===c.Action.OpenSidebar){const e=r.payload.fileViewerId,s=i();s.modes[e]&&"zoom"===s.modes[e].sidebar.selectedControlId&&t(o.logZoomEvent({event:{event_name:a.InstrEventType.UserClick,feature_name:a.InstrFeatureType.ZoomFileViewerExtension,service_type:"zoom",extra:{action:a.InstrActionType.ReopenZoomSideBar}}}))}else if(r.type===c.Action.ChangeMode&&"zoom"===r.payload.mode)t(o.logZoomEvent({event:{event_name:a.InstrEventType.UserClick,feature_name:a.InstrFeatureType.ZoomFileViewerExtension,service_type:"zoom",extra:{action:a.InstrActionType.OpenZoomSideBar}}}));else if(r.type===n.Action.GetUserSettingsResult&&r.payload.result&&r.payload.result.zoom_settings&&r.payload.result.zoom_settings.external_settings&&r.payload.result.zoom_settings.external_settings.settings){const e=r.payload.result.zoom_settings.external_settings.settings.use_pmi_for_instant_meetings;t(o.logZoomEvent({event:{event_name:a.InstrEventType.ReceivedUserSetting,feature_name:a.InstrFeatureType.ZoomFileViewerExtension,service_type:"zoom",extra:{pmiSetting:e.toString()}}}))}s(r)}}}));
//# sourceMappingURL=middlewares.amd.min.js-vfl9mShLZ.map