define("modules/clean/react/previews/video/preview_video",["require","exports","tslib","react","modules/clean/react/previews/video/preview_video_basic","modules/clean/react/previews/video/preview_video_comments2","modules/clean/react/previews/constants"],(function(e,t,i,r,s,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewVideo=void 0,r=i.__importDefault(r),t.PreviewVideo=function(e){const{sourceContext:t,hidePageChrome:i}=e;return t!==a.PreviewSourceContext.EmbeddedSharedLinkFile&&!i?r.default.createElement(n.PreviewVideoComments2,Object.assign({},e)):r.default.createElement(s.PreviewVideoBasic,Object.assign({},e))}})),define("modules/clean/react/previews/error/preview_error",["require","exports","tslib","react","modules/clean/em_string","modules/clean/previews/pending_upload_watcher","modules/clean/react/components/css","modules/clean/file_store/utils","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/fullscreen_view","modules/clean/react/previews/error/view","modules/clean/web_timing_logger","modules/clean/react/previews/error/upsell"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewError=t._PreviewError=void 0,r=i.__importDefault(r),p=i.__importStar(p);class h extends r.default.Component{componentDidMount(){if(p.set_tti_exclusion_flow("failed previews not included"),p.mark_time_to_view(),p.mark_time_to_interactive(),this.logPreviewSupportDenied(),this.props.errorType===d.ErrorType.PendingUploadError&&this.props.shareToken){new n.PendingUploadWatcher(this.props.shareToken.linkType,this.props.shareToken.linkKey,this.props.shareToken.secureHash).startPolling()}}get allowOpenInApp(){return!!this.props.file.open_in_app_data&&!this.props.isMobileUserAgent}logPreviewSupportDenied(){this.props.errorType!==d.ErrorType.LoadError&&this.props.errorType!==d.ErrorType.PendingUploadError&&this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(l.EventType.FilePreviewSupportDenied,{errorType:this.props.errorType})}render(){const e=s.Emstring.em_snippet(o.getFilename(this.props.file),this.props.maxFilenameEmLength);return this.props.errorType===d.ErrorType.UpsellError?r.default.createElement(m.PreviewUpsellErrorView,{areActionablesEnabled:this.props.areActionablesEnabled,allowOpenInApp:this.allowOpenInApp,count:this.props.count,errorType:this.props.errorType,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,filePreviewSession:this.props.filePreviewSession,filename:e,index:this.props.index,onNext:this.props.onNext,onPrevious:this.props.onPrevious,preview:this.props.preview,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,sharedLinkInfo:this.props.sharedLinkInfo,shouldDisplayToolbar:this.props.shouldDisplayToolbar,sizeClass:this.props.sizeClass,user:this.props.user,encryptionOptions:this.props.encryptionOptions}):this.props.isFullscreen?r.default.createElement(c.PreviewErrorFullscreenView,Object.assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e})):r.default.createElement(u.PreviewErrorView,Object.assign({},this.props,{allowOpenInApp:this.allowOpenInApp,filename:e}))}}t._PreviewError=h,h.defaultProps={areActionablesEnabled:!0,isFullscreen:!1},h.displayName="PreviewError";const f=a.requireCssWithComponent(h,["/static/css/preview_error-vflZQp8qV.css"]);t.PreviewError=f})),define("modules/clean/react/previews/video/preview_video_comments2",["require","exports","tslib","react","react-redux","typescript/libraries/comments2/src/components/annotation_utils","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/video_annotations/annotation_helper","modules/clean/react/comments2/video_annotations/constants","modules/clean/react/comments2/video_annotations/video_preview_event_emitter","modules/clean/react/previews/video/preview_video_basic"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewVideoComments2=t.ConnectedPreviewVideoComments2=t.PreviewVideoBasicWithPlayerIntegration=void 0,r=i.__importDefault(r);class m extends r.default.PureComponent{componentDidMount(){this.seekToActivatedTimecode()}componentDidUpdate(e){e.activatedTimecodeThread===this.props.activatedTimecodeThread||this.isPendingThread(e)||this.seekToActivatedTimecode()}isPendingThread(e){var t,i;return(null===(t=e.activatedTimecodeThread)||void 0===t?void 0:t.pending)||(null===(i=this.props.activatedTimecodeThread)||void 0===i?void 0:i.pending)}seekToActivatedTimecode(){const{activatedTimecodeThread:e}=this.props;if(e){let t=0;t=n.isVideoAnnotation(e.annotation)&&e.annotation.timeSec?e.annotation.timeSec:d.VideoAnnotationHelper.unitConvertDomainObjectTimeToSeconds(e.annotation.time),u.videoPreviewEventEmitter.emit(c.EventTypes.SEEK_POSITION_AND_PAUSE,t)}}render(){const{onTimeUpdate:e,playerIntegrationEnabled:t}=this.props;return r.default.createElement(p.PreviewVideoBasic,Object.assign({},this.props,{onTimeUpdate:t?e:void 0}))}}t.PreviewVideoBasicWithPlayerIntegration=m,m.displayName="PreviewVideoBasicWithPlayerIntegration",t.ConnectedPreviewVideoComments2=s.connect(e=>{const t=l.getIsPlayerIntegrationEnabled(e);return{showOnboarding:l.getShowOnboardingOnVideo(e),framePreciseCommentsEnabled:l.getFramePreciseCommentsEnabled(e),frameRate:l.getFrameRate(e),playerIntegrationEnabled:t,activatedTimecodeThread:t?l.getActivatedTimecodeThread(e):void 0}},{onTimeUpdate:a.Actions.updatePlayerCurrentTime,onGutterClick:a.Actions.deactivateAllThreads})(m);class h extends r.default.PureComponent{constructor(e){super(e),this.store=o.getStoreForComments2()}render(){return r.default.createElement(s.Provider,{store:this.store},r.default.createElement(t.ConnectedPreviewVideoComments2,Object.assign({},this.props)))}}t.PreviewVideoComments2=h,h.displayName="PreviewVideoComments2"})),define("modules/clean/react/workflows/markup/api",["require","exports","modules/clean/react/file_viewer/feedback_form/types","modules/clean/react/file_viewer/feedback_form/api"],(function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.submitMarkupFeedback=void 0,t.submitMarkupFeedback=function(e,t,s){return r.submitFeedback(i.SubmitFeedbackProductName.DROPBOX_MARKUP,e,t,s)}})),define("modules/clean/react/previews/preview_zoom_container",["require","exports","tslib","keymaster","classnames","react","lodash","jquery","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n","modules/clean/react/sticky_position"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewZoomContainer=void 0,r=i.__importDefault(r),s=i.__importDefault(s),n=i.__importDefault(n),a=i.__importStar(a),o=i.__importDefault(o);let f="";const g="previewzoomcontainer";class _ extends n.default.Component{constructor(){super(...arguments),this.state={controlsHidden:!1},this.flipNext=(e=d.UserActionContext.LightboxToolbar)=>{this.props.onFlipNext&&this.props.onFlipNext(),l.logUserAction(d.UserAction.FlipNext,e)},this.flipPrevious=(e=d.UserActionContext.LightboxToolbar)=>{this.props.onFlipPrevious&&this.props.onFlipPrevious(),l.logUserAction(d.UserAction.FlipPrevious,e)},this.onClick=e=>{e.target===e.currentTarget&&(e.preventDefault(),this.onCloseFactory({},d.UserActionContext.LightboxFrame))},this.onMouseMove=e=>{0===o.default(e.target).parents(".preview-toolbar-overlay").length?this.startControlsTimer():clearTimeout(this.controlsHideTimer)},this.onCloseFactory=(e={},t=d.UserActionContext.LightboxCloseButton)=>{l.logUserAction(d.UserAction.ToggleFullscreenOff,t),this.props.onClose()}}componentDidMount(){this.flipNext=a.throttle(this.flipNext,100),this.flipPrevious=a.throttle(this.flipPrevious,100),r.default("esc",g,()=>{this.onCloseFactory({},d.UserActionContext.Keyboard)}),null!=this.props.onZoomOut&&r.default("space",g,this.props.onZoomOut),f=r.default.getScope(),r.default.setScope(g),this.startControlsTimer()}UNSAFE_componentWillUpdate(){r.default.setScope(g)}componentWillUnmount(){r.default.clearScope(g),r.default.setScope(f),clearTimeout(this.controlsHideTimer)}startControlsTimer(){this.showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(()=>{this.hideControls()},3e3)}showControls(){this.setState({controlsHidden:!1})}hideControls(){this.setState({controlsHidden:!0})}renderFlippableControls(){return this.props.fileCount?n.default.createElement(c.FlippableControls,{index:`${this.props.fileIndex+1}`,numFlippableFiles:this.props.fileCount,onNext:this.flipNext,onPrevious:this.flipPrevious}):null}renderControls(){const{renderZoomControls:e,scaleFactor:t}=this.props,i=s.default("preview-toolbar-container",{hidden:this.state.controlsHidden});return n.default.createElement("div",{className:i,ref:"previewZoomerToolbarContainer"},n.default.createElement("div",{className:"preview-toolbar-overlay-container"},n.default.createElement("div",{className:"preview-toolbar-overlay"},n.default.createElement("div",{className:"preview-toolbar-content"},this.renderFlippableControls(),e?n.default.createElement("div",{className:s.default("toolbar-button-entry","zoom-out",{disabled:this.props.zoomOutDisabled}),onClick:this.props.onZoomOut},n.default.createElement(u.Sprite,{alt:m.intl.formatMessage({id:"pK5LJK",defaultMessage:"Zoom out"}),group:"web",name:"zoomout"})):null,e?n.default.createElement("div",{className:"toolbar-button-entry",ref:"zoomLabelContainer",onClick:this.props.onViewActualSize},n.default.createElement(p.TitleBubble,{content:m.intl.formatMessage({id:"Jzzn4t",defaultMessage:"View actual size"}),position:h.StickyPosition.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},n.default.createElement("span",null,Math.floor(100*(t||0)),"%"))):null,e?n.default.createElement("div",{className:s.default("toolbar-button-entry","zoom-in",{disabled:this.props.zoomInDisabled}),onClick:this.props.onZoomIn},n.default.createElement(u.Sprite,{alt:m.intl.formatMessage({id:"T8BfJ2",defaultMessage:"Zoom in"}),group:"web",name:"zoom"})):null))))}renderClose(){const e=s.default("preview-zoomer-close",{hidden:this.state.controlsHidden});return n.default.createElement("span",null,n.default.createElement("button",{"aria-label":m.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),className:e,onClick:this.onCloseFactory,ref:"previewZoomerClose"},n.default.createElement(u.Sprite,{alt:m.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),group:"web",name:"xclose"})))}render(){const e=s.default("preview-zoomer-container",{"zoomer-drag-disabled":this.props.dragDisabled});return n.default.createElement("div",{className:e,onClick:this.onClick,onMouseMove:this.onMouseMove,ref:"previewZoomerContainer"},this.props.children,this.renderClose(),this.renderControls())}}t.PreviewZoomContainer=_,_.defaultProps={dragDisabled:!0,zoomInDisabled:!0,zoomOutDisabled:!0},_.displayName="PreviewZoomContainer"})),define("modules/clean/react/previews/preview_html",["require","exports","tslib","react","react-dom","modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/previews/frame_messenger_host","modules/clean/react/file_viewer/logging","modules/clean/react/previews/preview_toolbar","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/uri","modules/clean/react/previews/toolbar_flip_buttons","modules/clean/react/file_viewer/full_screen_helpers","typescript/libraries/file-viewer/src/toolbar/index","modules/clean/react/previews/preview_toolbar_button","modules/clean/react/previews/print_helpers","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","ts-keycode-enum","modules/clean/react/previews/preview_toolbar_frame_messenger","modules/core/i18n","typescript/libraries/file-viewer/src/core/data/riviera/types"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f,g,_,v,w,b,E,S,y,P){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewHTML=void 0,r=i.__importDefault(r),s=i.__importStar(s),u=i.__importStar(u),p=i.__importStar(p);const C=["failed","viewer-ready","idle-mouse","active-mouse","exit-parent-fullscreen","keydown","child-focus","get-keydown-keys-handled-by-parent","tab-switch","content-select"];var M;(function(e){e.ClearMouseTracking="clear-mouse-tracking",e.EnableRegionCreation="enable-region-creation",e.EnterFullscreen="enter-fullscreen",e.ExitViewerFullscreen="exit-viewer-fullscreen",e.PageDown="page-down",e.PageUp="page-up",e.SetCurrentPage="set-current-page",e.PreviewToolbarMounted="preview-toolbar-mounted",e.Print="print"})(M||(M={}));class k extends r.default.Component{constructor(){super(...arguments),this.getIframeProps=()=>{const e={title:this.props.filename,name:"preview-content",type:"text/html",src:this.getIframeSrc(),sandbox:"",className:"previewhtml",ref:this.setRefIframe};return this.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},this.handleTrustedMessageFromChild=e=>{var t,i,r,s;if(!this.isHtmlFrameMessage(e))return;const{action:o,parameters:d}=e;switch(o){case"failed":this.logFilePreviewEvent(a.EventType.FilePreviewDownloadSucceeded),this.logFilePreviewEvent(a.EventType.FilePreviewRenderFailed);let e=P.RivieraStatus.Unknown;d&&(e=d.rivieraStatusCode),this.props.onError&&this.props.onError(n.mapRivieraStatusToErrorType(e));break;case"viewer-ready":this.markWebTiming(),this.logFilePreviewEvent(a.EventType.FilePreviewDownloadSucceeded),this.logFilePreviewEvent(a.EventType.FilePreviewRenderSucceeded),this.props.setRenderStatusSuccess(),this.props.isFullscreen?null===(t=this.frameMessenger)||void 0===t||t.postMessageToChildren("enter-fullscreen"):null===(i=this.frameMessenger)||void 0===i||i.postMessageToChildren("exit-viewer-fullscreen"),this.props.sharePermission&&0===this.props.sharePermission.canDownloadRoles.length&&(null===(r=this.frameMessenger)||void 0===r||r.postMessageToChildren("disable-download")),this.shouldIncreaseTabHeightForExcel()&&(null===(s=this.frameMessenger)||void 0===s||s.postMessageToChildren("increase-tab-height"));break;case"exit-parent-fullscreen":f.exitFullScreen(a.UserActionContext.Unknown);break;case"get-keydown-keys-handled-by-parent":this.postKeysHandledByParent();break;case"tab-switch":{const e=null!=(null==d?void 0:d.tabId)?{tab_index:d.tabId}:void 0;l.logUserAction(a.UserAction.SwitchWorkbookTab,a.UserActionContext.Browser,e);break}case"content-select":{const e=null!=(null==d?void 0:d.tabId)?{tab_index:d.tabId}:void 0;l.logUserAction(a.UserAction.SelectWorkbookContent,a.UserActionContext.Browser,e);break}}},this.handleIframeLoad=()=>{this.logFilePreviewEvent(a.EventType.FilePreviewDownloadSucceeded),this.props.usesFrameMessenger||(this.markWebTiming(),this.logFilePreviewEvent(a.EventType.FilePreviewRenderSucceeded),this.props.setRenderStatusSuccess())},this.handleIframeError=()=>{this.logFilePreviewEvent(a.EventType.FilePreviewDownloadFailed)},this.setRefIframe=e=>{this.iframe=e},this.printDocument=e=>{var t;null===(t=this.frameMessenger)||void 0===t||t.postMessageToChildren(M.Print,{context:e})},this.keyboardBindings=[b.hydrateKeyboardBinding({keyboardEventCriteria:{which:E.Key.P},callback:()=>this.printDocument(a.UserActionContext.Keyboard)})]}getIframeSrc(){const e=m.URI.parse(this.props.src);return this.props.isExcel&&(this.props.forceTestExcelHtml?e.updateQuery({canned_file_name:a.CannedTestFilename.ExcelHTML}):"password_protected"===this.props.forceRivieraException?e.updateQuery({canned_exception:"riviera_exception_password"}):"too_big"===this.props.forceRivieraException&&e.updateQuery({canned_exception:"riviera_exception_too_big"})),e.toString()}shouldIncreaseTabHeightForExcel(){return this.props.isExcel&&p.is_mobile_or_tablet()}isHtmlFrameMessage(e){return C.includes(e.action)}logFilePreviewEvent(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)}postKeysHandledByParent(){var e;null===(e=this.frameMessenger)||void 0===e||e.postMessageToChildren("keydown-keys-handled-by-parent",{keycodes:T})}markWebTiming(){this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),u.mark_time_to_view(),u.mark_time_to_interactive()}componentDidMount(){this.logFilePreviewEvent(a.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(a.EventType.FilePreviewDownloadAttempted),this.props.usesFrameMessenger&&(this.frameMessenger=new o.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging("iframe.previewhtml",this.handleTrustedMessageFromChild,C),this.frameMessenger.startListening(),this.postKeysHandledByParent());const e=s.findDOMNode(this.iframe);e.onload=this.handleIframeLoad,e.onerror=this.handleIframeError}componentWillUnmount(){var e;this.props.usesFrameMessenger&&(null===(e=this.frameMessenger)||void 0===e||e.stopListening())}render(){let e={};p.iOS&&(e=n.iOSIframeScrollStyles());const{count:t,index:i,isFullscreen:s,isExcel:o,sharePermission:l,sizeClass:u,onClickNext:m,onClickPrevious:b,usesFrameMessenger:E}=this.props;return r.default.createElement("div",{className:"preview-content",style:e},r.default.createElement("iframe",Object.assign({},this.getIframeProps())),r.default.createElement(d.PreviewToolbar,{elevateToolbar:o,isFullscreen:s,isHidden:u===c.SizeClass.Small,fadeController:({fadeIn:e,fadeOut:t})=>r.default.createElement(S.PreviewToolbarFrameMessenger,{activeMouse:e,idleMouse:t})},r.default.createElement(h.ToolbarFlipButtons,{index:i,count:t,onClickPrevious:b,onClickNext:m}),r.default.createElement(g.FullScreenButton,{className:"toolbar-button-entry",intl:y.intl,onClick:()=>f.toggleFullScreen(s,a.UserActionContext.Toolbar)}),E&&r.default.createElement(_.PreviewToolbarButton,{className:"print","data-test":"print",disabled:!v.canPrint(l),spriteGroup:"web",spriteName:"print",tooltip:v.getPrintTooltip(l),onClick:v.canPrint(l)?()=>this.printDocument(a.UserActionContext.Toolbar):()=>{}}),r.default.createElement(w.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings})))}}t.PreviewHTML=k,k.defaultProps={usesFrameMessenger:!0},k.displayName="PreviewHTML";const T={[E.Key.Escape]:{altKey:!0,ctrlKey:!0,metaKey:!0},[E.Key.Enter]:{altKey:!0,ctrlKey:!0,metaKey:!0},[E.Key.Space]:{altKey:!0,ctrlKey:!0,metaKey:!0},[E.Key.PageUp]:{altKey:!0,ctrlKey:!0,metaKey:!0},[E.Key.PageDown]:{altKey:!0,ctrlKey:!0,metaKey:!0},[E.Key.LeftArrow]:{altKey:!0,ctrlKey:!0,metaKey:!0},[E.Key.UpArrow]:{altKey:!0,ctrlKey:!0,metaKey:!0},[E.Key.RightArrow]:{altKey:!0,ctrlKey:!0,metaKey:!0},[E.Key.DownArrow]:{altKey:!0,ctrlKey:!0,metaKey:!0},[b.ExtraKeyCodes.EQUALS]:{altKey:!0,ctrlKey:!0,metaKey:!0},[E.Key.F]:{altKey:!1,ctrlKey:!0,metaKey:!0},[E.Key.P]:{altKey:!0,ctrlKey:!0,metaKey:!0},[b.ExtraKeyCodes.PLUS_EQUALS_FF]:{altKey:!0,ctrlKey:!0,metaKey:!0},[b.ExtraKeyCodes.MINUS_FF]:{altKey:!0,ctrlKey:!0,metaKey:!0},[b.ExtraKeyCodes.PLUS_EQUALS_FF_GERMAN]:{altKey:!0,ctrlKey:!0,metaKey:!0},[b.ExtraKeyCodes.MINUS_FF_MAC]:{altKey:!0,ctrlKey:!0,metaKey:!0},[E.Key.PlusSign]:{altKey:!0,ctrlKey:!0,metaKey:!0},[E.Key.Dash]:{altKey:!0,ctrlKey:!0,metaKey:!0}}})),define("modules/clean/react/previews/preview_image",["require","exports","tslib","classnames","react","react-redux","modules/clean/analytics","modules/clean/image_preview_util","modules/clean/photos/thumbnail_url_util","modules/clean/previews/actions","modules/clean/react/comments2/components/annotations/loadable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","typescript/libraries/file-viewer/src/core/data/base_types","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_toolbar","modules/clean/react/size_class/constants","modules/clean/web_timing_logger","modules/clean/react/components/css","spectrum/dimensions/index","typescript/libraries/file-viewer/src/preview_image/img_layer","typescript/libraries/file-viewer/src/preview_image/preview_image","modules/clean/file_store/utils","modules/clean/react/previews/toolbar_flip_buttons","typescript/libraries/file-viewer/src/toolbar/index","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/previews/print_helpers","modules/clean/react/previews/preview_toolbar_button","modules/clean/react/keyboard_binding/keyboard_binding","ts-keycode-enum","modules/clean/react/file_viewer/logging","modules/clean/react/watermarking/watermarking_layer","modules/clean/react/workflows/markup/markup_layer","modules/core/i18n","typescript/libraries/file-viewer/src/core/config","typescript/libraries/file-viewer/src/core/data/preview_key"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f,g,_,v,w,b,E,S,y,P,C,M,k,T,A,I,F,O,x,D,L,R,N,U,B,W,V){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewImage=t._PreviewImage=void 0,r=i.__importDefault(r),s=i.__importDefault(s),o=i.__importDefault(o),d=i.__importStar(d),w=i.__importStar(w),S=i.__importStar(S);function K(){}class j extends s.default.Component{constructor(){super(...arguments),this.imgLoaded=!1,this.state={},this.logTTI=()=>{this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),S.mark_time_to_view(),S.mark_time_to_interactive()},this.logRenderSuccess=()=>{this.imgLoaded||(this.imgLoaded=!0,this.logFilePreviewEvent(u.EventType.FilePreviewDownloadSucceeded),this.logFilePreviewEvent(u.EventType.FilePreviewRenderSucceeded),this.props.setRenderStatusSuccess(),null!=this.props.onLoad&&this.props.onLoad())},this.onImageDoubleClick=()=>{this.shouldDisableZoom()&&this.props.sizeClass!==E.SizeClass.Small&&this.openFullscreen()},this.openFullscreen=()=>{null!=this.props.isFullscreen&&f.enterFullScreen({})},this.logRenderFailure=()=>{const e=e=>{const t={};void 0!==e&&(t.rivieraStatusCode=e.toString()),this.logFilePreviewEvent(u.EventType.FilePreviewDownloadFailed,t),this.props.onError&&this.props.onError(_.ErrorType.LoadError,e)};this.rivieraStatusCodeRequest=g.fetchRivieraStatusCode(this.props["preview-url"],e,e)},this.onZoomIn=()=>{this.zoomWithMultiplier(1.25),p.logUserAction(u.UserAction.ZoomIn,u.UserActionContext.Toolbar)},this.onZoomOut=()=>{this.zoomWithMultiplier(.8),p.logUserAction(u.UserAction.ZoomOut,u.UserActionContext.Toolbar)},this.onZoomOriginalOrFit=()=>{const{scaleFactor:e,fitScaleFactor:t,storedFitScaleFactor:i}=this.state,r=1===e&&i?i:void 0,s=e===t?1:t;this.setState({scaleFactor:r||s})},this.onPrint=e=>{d.imagePrint(l.fullSizeUrl(this.props["preview-url"])),p.logUserAction(u.UserAction.Print,e)},this.handleFitScaleFactorChange=(e,t)=>{isNaN(e)||this.state.fitScaleFactor===e||this.setState({fitScaleFactor:e,scaleFactor:e,storedFitScaleFactor:t})},this.keyboardBindings=[...F.getEqualsKeyBindings(R.wrapKeyboardActionWithLogging(this.onZoomIn,u.UserAction.ZoomIn)),...F.getMinusKeyBindings(R.wrapKeyboardActionWithLogging(this.onZoomOut,u.UserAction.ZoomOut)),D.hydrateKeyboardBinding({keyboardEventCriteria:{which:L.Key.P},callback:()=>this.onPrint(u.UserActionContext.Keyboard)})],this.renderLayers=e=>t=>{const i=s.default.createElement(C.ImageLayer,Object.assign({},e,t)),r=this.state.scaleFactor||this.state.fitScaleFactor||1,{originalWidth:n,originalHeight:a}=t,o=n&&a?{width:n*r,height:a*r}:void 0,l=n&&a?{width:n,height:a}:void 0,d=t.data.thumbnailUrl,u=o&&l&&this.props.isWatermarkingMode?s.default.createElement(N.WatermarkingLayer,{layerSize:o,pageDimensions:l,thumbUrl:d}):null,p=o&&l&&this.props.isMarkupMode?s.default.createElement(U.MarkupLayer,{layerSize:o,pageDimensions:l,page:0}):null;return o&&this.props.annotationAllowed?[s.default.createElement(c.AnnotationConductorLayer,{layerSize:o,key:"annotation-layer",intl:B.intl},s.default.createElement(c.AnnotationInstructionalTooltipPane,{layerSize:o},i,u,p,s.default.createElement(c.AnnotationViewLayer,null)))]:[i,u,p]}}componentWillUnmount(){this.rivieraStatusCodeRequest&&this.rivieraStatusCodeRequest.readyState!==XMLHttpRequest.DONE&&this.rivieraStatusCodeRequest.abort(),this.props.overflowZoomOff()}UNSAFE_componentWillMount(){this.logFilePreviewEvent(u.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(u.EventType.FilePreviewDownloadAttempted)}componentDidMount(){this.logOpen();const{nsId:t,sjId:r}=this.props,s=`${t}_${r}`;null!=t&&null!=r&&window._timingData&&window._timingData.img&&window._timingData.img.dl_error_finish&&window._timingData.img.dl_error_finish[s]&&this.logRenderFailure(),new Promise((t,i)=>{e(["modules/clean/react/previews/preview_image_zoom"],t,i)}).then(i.__importStar)}UNSAFE_componentWillReceiveProps(e){if(e["preview-url"]!==this.props["preview-url"]){const t=e.filePreviewSession;this.logFilePreviewEvent(u.EventType.FilePreviewSupportConfirmed,void 0,t),this.logFilePreviewEvent(u.EventType.FilePreviewDownloadAttempted,void 0,t),this.logOpen(),this.setState({scaleFactor:void 0,fitScaleFactor:void 0}),this.imgLoaded=!1}}componentDidUpdate(e,t){t.scaleFactor!==this.state.scaleFactor&&(null!=this.state.scaleFactor&&null!=this.state.fitScaleFactor&&this.state.scaleFactor>this.state.fitScaleFactor?this.props.overflowZoomOn():this.props.overflowZoomOff())}logFilePreviewEvent(e,t={},i=this.props.filePreviewSession){null!=i&&i.recordEvent(e,t)}logOpen(){a.PreviewActivityLogger.log("open",{file_ext:this.props["file-extension"]})}shouldDisableZoom(){const{sizeClass:e,shouldDisplayToolbar:t}=this.props;return t||e===E.SizeClass.Small}zoomWithMultiplier(e){const{fitScaleFactor:t}=this.state,i=this.state.scaleFactor||t;if(1===e||!i)return;let r=.05*Math.round(i*e/.05);Math.abs(r-i)<.05&&(r+=e>1?.05:-.05),this.setState({scaleFactor:Math.min(Math.max(r,t||0),16)})}render(){const{count:e,currentMode:t,index:i,onNext:n,onPrevious:a,shouldDisplayToolbar:d,isEditMode:c,isFlippingEnabled:p,isFullscreen:m,sharePermission:h,contextMenuDisabled:g,windowWidth:_,windowHeight:E,nsId:S=0,sjId:y=0,fileName:P,"preview-url":C}=this.props,{scaleFactor:F,fitScaleFactor:D}=this.state,R=F||D,N=k.getFileRevisionId({ns_id:S,sjid:y}),U=V.getPreviewKey(N,v.asNsId(S),v.asSjId(y));return s.default.createElement("div",{className:r.default("flex-preview-container","image-visible","annotations-visible",o.default.PREVIEW_IMAGE_CONTAINER,{"zoom-disabled":this.shouldDisableZoom(),"has-toolbar":d})},s.default.createElement(M.PreviewImage,{previewMetadata:{content:{".tag":"image",default_src:w.getFallbackSrc(C),src_set:w.getSrcSet(C),full_size_src:l.fullSizeUrl(C),thumbnail_url_tmpl:C}},fileMetadata:{file_name:P},fileInfo:{ns_id:S,sj_id:y,file_id:N,bootstrap:{state:"ready"},previewKey:U},previewKey:U,currentMode:t,data:void 0,filePreviewUiData:{zoomScaleFactor:F,fitScaleFactor:D||0},coreFileViewerUiData:{isDocSidebarOpen:!1,showVideoFrameSteppers:!1,isFullScreen:!1},fileViewerId:"",intl:B.intl,account:{state:"loaded",data:null},dispatch:K,config:W.DEFAULT_CONFIG,contextMenuDisabled:!!g,onDoubleClick:this.onImageDoubleClick,onInteractive:this.logTTI,onRenderSucceeded:this.logRenderSuccess,onRenderFailed:this.logRenderFailure,sizerClassName:o.default.PREVIEW_IMAGE,className:r.default(o.default.PREVIEW_IMAGE_WRAPPER,"preview-content"),width:null!=_?_:0,height:null!=E?E:0,layerRenderFn:this.renderLayers,onFitScaleFactorChanged:this.handleFitScaleFactorChange,fileConfig:void 0}),!c&&s.default.createElement(I.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),!c&&d&&s.default.createElement(b.PreviewToolbar,{isFullscreen:!!m},p?s.default.createElement(T.ToolbarFlipButtons,{index:i,count:e,onClickPrevious:a,onClickNext:n}):null,s.default.createElement(A.ZoomOutButton,{className:"toolbar-button-entry",disabled:null!=R&&null!=D&&R<=D,intl:B.intl,onClick:this.onZoomOut,onKeyUp:e=>{e.keyCode===L.Key.Enter&&this.onZoomOut()}}),s.default.createElement(A.ZoomToFitButton,{className:"zoom-label toolbar-button-entry",intl:B.intl,onClick:this.onZoomOriginalOrFit,zoomPercent:R}),s.default.createElement(A.ZoomInButton,{className:"toolbar-button-entry",disabled:null!=R&&R>=16,intl:B.intl,onClick:this.onZoomIn,onKeyUp:e=>{e.keyCode===L.Key.Enter&&this.onZoomIn()}}),s.default.createElement(A.FullScreenButton,{className:"toolbar-button-entry",intl:B.intl,onClick:()=>f.toggleFullScreen(!!m,u.UserActionContext.Toolbar)}),s.default.createElement(x.PreviewToolbarButton,{className:"print","data-test":"print",disabled:!O.canPrint(h),spriteGroup:"web",spriteName:"print",tooltip:O.getPrintTooltip(h),onClick:O.canPrint(h)?()=>this.onPrint(u.UserActionContext.Toolbar):K})))}}t._PreviewImage=j,j.displayName="PreviewImage";const q=y.requireCssWithComponent(e=>s.default.createElement(P.Dimensions,{className:"flex-preview-container"},({width:t,height:i})=>s.default.createElement(j,Object.assign({},e,{windowHeight:i,windowWidth:t}))),["/static/css/preview_image-vfl-h4TzK.css"]),H=n.connect(e=>({isFlippingEnabled:m.getIsFlippingEnabled(e),annotationAllowed:m.getAnnotationAllowed(e),isEditMode:m.getIsEditMode(e),isWatermarkingMode:m.getIsWatermarkingMode(e),isMarkupMode:m.getIsMarkupMode(e)}),{overflowZoomOn:h.overflowZoomOn,overflowZoomOff:h.overflowZoomOff})(q);t.PreviewImage=H})),define("modules/clean/react/previews/video/preview_video_basic",["require","exports","tslib","classnames","lodash","react","modules/clean/image_size","ts-keycode-enum","modules/clean/loggers/file_preview_logger","modules/clean/react/previews/video/video_preview_logger","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/components/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/components/helpers","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/uri","modules/clean/react/previews/video/utils","modules/clean/react/file_viewer/data/actions","react-redux","modules/clean/react/file_viewer/file_conversion/utils","typescript/libraries/file-viewer/src/core/logging/video"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f,g,_,v,w,b,E,S,y,P,C,M){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewVideoBasic=t._PreviewVideoBasic=t.AsyncVideoPlayer=void 0,r=i.__importDefault(r),s=i.__importStar(s),n=i.__importDefault(n),w=i.__importStar(w),t.AsyncVideoPlayer=u.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/previews/video/video_player"],t,i)}).then(i.__importStar).then(({VideoPlayer:e})=>e)});class k extends n.default.Component{constructor(){super(...arguments),this.lastPlaybackRate=1,this.userActionLogger=null,this.startsPlayingEvent=M.VideoPreviewEvent.VideoStartsPlaying,this.onEmbed=()=>{this.logFilePreviewTimelineEvent(m.EventType.FilePreviewSupportConfirmed),this.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadAttempted)},this.onLoadedMetadata=(e=0)=>{this.videoLogger.populateVideoDuration(e)},this.onReady=(e=!1)=>{this.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadSucceeded),this.props.filePreviewSession&&this.props.filePreviewSession.markPrimaryEvent(),w.mark_time_to_view(),w.mark_time_to_interactive(),this.markRenderSucceeded(),this.videoLogger.logEvent(M.VideoPreviewEvent.PlayerRendered)},this.logPlay=s.once(()=>{this.videoLogger.logEvent(M.VideoPreviewEvent.FirstClickPlay)}),this.onPlay=()=>{const{setMediaPlaying:e}=this.props;this.logPlay(),e&&e()},this.onPause=e=>{const{setMediaPaused:t}=this.props;t&&t(),this.videoLogger.logEvent(M.VideoPreviewEvent.VideoPaused,{video_timestamp:e.toString()})},this.onStartsPlaying=e=>{this.videoLogger.logEvent(this.startsPlayingEvent,{play_latency:e.latency.toString(),play_latency_since:e.trigger}),this.startsPlayingEvent=M.VideoPreviewEvent.VideoResumesPlaying},this.onUserInactive=e=>{e!==this.lastPlaybackRate&&(this.lastPlaybackRate=e,this.logUserAction(m.UserAction.VideoPlaybackRateChanged,{playback_rate:e.toString()}))},this.onScrubberThumbnailsLoaded=e=>{e?this.videoLogger.logEvent(M.VideoPreviewEvent.ScrubberThumbnailsLoaded):this.videoLogger.logEvent(M.VideoPreviewEvent.ScrubberThumbnailsFailed)},this.onAudioWaveformLoaded=()=>{this.videoLogger.logEvent(M.VideoPreviewEvent.AudioWaveformLoaded)},this.onAudioWaveformFailed=()=>{this.videoLogger.logEvent(M.VideoPreviewEvent.AudioWaveformFailed)},this.onError=e=>{if(e&&(this.videoLogger.logEvent(M.VideoPreviewEvent.MediaError,{errorCode:e.code?e.code.toString():"",errorMessage:e.message||""}),"needflash"===e.message))return this.logFilePreviewTimelineEvent(m.EventType.FilePreviewSupportDenied),void("function"==typeof this.props.onError&&this.props.onError(v.ErrorType.NeedFlashError));this.logFilePreviewTimelineEvent(m.EventType.FilePreviewDownloadFailed),w.mark_time_to_view(),w.mark_time_to_interactive(),this.props.onError&&this.props.onError(v.ErrorType.LoadError)},this.onPlaybackRateChange=(e,t)=>{this.videoLogger.logEvent(M.VideoPreviewEvent.ChangePlaybackRate,{old_playback_rate:e.toString(),new_playback_rate:t.toString()})},this.onSeek=(e,t)=>{this.videoLogger.logEvent(M.VideoPreviewEvent.SeekVideo,{old_video_time:e.toString(),new_video_time:t.toString()})},this.onStalled=(e,t)=>{this.videoLogger.logEvent(M.VideoPreviewEvent.VideoStalled,{video_timestamp:e.toString(),playback_rate:t.toString()})},this.onTruncated=()=>{h.filePreviewEventEmitter.emit(m.EventType.FilePreviewVideoTruncated),this.videoLogger.setVideoTruncated()},this.onClose=e=>{this.videoLogger.logEvent(M.VideoPreviewEvent.ClosePreview,{video_time_on_close:e.toString()})},this.onSelectQuality=(e,t)=>{this.videoLogger.logEvent(M.VideoPreviewEvent.ChangeVideoQuality,{old_video_quality:e,new_video_quality:t})},this.onCanPlayThrough=e=>{this.videoLogger.logEvent(M.VideoPreviewEvent.TimeToBuffer,{time_to_buffer:e.toString()})},this.handleKeyPress=e=>(null==e?void 0:e.keyCode)===o.Key.Space&&(this.togglePlayback(),g.isKeyboardEvent(e)&&e.preventDefault(),!0),this.keyboardBindings=[{keyboardEventCriteria:g.generateUnmodifiedKeyboardEventCriteria(o.Key.Space),callback:this.handleKeyPress}],this.processGutterClick=e=>{const{onGutterClick:t}=this.props;t&&e.target===e.currentTarget&&t()}}setUpLoggers(){this.teardownLoggers(),this.userActionLogger=new l.FilePreviewUserActionLogger,this.userActionLogger.listenTo(h.filePreviewEventEmitter),this.videoLogger=new d.VideoPreviewLogger(this.props.fileExtension,this.props.filePreviewSession)}teardownLoggers(){this.userActionLogger&&(this.userActionLogger.unlistenTo(h.filePreviewEventEmitter),this.userActionLogger=null)}logFilePreviewTimelineEvent(e){this.props.filePreviewSession&&this.props.filePreviewSession.recordEvent(e)}logUserAction(e,t){h.filePreviewEventEmitter.emit(m.EventType.FilePreviewUserAction,this.props.filePreviewSession,e,m.UserActionContext.VideoPlayer,t)}markRenderSucceeded(){this.logFilePreviewTimelineEvent(m.EventType.FilePreviewRenderSucceeded),this.props.setRenderStatusSuccess()}getPlaybackRates(){return[.5,1,1.25,1.5,2,4]}componentDidMount(){this.setUpLoggers()}componentWillUnmount(){this.teardownLoggers()}shouldComponentUpdate(e){return f.compareStateAndProps(e,{})}togglePlayback(){h.filePreviewEventEmitter.emit(m.EventType.FilePreviewVideoToggled)}render(){const{title:e,previewUrl:i,separateResolutionUrls:s,sourceContext:o,thumbnailUrlTmpl:l,videoMetadataUrl:d,videoContainer:u,vttThumbnailsUrl:p,waveformUrl:m,user:h,file:f,shareToken:g,sharePermission:w}=this.props,y=S.video_type(u),P=o!==v.PreviewSourceContext.EmbeddedSharedLinkFile;let M=!1,k=!1,T=0;b.is_mobile_or_tablet()&&(M=!0,k=!0,T=1);const A={preload:"auto",playbackRates:this.getPlaybackRates(),nativeControlsForTouch:k,playsinline:T};null!=l&&(A.poster=c.tagCriticalPathContentRequest((function(e){return E.URI.parse(e).updateQuery({size:a.imageBestFitSize(window.innerWidth,window.innerHeight),size_mode:"2"}).toString()})(l),this.props.filePreviewSession));const I={videoProps:{src:i,separateResolutionSrcs:s,sourceContentType:y,metadataLink:d,title:e,vttThumbnailsUrl:p,waveformUrl:m},playerCallbacks:{onLoadedMetadata:this.onLoadedMetadata,onError:this.onError,onReady:this.onReady,onPlay:this.onPlay,onCanPlayThrough:this.onCanPlayThrough,onPause:this.onPause,onStartsPlaying:this.onStartsPlaying,onUserInactive:this.onUserInactive,onScrubberThumbnailsLoaded:this.onScrubberThumbnailsLoaded,onAudioWaveformLoaded:this.onAudioWaveformLoaded,onAudioWaveformFailed:this.onAudioWaveformFailed,onPlaybackRateChange:this.onPlaybackRateChange,onSeek:this.onSeek,onStalled:this.onStalled,onSelectQuality:this.onSelectQuality,onTimeUpdate:this.props.onTimeUpdate},playerOptions:A,seekPosition:this.props.seekPosition,shouldEnableControls:!this.props.hideControls,noDownload:M,shouldFocusOnReady:this.props.shouldFocusOnReady,onEmbed:this.onEmbed,onTruncated:this.onTruncated,onClose:this.onClose,shouldShowTruncationMessage:P,isAudio:this.props.isAudio,bytes:this.props.bytes,showOnboarding:!!this.props.showOnboarding,framePreciseCommentsEnabled:this.props.framePreciseCommentsEnabled,frameRate:this.props.frameRate,playerIntegrationEnabled:!!this.props.playerIntegrationEnabled},F=n.default.createElement("div",{className:r.default({"flex-preview-container":!0,"touch-device":b.is_mobile_or_tablet()})},this.props.disableKeyboardShortcuts?null:n.default.createElement(_.KeyboardBindingConnector,{keyboardBindings:this.keyboardBindings}),n.default.createElement("div",{className:"preview-content preview-video",onClick:this.processGutterClick},n.default.createElement("div",{className:"preview-video__wrapper"},n.default.createElement("div",{className:r.default({"preview-video__aspect-container":!0,"preview-audio-transcoded":this.props.isAudio})},n.default.createElement("div",{className:"preview-video__container"},n.default.createElement(t.AsyncVideoPlayer,Object.assign({},I))))))),O=C.getConversionsForPreview(f,h,g,w);return n.default.createElement(n.default.Fragment,null,O,F)}}t._PreviewVideoBasic=k,k.displayName="PreviewVideoBasic";const T=P.connect(void 0,{setMediaPlaying:y.setMediaPlaying,setMediaPaused:y.setMediaPaused})(k),A=p.requireCssWithComponent(T,["/static/css/preview_video-vflaCvSEW.css","/static/css/video-js-7-custom-v1-vflVPUGJP.css"]);t.PreviewVideoBasic=A})),define("modules/clean/react/previews/error/view",["require","exports","tslib","classnames","react","modules/clean/react/previews/preview_toolbar","modules/clean/file_store/utils","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/previews/constants","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/image","modules/clean/react/previews/error/message","modules/core/i18n","modules/clean/react/previews/toolbar_flip_buttons"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewErrorView=void 0,r=i.__importDefault(r),s=i.__importDefault(s),t.PreviewErrorView=e=>{const{areActionablesEnabled:t,allowOpenInApp:i,count:m,errorType:g,extensionsEnabled:_,file:v,filename:w,index:b,message:E,onNext:S,onPrevious:y,preview:P,sharedLinkInfo:C,shareToken:M,sharePermission:k,shouldDisplayToolbar:T,sizeClass:A,user:I,encryptionOptions:F}=e;return s.default.createElement("div",{className:r.default({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":T})},s.default.createElement("div",{className:"preview-error__wrapper"},s.default.createElement("div",{className:"preview-error__content"},s.default.createElement(u.PreviewErrorImage,{errorType:g}),s.default.createElement(p.PreviewErrorMessage,{file:v,preview:P,errorType:g,message:E}),s.default.createElement(c.PreviewErrorFileInfo,{filename:w,bytes:v.bytes}),t?s.default.createElement(o.Actionable,{allowOpenInApp:!!i,extensionsEnabled:_,file:v,variant:"primary",location:l.FileViewerPane.PreviewContent,sharedLinkInfo:C,shareToken:M,sharePermission:k,user:I,userActionContext:l.UserActionContext.PreviewContentMain,sizeClass:A,encryptionOptions:F}):null,g!==d.ErrorType.ExtensionError||a.isArchiveFile(v)?null:s.default.createElement(f,null)),T&&null!=b&&null!=m?s.default.createElement("div",{className:"preview-toolbar-container"},s.default.createElement(n.PreviewToolbar,{isFullscreen:!1},s.default.createElement(h.ToolbarFlipButtons,{index:b,count:m,onClickPrevious:y,onClickNext:S}))):null))};const f=()=>s.default.createElement("div",{className:"preview-error__help-link"},s.default.createElement("a",{href:l.UnsupportedExtensionHelpLink,target:"_blank",rel:"noopener\n    noreferrer"},m.intl.formatMessage({id:"KlxqP+",defaultMessage:"Learn more."})))})),define("modules/clean/react/previews/error/upsell",["require","exports","tslib","classnames","react","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/image","modules/clean/react/previews/error/message","modules/core/i18n","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/preview_toolbar","modules/clean/react/previews/toolbar_flip_buttons"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewUpsellErrorView=void 0,r=i.__importDefault(r),s=i.__importDefault(s);class h extends s.default.Component{constructor(){super(...arguments),this.onClickCTA=()=>{this.props.filePreviewSession&&u.filePreviewEventEmitter.emit(a.EventType.FilePreviewUpsellClicked,this.props.filePreviewSession)}}componentDidMount(){this.props.filePreviewSession&&u.filePreviewEventEmitter.emit(a.EventType.FilePreviewUpsellExposed,this.props.filePreviewSession)}render(){return s.default.createElement("div",{className:r.default({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-toolbar":this.props.shouldDisplayToolbar})},s.default.createElement("div",{className:"preview-error__wrapper"},s.default.createElement("div",{className:"preview-error__content"},s.default.createElement(l.PreviewErrorImage,{errorType:this.props.errorType}),s.default.createElement(d.PreviewErrorMessage,{file:this.props.file,preview:this.props.preview,errorType:this.props.errorType}),s.default.createElement(o.PreviewErrorFileInfo,{filename:this.props.filename,bytes:this.props.file.bytes}),this.props.areActionablesEnabled?s.default.createElement("div",{className:"preview-error__upsell-cta"},s.default.createElement(n.Actionable,{allowOpenInApp:!!this.props.allowOpenInApp,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,variant:"primary",location:a.FileViewerPane.PreviewContent,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermission:this.props.sharePermission,user:this.props.user,userActionContext:a.UserActionContext.PreviewContentMain,sizeClass:this.props.sizeClass,encryptionOptions:this.props.encryptionOptions})):null,s.default.createElement("div",{className:"preview-error__help-link"},s.default.createElement("a",{href:a.PreviewsUpsellUrl,onClick:this.onClickCTA},c.intl.formatMessage({id:"pvR+AO",defaultMessage:"Upgrade"}))),this.props.shouldDisplayToolbar&&null!=this.props.index&&null!=this.props.count?s.default.createElement("div",{className:"preview-toolbar-container"},s.default.createElement(p.PreviewToolbar,{isFullscreen:!1},s.default.createElement(m.ToolbarFlipButtons,{index:this.props.index,count:this.props.count,onClickPrevious:this.props.onPrevious,onClickNext:this.props.onNext}))):null)))}}t.PreviewUpsellErrorView=h,h.displayName="PreviewUpsellErrorView"})),define("modules/clean/react/previews/error/fullscreen_view",["require","exports","tslib","react","modules/clean/react/components/css","modules/clean/react/file_viewer/actionable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/error/file_info","modules/clean/react/previews/error/message","modules/clean/react/previews/preview_zoom_container"],(function(e,t,i,r,s,n,a,o,l,d,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewErrorFullscreenView=void 0,r=i.__importDefault(r);const u=s.requireCssWithComponent(e=>{const{allowOpenInApp:t,areActionablesEnabled:i,count:s,errorType:u,extensionsEnabled:p,file:m,filename:h,index:f,message:g,onNext:_,onPrevious:v,preview:w,sharedLinkInfo:b,shareToken:E,sharePermission:S,user:y,encryptionOptions:P}=e;return r.default.createElement(c.PreviewZoomContainer,{fileCount:s,fileIndex:f,onClose:o.exitFullScreen,onFlipNext:_,onFlipPrevious:v,renderZoomControls:!1},r.default.createElement("div",{className:"preview-error--fullscreen fullscreen"},r.default.createElement(d.PreviewErrorMessage,{file:m,preview:w,errorType:u,message:g}),r.default.createElement(l.PreviewErrorFileInfo,{bytes:m.bytes,filename:h}),i?r.default.createElement(n.Actionable,{allowOpenInApp:!!t,extensionsEnabled:p,file:m,variant:"primary",location:a.FileViewerPane.PreviewContent,sharedLinkInfo:b,shareToken:E,sharePermission:S,user:y,userActionContext:a.UserActionContext.PreviewContentMain,encryptionOptions:P}):null))},["/static/css/preview_image-vfl-h4TzK.css","/static/css/preview_error-vflZQp8qV.css"]);t.PreviewErrorFullscreenView=u})),define("modules/clean/react/previews/video/audio_waveform/average_counter",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AverageCounter=void 0;t.AverageCounter=class{constructor(){this.average=0,this.count=0}getAverage(){return this.average}add(e){this.average=(this.average*this.count+e)/(this.count+1),this.count++}addArray(e){const t=e.reduce((e,t)=>e+t),i=this.count+e.length;this.average=(this.average*this.count+t)/i,this.count=i}}})),define("modules/clean/callback_chain/callback_chain",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallbackChain=void 0;t.CallbackChain=class{constructor(e){this.callbacks=e}run(e){const t=(function(e){return void 0!==e.abortCallbackChain})(e)?e:(function(e){const t=e;let i=!1;return t.abortCallbackChain=()=>{i=!0},Object.defineProperty(t,"callbackChainAborted",{get:()=>i}),t})(e);for(const e of this.callbacks){if(t.callbackChainAborted)break;e(t)}}}})),define("modules/clean/react/file_action_button_group",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileActionButtonGroup=void 0,(function(e){e.COMMENTS="COMMENTS",e.WATERMARKING="WATERMARKING"})(t.FileActionButtonGroup||(t.FileActionButtonGroup={}))})),define("modules/clean/react/file_action_button_type",["require","exports","modules/core/i18n"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFileActionButtonText=t.FileActionButtonType=void 0,t.FileActionButtonType={COMMENT:"COMMENT",COPY:"COPY",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD",MOVE:"MOVE",OPEN:"OPEN",PREVIOUS_VERSIONS:"PREVIOUS_VERSIONS",REMOVE_LINK:"REMOVE_LINK",RENAME:"RENAME",SHARE:"SHARE",ENABLE_COMMENTS:"ENABLE_COMMENTS",DISABLE_COMMENTS:"DISABLE_COMMENTS",SHOW_RESOLVED_COMMENTS:"SHOW_RESOLVED_COMMENTS",HIDE_RESOLVED_COMMENTS:"HIDE_RESOLVED_COMMENTS",SUBSCRIBE:"SUBSCRIBE",SUBSCRIBE_TO_NOTIFICATIONS:"SUBSCRIBE_TO_NOTIFICATIONS",UNSUBSCRIBE:"UNSUBSCRIBE",UNSUBSCRIBE_FROM_NOTIFICATIONS:"UNSUBSCRIBE_FROM_NOTIFICATIONS",ENABLE_WATERMARKING:"ENABLE_WATERMARKING",REMOVE_WATERMARKING:"REMOVE_WATERMARKING"};const r={[t.FileActionButtonType.COMMENT]:i.intl.formatMessage({id:"aM022A",defaultMessage:"Comment"}),[t.FileActionButtonType.COPY]:i.intl.formatMessage({id:"P7oHCQ",defaultMessage:"Copy…"}),[t.FileActionButtonType.DELETE]:i.intl.formatMessage({id:"OADU7S",defaultMessage:"Delete…"}),[t.FileActionButtonType.DOWNLOAD]:i.intl.formatMessage({id:"n062nX",defaultMessage:"Download"}),[t.FileActionButtonType.MOVE]:i.intl.formatMessage({id:"wz9EvW",defaultMessage:"Move…"}),[t.FileActionButtonType.OPEN]:i.intl.formatMessage({id:"PHsPd8",defaultMessage:"Open"}),[t.FileActionButtonType.PREVIOUS_VERSIONS]:i.intl.formatMessage({id:"QSlOA6",defaultMessage:"Version history"}),[t.FileActionButtonType.REMOVE_LINK]:i.intl.formatMessage({id:"yypOy/",defaultMessage:"Remove link"}),[t.FileActionButtonType.RENAME]:i.intl.formatMessage({id:"cBNivm",defaultMessage:"Rename"}),[t.FileActionButtonType.SHARE]:i.intl.formatMessage({id:"V5WMXh",defaultMessage:"Share"}),[t.FileActionButtonType.ENABLE_COMMENTS]:i.intl.formatMessage({id:"ouKfC+",defaultMessage:"Enable comments"}),[t.FileActionButtonType.DISABLE_COMMENTS]:i.intl.formatMessage({id:"iVmeBf",defaultMessage:"Disable comments"}),[t.FileActionButtonType.SHOW_RESOLVED_COMMENTS]:i.intl.formatMessage({id:"fKXJUR",defaultMessage:"Show resolved comments"}),[t.FileActionButtonType.HIDE_RESOLVED_COMMENTS]:i.intl.formatMessage({id:"U75RtN",defaultMessage:"Hide resolved comments"}),[t.FileActionButtonType.SUBSCRIBE]:i.intl.formatMessage({id:"5rfGLn",defaultMessage:"Subscribe"}),[t.FileActionButtonType.SUBSCRIBE_TO_NOTIFICATIONS]:i.intl.formatMessage({id:"9Zx9uj",defaultMessage:"Subscribe to notifications"}),[t.FileActionButtonType.UNSUBSCRIBE]:i.intl.formatMessage({id:"JFibpn",defaultMessage:"Unsubscribe"}),[t.FileActionButtonType.UNSUBSCRIBE_FROM_NOTIFICATIONS]:i.intl.formatMessage({id:"1Y5o16",defaultMessage:"Unsubscribe from notifications"}),[t.FileActionButtonType.ENABLE_WATERMARKING]:i.intl.formatMessage({id:"WnWL5z",defaultMessage:"Enable watermarking"}),[t.FileActionButtonType.REMOVE_WATERMARKING]:i.intl.formatMessage({id:"qXY4zf",defaultMessage:"Remove watermarking"})};t.getFileActionButtonText=function(e){return e&&r[e]?r[e]:null}})),define("modules/clean/react/file_viewer/more_dropdown/models",["require","exports","tslib","lodash"],(function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoreOptionGroup=t.MoreOption=void 0,r=i.__importStar(r);class s{equals(e){return r.isEqual(this,e)}}t.MoreOption=class extends s{constructor(e={}){super(),this.className=e.className||null,this.fileActionButtonType=e.fileActionButtonType||null,this.handler=e.handler||r.noop,this.component=e.component||null,this.sortWeight=e.sortWeight||0}};t.MoreOptionGroup=class extends s{constructor(e){super(),this.fileActionButtonGroup=e.fileActionButtonGroup,this.options=e.options||[],this.sortWeight=e.sortWeight||0}}})),define("modules/clean/react/file_viewer/more_dropdown/more_option_registry",["require","exports","tslib","lodash","modules/clean/react/file_viewer/more_dropdown/models"],(function(e,t,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.moreOptionRegistry=t.MoreOptionRegistry=void 0,r=i.__importStar(r);class n extends class{constructor(){this.listeners=[]}emitChange(){return this.listeners.forEach(e=>e())}addListener(e){return this.listeners.push(e),()=>{const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}}removeListeners(){this.listeners=[]}}{constructor(){super(...arguments),this.options=[]}isValidMoreOption(e){return null!=e.fileActionButtonType}isValidMoreOptionGroup(e){const{options:t}=e;return t.length&&t.every(e=>this.isValidMoreOption(e))}isValidOption(e){return e instanceof s.MoreOption&&this.isValidMoreOption(e)||e instanceof s.MoreOptionGroup&&this.isValidMoreOptionGroup(e)}reset(){this.options=[],this.removeListeners()}getOptionItems(){return r.sortBy(this.options.slice(),e=>e.sortWeight)}addOption(e){if(!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");this.options=[...this.options,e],this.emitChange()}removeOption(e){if(null!=e&&!this.isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");const t=this.options.length;var i,r;this.options=(i=this.options,r=e,i.filter(e=>e!==r)),this.options.length<t&&this.emitChange()}replaceOption(e,t){if(null==t)throw new Error("Please provide option to replace it with. Otherwise use removeOption");if(!this.isValidOption(e)||!this.isValidOption(t))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");if(e.equals(t))return;let i=!1;this.options=this.options.map(r=>r===e?(i=!0,t):r),i&&this.emitChange()}}t.MoreOptionRegistry=n,t.moreOptionRegistry=new n})),define("modules/clean/react/file_viewer/actionable",["require","exports","tslib","react","modules/clean/file_store/utils","modules/clean/react/open_in_app/button","modules/clean/react/share_download/button","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/extensions/data/types","modules/clean/react/file_viewer/open_button/open_button"],(function(e,t,i,r,s,n,a,o,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Actionable=void 0,r=i.__importDefault(r),t.Actionable=e=>{const{allowOpenInApp:t,extensionsEnabled:i,variant:c,location:u,sizeClass:p,user:m,userActionContext:h,encryptionOptions:f}=e;let g;return s.isSharedFile(e.file)?(g=e.file,t&&g.open_in_app_data?r.default.createElement(n.OpenInAppButton,{urls:g.open_in_app_data,userActionContext:h}):r.default.createElement(a.ShareDownloadButton,{copyable:g,importance:c,location:u,sharedLinkInfo:e.sharedLinkInfo,shareToken:e.shareToken,sharePermission:e.sharePermission,user:m,encryptionOptions:f})):m?(g=e.file,i?r.default.createElement(o.ExtensionsMenu,{file:g,user:m,showAsButtonIfDownloadOnly:!0,triggerType:l.TriggerType.PrimaryButton,telemetryContext:{surface:"previews"},onPresentInZoom:()=>{}}):r.default.createElement(d.OpenButton,{file:g,user:m,justifyRight:!1,location:u,buttonVariant:c,sizeClass:p})):null}})),define("modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial",["require","exports","tslib","react","modules/clean/analytics","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/web_timing_logger","modules/clean/react/file_viewer/app_download_interstitial/app_download_interstitial"],(function(e,t,i,r,s,n,a,o,l,d,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilePreviewAppDownloadInterstitial=void 0,r=i.__importDefault(r);class u extends r.default.PureComponent{constructor(){super(...arguments),this.onContinue=()=>{this.log(n.UserAction.AppDownloadInterstitialContinue),"function"==typeof this.props.onContinue&&this.props.onContinue()},this.onClose=()=>{this.log(n.UserAction.AppDownloadInterstitialClose),"function"==typeof this.props.onClose&&this.props.onClose()},this.onAppDownload=()=>{this.log(n.UserAction.AppDownloadInterstitialInstall)}}componentDidMount(){d.mark_time_to_interactive(),this.setupLogger(),this.filePreviewSession.markPrimaryEvent(),this.log(n.UserAction.AppDownloadInterstitialView)}UNSAFE_componentWillReceiveProps(e){e.file.ns_id===this.props.file.ns_id&&e.file.sjid===this.props.file.sjid&&e.fileViewerSession===this.props.fileViewerSession||this.setupLogger(e)}setupLogger(e=this.props){const{file:t,fileViewerSession:i,previewType:r,previewSourceAction:s=l.PreviewSourceAction.Visit,previewSourceContext:n=l.PreviewSourceContext.SharedLinkFile}=this.props;i&&(this.filePreviewSession=new o.FilePreviewSession({file:t,previewType:r,fileViewerSession:i,sourceAction:s,sourceContext:n}))}log(e){const{fileViewerSession:t,file:i}=this.props;this.filePreviewSession&&t&&i.ns_id&&i.sjid&&s.MobileFilePreviewLogger.log(e,t.id,this.filePreviewSession.id,i.ns_id,i.sjid,{context:n.UserActionContext.AppDownloadInterstitial})}render(){const e=this.props,{file:t,sharedLinkInfo:s}=e,n=i.__rest(e,["file","sharedLinkInfo"]);return r.default.createElement(c.AppDownloadInterstitial,Object.assign({fileOrFolderName:a.getFilename(t),open_in_app_data:t.open_in_app_data,onContinue:this.onContinue,onAppDownload:this.onAppDownload,ownerName:s.ownerName,ownerTeamName:s.ownerTeamName,onClose:this.onClose},n))}}t.FilePreviewAppDownloadInterstitial=u,u.displayName="FilePreviewAppDownloadInterstitial"})),define("modules/clean/react/file_viewer/cloud_doc_preview",["require","exports","tslib","react","modules/clean/cloud_docs/event_logging","modules/clean/cloud_docs/types","modules/clean/referrer_cleansing_redirect","modules/clean/file_store/utils","modules/clean/cloud_docs/constants"],(function(e,t,i,r,s,n,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloudDocPreview=void 0,r=i.__importDefault(r),a=i.__importStar(a);class d extends r.default.Component{constructor(e){super(e),this.logPreviewAction=()=>{if(this.props.file.file_id){const e={};this.props.user?s.logUserAction({actionEvent:n.UserActionEventType.PREVIEW,userId:this.props.user.id,docPathOrId:this.props.file.file_id,actionSource:n.UserActionSourceType.WEB}):(this.props.LoggedOutUXGoogleVariant&&(e[l.CLOUD_DOCS_STORMCROW_LOGGED_OUT_UX_GOOGLE]=this.props.LoggedOutUXGoogleVariant||""),s.logLoggedOutUserAction({actionEvent:n.UserActionEventType.PREVIEW,userId:0,docPathOrId:this.props.file.file_id,actionSource:n.UserActionSourceType.WEB,extra:e}))}},this.shouldRedirect=!e.showCloudDocPreview&&Boolean(e.cloudDoc.exit_url)}componentDidMount(){this.logPreviewAction(),this.shouldRedirect&&a.redirect(this.props.cloudDoc.exit_url)}componentDidUpdate(e){this.props.file.file_id!==e.file.file_id&&this.logPreviewAction()}shouldComponentUpdate(e){return this.props.file.file_id!==e.file.file_id}render(){if(this.shouldRedirect)return null;const e=o.getExtension(this.props.file);return["gdoc","gslides","paper","papert","binder"].includes(e)?this.props.renderPdfPreview(this.props.cloudDoc):["gsheet"].includes(e)?this.props.renderExcelPreview():this.props.renderUnsupportedErrorPreview()}}t.CloudDocPreview=d,d.displayName="CloudDocPreview"})),define("modules/clean/react/file_viewer/exp_file_viewer_upsell_banner",["require","exports","tslib","react","modules/clean/react/components/css","modules/constants/payments","modules/core/i18n"],(function(e,t,i,r,s,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExpFileViewerUpsellBannerV2=void 0,r=i.__importDefault(r),n=i.__importStar(n);class o extends r.default.Component{render(){const e=n.OUT_OF_SPACE_URL+"?oqa=oq_fp";return r.default.createElement("div",{className:"fileviewer-upsell-banner"},a.intl.formatMessage({id:"XOn3VZ",defaultMessage:"Get more space to add more files to your Dropbox. <a>Upgrade now.</a>"},{a:t=>r.default.createElement("a",{href:e},t)}))}}o.displayName="ExpFileViewerUpsellBannerComponent",t.ExpFileViewerUpsellBannerV2=s.requireCssWithComponent(o,["/static/css/exp_file_preview_upsell-vfli2_OuA.css"])})),define("modules/clean/react/file_viewer/feedback_form/api",["require","exports","tslib","api_v2/user_client","modules/clean/react/file_viewer/feedback_form/types"],(function(e,t,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.submitFeedback=void 0,t.submitFeedback=function(e,t,n,a){return i.__awaiter(this,void 0,void 0,(function*(){if(!a)return;let i;i=t===s.NOT_APPLICABLE_SATISFACTION_RATING_VALUE?void 0:t;const o={product_name:e,satisfaction_rating:i,comment:n};return yield(new r.UserApiV2Client).ns("workflows").rpc("submit_feedback",o,{subjectUserId:a.id})}))}})),define("modules/clean/react/file_viewer/feedback_form/feedback_form_modal",["require","exports","tslib","react","modules/core/i18n","file-transfers/feedback-form/index","modules/clean/react/components/css","spectrum/modal/index","modules/clean/react/snackbar"],(function(e,t,i,r,s,n,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeedbackFormModal=t.FeedbackFormModalComponent=void 0,r=i.__importDefault(r);class d extends r.default.Component{constructor(){super(...arguments),this.state={comment:"",rating:null},this.handlePrimaryAction=()=>{const{rating:e,comment:t}=this.state,{user:i}=this.props;e?(this.props.submitFeedback(e,t,i),this.props.onRequestClose(),l.Snackbar.complete(s.intl.formatMessage({id:"w0RwUf",defaultMessage:"Feedback submitted!"}),"feedback-snackbar-id")):l.Snackbar.fail(s.intl.formatMessage({id:"HnlRF6",defaultMessage:"Please provide a rating"}),"feedback-snackbar-id")},this.handleRatingChange=e=>{this.setState({rating:e})},this.handleCommentsChange=e=>{this.setState({comment:e})}}render(){const{comment:e,rating:t}=this.state;return r.default.createElement(o.UtilityModal,{ariaLabel:this.props.title,title:this.props.title,open:this.props.open,displayCloseButton:!0,overlayClickClose:!0,onReady:this.props.onReady,onRequestClose:this.props.onRequestClose,primaryAction:s.intl.formatMessage({id:"Laz2WV",defaultMessage:"Submit"}),onPrimaryAction:this.handlePrimaryAction,secondaryAction:s.intl.formatMessage({id:"5FcUkH",defaultMessage:"Not now"}),onSecondaryAction:this.props.onRequestClose,shouldRequestCloseOnActions:!1,overlayClassName:"file-viewer-modal-overlay",appElement:document.getElementById("embedded-app")||document.body},r.default.createElement(n.FeedbackForm,{comment:e,rating:t,commentPrompt:this.props.commentPrompt,onRatingChange:this.handleRatingChange,onCommentsChange:this.handleCommentsChange}))}}t.FeedbackFormModalComponent=d,d.displayName="FeedbackFormModalComponent",t.FeedbackFormModal=a.requireCssWithComponent(d,["/static/js/file-transfers/index.web-vflyfQdY4.css"])})),define("modules/clean/react/file_viewer/feedback_form/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=t.SubmitFeedbackProductName=void 0,(function(e){e.DROPBOX_MARKUP="Dropbox Markup"})(t.SubmitFeedbackProductName||(t.SubmitFeedbackProductName={})),t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=-1})),define("modules/clean/react/file_viewer/file_preview",["require","exports","tslib","classnames","react","lodash","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/previews/util","modules/clean/previews/util","modules/clean/react/async/loadable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/data/utils","modules/clean/cloud_docs/shared_components/routing","modules/clean/react/file_viewer/cloud_doc_preview","modules/clean/react/file_viewer/file_conversion/utils","modules/clean/file_store/utils","modules/clean/react/file_viewer/utils","modules/clean/react/previews/constants","modules/clean/react/previews/loading_indicator","modules/clean/react/previews/error/preview_error","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/video/preview_video","modules/clean/react/previews/preview_pdf_loadable","modules/clean/react/previews/preview_ppt_loadable","modules/clean/react/previews/archive/preview_archive_loadable","spectrum-sharing/utils/sharing_constants","modules/core/i18n","modules/core/browser","modules/clean/react/file_viewer/file_preview_logging_manager","modules/clean/redux/constants","modules/clean/previews/data/util","modules/clean/react/snackbar","modules/clean/react/file_viewer/logging","modules/constants/file_viewer","typescript/libraries/file-viewer/src/core/data/modes/types","typescript/libraries/file-viewer/src/core/data/riviera/types"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f,g,_,v,w,b,E,S,y,P,C,M,k,T,A,I,F,O,x,D,L,R,N,U){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilePreviewWithLogging=t.FilePreview=void 0,r=i.__importDefault(r),s=i.__importDefault(s),n=i.__importStar(n),o=i.__importStar(o),l=i.__importStar(l),I=i.__importStar(I);const B=c.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/previews/preview_image_zoom"],t,i)}).then(i.__importStar).then(({PreviewImageZoom:e})=>e)}),W=c.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/previews/limited_preview_message"],t,i)}).then(i.__importStar).then(({LimitedPreviewMessage:e})=>e)}),{forceRivieraException:V,forceTestPdf:K,forceTestExcelHtml:j}=I.get_uri().getQuery();class q extends s.default.Component{componentDidMount(){this.triggerDynamicRoutingModalCheck()}componentDidUpdate({user:e,file:t}){const{user:i,file:r}=this.props;n.isEqual(t,r)&&n.isEqual(e,i)||this.triggerDynamicRoutingModalCheck()}triggerDynamicRoutingModalCheck(){const{user:e,file:t,file:{file_id:i}}=this.props;e&&i&&!this.isViewOnly()&&m.maybeShowDynamicRoutingModal(e,t,g.getExtension(t))}isViewOnly(){let e=!1;return this.props.hasOwnProperty("shareToken")&&void 0!==this.props.shareToken&&(e=this.props.shareToken.linkType===T.SharedLinkType.Shmodel),e}render(){const{doc:{autoprint_url:e,image_url_tmpl:t,refresh_url:i="",text_url_tmpl:r},file:n,filePreviewSession:a,invalidateFrameMessenger:o,isFullscreen:l,isSidebarOpen:c,location:u,mode:p=N.FileViewerMode.Default,renderUnsupportedErrorPreview:m,setRenderStatusSuccess:h,sharePermission:f,shareToken:_,sidebar:v,sizeClass:w,triggerError:b,user:E,count:S,index:y,onPrevious:P,onNext:k}=this.props;if(!t||!r)return m();const T=g.getExtension(n),A={autoprintUrl:e,currentMode:{sidebar:v,mode:p},revisionId:x.buildRevisionId(n.ns_id,n.sjid),file:n,fileExtension:T,filePreviewSession:a,imageUrlTmpl:t,isArchiveFile:!1,isFullscreen:l,isSidebarOpen:c,onError:b,useCanned:!!K,refreshUrl:i,location:u,sharePermission:f,shareToken:_,sizeClass:w,textUrlTmpl:r,invalidateFrameMessenger:o,setRenderStatusSuccess:h,user:E,count:S,index:y,onPrevious:P,onNext:k};return d.isPptExtension(T)?s.default.createElement(M.PreviewPPTLoadable,Object.assign({},A)):s.default.createElement(C.PreviewPDFLoadable,Object.assign({},A))}}q.displayName="PDFPreview";class H extends s.default.Component{constructor(){super(...arguments),this.state={hasError:!1},this.handlePrevious=L.wrapToolbarActionWithLogging(()=>{var e,t;return null===(t=(e=this.props).onPrevious)||void 0===t?void 0:t.call(e)},u.UserAction.FlipPrevious),this.handleNext=L.wrapToolbarActionWithLogging(()=>{var e,t;return null===(t=(e=this.props).onNext)||void 0===t?void 0:t.call(e)},u.UserAction.FlipNext),this.shouldDisableDownload=()=>!!this.props.sharePermission&&!this.props.sharePermission.canViewContextMenuRoles.length,this.onContextMenu=e=>{this.shouldDisableDownload()&&e.preventDefault()},this.onCopy=e=>{this.props.sharePermission&&0===this.props.sharePermission.canDownloadRoles.length&&e.preventDefault()},this.renderExcelPreview=()=>{const{preview_url:e}=this.props.previewApiData.data;return e?s.default.createElement(E.PreviewHTML,Object.assign({src:e,isExcel:!0,forceRivieraException:Array.isArray(V)?V[0]:"",forceTestExcelHtml:!!j,usesFrameMessenger:!0},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()},this.renderPdfPreview=e=>s.default.createElement(q,Object.assign({},this.props,{onPrevious:this.handlePrevious,onNext:this.handleNext,doc:e,renderUnsupportedErrorPreview:this.renderUnsupportedErrorPreview,triggerError:this.triggerError})),this.renderUnsupportedErrorPreview=()=>this.renderErrorPreview(v.ErrorType.SupportError),this.showLoadingIndicator=()=>s.default.createElement(w.LoadingIndicator,{className:"loading-indicator"}),this.getErrorMessage=(e,t,i)=>{if(i&&"sketch"===g.getExtension(i)&&e===v.ErrorType.LoadError&&t===U.RivieraStatus.UnsupportedFormat)return A.intl.formatMessage({id:"I5lVCX",defaultMessage:"This file can’t be previewed. Previews are only available for files created in Sketch v43 and up."})},this.triggerError=(e,t)=>{this.setState({hasError:!0,errorType:e,rivieraStatusCode:t})}}UNSAFE_componentWillReceiveProps(e){n.isEqual(e.file,this.props.file)||this.setState({hasError:!1,errorType:void 0})}componentDidMount(){if(a.PreviewType.Excel===o.getPreviewType(this.props.previewApiData.data)){const e=this.props.file,t=g.getExtension(e);this.props.user&&e.file_id&&!this.isViewOnly()&&m.maybeShowDynamicRoutingModal(this.props.user,e,t)}window.setTimeout(_.cleanupPrerenderPreview)}isViewOnly(){let e=!1;return this.props.hasOwnProperty("shareToken")&&void 0!==this.props.shareToken&&(e=this.props.shareToken.linkType===T.SharedLinkType.Shmodel),e}renderImagePreview(e){const{file:t,mode:i,sidebar:r}=this.props,n=g.getExtension(t),o={mode:i||N.FileViewerMode.Default,sidebar:r};if(this.props.isFullscreen)return{preview:s.default.createElement(B,{currentMode:o,thumbnailUrlTmpl:e.thumbnail_url_tmpl,fileCount:this.props.count,fileIndex:this.props.index,onError:this.triggerError,onFlipNext:this.handleNext,onFlipPrevious:this.handlePrevious,filePreviewSession:this.props.filePreviewSession,contextMenuDisabled:this.shouldDisableDownload(),fileExtension:n,fileId:this.props.file.file_id||"",fileName:g.getFilename(this.props.file),setRenderStatusSuccess:this.props.setRenderStatusSuccess}),saveAsButton:null};const d={currentMode:o,"preview-url":e.thumbnail_url_tmpl,"file-extension":n,isFullscreen:this.props.isFullscreen,shouldDisplayToolbar:this.props.shouldDisplayToolbar&&!l.isLimitedPreview(t,a.PreviewType.Image),index:this.props.index,count:this.props.count,onPrevious:this.handlePrevious,onError:this.triggerError,onNext:this.handleNext,filePreviewSession:this.props.filePreviewSession,contextMenuDisabled:this.shouldDisableDownload(),nsId:this.props.file.ns_id,sjId:this.props.file.sjid,fileName:g.getFilename(this.props.file),sizeClass:this.props.sizeClass,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharePermission:this.props.sharePermission,user:this.props.user,file:this.props.file,shareToken:this.props.shareToken},c=f.getConversionsForPreview(t,this.props.user,this.props.shareToken,this.props.sharePermission);return{preview:s.default.createElement(S.PreviewImage,Object.assign({},d)),saveAsButton:c}}get shouldShowActionables(){return this.props.areActionablesEnabled&&!g.isArchiveFile(this.props.file)}renderVideoPreview(e){const{file:t,hidePageChrome:i}=this.props;return s.default.createElement(P.PreviewVideo,{title:g.getFilenameWithoutExtension(t),fileExtension:g.getExtension(t),previewUrl:e.transcode_url,separateResolutionUrls:e.transcode_urls_separate_resolutions,thumbnailUrlTmpl:e.poster_url_tmpl,videoMetadataUrl:e.metadata_url,videoContainer:e.container,shouldFocusOnReady:this.props.shouldFocusOnReady,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,sourceContext:this.props.sourceContext,vttThumbnailsUrl:e.thumb_scrubber_vtt_url,setRenderStatusSuccess:this.props.setRenderStatusSuccess,user:this.props.user,file:t,shareToken:this.props.shareToken,hidePageChrome:i,sharePermission:this.props.sharePermission})}renderLinkfilePreview(e){const{file:t}=this.props,i={url:e.url,authenticated:!!e.authenticated};return s.default.createElement(y.PreviewLinkfile,{filename:g.getFilename(t),data:i,source:e.authenticated?"browse":"sharedLink",filePreviewSession:this.props.filePreviewSession,setRenderStatusSuccess:this.props.setRenderStatusSuccess,index:this.props.index,count:this.props.count,onPrevious:this.handlePrevious,onNext:this.handleNext})}getCommonHtmlPreviewProps(){const{file:e}=this.props,t=g.getExtension(e);return{count:this.props.count,fileExtension:t,filePreviewSession:this.props.filePreviewSession,filename:g.getFilename(e),index:this.props.index,isFullscreen:this.props.isFullscreen,onClickNext:this.handleNext,onClickPrevious:this.handlePrevious,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharePermission:this.props.sharePermission,sizeClass:this.props.sizeClass}}renderHtmlifiedPreview(e){const{htmlified_link:t,uses_frame_messenger:i}=e;return t?s.default.createElement(E.PreviewHTML,Object.assign({src:t,isExcel:!1,usesFrameMessenger:i},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()}renderRawHtmlPreview(){const{preview_url:e}=this.props.previewApiData.data;return e?s.default.createElement(E.PreviewHTML,Object.assign({src:e,isExcel:!1,usesFrameMessenger:!1},this.getCommonHtmlPreviewProps())):this.renderUnsupportedErrorPreview()}renderAudioPreview(e){const{file:t}=this.props;return s.default.createElement(P.PreviewVideo,{title:g.getFilenameWithoutExtension(t),fileExtension:g.getExtension(t),previewUrl:e.transcode_url,videoContainer:e.container,filePreviewSession:this.props.filePreviewSession,shouldFocusOnReady:this.props.shouldFocusOnReady,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sourceContext:this.props.sourceContext,isAudio:!0,bytes:t.bytes,waveformUrl:e.waveform_url,user:this.props.user,file:t,shareToken:this.props.shareToken,sharePermission:this.props.sharePermission})}renderArchivePreview(){return s.default.createElement(k.PreviewArchiveLoadable,{rootFile:this.props.file,previewUrl:this.props.previewApiData.data.preview_url,fileSubpath:this.props.fileSubpath,filePreviewSession:this.props.filePreviewSession,onError:this.triggerError,setRenderStatusSuccess:this.props.setRenderStatusSuccess,sharedLinkUrl:this.props.sharedLinkUrl,user:this.props.user,encryptionOptions:this.props.encryptionOptions,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken})}renderCloudDocPreview(e){return s.default.createElement(h.CloudDocPreview,{file:this.props.file,user:this.props.user,cloudDoc:e,showCloudDocPreview:this.props.showCloudDocPreview,renderExcelPreview:this.renderExcelPreview,renderPdfPreview:this.renderPdfPreview,renderUnsupportedErrorPreview:this.renderUnsupportedErrorPreview,LoggedOutUXGoogleVariant:this.props.LoggedOutUXGoogleVariant})}renderErrorPreview(e){const{rivieraStatusCode:t}=this.state,{count:i,extensionsEnabled:r,file:n,previewApiData:a,filePreviewSession:o,index:l,isFullscreen:d,isMobileUserAgent:c,maxFilenameEmLength:u,mode:p,sharedLinkInfo:m,sharePermission:h,shareToken:f,user:_,encryptionOptions:w}=this.props,E=this.props.shouldDisplayToolbar&&!g.isArchiveFile(n);let S=e;return p===N.FileViewerMode.Watermarking&&(D.Snackbar.close(),S=v.ErrorType.WatermarkingError),s.default.createElement(b.PreviewError,{file:n,extensionsEnabled:r,preview:a.data,maxFilenameEmLength:u,filePreviewSession:o,errorType:S,user:_,areActionablesEnabled:this.shouldShowActionables,sharedLinkInfo:m,shareToken:f,sharePermission:h,shouldDisplayToolbar:E,index:l,isFullscreen:d,isMobileUserAgent:c,count:i,onPrevious:this.handlePrevious,onNext:this.handleNext,message:this.getErrorMessage(e,t,n),sizeClass:this.props.sizeClass,encryptionOptions:w})}getPreviewTypeWhitelist(){return this.props.previewTypeWhitelist||l.VALID_PREVIEW_TYPES}choosePreview(){const{file:e,previewApiData:t}=this.props,i=this.getPreviewTypeWhitelist(),r=this.validateFile(e,t);if(r)return{preview:r,saveAsButton:null};if(t.status===O.ApiClientStatus.Request)return{preview:this.showLoadingIndicator(),saveAsButton:null};if(t.status===O.ApiClientStatus.Error)return{preview:this.renderErrorPreview(v.ErrorType.ExtensionError),saveAsButton:null};if(!t.data||!t.data.content)return{preview:g.isArchiveFile(e)?this.renderErrorPreview(v.ErrorType.ExtensionError):this.renderErrorPreview(v.ErrorType.UnknownError),saveAsButton:null};const n=t.data.content,d=o.getPreviewType(t.data);if(l.isEmptyFile(e)&&d!==a.PreviewType.CloudDoc)return{preview:this.renderErrorPreview(v.ErrorType.EmptyFileError),saveAsButton:null};if(!(null==i||i.includes(d)))return{preview:this.renderErrorPreview(v.ErrorType.ExtensionError),saveAsButton:null};if(d===a.PreviewType.Restricted)return p.isUserOwnerOfFile(this.props.user,this.props.file)?{preview:this.renderErrorPreview(v.ErrorType.UpsellError),saveAsButton:null}:{preview:this.renderErrorPreview(v.ErrorType.ExtensionError),saveAsButton:null};switch(d){case a.PreviewType.Video:return{preview:this.renderVideoPreview(n),saveAsButton:null};case a.PreviewType.Audio:return{preview:this.renderAudioPreview(n),saveAsButton:null};case a.PreviewType.Archive:return{preview:this.renderArchivePreview(),saveAsButton:null};case a.PreviewType.Image:return this.renderImagePreview(n);case a.PreviewType.SsrDoc:return{preview:s.default.createElement(q,Object.assign({},this.props,{onPrevious:this.handlePrevious,onNext:this.handleNext,doc:n,renderUnsupportedErrorPreview:this.renderUnsupportedErrorPreview,triggerError:this.triggerError})),saveAsButton:null};case a.PreviewType.Linkfile:return{preview:this.renderLinkfilePreview(n),saveAsButton:null};case a.PreviewType.CloudDoc:return{preview:this.renderCloudDocPreview(n),saveAsButton:null};case a.PreviewType.Excel:return{preview:this.renderExcelPreview(),saveAsButton:null};case a.PreviewType.RawHTML:return{preview:this.renderRawHtmlPreview(),saveAsButton:null};case a.PreviewType.HTML:return{preview:this.renderHtmlifiedPreview(n),saveAsButton:null}}return{preview:void 0,saveAsButton:null}}validateFile(e,t){return e.is_dir&&!l.isSupportedBundleFile(e)?this.renderErrorPreview(v.ErrorType.ExtensionError):null!=e.ns_id||g.isArchiveFile(e)?g.isSymLink(e)?this.renderErrorPreview(v.ErrorType.SymLinkError):t?l.filesizeSupported(e,o.getPreviewType(t.data))?void 0:this.renderErrorPreview(v.ErrorType.FileSizeError):this.renderErrorPreview(v.ErrorType.ExtensionError):this.renderErrorPreview(v.ErrorType.PendingUploadError)}render(){const{file:e,previewApiData:t,sharedLinkInfo:i,shareToken:n,sharePermission:a,sizeClass:d,user:c,encryptionOptions:u}=this.props,{errorType:p,hasError:m}=this.state;if(m)return this.renderErrorPreview(p);const{preview:h,saveAsButton:f}=this.choosePreview();return s.default.createElement(s.default.Fragment,null,f,s.default.createElement("div",{className:r.default({"flex-preview-container":!0,"no-download":a&&0===a.canViewContextMenuRoles.length}),onContextMenu:this.onContextMenu,onCopy:this.onCopy},g.isArchiveFile(e)?null:s.default.createElement(F.FilePreviewPaasLoggerManager,{file:e}),h,t&&l.isLimitedPreview(e,o.getPreviewType(t.data))?s.default.createElement(W,{extension:g.getExtension(e),file:e,sharedLinkInfo:i,shareToken:n,sharePermission:a,shouldShowActionables:this.shouldShowActionables,sizeClass:d,user:c,encryptionOptions:u}):null))}}t.FilePreview=H,H.defaultProps={areActionablesEnabled:!0,isFullscreen:!1,sharePermission:null,setRenderStatusSuccess:n.noop,user:null},H.displayName="FilePreview",t.FilePreviewWithLogging=function(e){const{file:t,sourceAction:i,sourceContext:r,previewApiData:n,onPreviewSessionInitialized:a}=e;return s.default.createElement(F.FilePreviewSessionManager,{file:t,previewType:o.getPreviewType(n.data),sourceAction:i,sourceContext:r,extra:{FVSDK_ON:"false",preview_page_revamp:R.PREVIEW_PAGE_REVAMP?R.PREVIEW_PAGE_REVAMP:"NULL"},onPreviewSessionInitialized:a,render:t=>s.default.createElement(H,Object.assign({},e,{filePreviewSession:t}))})}})),define("modules/clean/react/file_viewer/file_preview_logging_manager",["require","exports","tslib","react","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/previews/constants","modules/clean/react/previews/frame_messenger_host","lodash"],(function(e,t,i,r,s,n,a,o,l,d,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilePreviewPaasLoggerManager=t.FilePreviewSessionManager=void 0,r=i.__importDefault(r),n=i.__importStar(n),u=i.__importStar(u);class p extends r.default.Component{constructor(e){super(e),this.setUpFilePreviewLogger=e=>{this.teardownFilePreviewLogger(),this.filePreviewTimelineLogger=new s.FilePreviewTimelineLogger(e),this.filePreviewTimelineLogger.listenTo(o.filePreviewEventEmitter),this.filePreviewUserActionLogger=new s.FilePreviewUserActionLogger,this.filePreviewUserActionLogger.listenTo(o.filePreviewEventEmitter),this.filePreviewModeLogger=new s.FilePreviewModeLogger,this.filePreviewModeLogger.listenTo(o.filePreviewEventEmitter),this.filePreviewSidebarLogger=new s.FilePreviewSidebarLogger,this.filePreviewSidebarLogger.listenTo(o.filePreviewEventEmitter),this.filePreviewUpsellLogger=new s.FilePreviewUpsellLogger,this.filePreviewUpsellLogger.listenTo(o.filePreviewEventEmitter),this.filePreviewConversionLogger=new s.FilePreviewConversionLogger,this.filePreviewConversionLogger.listenTo(o.filePreviewEventEmitter),this.fileConversionLogger=new s.FileConversionLogger,this.fileConversionLogger.listenTo(o.filePreviewEventEmitter)},this.teardownFilePreviewLogger=()=>{null!=this.filePreviewTimelineLogger&&this.filePreviewTimelineLogger.unlistenTo(o.filePreviewEventEmitter),null!=this.filePreviewUserActionLogger&&this.filePreviewUserActionLogger.unlistenTo(o.filePreviewEventEmitter),null!=this.filePreviewModeLogger&&this.filePreviewModeLogger.unlistenTo(o.filePreviewEventEmitter),null!=this.filePreviewSidebarLogger&&this.filePreviewSidebarLogger.unlistenTo(o.filePreviewEventEmitter),null!=this.filePreviewUpsellLogger&&this.filePreviewUpsellLogger.unlistenTo(o.filePreviewEventEmitter),null!=this.filePreviewConversionLogger&&this.filePreviewConversionLogger.unlistenTo(o.filePreviewEventEmitter),null!=this.fileConversionLogger&&this.fileConversionLogger.unlistenTo(o.filePreviewEventEmitter)},this.logPreviewSessionEnded=(e=d.PreviewSessionEndReason.Unknown)=>{const t={min_page_width_ratio:"",max_page_width_ratio:"",session_end_reason:e};this.state.filePreviewSession.recordEvent(a.EventType.FilePreviewSessionEnded,t)},this.getNewFilePreviewSession=({file:e,previewType:t,sourceAction:i,sourceContext:r,extra:s})=>{const n=new l.FilePreviewSession({file:e,previewType:t,fileViewerSession:l.FileViewerSession.currentSession,sourceAction:i,sourceContext:r,extra:s});return this.props.onPreviewSessionInitialized&&this.props.onPreviewSessionInitialized(n.id),l.FilePreviewSession.currentSession=n,this.setUpFilePreviewLogger(n.id),n.recordEvent(a.EventType.FilePreviewAttemptStarted,{window_width:`${window.innerWidth}`,window_height:`${window.innerHeight}`}),n},this.windowCloseHandler=()=>{this.logPreviewSessionEnded(d.PreviewSessionEndReason.BeforeUnload)};const t=this.getNewFilePreviewSession(this.props);this.state={filePreviewSession:t}}componentDidMount(){window.addEventListener("beforeunload",this.windowCloseHandler)}componentWillUnmount(){this.logPreviewSessionEnded(d.PreviewSessionEndReason.Unmount),this.teardownFilePreviewLogger(),window.removeEventListener("beforeunload",this.windowCloseHandler)}UNSAFE_componentWillReceiveProps(e){if(u.isEqual(e.file,this.props.file))return;this.logPreviewSessionEnded(d.PreviewSessionEndReason.NewFile);const t=this.getNewFilePreviewSession(e);this.setState({filePreviewSession:t})}render(){return this.props.render(this.state.filePreviewSession)}}t.FilePreviewSessionManager=p,p.displayName="FilePreviewSessionManager";class m extends r.default.Component{constructor(){super(...arguments),this.onFrameMessage=e=>{const{file:t}=this.props,{action:i,parameters:r}=e;"pagerendered"===i&&n.logPageRendered(t,r)},this.startLogger=()=>{this.frameMessenger=new c.PreviewFrameMessengerHost,this.frameMessenger.configureChildMessaging(".react-file-viewer__preview iframe",this.onFrameMessage,["pagerendered"]),this.frameMessenger.startListening()},this.stopLogger=()=>{this.frameMessenger.stopListening()}}componentDidMount(){this.startLogger()}componentWillUnmount(){this.stopLogger()}render(){return null}}t.FilePreviewPaasLoggerManager=m,m.displayName="FilePreviewPaasLoggerManager"})),define("modules/clean/react/file_viewer/file_viewer",["require","exports","tslib","classnames","keymaster","react","lodash","react-redux","modules/clean/react/comments2/components/mobile_web_comments","modules/clean/analytics","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/utils","modules/clean/loggers/file_viewer_logger","modules/clean/loggers/workflows_logger","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/react/file_sidebar/file_sidebar_provider","modules/clean/react/file_viewer/surface_existing_teams_header","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/app_download_interstitial/file_preview_app_download_interstitial","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/ml_experiment","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/file_viewer/exp_file_viewer_upsell_banner","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/location_utils","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer_sidebar/sidebar","modules/clean/react/watermarking/utils","modules/clean/pro_analytics/data/util","modules/clean/previews/data/preview_type_util","modules/clean/react/keyboard_binding/keyboard_binding_provider","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","ts-keycode-enum","modules/clean/react/location/with_location","modules/clean/react/components/modal","modules/clean/react/open_in_app/banner","modules/clean/react/previews/constants","modules/clean/react/size_class/constants","modules/clean/react/size_class/size_class","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/python","modules/core/browser","modules/core/browser_detection","modules/core/dom","modules/core/i18n","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/data/selectors","modules/clean/integrations/data/selectors","modules/clean/react/components/css","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/file_store/utils","spectrum-sharing/utils/sharing_constants","modules/clean/react/file_viewer_sidebar/data_managers/async_activity_data_manager","modules/clean/react/file_viewer_sidebar/data_managers/async_commenting_data_manager","modules/clean/react/file_viewer_sidebar/data_managers/async_pro_analytics_data_manager","modules/clean/react/workflows/i18n/with_translations","typescript/component_libraries/pro-ui/src/components/trial/banner/index","modules/clean/abuse/async_report_flag","modules/clean/react/file_viewer_titlebar/titlebar","typescript/libraries/file-viewer/src/core/data/modes/types","modules/clean/react/file_viewer/prompt/loadable_prompt","modules/clean/react/file_viewer/mode_manager","modules/clean/react/file_viewer_sidebar/buttons/more_dropdown","modules/clean/react/file_viewer_titlebar/edit_mode_titlebar","modules/clean/bug_reporting/routing","modules/clean/react/teams/team_discovery/data/logger","modules/clean/react/extensions/data/action_creators","dig-components/layer","modules/core/browser_detection","modules/constants/file_viewer","modules/clean/react/branding/branding_modal_controller","modules/clean/user_survey/user_survey","modules/clean/sharing/ui_util"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f,g,_,v,w,b,E,S,y,P,C,M,k,T,A,I,F,O,x,D,L,R,N,U,B,W,V,K,j,q,H,z,G,Y,X,J,Z,Q,$,ee,te,ie,re,se,ne,ae,oe,le,de,ce,ue,pe,me,he,fe,ge,_e,ve,we,be,Ee,Se,ye,Pe){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileViewer=t._FileViewer=void 0,r=i.__importDefault(r),s=i.__importDefault(s),n=i.__importDefault(n),a=i.__importStar(a),p=i.__importStar(p),f=i.__importStar(f),q=i.__importStar(q),H=i.__importStar(H),z=i.__importStar(z),Y=i.__importStar(Y),be=i.__importStar(be);let Ce="",Me="";class ke extends n.default.Component{constructor(){super(...arguments),this.state={modeClassnames:"",dismissedSETHeader:!1},this.previewSourceAction=this.props.initialPreviewSourceAction,this.previewSourceContext=this.props.initialPreviewSourceContext,this.fetchActiveUserBrandingInfo=()=>{const{user:e,sharedLinkInfo:t,brandingInfo:i}=this.props;i||t||!e||this.props.fetchActiveUserBrandingInfoAction(e)},this.fetchControllerMode=()=>{const{file:e,sharedLinkInfo:t,user:i,sizeClass:r}=this.props;this.props.fetchControllerModeAction({path:e.fq_path,shared_link_url:t&&t.url},i,r)},this.handleHelloSignDeepIntegrationLaunch=()=>{if(this.hellosignDeepIntegrationLauncher)return this.hellosignDeepIntegrationLauncher.then(e=>(e.launch(),e));{const{file:t,user:r}=this.props;return t&&ie.isBrowseFile(t)&&r?this.hellosignDeepIntegrationLauncher=new Promise((t,i)=>{e(["modules/clean/integrations/hellosign_deep_integration/launcher"],t,i)}).then(i.__importStar).then(({getLauncher:e})=>{const i=e();return i.init({entryPoint:"file_preview_side_bar",file:t,user:r}),i}).then(e=>(e.launch(),e)):Promise.resolve()}},this.handleHelloSignAppActionLaunch=()=>{const{file:t,updateLinkState:r,user:s}=this.props;t&&ie.isBrowseFile(t)&&s&&new Promise((t,i)=>{e(["modules/clean/react/app_actions/redirect"],t,i)}).then(i.__importStar).then(({redirectToActionOrShowAuth:n})=>{const{hellosignAppAction:a}=this.props;a&&(n(s,[t],a,{},void 0,(e,t)=>{r({actionId:e,linkState:t})}),new Promise((t,i)=>{e(["modules/clean/integrations/hellosign_deep_integration/logging"],t,i)}).then(i.__importStar).then(({logAppActionLaunch:e})=>{e(t,a)}))})},this.resetControllerMode=()=>{this.props.changeMode(ue.FileViewerMode.Default)},this.setupKeymaster=()=>{Ce=s.default.getScope(),s.default.setScope("fileviewer")},this.cleanupKeymaster=()=>{s.default.clearScope("fileviewer"),s.default.setScope(Ce)},this.shouldShowOpenInAppBanner=()=>{const{hidePageChrome:e,isMobileUserAgent:t}=this.props;return!e&&((t||G.is_mobile_or_tablet())&&(be.iOS||be.is_android())&&void 0!==this.getOpenInAppUrls())},this.openInAppBannerOnClick=function(){v.logUserAction(ee.UserAction.OpenInApp,ee.UserActionContext.OpenInAppBanner,{mobile_web_appbanner_color_experiment:Ee.MOBILE_WEB_BANNER_EXPERIMENT})},this.renderOverflowMenuFnFactory=e=>()=>{const{file:t,sharedLinkInfo:i,isVersionHistoryMode:r,shareToken:s,sharePermission:a,encryptionOptions:o}=this.props;if(i){if(t&&s&&a)return n.default.createElement(he.AsyncSharedFileMoreDropdown,{user:this.props.user,file:t,sizeClass:this.props.sizeClass,sharedLinkInfo:i,shouldDisplayActionButtons:!this.isViewingFileSubpath,shareToken:s,sharePermission:a,direction:e,encryptionOptions:o})}else{if(r)return null;if(this.props.user&&t)return n.default.createElement(he.AsyncMountedFileMoreDropdown,{user:this.props.user,file:t,sizeClass:this.props.sizeClass,direction:e})}return null},this.renderManagers=()=>{const{file:e,isVersionHistoryMode:t=!1,sharedLinkInfo:i,user:r}=this.props,s=null!=(null==e?void 0:e.ns_id),a=e;return n.default.createElement(n.default.Fragment,null,n.default.createElement(me.ModeManager,{isViewingFileSubpath:this.isViewingFileSubpath}),n.default.createElement(ne.AsyncCommentingDataManager,{currentFile:a,isVersionHistoryMode:t,sharedLinkInfo:i,user:r}),s&&n.default.createElement(se.AsyncActivityDataManager,{file:a,isVersionHistoryMode:t,user:this.props.user}),s&&!i&&F.isProAnalyticsEnabled(r)&&n.default.createElement(ae.AsyncProAnalyticsDataManager,{fileId:a.file_id,user:r}))},this.onTrialBannerClicked=()=>{m.logWorkflowsEvent(m.WorkflowsEvent.WatermarkUpsellHeaderButtonClicked,I.getWatermarkMilestone(this.props.user)),z.redirect("/buy?_tk=watermarking_header_upsell")},this.onInterstitialClose=()=>{this.props.onAppDownloadInterstitialDismissed()},this.onInterstitialContinue=()=>{this.props.onAppDownloadInterstitialDismissed()},this.getKeyboardBindings=a.memoize(({isFullscreen:e,isWatermarkingMode:t})=>e?[L.hydrateKeyboardBinding({keyboardEventCriteria:{which:R.Key.Escape},callback:()=>y.exitFullScreen(ee.UserActionContext.Keyboard)})]:t?[L.hydrateKeyboardBinding({keyboardEventCriteria:{which:R.Key.Escape},callback:()=>this.props.changeMode(ue.FileViewerMode.Documentation)})]:[L.hydrateKeyboardBinding({keyboardEventCriteria:{which:R.Key.F},callback:()=>y.enterFullScreen({logContext:ee.UserActionContext.Keyboard})}),L.hydrateKeyboardBinding({keyboardEventCriteria:{which:R.Key.Escape},callback:e=>{L.isKeyboardEvent(e)&&this.shouldIgnoreEscape(e)||null==this.props.onCloseViewer||this.props.onCloseViewer()}})])}UNSAFE_componentWillMount(){this.setUpLogging()}componentDidMount(){const{fetchShowOverQuotaUpsell:e,file:t,hasJoinableTeam:i,onComponentDidMount:r,user:s,docClassificationVariant:n,fetchDocClassificationAction:a,shareToken:o,sharePermission:l}=this.props;if(null!=r&&r(),this.setDocumentTitle(ie.getFilename(t),!0),Y.scroll_lock_document(),this.logView(),ye.UserSurvey.addAttribute("previewPageRevamp",Ee.PREVIEW_PAGE_REVAMP),ye.UserSurvey.trackEvent("preview_viewed","previews"),t&&o&&l&&setTimeout(()=>{Pe.trackReceiverUserLeapEvent(Pe.ReceiverUserLeapEvent.VIEWED_SHARED_FILE)},5e3),i){const{suggestTeamInfo:e}=this.props,t="1"===z.get_uri().getQuery().new_user;if(s){(new _e.Logger).logExposedToSETOnPreviewEvent(s.id,s.is_cdm_member,s.user_root_permissions,!!e,e?e.joinableTeam.id:void 0,e?e.joinableTeam.membersCount:void 0,t)}}e(s),s&&this.previewType&&!this.props.hidePageChrome&&this.props.fetchBestCampaignsAction(s,this.previewType),s&&t&&n&&E.ML_ENDPOINT_FETCH_TYPES.includes(n)&&a(s.id,t.file_id),this.fetchControllerMode(),this.fetchActiveUserBrandingInfo()}UNSAFE_componentWillUpdate(e){const t=e.file;if(t&&t!==this.props.file){this.setDocumentTitle(ie.getFilename(t)),this.previewSourceAction=W.PreviewSourceAction.Click,this.previewSourceContext=W.PreviewSourceContext.FileViewer;const{user:i,docClassificationVariant:r,fetchDocClassificationAction:s}=e;i&&r&&E.ML_ENDPOINT_FETCH_TYPES.includes(r)&&s(i.id,t.file_id)}s.default.setScope("fileviewer"),e.mode!==this.props.mode&&this.setState({modeClassnames:`state-${this.props.mode}-out state-${e.mode}-in`})}componentDidUpdate(e){ie.areFilesEqual(e.file,this.props.file)||this.logView(),e.previewApiData&&O.isImage(e.previewApiData.data)&&this.props.previewApiData&&!O.isImage(this.props.previewApiData.data)&&y.exitFullScreen(),this.props.onFullscreenChange&&e.isFullscreen!==this.props.isFullscreen&&this.props.onFullscreenChange(this.props.isFullscreen)}componentWillUnmount(){this.unsetDocumentTitle(),Y.scroll_unlock_document(),null!=this.props.onComponentWillUnmount&&this.props.onComponentWillUnmount(),U.Modal.close(),this.resetControllerMode()}get fileSubpath(){return this.props.location&&k.getFileSubpath(this.props.location)}get previewType(){return this.props.previewApiData&&f.getPreviewType(this.props.previewApiData.data)}get isViewingFileSubpath(){return f.isArchive(this.props.previewApiData.data)&&!!this.fileSubpath}shouldSuppressPassInfo(){return null==this.props.file.ns_id}setUpLogging(){if(T.FileViewerSession.currentSession=new T.FileViewerSession,this.props.fileViewTarget===H.FileViewTargetType.SHARED_CONTENT_LINK){const e=q.start_time(),t=(new Date).getTime(),i=re.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE;this.props.user&&d.ShareTibEventLogger.log(this.props.user.id,"PREVIEW_RENDER",i,{timing:t-e,containing_ns_id:this.props.file.ns_id,sjid:this.props.file.sjid})}}isDownloadDisabled(){return!(!this.props.sharePermission||!this.props.sharePermission.canDownloadRoles)&&0===this.props.sharePermission.canDownloadRoles.length}shouldShowAppDownloadInterstitial(){return!this.props.appDownloadInterstitialDismissed&&this.props.file.open_in_app_data}shouldIgnoreEscape(e){const t=document.querySelector(".vjs-fullscreen");return Y.focus_in_input()||Y.is_input(e.target)||document.querySelector(".annotation-bubble")||this.props.isFullscreen||this.fileSubpath||t||this.props.isEditMode||this.props.hidePageChrome}setDocumentTitle(e,t=!1){this.props.doNotUpdateDocumentTitle||(t&&(Me=document.title),document.title=e)}unsetDocumentTitle(){this.props.doNotUpdateDocumentTitle||""!==Me&&(document.title=Me)}logView(){if(null===this.props.file.ns_id||te.getSourceContext()===W.PreviewSourceContext.SharedLinkCollection||this.props.hidePageChrome)return;const e=()=>{p.logView(this.props.file,this.props.user,this.props.fileViewTarget,this.props.fileViewOrigin,this.props.fileViewAction,null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,this.isDownloadDisabled(),j.Viewer.get_viewer().is_assume_user_session)},t=u.getFileExt(this.props.file);c.isCloudDocByExtension(t)?setTimeout(()=>e(),c.CLOUD_DOCS_PASS_LOG_DELAY_MS):e()}isImagePreviewAnnotationEnabled(){return!(this.props.sizeClass===V.SizeClass.Small)&&!this.props.hidePageChrome}renderFlippableControls(){if(!(this.props.forceDisplayToolbar||this.props.isFullscreen||this.isImagePreviewAnnotationEnabled()||null==this.props.fileIndex||[h.PreviewType.Video,h.PreviewType.Audio].includes(this.previewType)||this.props.isEditMode))return n.default.createElement(M.FlippableControls,{index:`${this.props.fileIndex+1}`,numFlippableFiles:this.props.fileCount,onNext:this.props.onFlipNext,onPrevious:this.props.onFlipPrevious})}getOpenInAppUrls(){const{file:e,shareToken:t,sharePermission:i,user:r}=this.props;return te.getOpenInAppUrls(e,t,i,r)}renderFilePreview(){const{isEditMode:e,file:t,shareToken:i,sharePermission:s}=this.props;return n.default.createElement("div",{className:r.default("react-file-viewer__preview","react-file-preview",{"react-file-viewer__preview--edit-mode":e})},n.default.createElement("div",{className:"flex-preview-container"},this.renderReportFlag(),this.shouldShowOpenInAppBanner()&&n.default.createElement(B.OpenInAppBanner,{urls:this.getOpenInAppUrls(),onClick:this.openInAppBannerOnClick,isMountedFile:!(t&&i&&s)}),n.default.createElement(C.FilePreviewWithLogging,{areActionablesEnabled:!this.props.hidePageChrome&&null!=this.props.file.ns_id,count:this.props.fileCount,extensionsEnabled:this.props.extensionsEnabled,file:this.props.file,previewApiData:this.props.previewApiData,fileSubpath:this.fileSubpath,index:this.props.fileIndex,isFullscreen:this.props.isFullscreen,isMobileUserAgent:this.props.isMobileUserAgent,isSidebarOpen:this.props.isSidebarOpen,maxFilenameEmLength:ee.SizeClassFilenameLengthMap[this.props.sizeClass],onNext:this.props.onFlipNext,onPrevious:this.props.onFlipPrevious,sharedLinkInfo:this.props.sharedLinkInfo,location:this.props.location,sharePermission:this.props.sharePermission,shareToken:this.props.shareToken,shouldFocusOnReady:!1,sidebar:this.props.sidebar,sourceAction:this.previewSourceAction,sourceContext:this.previewSourceContext,sharedLinkUrl:null!=this.props.sharedLinkInfo?this.props.sharedLinkInfo.url:void 0,setRenderStatusSuccess:this.props.setRenderStatusSuccessForCurrentFile,shouldDisplayToolbar:this.isImagePreviewAnnotationEnabled()||this.props.forceDisplayToolbar,sizeClass:this.props.sizeClass,user:this.props.user,mode:this.props.mode,showCloudDocPreview:this.props.showCloudDocPreview,LoggedOutUXGoogleVariant:this.props.LoggedOutUXGoogleVariant,encryptionOptions:this.props.encryptionOptions,onPreviewSessionInitialized:this.props.onPreviewSessionInitialized}),this.renderFlippableControls()))}shouldRenderSidebar(){return this.props.sizeClass!==V.SizeClass.Small&&!this.props.isFullscreen&&!this.props.hidePageChrome&&null!=this.props.file.ns_id}renderSidebar(){if(!this.shouldRenderSidebar())return null;const{sizeClass:e,file:t,user:i,brandingInfo:s,activeUserBrandingInfo:a,sharedLinkInfo:o,hellosignAppAction:l,isVersionHistoryMode:d,shareToken:c,sharePermission:u,canRestoreRevision:p,onRestoreRevision:m,sidebar:h,encryptionOptions:f,isCapture:g}=this.props;return n.default.createElement("div",{className:r.default("react-file-viewer__sidebar",{"react-file-viewer__sidebar--closed":h.visibility===ue.SidebarVisibility.Closed}),"data-preview-type":this.previewType,"data-theme":"web"},n.default.createElement(A.Sidebar,{sizeClass:e,file:t,user:i,brandingInfo:null!=s?s:a,sharedLinkInfo:o,hellosignAppAction:l,isVersionHistoryMode:d,isViewingFileSubpath:!!this.isViewingFileSubpath,sharePermission:u,shareToken:c,previewType:this.previewType,isSeenStatesEnabled:!this.shouldSuppressPassInfo(),isCapture:g,onHelloSignAppActionLaunch:this.handleHelloSignAppActionLaunch,onHelloSignDeepIntegrationLaunch:this.handleHelloSignDeepIntegrationLaunch,canRestoreRevision:p,onRestoreRevision:m,renderSidebarOverflowMenuFn:this.renderOverflowMenuFnFactory(ee.OverflowMenuDirection.BELOW),encryptionOptions:f}))}shouldRenderMobileWebComments(){return this.props.sizeClass===V.SizeClass.Small}renderMobileComments(){const{file:e,sharedLinkInfo:t,sizeClass:i,user:r,isFullscreen:s}=this.props;return!this.shouldRenderMobileWebComments()||s||this.isViewingFileSubpath||this.props.hidePageChrome||null==e.ns_id?null:n.default.createElement(l.MobileWebComments,{currentFile:e,previewType:this.previewType,sharedLinkInfo:t,user:r,sizeClass:i,encryptionOptions:this.props.encryptionOptions})}renderBanner(){return n.default.createElement("div",{className:"react-file-viewer__banner"},this.renderUpsellBanner(),this.renderTrialBanner())}renderBrandingModalController(){const{brandingInfo:e,isFullscreen:t,hidePageChrome:i,file:r,sharedLinkInfo:s}=this.props;return t||i||!r||null===r.ns_id?null:n.default.createElement(Se.BrandingModalController,{brandingInfo:e,closeButtonText:X.intl.formatMessage({id:"D/tUrq",defaultMessage:"View file"}),sharedLinkInfo:s})}renderTitleBar(){return this.props.isFullscreen||this.props.hidePageChrome&&!f.isArchive(this.props.previewApiData.data)?null:this.props.mode===ue.FileViewerMode.Watermarking?n.default.createElement(fe.EditModeTitlebar,{user:this.props.user,file:this.props.file,maxFilenameEmLength:ee.SizeClassFilenameLengthMap[this.props.sizeClass],title:X.intl.formatMessage({id:"TJfgIg",defaultMessage:"Watermarking"}),mode:ue.FileViewerMode.Watermarking,sizeClass:this.props.sizeClass}):this.props.mode===ue.FileViewerMode.Markup?n.default.createElement(fe.EditModeTitlebar,{user:this.props.user,file:this.props.file,maxFilenameEmLength:ee.SizeClassFilenameLengthMap[this.props.sizeClass],title:X.intl.formatMessage({id:"PSIegi",defaultMessage:"Markup"}),beta:!0,mode:ue.FileViewerMode.Markup,sizeClass:this.props.sizeClass}):n.default.createElement(ce.FileTitleBar,{file:this.props.file,maxFilenameEmLength:ee.SizeClassFilenameLengthMap[this.props.sizeClass],isViewingFileSubpath:this.isViewingFileSubpath,user:this.props.user||null,isSidebarOpen:this.props.sidebar.visibility===ue.SidebarVisibility.Open,closeUrl:this.props.titleBarCloseUrl,onClose:this.props.onCloseViewer,canClose:this.props.canClose,hidePageChrome:this.props.hidePageChrome,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,isVersionHistoryMode:this.props.isVersionHistoryMode,sharedLinkInfo:this.props.sharedLinkInfo,fileSubpath:this.fileSubpath,previewType:this.previewType,renderTitlebarOverflowMenuFn:this.renderOverflowMenuFnFactory(ee.OverflowMenuDirection.BELOW)})}renderReportFlag(){return this.props.sharedLinkInfo&&!1!==this.props.sharedLinkInfo.hasPublicAudienceOrVisibility&&!this.props.hidePageChrome?n.default.createElement(de.AsyncReportFlag,{sharedLink:this.props.sharedLinkInfo.url,previewType:this.previewType}):null}renderUpsellBanner(){return this.props.showOverQuotaUpsell?n.default.createElement(P.ExpFileViewerUpsellBannerV2,null):null}renderTrialBanner(){const{mode:e,isTrialMode:t}=this.props;return t?n.default.createElement(le.Banner,{mode:e,onClick:this.onTrialBannerClicked}):null}shouldRenderSETHeader(){return!(this.state.dismissedSETHeader||!this.props.suggestTeamInfo||!this.props.user||this.props.hidePageChrome||this.props.sizeClass===V.SizeClass.Small)}renderSETHeader(){if(this.shouldRenderSETHeader()){const{suggestTeamInfo:e,user:t}=this.props;if(e&&t)return n.default.createElement(_.SurfaceExistingTeamsHeader,{suggestTeamInfo:e,user:t,dismissHeader:()=>this.setState({dismissedSETHeader:!0})})}return null}renderExperimentHeader(){return this.renderSETHeader()}render(){const{className:e,file:t,hidePageChrome:i,isFullscreen:s,sharedLinkInfo:a,transparentBackground:o,user:l,isEditMode:d=!1,isWatermarkingMode:c=!1,campaign:u}=this.props,p=ie.getFilename(t),m=this.previewType;return this.shouldShowAppDownloadInterstitial()?n.default.createElement(ge.RegisterComponentWithBugReporter,{componentId:"web.previews",componentName:"File Preview"},n.default.createElement("div",{"aria-label":p},n.default.createElement(w.FilePreviewAppDownloadInterstitial,{sharedLinkInfo:a,file:t,previewType:m,fileViewerSession:T.FileViewerSession.currentSession,previewSourceAction:this.previewSourceAction,previewSourceContext:this.previewSourceContext,onClose:this.onInterstitialClose,onContinue:this.onInterstitialContinue}))):n.default.createElement(we.LayerContext.Provider,{value:500},n.default.createElement(ge.RegisterComponentWithBugReporter,{componentId:"web.previews",componentName:"File Preview"},n.default.createElement(x.KeyboardBindingProvider,{onDestroy:this.cleanupKeymaster,onSetup:this.setupKeymaster},n.default.createElement(Te,{ns_id:t.ns_id},n.default.createElement("div",{"aria-label":p,className:r.default("react-file-viewer",`preview-type-${this.previewType?this.previewType.toLowerCase():"unknown"}`,e,this.state.modeClassnames,{"no-background":o&&!s,"react-file-viewer--edit-mode":d}),style:{top:this.props.hidePageChrome&&!this.props.isFullscreen?this.props.headerHeight:"0"},role:"dialog"},this.renderExperimentHeader(),n.default.createElement(D.KeyboardBindingConnector,{keyboardBindings:this.getKeyboardBindings({isFullscreen:s,isWatermarkingMode:c})}),this.renderBanner(),n.default.createElement("div",{className:"react-file-viewer__main"},u&&l&&!i?n.default.createElement(pe.FileViewerPrompt,{user:l,campaign:u}):null,n.default.createElement("div",{className:r.default("react-file-viewer__content","comments2",{"comments2-mobile-web":this.shouldRenderMobileWebComments(),"comments2-annotation-enabled":!0,"video-audio":this.previewType===h.PreviewType.Video||this.previewType===h.PreviewType.Audio,"react-file-viewer__content--edit-mode":d}),"data-preview-type":m,"data-theme":"web"},this.renderTitleBar(),this.renderFilePreview(),this.renderMobileComments(),this.renderManagers(),this.renderBrandingModalController()),this.renderSidebar()))))))}}t._FileViewer=ke,ke.defaultProps={canClose:!1,canRestoreRevision:!1,className:"",hideComments:!1,hidePageChrome:!1,isVersionHistoryMode:!1,forceFileUnlocked:!1,oref:H.OREF_CONSTANTS.BROWSE_UNKNOWN,sizeClass:V.SizeClass.Large,fileCount:0,showCloudDocPreview:!1},ke.displayName="FileViewer";const Te=({children:e,ns_id:t})=>null==t?n.default.createElement(n.default.Fragment,null,e):n.default.createElement(g.FileSidebarProvider,null,e),Ae=N.withLocation(e=>{const{file:t}=e;return null!=t?n.default.createElement(ke,Object.assign({},e)):n.default.createElement("div",null)}),Ie=K.withSizeClass(Ae,{isResponsiveEnabled:te.isResponsiveEnabled,responsiveClassName:ee.ResponsiveClassName}),Fe=oe.withTranslations(Ie),Oe={onAppDownloadInterstitialDismissed:b.dismissAppDownloadInterstitial,fetchShowOverQuotaUpsell:b.fetchShowOverQuotaUpsell,setRenderStatusSuccessForCurrentFile:b.setRenderStatusSuccessForCurrentFile,fetchControllerModeAction:b.fetchControllerModeAction,fetchActiveUserBrandingInfoAction:b.fetchActiveUserBrandingInfoAction,fetchBestCampaignsAction:b.fetchBestCampaignsAction,fetchDocClassificationAction:b.fetchDocClassificationAction,changeMode:b.changeMode,updateLinkState:ve.updateLinkState},xe=o.connect((e,t)=>{let i=J.getAppDownloadInterstitial(e);void 0===i&&t&&(i=t.appDownloadInterstitialDismissed);const r=J.getActiveFile(e);return{appDownloadInterstitialDismissed:i,file:r,hellosignAppAction:(()=>{if(r)return J.getHelloSignAppActionForFile(e,r)})(),mode:J.getMode(e),isFullscreen:J.getIsFullScreen(e),isSidebarOpen:J.getIsSidebarOpen(e),renderStatus:J.getRenderStatusForCurrentFile(e),showOverQuotaUpsell:J.getShowOverQuotaUpsell(e),sidebar:J.getSidebar(e),isEditMode:J.getIsEditMode(e),isWatermarkingMode:J.getIsWatermarkingMode(e),isTrialMode:J.getIsTrialMode(e),campaign:J.getSelectedPromptCampaign(e),activeUserBrandingInfo:J.getActiveUserBrandingInfo(e),previewApiData:Z.getApiDataForFile(e,r),extensionsEnabled:J.getExtensionsEnabled(e),docClassificationVariant:(()=>{if(!r)return null;const t=ie.getExtension(r);return t&&!1!==E.ML_EXPERIMENT_EXTENSIONS.includes(t)&&(Q.isHelloSignAppActionInFileViewerSidebarEnabled(e)||Q.isHelloSignDeepIntegrationInFileViewerSidebarEnabled(e))&&Q.isHelloSignMLClassificationEnabled(e)?Q.getHelloSignMLClassificationVariant(e):null})()}},Oe)(Fe),De=S.getStoreForFileViewer(),Le=$.requireCssWithComponent(e=>n.default.createElement(o.Provider,{store:De},n.default.createElement(xe,Object.assign({},e))),["/static/css/preview_flexbox_layout-vflNFyVwu.css","/static/css/react_file_viewer-vfl419ufQ.css","/static/css/react_title_bar-vflbikD6O.css","/static/css/spectrum/index.web-vfliw9181.css","/static/js/typescript/libraries/file-viewer/src/index.web-vfl9bj7wa.css","/static/js/typescript/component_libraries/pro-ui/src/index.web-vfl7fyKnY.css"]);t.FileViewer=Le})),define("modules/clean/react/file_viewer/flippable_controls",["require","exports","tslib","react","modules/clean/react/sprite","modules/core/i18n"],(function(e,t,i,r,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FlippableControls=void 0,r=i.__importDefault(r);class a extends r.default.Component{constructor(){super(...arguments),this.handlePreviousClick=()=>{this.props.onPrevious&&this.props.onPrevious()},this.handleNextClick=()=>{this.props.onNext&&this.props.onNext()}}getNavText(){return n.intl.formatMessage({id:"CQTi9x",defaultMessage:"{cur_file_num} of {num_total_files}"},{cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})}render(){if(this.props.numFlippableFiles<=1)return null;const e=n.intl.formatMessage({id:"J7UPY9",defaultMessage:"Flip left"}),t=n.intl.formatMessage({id:"vVU6YH",defaultMessage:"Flip right"});return r.default.createElement("div",{className:"react-file-viewer__controls"},r.default.createElement("button",{className:"nav-control",onClick:this.handlePreviousClick},r.default.createElement(s.Sprite,{group:"web",name:"s_flip_left",alt:e})),r.default.createElement("div",{className:"nav-text"},this.getNavText()),r.default.createElement("button",{className:"nav-control",onClick:this.handleNextClick},r.default.createElement(s.Sprite,{group:"web",name:"s_flip_right",alt:t})))}}t.FlippableControls=a,a.displayName="FlippableControls"})),define("modules/clean/react/file_viewer/full_screen_helpers",["require","exports","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants"],(function(e,t,i,r,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toggleFullScreen=t.isBrowserFullScreen=t.browserSupportFullScreen=t.exitFullScreen=t.enterFullScreen=void 0;const a=i.getStoreForFileViewer(),o=()=>a.dispatch(r.closeFullScreen());let l=o;function d(){f()||h(n.UserActionContext.Browser)}function c(){h(n.UserActionContext.Browser)}function u(){var e;e=d,document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("mozfullscreenchange",e),(function(e){window.addEventListener("popstate",e)})(c)}function p(){var e;e=d,document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("mozfullscreenchange",e),(function(e){window.removeEventListener("popstate",e)})(c)}function m({dispatchFunction:e,logContext:t,shouldDispatchReduxAction:i=!0}){(function(e=o){l=e})(e),i&&a.dispatch(r.openFullScreen()),(function(){const e=document.body;null!=e.requestFullscreen?e.requestFullscreen():null!=e.msRequestFullscreen?e.msRequestFullscreen():null!=e.mozRequestFullScreen?e.mozRequestFullScreen():null!=e.webkitRequestFullscreen&&e.webkitRequestFullscreen()})(),u(),t&&s.logUserAction(n.UserAction.ToggleFullscreenOn,t)}function h(e){p(),l(),(function(){const e=document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()})(),e&&s.logUserAction(n.UserAction.ToggleFullscreenOff,e)}function f(){const e=document;return null!=e.fullScreen?e.fullScreen:null!=e.webkitIsFullScreen?e.webkitIsFullScreen:null!=e.mozFullScreen?e.mozFullScreen:null!=e.msFullscreenElement||null!=e.fullscreenElement}t.enterFullScreen=m,t.exitFullScreen=h,t.browserSupportFullScreen=function(){const e=document.body;return e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen},t.isBrowserFullScreen=f,t.toggleFullScreen=function(e,t){return e||f()?h(t):m({logContext:t})}})),define("modules/clean/react/file_viewer/mode_manager",["require","exports","tslib","react","react-redux","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/data/actions","typescript/libraries/file-viewer/src/core/data/modes/types"],(function(e,t,i,r,s,n,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ModeManager=t.UnconnectedModeManager=void 0,r=i.__importDefault(r);class l extends r.default.PureComponent{componentDidUpdate(){this.unavailableModes()[this.props.mode]&&this.props.mode!==o.FileViewerMode.Default&&this.props.changeMode(o.FileViewerMode.Default)}unavailableModes(){const e=Object.assign({},this.props.disabledModes);return this.props.isViewingFileSubpath&&(e[o.FileViewerMode.Commenting]=!0),e}render(){return null}}t.UnconnectedModeManager=l,l.displayName="UnconnectedModeManager",t.ModeManager=s.connect(e=>({mode:n.getMode(e),disabledModes:n.getDisabledModes(e)}),{changeMode:a.changeMode})(l)}));var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer/open_button/open_button",["require","exports","modules/clean/react/async/loadable"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenButton=void 0,t.OpenButton=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer/open_button/open_button_component"],t,i)}).then(__importStar).then(({OpenButton:e})=>e)})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer/prompt/loadable_prompt",["require","exports","modules/clean/react/async/loadable"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileViewerPrompt=void 0,t.FileViewerPrompt=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer/prompt/prompt"],t,i)}).then(__importStar).then(({SyncFileViewerPrompt:e})=>e)})})),define("modules/clean/react/file_viewer/utils",["require","exports","tslib","react","modules/clean/deprecated_ajax/ajax_jquery","modules/core/browser","modules/clean/previews/constants","modules/clean/react/file_viewer/constants","modules/clean/file_store/utils","modules/clean/previews/data/preview_type_util","modules/core/uri","modules/clean/react/previews/constants","modules/clean/react/previews/image_helpers","modules/clean/previews/api","modules/clean/auth/login_or_register/types","typescript/libraries/file-viewer/src/core/config","modules/constants/file_viewer","modules/core/browser_detection","modules/constants/python"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f,g,_,v){"use strict";function w(){return new c.URI({path:"/login",query:{cont:n.get_href()}}).toString()}function b(e){return!e}function E(e){if(e)switch(e){case v.FileViewOriginType.BROWSE:return u.PreviewSourceContext.Browse;case v.FileViewOriginType.COLLECTIONS:return u.PreviewSourceContext.Collections;case v.FileViewOriginType.COMMERCE:return u.PreviewSourceContext.Commerce;case v.FileViewOriginType.HELLOSIGN:return u.PreviewSourceContext.Hellosign;case v.FileViewOriginType.HOME:return u.PreviewSourceContext.Home;case v.FileViewOriginType.PHOTOS:return u.PreviewSourceContext.Photos;case v.FileViewOriginType.RECENTS:return u.PreviewSourceContext.Recents;case v.FileViewOriginType.SEARCH:return u.PreviewSourceContext.Search;case v.FileViewOriginType.STARRED:return u.PreviewSourceContext.Starred;case v.FileViewOriginType.TRANSFER:return u.PreviewSourceContext.Transfer}const t=n.get_uri().path;return/^\/h$/.test(t)?u.PreviewSourceContext.Home:/^\/starred$/.test(t)?u.PreviewSourceContext.Starred:/^\/recents$/.test(t)?u.PreviewSourceContext.Recents:/^\/search$/.test(t)?u.PreviewSourceContext.Search:/^\/(s|scl\/fi)\//.test(t)?u.PreviewSourceContext.SharedLinkFile:/^\/(sh|scl\/fo)\//.test(t)?u.PreviewSourceContext.SharedLinkFolder:/^\/sc\//.test(t)?u.PreviewSourceContext.SharedLinkCollection:/^\/history/.test(t)?u.PreviewSourceContext.VersionHistory:/^\/(home|work|personal)/.test(t)?u.PreviewSourceContext.Browse:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.getOpenInAppUrls=t.showAuthModal=t.isResponsiveEnabled=t.fetchRivieraStatusCode=t.isFvsdkPdfEditorEnabled=t.isPaperEmbedEnabled=t.isMobileWebRevampEnabled=t.isPreviewPageRevampEnabled=t.preloadImages=t.getSourceAction=t.getSourceContext=t.canUserUsePaper=t.canDownloadFile=t.isFileEditable=t.isMountedFile=t.getFileViewerInterfaceTypeForSharedLink=t.sharedLinkLoginUrl=t.getSharedLinkLoginUrl=t.cleanupPrerenderPreview=t.modalIsUp=t.getSplitButtonUserActionContext=t.TooltipHelpers=void 0,r=i.__importDefault(r),s=i.__importStar(s),n=i.__importStar(n),p=i.__importStar(p),_=i.__importStar(_),t.TooltipHelpers={fetchTooltipInfo:function(e,t){s.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:e=>t(e),subject_user:e})},getVendorAndApplication:function(e,t){for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];for(const e in r)if(r.hasOwnProperty(e)){if(r[e].extensions.indexOf(t)>-1)return{vendor:i,application:e}}}return null},logImpression:function(e,t,i){"acrobat_or_reader"===i?s.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:i,extension:e},subject_user:t}):s.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:i,extension:e},subject_user:t})}},t.getSplitButtonUserActionContext=function(e,t){if(e===o.SplitButtonActionLocation.Main){if(t===o.FileViewerPane.TitleBar)return o.UserActionContext.TitleBarMain;if(t===o.FileViewerPane.PreviewContent)return o.UserActionContext.PreviewContentMain}else if(e===o.SplitButtonActionLocation.Split){if(t===o.FileViewerPane.TitleBar)return o.UserActionContext.TitleBarSplitButton;if(t===o.FileViewerPane.PreviewContent)return o.UserActionContext.PreviewContentSplitButton}return o.UserActionContext.Unknown},t.modalIsUp=function(){let e=!1;const t=document.getElementsByClassName("db-modal-wrapper");for(let i=0;!e&&i<t.length;i++){e="none"!==window.getComputedStyle(t[i]).display}return e},t.cleanupPrerenderPreview=function(){const e=document.querySelectorAll(".prerender-preview");Array.prototype.forEach.call(e,e=>{e.style.display="none"})},t.getSharedLinkLoginUrl=w,t.sharedLinkLoginUrl=w(),t.getFileViewerInterfaceTypeForSharedLink=function(e){switch(e){case a.PreviewType.Image:return o.FileViewerInterfaceType.Window;case a.PreviewType.SsrDoc:return o.FileViewerInterfaceType.Frame;default:return}},t.isMountedFile=b,t.isFileEditable=e=>!!e&&(l.isBrowseFile(e)&&!e.read_only),t.canDownloadFile=function(e,t){return b(e)||t&&t.canDownloadRoles.length>0},t.canUserUsePaper=function(e){return null!=e&&!e.is_paper_disabled},t.getSourceContext=E,t.getSourceAction=function(){switch(E()){case u.PreviewSourceContext.SharedLinkFile:case u.PreviewSourceContext.SharedLinkFolder:return u.PreviewSourceAction.Visit;default:return u.PreviewSourceAction.Click}},t.preloadImages=function(e,t){if(0===e.length)return;const i=[];[0,1,2,3,4,5,6,-1,-2].forEach((function(r){const s=(t+r+e.length)%e.length;-1===i.indexOf(s)&&i.push(s)})),i.forEach((function(t){if(e.length>t&&d.isImage(e[t])){const i=e[t];if(i){const e=i.content.thumbnail_url_tmpl||i.preview_url;e&&p.preloadResponsiveImage(e)}}}))};const S=["ON","AD_FREE","EXPOSED"];t.isPreviewPageRevampEnabled=()=>S.includes(g.PREVIEW_PAGE_REVAMP);const y=["SIGNUP","DOWNLOAD"];t.isMobileWebRevampEnabled=()=>_.is_supported_mobile_browser()&&y.includes(g.MOBILE_WEB_FVSDK_VARIANT),t.isPaperEmbedEnabled=()=>g.ENABLE_FVSDK_PAPER_EMBED;const P=["ON"];t.isFvsdkPdfEditorEnabled=()=>P.includes(g.ENABLE_FVSDK_PDF_EDITOR),t.fetchRivieraStatusCode=(e,t,i=(()=>{}))=>{const r=new XMLHttpRequest;return r.open("GET",e),r.withCredentials=!0,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){const e=m.getParsedDropboxMetadataHeader(r);e.rivieraStatusCode?t(e.rivieraStatusCode):i()}},r.send(),r},t.isResponsiveEnabled=function(){return E()!==u.PreviewSourceContext.VersionHistory};const C={[f.AuthMode.LOGIN]:h.Mode.LOGIN,[f.AuthMode.REGISTER]:h.Mode.REGISTER},M={[f.LoginOrRegisterKind.COMMENT]:h.LoginOrRegisterKind.COMMENT,[f.LoginOrRegisterKind.DOWNLOAD]:h.LoginOrRegisterKind.DOWNLOAD,[f.LoginOrRegisterKind.IMMEDIATE]:h.LoginOrRegisterKind.IMMEDIATE,[f.LoginOrRegisterKind.POSTDOWNLOAD]:h.LoginOrRegisterKind.POSTDOWNLOAD,[f.LoginOrRegisterKind.SIDEBAR]:h.LoginOrRegisterKind.SIDEBAR},k={[f.CommentTextVariant.DEFAULT]:h.CommentTextVariant.DEFAULT,[f.CommentTextVariant.POST]:h.CommentTextVariant.POST,[f.CommentTextVariant.SUBSCRIBE]:h.CommentTextVariant.SUBSCRIBE};t.showAuthModal=function({mode:t,kind:s,sharedLinkUrl:n,encryptionOptions:a,commentParams:o,loggingExtra:l}){return i.__awaiter(this,void 0,void 0,(function*(){const[{Modal:d},{LoginOrRegisterModal:c}]=yield Promise.all([new Promise((t,i)=>{e(["modules/clean/react/components/modal"],t,i)}).then(i.__importStar),new Promise((t,i)=>{e(["modules/clean/auth/login_or_register/modal"],t,i)}).then(i.__importStar)]);d.showInstance(r.default.createElement(c,{downloadAction:null,id:"shared-link-immediate-signup-modal",initialMode:C[t],kind:M[s],onCancel:()=>{},onAuthenticateSuccess:()=>window.location.reload(),commentParams:o?{stream:o.stream,variant:k[o.variant]}:void 0,signup_tag:"shmodel_modal_register",showGoogleRegistration:!0,googleRegisterProps:n?{signupContinuationUrl:n}:void 0,encryptionOptions:a,loggingExtra:l}))}))},t.getOpenInAppUrls=function(e,t,i,r){if(e&&t&&i)return e.open_in_app_data;if(_.iOS&&r){const t=encodeURIComponent(e.fq_path),i=encodeURIComponent(r.id);return{platform:g.OpenInMobileAppPlatform.IPHONE,iOSAppUrl:`dbapi-5://1/viewPath?path=${t}&userId=${i}`,iOSAppStoreUrl:"https://itunes.apple.com/us/app/dropbox/id327630330?mt=8e"}}if(_.is_android()){const e="/dl/home/mobile?mobile_app_fallback";return{platform:g.OpenInMobileAppPlatform.ANDROID_MARKET,androidAppUrl:e}}}})),define("modules/clean/react/file_viewer_sidebar/buttons/icon",["require","exports","tslib","react","spectrum/icon_action/index","spectrum/colorized_icon/index"],(function(e,t,i,r,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonIcon=void 0,r=i.__importDefault(r);t.ButtonIcon=e=>{var{isPrimary:t}=e,a=i.__rest(e,["isPrimary"]);return r.default.createElement(n.ColorizedIcon,{color:t?"white":"#717781"},r.default.createElement(s.IconAction,Object.assign({},a)))},t.ButtonIcon.displayName="ButtonIcon"}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/buttons/more_dropdown",["require","exports","modules/clean/react/async/loadable"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncMountedFileMoreDropdown=t.AsyncSharedFileMoreDropdown=void 0,t.AsyncSharedFileMoreDropdown=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer/shared_file_actions"],t,i)}).then(__importStar).then(({SharedFileMoreDropdown:e})=>e)}),t.AsyncMountedFileMoreDropdown=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer/mounted_file_actions"],t,i)}).then(__importStar).then(({MountedFileMoreDropdown:e})=>e)})})),define("modules/clean/react/file_viewer_sidebar/buttons/mounted_file_actions",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/file_viewer/open_button/open_button"],(function(e,t,i,r,s,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncExtensionsButton=t.AsyncOpenButton=t.AsyncSpacesDropdown=t.AsyncShareButton=void 0,r=i.__importDefault(r),t.AsyncShareButton=s.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer/share_button"],t,i)}).then(i.__importStar).then(({ShareButton:e})=>e)}),t.AsyncSpacesDropdown=s.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer/spaces_dropdown"],t,i)}).then(i.__importStar).then(({SpacesDropdown:e})=>e)}),Object.defineProperty(t,"AsyncOpenButton",{enumerable:!0,get:function(){return a.OpenButton}}),t.AsyncExtensionsButton=e=>r.default.createElement("div",{className:"control__button"},r.default.createElement(n.ExtensionsMenu,Object.assign({},e))),t.AsyncExtensionsButton.displayName="AsyncExtensionsButton"}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/buttons/shared_file_actions",["require","exports","modules/clean/react/async/loadable","modules/clean/react/share_download/button"],(function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncShareDownloadButton=t.AsyncOpenInAppButton=t.AsyncExtensionsMenuNoUnity=t.AsyncSignInButton=t.AsyncEditNowButton=void 0,t.AsyncEditNowButton=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/cloud_docs/edit_now_button"],t,i)}).then(__importStar).then(({EditNowButton:e})=>e)}),t.AsyncSignInButton=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/sign_in/button"],t,i)}).then(__importStar).then(({SignInButton:e})=>e)}),t.AsyncExtensionsMenuNoUnity=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/extensions/extensions_menu_component_v2"],t,i)}).then(__importStar).then(({ExtensionsMenuV2NoUnity:e})=>e)}),t.AsyncOpenInAppButton=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/open_in_app/button"],t,i)}).then(__importStar).then(({OpenInAppButton:e})=>e)}),Object.defineProperty(t,"AsyncShareDownloadButton",{enumerable:!0,get:function(){return r.ShareDownloadButton}})})),define("modules/clean/react/file_viewer_sidebar/buttons/version_history_file_actions",["require","exports","tslib","react","classnames","spectrum/button/index","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/core/i18n"],(function(e,t,i,r,s,n,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RestoreButton=void 0,r=i.__importDefault(r),s=i.__importDefault(s),t.RestoreButton=e=>{const t=o.intl.formatMessage({id:"PL5ta5",defaultMessage:"Restore"});return r.default.createElement(n.Button,{variant:"primary",className:s.default("control__button","restore-button",{"control__button--collapsed":e.isCollapsed}),onClick:e.onClick},e.isCollapsed?r.default.createElement(a.ButtonIcon,{isPrimary:!0,name:"restore-file","aria-label":t}):t)},t.RestoreButton.displayName="RestoreButton"}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/data_managers/async_activity_data_manager",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncActivityDataManager=void 0,t.AsyncActivityDataManager=i.Loadable({loader:()=>r.waitForTTI().then(()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer_sidebar/data_managers/activity_data_manager"],t,i)}).then(__importStar)).then(e=>e.ActivityDataManager)})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/data_managers/async_commenting_data_manager",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncCommentingDataManager=void 0,t.AsyncCommentingDataManager=i.Loadable({loader:()=>r.waitForTTI().then(()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer_sidebar/data_managers/commenting_data_manager"],t,i)}).then(__importStar)).then(e=>e.CommentingDataManager)})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/data_managers/async_pro_analytics_data_manager",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncProAnalyticsDataManager=void 0,t.AsyncProAnalyticsDataManager=i.Loadable({loader:()=>r.waitForTTI().then(()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer_sidebar/data_managers/pro_analytics_data_manager"],t,i)}).then(__importStar)).then(e=>e.ProAnalayticsDataManager)})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/esign_upsell/async_esign_upsell",["require","exports","modules/clean/react/async/loadable"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncEsignUpsell=void 0,t.AsyncEsignUpsell=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer_sidebar/esign_upsell/esign_upsell"],t,i)}).then(__importStar).then(({EsignUpsell:e})=>e)})})),define("modules/clean/react/file_viewer_sidebar/esign_upsell/esign_upsell",["require","exports","tslib","react","dig-components/typography","dig-components/buttons","modules/core/i18n","modules/clean/react/components/css","react","modules/clean/react/file_viewer_sidebar/esign_upsell/use_show_esign_upsell"],(function(e,t,i,r,s,n,a,o,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EsignUpsell=void 0,r=i.__importStar(r);const c=({isCollapsed:t,userId:o,file:c,launchHelloSignDeepIntegration:u})=>{const[p,m]=l.useState(!1),h=l.useRef(!0);r.useEffect(()=>(h.current=!0,()=>{h.current=!1}));const{showEsignUpsell:f,stormcrowVariant:g,productPlanType:_}=d.useShowEsignUpsell(o,c);return t||p||!f?null:r.createElement("div",{className:"esign-upsell-dialog"},r.createElement(s.Title,{size:"standard",isBold:!0},a.intl.formatMessage({id:"14Lkt7",defaultMessage:"Collect signatures on your documents right from Dropbox"})),r.createElement(s.Text,{className:"esign-upsell-subtext",tagName:"p",isBold:!0},"PLUS"===_?a.intl.formatMessage({id:"Chr0Rd",defaultMessage:"Add e-sign to your plan and upgrade to Professional"}):a.intl.formatMessage({id:"jA1VlD",defaultMessage:"Add eSign to your plan"})),r.createElement(s.Text,{className:"esign-upsell-subtext",tagName:"p"},r.createElement("li",null,a.intl.formatMessage({id:"tIBR0E",defaultMessage:"Unlimited documents for signature"})),r.createElement("li",null,a.intl.formatMessage({id:"8oG+3m",defaultMessage:"5 templates for commonly signed documents"})),r.createElement("li",null,a.intl.formatMessage({id:"nnCgRS",defaultMessage:"Tamper-proofing and audit trail included"}))),r.createElement("div",{className:"esign-upsell-footer"},r.createElement(n.Button,{variant:"primary",onClick:t=>{t&&t.preventDefault(),Promise.all([new Promise((t,i)=>{e(["modules/clean/account_page/widgets/plan/views/change_plan_modal"],t,i)}).then(i.__importStar),new Promise((t,i)=>{e(["modules/clean/payments/skus/constants"],t,i)}).then(i.__importStar)]).then(([{ChangePlanModalView:e,ChangePlanOrigin:t},{ProductPlanType:i}])=>{h.current&&e.showInstance({origin:"V1"===g?t.ESIGN_UPSELL_V1:t.ESIGN_UPSELL_V2,admissiblePlans:[i.HS_DBX_PRO_BUNDLE],hideDetailsCurrentPlan:!0,defaultSelectedPlan:i.HS_DBX_PRO_BUNDLE,hideUpdateBillingInfo:!0,launchHelloSignDeepIntegration:u})}),m(!0)},"data-uxa-log":"preview-esign-upsell-continue"},a.intl.formatMessage({id:"BVa7ab",defaultMessage:"Continue"})),r.createElement("div",{className:"esign-upsell-secondary-button"},r.createElement(n.Button,{variant:"transparent",onClick:()=>{m(!0),d.trackClickAction(o)},"data-uxa-log":"preview-esign-upsell-dismiss"},a.intl.formatMessage({id:"zBnSR/",defaultMessage:"Not now"})))))};c.displayName="UnstyledEsignUpsell",t.EsignUpsell=o.requireCssWithComponent(c,["/static/css/file_viewer_sidebar/esign_upsell-vfl4W6PKM.css"])})),define("modules/clean/react/file_viewer_sidebar/esign_upsell/use_show_esign_upsell",["require","exports","react","api_v2/user_client","modules/clean/react/file_viewer_sidebar/esign_upsell/esign_upsell_user_actions_tracker"],(function(e,t,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trackClickAction=t.useShowEsignUpsell=void 0,t.useShowEsignUpsell=function(e,t){const[n,a]=i.useState(!1),[o,l]=i.useState("OFF"),[d,c]=i.useState("UNKNOWN");return i.useEffect(()=>{void 0!==e&&void 0!==t&&(new r.UserApiV2Client).ns("growth_bundling").rpc("show_pro_esign_upsell",{sjid:t.sjid,ns_id:t.ns_id,file_ext:t.ext.slice(1)},{subjectUserId:e}).then(t=>{if(t.show_campaign){a(!0),l(t.variant||""),c(t.product_plan_type||""),new s.EsignUpsellUserActionTracker(e).track(s.EsignUpsellUserAction.SHOW)}})},[e,t]),{showEsignUpsell:n,stormcrowVariant:o,productPlanType:d}},t.trackClickAction=e=>{if(void 0!==e){new s.EsignUpsellUserActionTracker(e).track(s.EsignUpsellUserAction.CLICK,{})}}})),define("modules/clean/react/file_viewer_sidebar/panes/commenting_pane",["require","exports","tslib","react","typescript/libraries/file-viewer/src/modes/index","modules/clean/react/async/loadable","typescript/libraries/file-viewer/src/core/data/modes/types"],(function(e,t,i,r,s,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentingPane=void 0,r=i.__importDefault(r);const o=n.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer_sidebar/panes/commenting_pane_contents"],t,i)}).then(i.__importStar).then(({CommentingPaneContents:e})=>e)});t.CommentingPane=e=>{const{coreFVUiProps:t,encryptionOptions:i,user:n}=e;return r.default.createElement(s.Pane,Object.assign({paneId:a.SidebarPaneId.Comments},t),r.default.createElement(o,{encryptionOptions:i,user:n}))}})),define("modules/clean/react/file_viewer_sidebar/panes/documentation_pane",["require","exports","tslib","react","typescript/libraries/file-viewer/src/modes/index","typescript/libraries/file-viewer/src/core/data/modes/types","modules/clean/em_string","modules/clean/file_store/utils","dig-components/typography","modules/clean/react/components/css","modules/clean/react/file_viewer_sidebar/panes/strings","modules/clean/react/file_viewer/data/actions","react-redux","modules/clean/react/file_viewer_sidebar/panes/file_activity_section","modules/clean/react/file_viewer_sidebar/panes/loadable_details_section","typescript/component_libraries/pro-ui/src/components/branding/branding_block/optional_branding_block"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentationPane=t.ConnectedDocumentationPaneComponent=t.UnconnectedDocumentationPaneComponent=void 0,r=i.__importDefault(r),t.UnconnectedDocumentationPaneComponent=e=>{const{file:t,user:i,maxFilenameEmLength:d,brandingInfo:u,sharedLinkInfo:p,isVersionHistoryMode:g,coreFVUiProps:_}=e,v=a.Emstring.em_snippet(o.getFilename(t),d);return r.default.createElement(s.Pane,Object.assign({paneId:n.SidebarPaneId.Documentation},_),r.default.createElement("div",{className:"documentation-pane"},r.default.createElement(f.OptionalBrandingBlock,{className:"documentation-pane__branding-block",brandingInfo:u,sharedLinkInfo:p}),r.default.createElement(l.Title,{className:"documentation-pane__title"},v),r.default.createElement(h.LoadableDetailsSection,{title:c.DocumentationPaneStrings.details,file:t,user:i,sharedLinkInfo:p,pushMetadataPaneHandler:()=>e.pushSidebarPane(n.SidebarPaneId.Metadata)}),r.default.createElement(m.ConnectedFileActivitySection,{file:t,user:i,isVersionHistoryMode:g,title:c.DocumentationPaneStrings.activity,pushActivityPaneHandler:()=>e.pushSidebarPane(n.SidebarPaneId.Activity)})))};const g={pushSidebarPane:u.pushSidebarPane};t.ConnectedDocumentationPaneComponent=p.connect(null,g)(t.UnconnectedDocumentationPaneComponent),t.DocumentationPane=d.requireCssWithComponent(t.ConnectedDocumentationPaneComponent,["/static/css/file_viewer_sidebar/documentation_pane-vflVp3XEa.css","/static/css/dig-components/index.web-vflm67Rix.css","/static/js/typescript/component_libraries/pro-ui/src/index.web-vfl7fyKnY.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/editing_pane",["require","exports","tslib","react","classnames","typescript/libraries/file-viewer/src/modes/index","modules/clean/react/components/css"],(function(e,t,i,r,s,n,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditingPane=t.EditingPaneComponent=void 0,r=i.__importDefault(r),s=i.__importDefault(s);class o extends r.default.PureComponent{componentWillUnmount(){const{paneId:e}=this.props,t=document.querySelector(`[data-control-id="${e}"]`);t&&t.focus()}render(){const{coreFVUiProps:e,paneId:t,children:i,classname:a}=this.props;return r.default.createElement(n.Pane,Object.assign({paneId:t,className:"editing-pane-wrapper"},e),r.default.createElement("div",{"aria-labelledby":"react-file-viewer__title-bar","aria-modal":"true",className:s.default("editing-pane",a),role:"dialog"},i))}}t.EditingPaneComponent=o,o.displayName="EditingPaneComponent",t.EditingPane=a.requireCssWithComponent(o,["/static/css/file_viewer_sidebar/editing_pane-vfljT-58j.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/file_activity_section",["require","exports","tslib","react","modules/clean/react/file_sidebar/file_sidebar_connect","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/react/components/css","modules/clean/react/file_viewer_sidebar/panes/loadable_file_activity_stream_summary","dig-components/icons","dig-components/icons/src","dig-components/typography","modules/clean/react/file_viewer_sidebar/panes/strings"],(function(e,t,i,r,s,n,a,o,l,d,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedFileActivitySection=t.UnconnectedFileActivitySection=void 0,r=i.__importDefault(r),n=i.__importStar(n);class p extends r.default.Component{render(){const{activities:e,user:t,isVersionHistoryMode:i,isFileActivityEnabled:s,title:n,pushActivityPaneHandler:a,file:p}=this.props;if(!t||i||!s)return null;const m=e&&!e.loading&&0!==e.value.length;return r.default.createElement("div",{className:"documentation-pane__section"},r.default.createElement(c.Title,{className:"documentation-pane__section-title",size:"small"},n),r.default.createElement(o.LoadableFileActivityStreamSummary,{file:p,user:t,maxVisibleActivityCards:2}),m&&r.default.createElement("div",{className:"documentation-pane__push-pane-button-wrapper"},r.default.createElement(c.Link,{href:"#",onClick:a},u.ActivitySectionStrings.viewAllActivities,r.default.createElement("span",{className:"documentation-pane__arrow-right-icon"},r.default.createElement(l.UIIcon,{size:"small",src:d.ChevronRightLine})))))}}t.UnconnectedFileActivitySection=p,p.displayName="UnconnectedFileActivitySection",t.ConnectedFileActivitySection=s.fileSidebarConnect((function(e){return{isFileActivityEnabled:n.isActivityEnabled(e),activities:n.getActivitiesMetadata(e)}}))(a.requireCssWithComponent(p,["/static/css/file_activity_stream-vflSz9fQP.css"]))})),define("modules/clean/react/file_viewer_sidebar/panes/image_chooser_section",["require","exports","tslib","react","dropins_sdk_refactor/src/v2_entry","modules/clean/filepath/filepath","modules/clean/loggers/workflows_logger","spectrum/popover/index","modules/core/i18n","modules/clean/react/snackbar","modules/clean/react/components/css","classnames","spectrum/colorized_icon/index","spectrum/icon_action/index","spectrum/tooltip/index","modules/clean/react/watermarking/utils"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ImageChooserSection=t.ImageChooserSectionWithoutCSS=t.ImageSource=void 0,r=i.__importDefault(r),u=i.__importDefault(u);const g=["image/png","image/jpeg","image/jpg","image/gif","image/bmp"];var _;(function(e){e.FROM_DROPBOX="dropbox",e.FROM_COMPUTER="computer",e.FROM_DRAGDROP="dragdrop"})(_=t.ImageSource||(t.ImageSource={}));const v=e=>r.default.createElement("svg",{className:e.className,viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},r.default.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},r.default.createElement("path",{d:"M16.9849536,10.3304435 L21.935986,13.4846597 L16.9501078,16.6610755 L11.9679572,13.4870801 L6.98587822,16.6610755 L2,13.4846597 L6.950961,10.330489 L2,7.17634414 L6.9859499,4 L11.9679214,7.17394657 L16.9501795,4 L21.9359143,7.17634414 L16.9849536,10.3304435 Z M16.9151901,10.330489 L11.9679213,7.17874171 L7.020724,10.3304435 L11.9679572,13.4822392 L16.9151901,10.330489 Z M7.01792123,17.713692 L12.0037994,14.5376346 L16.9897493,17.713692 L12.0037994,20.8901078 L7.01792123,17.713692 Z",fill:e.fill?e.fill:"#ffffff"})));v.displayName="DropboxIcon";const w=e=>r.default.createElement("svg",{className:e.className,viewBox:"0 0 24 24",version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},r.default.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},r.default.createElement("path",{d:"M14,10 L24,10 L24,14 L14,14 L14,24 L10,24 L10,14 L0,14 L0,10 L10,10 L10,0 L14,0 L14,10 Z",fill:e.fill?e.fill:"#ffffff"})));w.displayName="PlusIcon",w.displayName="PlusIcon";class b extends r.default.PureComponent{constructor(e){super(e),this.handleDragOver=()=>{this.setState({isDraggedOver:!0})},this.onChooseFromDropbox=e=>i.__awaiter(this,void 0,void 0,(function*(){const t=e.pop();if(!t||e.length)throw new Error("Dropbox chooser should only return one item");const i=t.link,r=yield f.getImageFromURL(i);this.onImageSelected(r,i,t.name,_.FROM_DROPBOX)})),this.onChooseFromComputer=e=>i.__awaiter(this,void 0,void 0,(function*(){if(e.currentTarget.files){const t=Array.from(e.currentTarget.files).pop();if(!t)return;const i=URL.createObjectURL(t),r=yield f.getImageFromURL(i);this.onImageSelected(r,i,t.name,_.FROM_COMPUTER)}})),this.onDropFile=e=>i.__awaiter(this,void 0,void 0,(function*(){e.preventDefault(),this.setState({isDraggedOver:!1});const t=e.dataTransfer.files[0];if(!t)return;if(!g.includes(t.type))return void d.Snackbar.show(r.default.createElement(d.ControlledSnackbarComponent,{id:"image-watermarking-drag-drop-error",title:l.intl.formatMessage({id:"tRlSi7",defaultMessage:"Can’t add. Choose an image file, like JPEG, GIF or PNG."}),variant:"fail",closeButtonText:l.intl.formatMessage({id:"2Cbv/y",defaultMessage:"Try again"})}));const i=URL.createObjectURL(t),s=yield f.getImageFromURL(i);this.onImageSelected(s,i,t.name,_.FROM_DRAGDROP)})),this.onDragOver=e=>{e.preventDefault(),this.setState({isDraggedOver:!0})},this.onDragLeave=e=>{e.preventDefault(),this.setState({isDraggedOver:!1})},this.onImageSelected=(e,t,i,r)=>{if(this.setState({imageURL:t},()=>{const e=t&&this.props.focusOnSelect?this.props.focusOnSelect:document.querySelector(".image-chooser__popover-trigger");e&&e.focus()}),e){const e=n.file_extension_for_logging(i||"");a.logWorkflowsEvent(a.WorkflowsEvent.WatermarkImageUploaded,f.getWatermarkMilestone(this.props.user),{source:r,image_ext:e})}this.props.onImageSelected(e)},this.onDeleteButtonClicked=e=>{a.logWorkflowsEvent(a.WorkflowsEvent.WatermarkImageDeleted,f.getWatermarkMilestone(this.props.user)),this.onImageSelected(void 0,void 0)},this.onSourceSelection=e=>{if(a.logWorkflowsEvent(a.WorkflowsEvent.WatermarkImageUploadClicked,f.getWatermarkMilestone(this.props.user),{source:e}),e===_.FROM_DROPBOX)try{s.Dropbox.choose({multiselect:!1,success:this.onChooseFromDropbox,linkType:"direct",extensions:["images"]})}catch(e){d.Snackbar.fail(l.intl.formatMessage({id:"muNFvG",defaultMessage:"Couldn’t add image from Dropbox. Please reload the page and try again."}))}else this.imageUploadRef&&this.imageUploadRef.click()},this.state={isDraggedOver:!1,imageURL:e.defaultImageURL},s.Dropbox.init({appKey:"dropbox",productKey:"file_viewer_image_chooser"})}componentDidMount(){this.props.isImageWatermarkingMode&&window.addEventListener("dragover",this.handleDragOver)}componentDidUpdate(e){this.props.isImageWatermarkingMode!==e.isImageWatermarkingMode&&(this.props.isImageWatermarkingMode?window.addEventListener("dragover",this.handleDragOver):window.removeEventListener("dragover",this.handleDragOver))}componentWillUnmount(){this.props.isImageWatermarkingMode&&window.removeEventListener("dragover",this.handleDragOver)}render(){return r.default.createElement(r.default.Fragment,null,this.props.isImageWatermarkingMode&&r.default.createElement("div",{className:u.default("watermarking-drop-zone",{"watermarking-drop-zone--dragged-over":this.state.isDraggedOver}),onDrop:this.onDropFile,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},this.state.isDraggedOver?r.default.createElement("p",{className:"watermarking-drop-zone__text"},l.intl.formatMessage({id:"+j0wlP",defaultMessage:"Drop image here"})):null),r.default.createElement("div",{className:"image-chooser-section"},this.state.imageURL?r.default.createElement(r.default.Fragment,null,r.default.createElement(h.Tooltip,{positioning:"left",positionOffset:8,tooltipContent:l.intl.formatMessage({id:"9v2+SN",defaultMessage:"Delete"})},r.default.createElement("button",{"aria-label":l.intl.formatMessage({id:"EpYmFq",defaultMessage:"Delete selected watermark image"}),className:"image-chooser-section__delete-button",onClick:this.onDeleteButtonClicked},r.default.createElement(p.ColorizedIcon,{color:"white"},r.default.createElement(m.IconAction,{name:"delete"})))),r.default.createElement("img",{className:"image-chooser-section__selected-image",src:this.state.imageURL,alt:l.intl.formatMessage({id:"ZeTVlG",defaultMessage:"Selected watermark image"})})):r.default.createElement(r.default.Fragment,null,r.default.createElement(o.Popover,{onSelection:this.onSourceSelection},r.default.createElement(o.PopoverTrigger,{"aria-label":l.intl.formatMessage({id:"Fb32+S",defaultMessage:"Open image source selection menu"}),className:"image-chooser__popover-trigger"},r.default.createElement("span",{className:"image-chooser-section__popover-button"},r.default.createElement(w,{className:"image-chooser-section__plus-svg"}))),r.default.createElement(o.PopoverContent,null,r.default.createElement(o.PopoverContentItem,{className:"image-chooser-section__add-from-dropbox",value:_.FROM_DROPBOX},r.default.createElement(v,{className:"image-chooser-section__logo-svg"}),l.intl.formatMessage({id:"rIir19",defaultMessage:"Dropbox"}),r.default.createElement("span",{className:"ax-visually-hidden"}," "+l.intl.formatMessage({id:"dRhmBa",defaultMessage:"(opens a new window)"}))),r.default.createElement(o.PopoverContentItem,{className:"image-chooser-section__add-from-computer",value:_.FROM_COMPUTER},r.default.createElement(p.ColorizedIcon,{color:"white"},r.default.createElement(m.IconAction,{name:"upload"})),l.intl.formatMessage({id:"CVumiI",defaultMessage:"My computer"})))),r.default.createElement("p",{className:"image-chooser-section__drop-text","aria-hidden":"true"},l.intl.formatMessage({id:"+j0wlP",defaultMessage:"Drop image here"}))),r.default.createElement("input",{className:"image-chooser-section__image-upload",type:"file",accept:g.join(", "),onClick:e=>e.target.value="",onChange:this.onChooseFromComputer,ref:e=>this.imageUploadRef=e})))}}t.ImageChooserSectionWithoutCSS=b,b.displayName="ImageChooserSectionWithoutCSS",t.ImageChooserSection=c.requireCssWithComponent(b,["/static/css/file_viewer_sidebar/image_chooser_section-vflr9AIyr.css"])}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/panes/loadable_activity_pane",["require","exports","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],(function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableActivityPane=void 0,t.LoadableActivityPane=i.Loadable({loader:()=>r.waitForTTI().then(()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer_sidebar/panes/activity_pane"],t,i)}).then(__importStar).then(({ActivityPane:e})=>e))})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/panes/loadable_details_section",["require","exports","modules/clean/react/async/loadable"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableDetailsSection=void 0,t.LoadableDetailsSection=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer_sidebar/panes/details_section"],t,i)}).then(__importStar).then(({DetailsSection:e})=>e)})}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/panes/loadable_file_activity_stream_summary",["require","exports","modules/clean/react/async/loadable"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableFileActivityStreamSummary=void 0,t.LoadableFileActivityStreamSummary=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer_sidebar/panes/file_activity_stream_summary"],t,i)}).then(__importStar).then(({FileActivityStreamSummary:e})=>e)})})),define("modules/clean/react/file_viewer_sidebar/panes/markup_pane",["require","exports","tslib","react","classnames","lodash","react-redux","typescript/libraries/file-viewer/src/core/data/modes/types","modules/core/browser","modules/core/i18n","ts-keycode-enum","modules/clean/browse_uri_interface","modules/clean/file_store/utils","modules/clean/loggers/workflows_logger","modules/clean/previews/data/selectors","modules/clean/previews/data/preview_type_util","modules/clean/react/components/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/panes/editing_pane","modules/clean/react/keyboard_binding/keyboard_binding_connector","modules/clean/react/keyboard_binding/keyboard_binding","modules/clean/react/previews/constants","modules/clean/react/snackbar","spectrum/button/index","modules/clean/react/workflows/markup/fabric","modules/clean/react/workflows/markup/selectors","modules/clean/react/workflows/markup/types","modules/clean/react/workflows/markup/utils","typescript/component_libraries/pro-ui/src/components/base/apply_button/index","modules/clean/react/workflows/markup_icons","spectrum/popover/index","spectrum/tooltip/index","spectrum/modal/index","dig-components/banner","modules/core/persistence/storage","modules/core/exception","modules/constants/file_viewer"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f,g,_,v,w,b,E,S,y,P,C,M,k,T,A,I,F,O,x,D,L,R,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarkupPane=t.ConnectedMarkupPaneComponent=t.MarkupPaneComponent=void 0,r=i.__importDefault(r),s=i.__importDefault(s),l=i.__importStar(l);const U=(e,t=!0)=>e===k.MarkupColor.TRANSPARENT?I.transparentFillIcon:I.circleIcon({stroke:e,fill:t?e:void 0}),B=[k.MarkupColor.TRANSPARENT,k.MarkupColor.RED_CHERRY,k.MarkupColor.ORANGE_TANGERINE,k.MarkupColor.GREEN,k.MarkupColor.DARK_BLUE,k.MarkupColor.ULTRAVIOLET,k.MarkupColor.WHITE,k.MarkupColor.BLACK].map(e=>({color:e,icon:U(e)})),W={[k.MarkupColor.TRANSPARENT]:d.intl.formatMessage({id:"cnToDS",defaultMessage:"No fill color"}),[k.MarkupColor.RED_CHERRY]:d.intl.formatMessage({id:"rZnlRM",defaultMessage:"Red"}),[k.MarkupColor.ORANGE_TANGERINE]:d.intl.formatMessage({id:"6YT7wY",defaultMessage:"Orange"}),[k.MarkupColor.GREEN]:d.intl.formatMessage({id:"TfeWUu",defaultMessage:"Green"}),[k.MarkupColor.DARK_BLUE]:d.intl.formatMessage({id:"Opr8C4",defaultMessage:"Blue"}),[k.MarkupColor.ULTRAVIOLET]:d.intl.formatMessage({id:"IZk7A9",defaultMessage:"Purple"}),[k.MarkupColor.WHITE]:d.intl.formatMessage({id:"NupPFJ",defaultMessage:"White"}),[k.MarkupColor.BLACK]:d.intl.formatMessage({id:"ukyV/6",defaultMessage:"Black"})};class V extends r.default.Component{constructor(){super(...arguments),this.state={isSubmenuOpen:!1},this.toggleSubMenu=({isOpen:e})=>{this.setState({isSubmenuOpen:e})}}render(){const{icon:e,onChange:t,label:i}=this.props,{isSubmenuOpen:n}=this.state;return r.default.createElement(F.Popover,{onSelection:t,onMenuToggle:this.toggleSubMenu,closeOnSelection:!1},r.default.createElement(F.PopoverTrigger,null,r.default.createElement("div",{className:"markup-pane__tool-buttons"},r.default.createElement(O.Tooltip,{positioning:"below",className:"markup-pane__tooltip",tooltipContent:i},r.default.createElement(P.Button,{variant:"secondary",size:"large",className:s.default("markup-pane__tool-button",{"markup-pane__tool-button--selected":n}),tagName:"span"},e)))),r.default.createElement(F.PopoverContent,null,B.map(({icon:e,color:t})=>r.default.createElement(O.Tooltip,{positioning:"below",className:"markup-pane__tooltip",tooltipContent:W[t],key:W[t]},r.default.createElement(F.PopoverContentItem,{value:t},e)))))}}V.displayName="ColorChooser";const K={[k.MarkupType.TEXT]:m.WorkflowsEvent.MarkupTextboxClicked,[k.MarkupType.FREEFORM]:m.WorkflowsEvent.MarkupDrawClicked,[k.MarkupType.ARROW]:m.WorkflowsEvent.MarkupArrowClicked,[k.MarkupType.RECT]:m.WorkflowsEvent.MarkupRectangleClicked,[k.MarkupType.CIRCLE]:m.WorkflowsEvent.MarkupCircleClicked};class j extends r.default.Component{constructor(e){super(e),this.getIsDeprecationBannerDismissed=()=>{try{const e=L.UserLocalStorage.get(this.props.user.id,"markup_deprecation_banner_last_dismissed")||0;return Date.now()-e<864e5}catch(e){return R.reportException({err:e,severity:"non-critical"}),!1}},this.setDeprecationBannerDismissed=()=>{try{this.setState({deprecationBannerDismissed:!0}),L.UserLocalStorage.set(this.props.user.id,"markup_deprecation_banner_last_dismissed",Date.now())}catch(e){R.reportException({err:e,severity:"non-critical"})}},this.onStrokeChange=e=>{const{markupState:t,currentPageIndex:i,setMarkupStroke:r}=this.props;r(e);const s=t[i].fabric;C.setOptionsForActiveObjects(s,{stroke:e})},this.onFillChange=e=>{const{markupState:t,currentPageIndex:i,setMarkupFill:r}=this.props;r(e);const s=t[i].fabric;C.setOptionsForActiveObjects(s,{fill:e})},this.addMarkupObject=e=>{const{currentPageIndex:t,markupState:i,markupState:{strokeColor:r,fillColor:s}}=this.props,n=i[t].fabric;n&&(C.addMarkupObject(n,e,{stroke:r,fill:s,left:this.left,top:this.top}),this.props.setMarkupDrawingMode(!1),this.left+=T.OFFSET,this.top+=T.OFFSET,this.left>=n.getWidth()&&(this.left=T.DEFAULT_LEFT),this.top>=n.getHeight()&&(this.top=T.DEFAULT_TOP))},this.onClickDraw=()=>{const{markupState:{isDrawingMode:e},setMarkupDrawingMode:t,setMarkupFormatSubmenu:i}=this.props;e||i([k.FormatSubmenuEntry.STROKE]),t(!e),m.logWorkflowsEvent(m.WorkflowsEvent.MarkupDrawClicked)},this.onClickTool=(e,t)=>()=>{const{setMarkupFormatSubmenu:i}=this.props;i(t),this.addMarkupObject(e),m.logWorkflowsEvent(K[e])},this.exitWithConfirmation=()=>{this.props.markupState[this.props.currentPageIndex].fabric.isEmpty()?this.props.changeMode(o.FileViewerMode.Documentation):this.setState({isConfirmationModalOpen:!0})},this.handleCancel=e=>{e.preventDefault(),this.exitWithConfirmation()},this.handleApply=e=>i.__awaiter(this,void 0,void 0,(function*(){let t;y.Snackbar.sync(d.intl.formatMessage({id:"Dn6iyj",defaultMessage:"Marking up file..."}),!1,"markup-notification"),m.logWorkflowsEvent(e?m.WorkflowsEvent.MarkupApplyOverwrite:m.WorkflowsEvent.MarkupApplySaveAsCopy);try{t=yield C.saveMarkup(this.props.user.id,this.props.file.file_id,e,this.props.markupState,this.props.previewType)}catch(e){const t=T.getMarkupErrorMessage(e.error),i="over_quota_error"===e.error[".tag"],s=i?d.intl.formatMessage({id:"nvlC/2",defaultMessage:"Upgrade"}):d.intl.formatMessage({id:"o+sT31",defaultMessage:"Close"}),n=i?()=>l.open_tab("/plans"):()=>{};return y.Snackbar.show(r.default.createElement(y.Snackbar,{id:"markup-notification",closeButtonText:s,timeoutDelayMs:5e3,title:t,variant:"fail",onCloseClick:n}))}const i=t.fq_path||p.isBrowseFile(this.props.file)&&this.props.file.fq_path;i?l.replace_location(u.preview_uri_for_fq_path(this.props.user,i,{context:S.PreviewSourceContext.Workflow})):l.reload()})),this.onDelete=e=>{e&&e instanceof KeyboardEvent&&e.preventDefault(),m.logWorkflowsEvent(m.WorkflowsEvent.MarkupDelete);const t=this.props.markupState[this.props.currentPageIndex].fabric;t&&(t.remove(...t.getActiveObjects()),t.discardActiveObject().requestRenderAll())},this.onEscape=()=>{const e=this.props.markupState[this.props.currentPageIndex].fabric;if(this.props.markupState.isDrawingMode){this.props.setMarkupDrawingMode(!1);const t=n.last(e.getObjects());t&&e.setActiveObject(t).requestRenderAll()}else e.getActiveObject()?e.discardActiveObject().requestRenderAll():this.exitWithConfirmation()},this.onCopy=()=>{this.props.markupState[this.props.currentPageIndex].fabric.getActiveObject().clone(e=>{this.clipboard=e})},this.onPaste=()=>{if(!this.clipboard)return;const e=this.props.markupState[this.props.currentPageIndex].fabric;this.clipboard.top=(this.clipboard.top||T.DEFAULT_TOP)+T.OFFSET,this.clipboard.left=(this.clipboard.left||T.DEFAULT_LEFT)+T.OFFSET,this.clipboard.left>=e.getWidth()&&(this.clipboard.left=T.DEFAULT_LEFT),this.clipboard.top>=e.getHeight()&&(this.clipboard.top=T.DEFAULT_TOP),this.clipboard.clone(t=>{if(e.discardActiveObject(),t.set({evented:!0,strokeUniform:!0}),"activeSelection"===t.type){const i=t;i.canvas=e,i.forEachObject(t=>{e.add(t)}),i.setCoords()}else e.add(t);e.setActiveObject(t).requestRenderAll()})},this.onLeftArrowPressed=()=>{this.moveActiveObject(-T.MOVE_DISTANCE_X,0)},this.onRightArrowPressed=()=>{this.moveActiveObject(T.MOVE_DISTANCE_X,0)},this.onUpArrowPressed=()=>{this.moveActiveObject(0,-T.MOVE_DISTANCE_Y)},this.onDownArrowPressed=()=>{this.moveActiveObject(0,T.MOVE_DISTANCE_Y)},this.moveActiveObject=(e,t)=>{const i=this.props.markupState[this.props.currentPageIndex].fabric,r=i.getActiveObject();r&&(r.left=r.left+e,r.top=r.top+t,i.trigger("object:moving",{target:r}),i.requestRenderAll())},this.renderConfirmationModal=()=>{const e=d.intl.formatMessage({id:"c7pOMh",defaultMessage:"Exit without saving?"});return r.default.createElement(x.UtilityModal,{title:e,ariaLabel:e,open:this.state.isConfirmationModalOpen,primaryAction:d.intl.formatMessage({id:"U5fgWD",defaultMessage:"Yes"}),onPrimaryAction:()=>this.props.changeMode(o.FileViewerMode.Documentation),secondaryAction:d.intl.formatMessage({id:"gWxS/S",defaultMessage:"No"}),onSecondaryAction:()=>this.setState({isConfirmationModalOpen:!1}),overlayClassName:"file-viewer-modal-overlay",appElement:document.getElementById("embedded-app")||document.body},d.intl.formatMessage({id:"rvkufC",defaultMessage:"Your markup will be lost if you exit before saving this file."}))},this.renderDeprecationBanner=()=>{const e=d.intl.formatMessage({id:"GOkzq4",defaultMessage:"Markup is going away in October. While we're sad to see it go, we want to keep simplifying your experience."});return r.default.createElement(D.Banner,{withCloseButton:"Close",variant:"basic",onRequestClose:this.setDeprecationBannerDismissed,style:{position:"absolute",bottom:"0px",margin:"24px",zIndex:11,backgroundColor:"rgb(245,230,235)"}},r.default.createElement(D.Banner.Message,null,e))},this.state={isConfirmationModalOpen:!1,deprecationBannerDismissed:this.getIsDeprecationBannerDismissed()},this.left=T.DEFAULT_LEFT,this.top=T.DEFAULT_TOP}componentDidMount(){m.logWorkflowsEvent(m.WorkflowsEvent.MarkupEnabled)}componentWillUnmount(){this.props.resetMarkupState(),m.logWorkflowsEvent(m.WorkflowsEvent.MarkupCancel)}isBannerEnabled(){return N.MARKUP_ANALYTICS_DEPRECATION_BANNER}render(){const{coreFVUiProps:e,markupState:{isDrawingMode:t,formatSubmenu:i,fillColor:n,strokeColor:a}}=this.props,{deprecationBannerDismissed:l}=this.state,u=[{icon:I.rectIcon,onClick:this.onClickTool(k.MarkupType.RECT,[k.FormatSubmenuEntry.FILL,k.FormatSubmenuEntry.STROKE]),label:d.intl.formatMessage({id:"JZlohh",defaultMessage:"Add square"})},{icon:I.circleIcon({stroke:"white",fill:"none"}),onClick:this.onClickTool(k.MarkupType.CIRCLE,[k.FormatSubmenuEntry.FILL,k.FormatSubmenuEntry.STROKE]),label:d.intl.formatMessage({id:"vOLK2M",defaultMessage:"Add circle"})},{icon:I.textIcon,onClick:this.onClickTool(k.MarkupType.TEXT,[k.FormatSubmenuEntry.STROKE]),label:d.intl.formatMessage({id:"3uYwiW",defaultMessage:"Add text"})},{icon:I.arrowIcon,onClick:this.onClickTool(k.MarkupType.ARROW,[k.FormatSubmenuEntry.STROKE]),label:d.intl.formatMessage({id:"pL0M9g",defaultMessage:"Add arrow"})},{icon:I.drawIcon,onClick:this.onClickDraw,label:d.intl.formatMessage({id:"WwXu7L",defaultMessage:"Draw"}),className:s.default({"markup-pane__tool-button--selected":t})}];return r.default.createElement("div",{className:"markup-pane__wrapper"},r.default.createElement(w.EditingPane,{paneId:o.SidebarPaneId.Markup,coreFVUiProps:e},r.default.createElement("div",{className:"markup-pane__actions"},r.default.createElement(A.ApplyButton,{onApply:this.handleApply,onClick:()=>{},disabled:!1}),r.default.createElement(P.Button,{tagName:"button",variant:"secondary",onClick:this.handleCancel},d.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}))),r.default.createElement("div",{className:"markup-pane__control"},r.default.createElement("div",{className:s.default("markup-pane__main-tool-buttons",{"markup-pane__main-tool-buttons--submenu-open":i.length>0})},u.map(({icon:e,onClick:t,label:i,className:n},a)=>r.default.createElement(O.Tooltip,{tooltipContent:i,className:"markup-pane__tooltip",positioning:"below",key:i},r.default.createElement(P.Button,{variant:"secondary",size:"large",onClick:t,className:s.default("markup-pane__tool-button",n)},e))))),i.length>0&&r.default.createElement(q,{onFillChange:this.onFillChange,onStrokeChange:this.onStrokeChange,fillColor:n,strokeColor:a,menuEntries:i}),r.default.createElement(b.KeyboardBindingConnector,{keyboardBindings:[E.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.Backspace},callback:this.onDelete}),E.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.Delete},callback:this.onDelete}),E.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.Escape},callback:this.onEscape}),E.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.C,ctrlKey:!0},callback:this.onCopy}),E.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.C,metaKey:!0},callback:this.onCopy}),E.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.V,ctrlKey:!0},callback:this.onPaste}),E.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.V,metaKey:!0},callback:this.onPaste}),E.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.LeftArrow},callback:this.onLeftArrowPressed}),E.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.UpArrow},callback:this.onUpArrowPressed}),E.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.RightArrow},callback:this.onRightArrowPressed}),E.hydrateKeyboardBinding({keyboardEventCriteria:{which:c.Key.DownArrow},callback:this.onDownArrowPressed})]}),this.renderConfirmationModal()),!l&&this.isBannerEnabled()&&this.renderDeprecationBanner())}}t.MarkupPaneComponent=j,j.displayName="MarkupPaneComponent";const q=({menuEntries:e,onFillChange:t,onStrokeChange:i,fillColor:s,strokeColor:n})=>r.default.createElement("div",{className:"markup-pane__control markup-pane__control-colors"},e.map(e=>{switch(e){case k.FormatSubmenuEntry.FILL:return r.default.createElement(V,{icon:U(s),onChange:t,key:"fill-menu",label:d.intl.formatMessage({id:"H/EWDP",defaultMessage:"Change fill color"})});case k.FormatSubmenuEntry.STROKE:return r.default.createElement(V,{icon:U(n,!1),onChange:i,key:"stroke-menu",label:d.intl.formatMessage({id:"m+pG8Y",defaultMessage:"Change line color"})});default:return null}}));q.displayName="FormatSubmenu";const H={changeMode:_.changeMode,setMarkupDrawingMode:_.setMarkupDrawingMode,resetMarkupState:_.resetMarkupState,setMarkupFill:_.setMarkupFill,setMarkupStroke:_.setMarkupStroke,setMarkupFormatSubmenu:_.setMarkupFormatSubmenu},z=a.connect((e,t)=>({markupState:M.getMarkupState(e),currentPageIndex:v.getCurrentPageIndex(e)||0,previewType:f.getPreviewType(h.getApiDataForFile(e,t.file).data)}),H);t.ConnectedMarkupPaneComponent=z(j),t.MarkupPane=g.requireCssWithComponent(t.ConnectedMarkupPaneComponent,["/static/css/file_viewer_sidebar/editing_pane-vfljT-58j.css","/static/css/file_viewer_sidebar/markup_pane-vflawt0ye.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/metadata_pane",["require","exports","tslib","react","typescript/libraries/file-viewer/src/modes/index","typescript/libraries/file-viewer/src/core/data/modes/types","modules/clean/react/file_metadata/component/loadable_metadata_details","modules/clean/react/components/css","modules/clean/react/file_viewer_sidebar/panes/strings","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer_sidebar/utils","react-redux","modules/clean/react/file_viewer/data/selectors","typescript/libraries/file-viewer/src/modes/sidebar/pane_title"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MetadataPane=t.ConnectedMetadataPaneComponent=t.UnconnectedMetadataPaneComponent=void 0,r=i.__importDefault(r),t.UnconnectedMetadataPaneComponent=e=>{const t=c.isSidebarOpen(e.sidebar)&&c.isSidebarPaneIdAtTopOfStack(n.SidebarPaneId.Metadata,e.sidebar),i=c.getSecondFromTopSidebarPaneId(e.sidebar);return r.default.createElement(s.Pane,Object.assign({paneId:n.SidebarPaneId.Metadata},e.coreFVUiProps),r.default.createElement("div",{className:"metadata-pane"},r.default.createElement(m.PaneTitleComponent,{title:l.MetadataPaneStrings.details,backButton:i?{previousPaneId:i,onClick:e.popSidebarPane}:void 0,intl:e.coreFVUiProps.intl}),r.default.createElement(a.LoadableMetadataDetails,{file:e.file,user:e.user,sharedLinkInfo:e.sharedLinkInfo,isActiveTab:t,previewType:e.previewType})))};const h={popSidebarPane:d.popSidebarPane};t.ConnectedMetadataPaneComponent=u.connect(e=>({sidebar:p.getSidebar(e)}),h)(t.UnconnectedMetadataPaneComponent),t.MetadataPane=o.requireCssWithComponent(t.ConnectedMetadataPaneComponent,["/static/css/file_viewer_sidebar/metadata_pane-vflJOp4bF.css"])})),define("modules/clean/react/file_viewer_sidebar/panes/rotation_control",["require","exports","tslib","react","classnames","modules/core/i18n","spectrum/button/index","modules/clean/mouse_button_code","ts-keycode-enum"],(function(e,t,i,r,s,n,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RotationControl=void 0,r=i.__importDefault(r),s=i.__importDefault(s);const d=15;class c extends r.default.Component{constructor(){super(...arguments),this.rotateTimeoutId=null,this.state={isRotating:!1},this.startRotatingAC=e=>{e.button!==o.MouseButtonCode.LEFT&&e.keyCode!==l.Key.Enter||this.startRotating(1)},this.startRotatingCW=e=>{e.button!==o.MouseButtonCode.LEFT&&e.keyCode!==l.Key.Enter||this.startRotating(-1)},this.startRotating=e=>{this.setState({isRotating:!0},()=>this.rotate(e))},this.stopRotating=()=>{this.setState({isRotating:!1})},this.rotate=e=>{const{onChange:t,step:i=d,value:r=0}=this.props;if(t&&this.state.isRotating){let s=r+e*i;s>359&&(s-=360),s<0&&(s+=360),t(s),this.rotateTimeoutId&&clearTimeout(this.rotateTimeoutId);const n=setTimeout(()=>{this.rotateTimeoutId=null,this.rotate(e)},200);this.rotateTimeoutId=n}}}componentWillUnmount(){this.rotateTimeoutId&&clearTimeout(this.rotateTimeoutId)}render(){const{className:e,disabled:t,value:i}=this.props;return r.default.createElement("div",{className:s.default("rotation-control",e)},r.default.createElement("div",{className:"rotation-control--current-value ax-visually-hidden","aria-live":"polite"},n.intl.formatMessage({id:"TSbTsY",defaultMessage:"{value} degrees"},{value:i})),r.default.createElement(a.Button,{disabled:t,onKeyDown:this.startRotatingAC,onKeyUp:this.stopRotating,onMouseDown:this.startRotatingAC,onMouseUp:this.stopRotating,size:"large",variant:"secondary"},r.default.createElement("span",{className:"ax-visually-hidden"},n.intl.formatMessage({id:"ZhlNXH",defaultMessage:"Rotate Anticlockwise"})),r.default.createElement("svg",{"aria-hidden":!0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.default.createElement("path",{d:"M9.87193 19.7329C10.5328 19.9073 11.227 20.0002 11.943 20.0002C16.3929 20.0002 20.0002 16.4106 20.0002 11.9825C20.0002 7.55449 16.3929 3.96484 11.943 3.96484C8.793 3.96484 6.06518 5.76364 4.74032 8.38529",stroke:"white",strokeWidth:"2"}),r.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.92141 7.72819L10.0233 7.21687L10.1704 8.66739L3.61077 9.3248L2.94905 2.79745L4.40675 2.65136L4.92141 7.72819Z",fill:"white"}))),r.default.createElement(a.Button,{disabled:t,onKeyDown:this.startRotatingCW,onKeyUp:this.stopRotating,onMouseDown:this.startRotatingCW,onMouseUp:this.stopRotating,size:"large",variant:"secondary"},r.default.createElement("span",{className:"ax-visually-hidden"},n.intl.formatMessage({id:"yDs6IE",defaultMessage:"Rotate Clockwise"})),r.default.createElement("svg",{"aria-hidden":!0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.default.createElement("path",{d:"M14.1283 19.7329C13.4674 19.9073 12.7732 20.0002 12.0572 20.0002C7.60734 20.0002 4 16.4106 4 11.9825C4 7.55449 7.60734 3.96484 12.0572 3.96484C15.2072 3.96484 17.9351 5.76364 19.2599 8.38529",stroke:"white",strokeWidth:"2"}),r.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.0788 7.72819L13.9769 7.21687L13.8299 8.66739L20.3895 9.3248L21.0512 2.79745L19.5935 2.65136L19.0788 7.72819Z",fill:"white"}))))}}t.RotationControl=c,c.displayName="RotationControl"})),define("modules/clean/react/file_viewer_sidebar/panes/strings",["require","exports","modules/core/i18n"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActivitySectionStrings=t.DetailsSectionStrings=t.ActivityPaneStrings=t.MetadataPaneStrings=t.DocumentationPaneStrings=void 0,t.DocumentationPaneStrings={details:i.intl.formatMessage({id:"ghld2g",defaultMessage:"Details"}),activity:i.intl.formatMessage({id:"wVS5Gq",defaultMessage:"Activity"})},t.MetadataPaneStrings={details:i.intl.formatMessage({id:"mBshLe",defaultMessage:"Details"})},t.ActivityPaneStrings={details:i.intl.formatMessage({id:"Zduv89",defaultMessage:"Activity"})},t.DetailsSectionStrings={viewPreviousVersions:i.intl.formatMessage({id:"cGuWuL",defaultMessage:"View previous versions"}),viewAllDetails:i.intl.formatMessage({id:"cdTbAt",defaultMessage:"View all details"})},t.ActivitySectionStrings={viewAllActivities:i.intl.formatMessage({id:"dkJoht",defaultMessage:"View all activity"})}})),define("modules/clean/react/file_viewer_sidebar/panes/watermarking_pane",["require","exports","tslib","react","react-dom","classnames","lodash","react-aria-tabpanel","react-redux","typescript/libraries/file-viewer/src/core/data/modes/types","modules/clean/browse_uri_interface","modules/clean/file_store/utils","modules/clean/loggers/workflows_logger","modules/clean/react/components/css","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/panes/editing_pane","modules/clean/react/snackbar","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/api","modules/core/i18n","spectrum/button/index","spectrum/dropdown_menu/index","spectrum/input/index","ts-key-enum","modules/clean/react/file_viewer_sidebar/panes/rotation_control","modules/clean/react/watermarking/utils","modules/clean/previews/data/selectors","modules/clean/previews/data/preview_type_util","modules/clean/react/previews/constants","modules/clean/react/watermarking/types","modules/core/browser","modules/clean/react/watermarking/selectors","modules/clean/react/file_viewer_sidebar/panes/image_chooser_section","modules/clean/react/watermarking/apply_watermark_button","modules/clean/react/watermarking/utils","typescript/component_libraries/pro-ui/src/components/base/slider/index","spectrum/tabbed_header/index"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f,g,_,v,w,b,E,S,y,P,C,M,k,T,A,I,F,O,x,D,L,R,N){"use strict";var U;Object.defineProperty(t,"__esModule",{value:!0}),t.WatermarkingPane=t.ConnectedWatermarkingPaneComponent=t.WatermarkingPaneComponent=t.WATERMARKING_PANE_POSITION_BUTTON_CLASSNAME=void 0,r=i.__importDefault(r),s=i.__importStar(s),n=i.__importDefault(n),F=i.__importStar(F),t.WATERMARKING_PANE_POSITION_BUTTON_CLASSNAME="watermarking-pane__position-button",(function(e){e.TEXT="watermark_pane_text_tab",e.IMAGE="watermark_pane_image_tab"})(U||(U={}));const B=4*Math.pow(10,6),W=()=>r.default.createElement("svg",{width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.default.createElement("circle",{className:"northwest",cx:"7",cy:"7",r:"2"}),r.default.createElement("circle",{className:"northeast",cx:"17",cy:"7",r:"2"}),r.default.createElement("circle",{className:"southeast",cx:"17",cy:"17",r:"2"}),r.default.createElement("circle",{className:"southwest",cx:"7",cy:"17",r:"2"}),r.default.createElement("circle",{className:"center",cx:"12",cy:"12",r:"2"}));W.displayName="PositionIcon";const V=[{key:I.WatermarkPosition.CENTER,description:b.intl.formatMessage({id:"2FTkI8",defaultMessage:"Center"})},{key:I.WatermarkPosition.NORTHWEST,description:b.intl.formatMessage({id:"0A9340",defaultMessage:"Upper left"})},{key:I.WatermarkPosition.NORTHEAST,description:b.intl.formatMessage({id:"DeXDpY",defaultMessage:"Upper right"})},{key:I.WatermarkPosition.SOUTHWEST,description:b.intl.formatMessage({id:"ON2oaH",defaultMessage:"Lower left"})},{key:I.WatermarkPosition.SOUTHEAST,description:b.intl.formatMessage({id:"JHqw26",defaultMessage:"Lower right"})},{key:I.WatermarkPosition.REPEAT,description:b.intl.formatMessage({id:"v5qde2",defaultMessage:"Repeat"})}],K=[{key:"black",description:b.intl.formatMessage({id:"GDUcy7",defaultMessage:"Dark"})},{key:"white",description:b.intl.formatMessage({id:"9QTLF+",defaultMessage:"Light"})}];class j extends r.default.Component{constructor(){super(...arguments),this.defaultText="",this.getTiledImageWatermark=()=>{const{watermarkState:e,tilingRenderer:t}=this.props,i=t(I.getWatermarkingOptions(e).scale),r=i.canvas.toDataURL().split(",",2).pop();if(r)return Object.assign(Object.assign({},i),{image:r})},this.getImageWatermark=()=>{const{watermarkState:e}=this.props;let t,i;if(e.mode===I.WatermarkingMode.TEXT){if(i=e.textWatermarkingOptions,!i.text)return;t=v.drawTextTile(i.text,i.size*i.scale,i.fontFamily,i.color,i.opacity/100,i.angle/180*Math.PI).canvas}else{if(i=e.imageWatermarkingOptions,!i.image)return;t=v.drawImageTile(i.image,i.size*i.scale,i.opacity/100,i.angle/180*Math.PI).canvas}if(t)return{image:t.toDataURL().split(",",2).pop(),position:i.position,marginX:i.position===I.WatermarkPosition.CENTER?0:i.marginX,marginY:i.position===I.WatermarkPosition.CENTER?0:i.marginY}},this.commitAndRedirect=e=>i.__awaiter(this,void 0,void 0,(function*(){const{watermarkState:t}=this.props,i=I.getWatermarkingOptions(t).position===I.WatermarkPosition.REPEAT?this.getTiledImageWatermark():this.getImageWatermark();if(!i)return;if(i.image.length>B)return _.Snackbar.fail(b.intl.formatMessage({id:"g1Qc/Z",defaultMessage:"That’s too big to save. Try making your watermark smaller."}),"watermarking-notification");let r;_.Snackbar.sync(b.intl.formatMessage({id:"sN5g4y",defaultMessage:"Watermarking file..."}),!1,"watermarking-notification");try{r=yield w.sendWatermarkRequest(this.props.user.id,this.props.file.file_id,e,i)}catch(e){let t;return t=M.isOverQuotaError(e.error)?b.intl.formatMessage({id:"ztdrtc",defaultMessage:"The watermark could not be saved because your account is over quota."}):M.isFilesystemError(e.error)?b.intl.formatMessage({id:"pHFNKD",defaultMessage:"The watermark could not be saved because the file was moved or deleted."}):M.isUnsupportedFileError(e.error)?b.intl.formatMessage({id:"1GlT+b",defaultMessage:"Watermarking is not available for this file type."}):M.isUnauthorizedAccessError(e.error)?b.intl.formatMessage({id:"sCMFzX",defaultMessage:"The watermark could not be saved because you do not have permission to save to this folder."}):b.intl.formatMessage({id:"PUQ8kA",defaultMessage:"Couldn’t save watermark. Refresh the page to try again."}),_.Snackbar.fail(t,"watermarking-notification")}const s=r.fq_path||u.isBrowseFile(this.props.file)&&this.props.file.fq_path;s?F.replace_location(c.preview_uri_for_fq_path(this.props.user,s,{context:A.PreviewSourceContext.Workflow})):F.reload()})),this.updateCommonWatermarkingOptions=e=>{const{watermarkState:t}=this.props;t.mode===I.WatermarkingMode.TEXT?this.updateTextWatermarkingOptions(e):this.updateImageWatermarkingOptions(e)},this.updateTextWatermarkingOptions=e=>{this.props.updateWatermarkOptions({textWatermarkingOptions:e})},this.updateImageWatermarkingOptions=e=>{this.props.updateWatermarkOptions({imageWatermarkingOptions:e})},this.debouncedLogOpacityChange=a.debounce(e=>{p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkTransparencyChanged,L.getWatermarkMilestone(this.props.user),{watermark_type:this.props.watermarkState.mode,start_transparency:String(this.startingOpacity),end_transparency:String(e)}),this.startingOpacity=void 0},200),this.handleOpacityChange=e=>{const{watermarkState:t}=this.props,i=I.getWatermarkingOptions(t).opacity;e!==i&&(this.startingOpacity=this.startingOpacity||i,this.debouncedLogOpacityChange(e),this.updateCommonWatermarkingOptions({opacity:e}))},this.debouncedLogSizeChange=a.debounce(e=>{p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkSizeChanged,L.getWatermarkMilestone(this.props.user),{watermark_type:this.props.watermarkState.mode,start_size:String(this.startingSize),end_size:String(e)}),this.startingSize=void 0},200),this.handleSizeChange=e=>{const{watermarkState:t}=this.props,i=I.getWatermarkingOptions(t).size;e!==i&&(this.startingSize=this.startingSize||i,this.debouncedLogSizeChange(e),this.updateCommonWatermarkingOptions({size:e}))},this.handleTextChange=e=>{this.textInput&&this.updateTextWatermarkingOptions({text:this.textInput.value})},this.logTextInputFocus=()=>{p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkTextInputEnterFocus,L.getWatermarkMilestone(this.props.user),{num_characters:this.textInput&&String(this.textInput.value.length)})},this.logTextInputBlur=()=>{p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkTextInputExitFocus,L.getWatermarkMilestone(this.props.user),{num_characters:this.textInput&&String(this.textInput.value.length)})},this.handleImageChange=e=>{this.updateImageWatermarkingOptions(Object.assign({image:e,imageAsDataURL:void 0},L.getImageDefaultSizes(e,this.props.pageDimensions)))},this.handlePositionChange=e=>{const{watermarkState:t}=this.props,{position:i}=I.getWatermarkingOptions(t),r={position:e};if(i===I.WatermarkPosition.REPEAT&&r.position!==I.WatermarkPosition.REPEAT&&(r.angle=0),i!==I.WatermarkPosition.REPEAT&&r.position===I.WatermarkPosition.REPEAT){const e=I.getWatermarkingOptions(M.DEFAULT_WATERMARKING_STATE);r.angle=e.angle}p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkPositionMenuSelectionMade,L.getWatermarkMilestone(this.props.user),{watermark_type:t.mode,start_position:i,end_position:e}),this.updateCommonWatermarkingOptions(r)},this.handleColorChange=e=>{p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkColorClicked,L.getWatermarkMilestone(this.props.user),{watermark_type:this.props.watermarkState.mode,color:e}),this.updateTextWatermarkingOptions({color:e})},this.handleRotationChange=e=>{const{watermarkState:t}=this.props,{angle:i}=I.getWatermarkingOptions(t);p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkRotationClicked,L.getWatermarkMilestone(this.props.user),{watermark_type:t.mode,start_rotation:String(i),end_rotation:String(e)}),this.updateCommonWatermarkingOptions({angle:e})},this.handleCancel=e=>{e.preventDefault(),this.props.changeMode(d.FileViewerMode.Documentation)},this.onTabClicked=e=>{e.currentTarget.id===U.TEXT?(p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkTextTabClicked,L.getWatermarkMilestone(this.props.user)),this.props.switchWatermarkingMode(I.WatermarkingMode.TEXT)):(p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkImageTabClicked,L.getWatermarkMilestone(this.props.user)),this.props.switchWatermarkingMode(I.WatermarkingMode.IMAGE))},this.onTabKeyUp=e=>{[P.Key.Enter," "].includes(e.key)&&(e.currentTarget.id===U.TEXT?(p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkTextTabClicked,L.getWatermarkMilestone(this.props.user)),this.props.switchWatermarkingMode(I.WatermarkingMode.TEXT)):(p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkImageTabClicked,L.getWatermarkMilestone(this.props.user)),this.props.switchWatermarkingMode(I.WatermarkingMode.IMAGE)))},this.onInputRef=e=>{this.textInput=e},this.onTabWrapperRef=e=>{this.tabWrapperRef=e?s.findDOMNode(e):null;const t=this.tabWrapperRef&&this.tabWrapperRef.querySelector('[role="tab"][aria-selected="true"]');t&&t.focus()},this.onPositionRef=e=>{this.positionRef=e},this.handleApply=e=>i.__awaiter(this,void 0,void 0,(function*(){const{isTrialMode:t,user:i,watermarkState:r}=this.props;t||(p.logWorkflowsEvent(e?p.WorkflowsEvent.WatermarkApplyOverwrite:p.WorkflowsEvent.WatermarkApplySaveAsCopy,L.getWatermarkMilestone(i),{watermark_type:r.mode,num_characters:this.textInput&&String(this.textInput.value.length),end_position:String(I.getWatermarkingOptions(r).position),end_rotation:String(I.getWatermarkingOptions(r).angle),end_size:String(I.getWatermarkingOptions(r).size),end_transparency:String(I.getWatermarkingOptions(r).opacity)}),M.setUserMetadataTextWatermarkingState(i,r),this.commitAndRedirect(e))})),this.logApplyButtonClick=()=>{p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkOpenApplyMenu,L.getWatermarkMilestone(this.props.user),{watermark_type:this.props.watermarkState.mode})},this.getDropdownDescription=(e,t)=>{const i=t.find(t=>t.key===e);return i?i.description:void 0}}componentDidMount(){const{watermarkState:e}=this.props;this.updateScale(),p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkEnable,L.getWatermarkMilestone(this.props.user),{num_characters:this.textInput&&String(this.textInput.value.length),start_position:String(I.getWatermarkingOptions(e).position),start_rotation:String(I.getWatermarkingOptions(e).angle),start_size:String(I.getWatermarkingOptions(e).size),start_transparency:String(I.getWatermarkingOptions(e).opacity)})}componentWillUnmount(){M.setUserMetadataTextWatermarkingState(this.props.user,this.props.watermarkState),p.logWorkflowsEvent(p.WorkflowsEvent.WatermarkCancel,L.getWatermarkMilestone(this.props.user),{watermark_type:this.props.watermarkState.mode})}updateScale(){const{updateWatermarkOptions:e,previewType:t}=this.props,i=M.getWatermarkScale(t);e({imageWatermarkingOptions:{scale:i},textWatermarkingOptions:{scale:i}})}render(){const{coreFVUiProps:e,file:t,watermarkState:i,user:s}=this.props,a=I.getWatermarkingOptions(i),l=i.textWatermarkingOptions,c=i.imageWatermarkingOptions,u=a.position||I.WatermarkPosition.REPEAT,p=l.color,m=i.mode===I.WatermarkingMode.TEXT&&!!l.text||i.mode===I.WatermarkingMode.IMAGE&&!!c.image;return r.default.createElement(g.EditingPane,{paneId:d.SidebarPaneId.Watermarking,coreFVUiProps:e,classname:"watermarking-pane"},r.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__actions"},r.default.createElement(D.ApplyWatermarkButton,{onApply:this.handleApply,onClick:this.logApplyButtonClick,allowWatermark:L.allowWatermark(t,s),hasInput:i.mode===I.WatermarkingMode.TEXT?!!l.text:!!c.image,trialVariant:L.getWatermarkTrialVariant(s),milestone:L.getWatermarkMilestone(s),isPlusUser:s.paid}),r.default.createElement(E.Button,{tagName:"button",variant:"secondary",onClick:this.handleCancel},L.allowWatermarkTrial(s)?b.intl.formatMessage({id:"+Dtv46",defaultMessage:"Exit"}):b.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}))),r.default.createElement(o.Wrapper,{ref:this.onTabWrapperRef},r.default.createElement(N.TabbedHeader,null,r.default.createElement(N.Tab,{id:U.TEXT,onClick:this.onTabClicked,onKeyUp:this.onTabKeyUp,active:i.mode===I.WatermarkingMode.TEXT},b.intl.formatMessage({id:"wzKMOb",defaultMessage:"Text"})),r.default.createElement(N.Tab,{id:U.IMAGE,onClick:this.onTabClicked,onKeyUp:this.onTabKeyUp,active:i.mode===I.WatermarkingMode.IMAGE},b.intl.formatMessage({id:"UOGf2g",defaultMessage:"Image"}))),r.default.createElement("div",{className:"watermarking-pane__tab-panels"},r.default.createElement(o.TabPanel,{active:i.mode===I.WatermarkingMode.TEXT,tabId:U.TEXT},r.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__text"},r.default.createElement("p",{className:"watermarking-pane__label"},b.intl.formatMessage({id:"1n+LVR",defaultMessage:"Watermark"})),r.default.createElement(y.Input,{"aria-label":b.intl.formatMessage({id:"W853K9",defaultMessage:"Text of Watermark"}),autoComplete:"off",placeholder:b.intl.formatMessage({id:"YZ+Jsk",defaultMessage:"Add watermark text"}),forwardedRef:this.onInputRef,fullWidth:!0,name:"text",value:l.text,onChange:this.handleTextChange,onFocus:this.logTextInputFocus,onBlur:this.logTextInputBlur,maxLength:100}))),r.default.createElement(o.TabPanel,{active:i.mode===I.WatermarkingMode.IMAGE,tabId:U.IMAGE},r.default.createElement("p",{className:"watermarking-pane__label","aria-hidden":!0},b.intl.formatMessage({id:"1n+LVR",defaultMessage:"Watermark"})),r.default.createElement(x.ImageChooserSection,{coreFVUiProps:e,file:t,user:this.props.user,defaultImageURL:c.image?c.image.src:void 0,onImageSelected:this.handleImageChange,focusOnSelect:this.positionRef&&this.positionRef.querySelector("button"),isImageWatermarkingMode:i.mode===I.WatermarkingMode.IMAGE})))),r.default.createElement("div",{className:n.default({"watermarking-pane__controls--disabled":!m})},r.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__position watermarking-pane__dropdown",ref:this.onPositionRef},r.default.createElement("p",{className:"watermarking-pane__label"},b.intl.formatMessage({id:"zxyFrb",defaultMessage:"Position"})),r.default.createElement(S.DropdownMenu,{disabled:!m,onSelection:this.handlePositionChange},r.default.createElement(S.DropdownMenuButton,null,r.default.createElement("span",{"aria-label":b.intl.formatMessage({id:"zxyFrb",defaultMessage:"Position"}),className:`icon icon-${u.toLowerCase()}`},r.default.createElement(W,null)),this.getDropdownDescription(u,V)),r.default.createElement(S.Menu,null,V.map(e=>r.default.createElement(S.MenuItem,{key:e.key,value:e.key,selected:e.key===u},r.default.createElement("span",{className:`icon icon-${e.key.toLowerCase()}`},r.default.createElement(W,null)),e.description))))),i.mode===I.WatermarkingMode.TEXT?r.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__dropdown watermarking-pane__color"},r.default.createElement("p",{className:"watermarking-pane__label"},b.intl.formatMessage({id:"HQyDBL",defaultMessage:"Color"})),r.default.createElement(S.DropdownMenu,{disabled:!m,onSelection:this.handleColorChange},r.default.createElement(S.DropdownMenuButton,null,r.default.createElement("span",{className:"icon watermarking-pane__color-icon",style:{backgroundColor:p}}),this.getDropdownDescription(p,K)),r.default.createElement(S.Menu,null,K.map(e=>r.default.createElement(S.MenuItem,{key:e.key,value:e.key,selected:e.key===p},r.default.createElement("span",{className:"icon watermarking-pane__color-icon",style:{backgroundColor:e.key}}),e.description))))):null,r.default.createElement("div",{className:"watermarking-pane__control watermarking-pane__rotation"},r.default.createElement("p",{className:"watermarking-pane__label"},b.intl.formatMessage({id:"kG/lBo",defaultMessage:"Rotation"})),r.default.createElement(C.RotationControl,{disabled:!m,value:a.angle,onChange:this.handleRotationChange})),r.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__opacity"},r.default.createElement("p",{className:"watermarking-pane__label"},b.intl.formatMessage({id:"8Ppp84",defaultMessage:"Opacity"})),r.default.createElement(R.Slider,{className:"watermarking-pane__opacity-slider",disabled:!m,min:0,max:100,darkMode:!0,fullWidth:!0,value:a.opacity,name:"opacity",onChange:this.handleOpacityChange})),r.default.createElement("label",{className:"watermarking-pane__control watermarking-pane__font_size"},r.default.createElement("p",{className:"watermarking-pane__label"},b.intl.formatMessage({id:"txUjQq",defaultMessage:"Size"})),r.default.createElement(R.Slider,{className:"watermarking-pane__fontsize-slider",disabled:!m,min:a.minSize,max:a.maxSize,darkMode:!0,fullWidth:!0,value:a.size,name:"fontsize",onChange:this.handleSizeChange,step:"any"}))))}}t.WatermarkingPaneComponent=j,j.displayName="WatermarkingPaneComponent";const q=l.connect((e,t)=>({mode:f.getMode(e),isTrialMode:f.getIsTrialMode(e),watermarkState:O.getWatermarkState(e),tilingRenderer:O.getWatermarkTilingFunc(e),previewType:T.getPreviewType(k.getApiDataForFile(e,t.file).data),pageDimensions:f.getPageDimensions(e)}),{changeMode:h.changeMode,updateWatermarkOptions:h.updateWatermarkOptions,switchWatermarkingMode:h.switchWatermarkingMode});t.ConnectedWatermarkingPaneComponent=q(j),t.WatermarkingPane=m.requireCssWithComponent(t.ConnectedWatermarkingPaneComponent,["/static/css/file_viewer_sidebar/watermarking_pane-vflgy-27E.css"])})),define("modules/clean/react/file_viewer_sidebar/render_utils/call_to_action",["require","exports","tslib","react","modules/clean/auth/login_or_register/types","modules/clean/react/components/modal","modules/clean/react/file_viewer_sidebar/buttons/mounted_file_actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/constants","modules/clean/react/extensions/data/types","spectrum-sharing/utils/sharing_constants","modules/clean/react/file_viewer_sidebar/buttons/shared_file_actions","modules/clean/previews/util","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/clean/react/file_viewer_sidebar/buttons/version_history_file_actions","modules/core/browser","modules/core/i18n","dig-components/buttons"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f,g,_,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderVersionHistoryActions=t.renderSharedFileActions=t.renderMountedFileActions=void 0,r=i.__importDefault(r),g=i.__importStar(g),t.renderMountedFileActions=function(e,t,i,s,n,o=!1,c=!1){if(!s)return[];const u=[r.default.createElement(a.AsyncShareButton,{key:"share",file:e,user:t,isCollapsed:o&&c}),r.default.createElement(a.AsyncSpacesDropdown,{key:"spaces",file:e,user:t,isCollapsed:o&&c})];return n?u.push(r.default.createElement(a.AsyncExtensionsButton,{key:"extension",user:t,file:e,showAsButtonIfDownloadOnly:!0,telemetryContext:{surface:"previews"},showBigTooltip:!0,onPresentInZoom:()=>{},triggerType:c&&o?d.TriggerType.CollapsedButton:void 0,isInFVSidebar:o})):u.push(r.default.createElement(a.AsyncOpenButton,{file:e,location:o?l.FileViewerPane.Sidebar:l.FileViewerPane.TitleBar,user:t,key:"open",sizeClass:i,isCollapsed:o})),u},t.renderSharedFileActions=function(t,a,f,w,b,E,S,y=!1,P=!1,C,M=!1){const k=!(!t.open_in_app_data||!t.preview_type),T=[];M&&!P&&T.push(r.default.createElement(v.Button,{variant:"primary",size:"standard",href:"https://dropbox.com/capture"},_.intl.formatMessage({id:"Z1jqLM",defaultMessage:"Try Capture for Free"})));const A=y?o.UserActionContext.Sidebar:o.UserActionContext.TitleBarMain;if(k&&S&&T.push(r.default.createElement(u.AsyncOpenInAppButton,{urls:t.open_in_app_data,userActionContext:A})),!a)if(p.isCloudDocPreview(t))T.push(r.default.createElement(u.AsyncEditNowButton,{isPrimaryButton:!k,onClick:()=>m.logUserAction(o.UserAction.SignIn,A),hideCallOut:!1,isCollapsed:y&&P}));else{const t=!k,a=P||y&&!t,l={href:void 0,onClick:()=>{m.logUserAction(o.UserAction.SignIn,A),new Promise((t,i)=>{e(["modules/clean/auth/login_or_register/modal"],t,i)}).then(i.__importStar).then(({LoginOrRegisterModal:e})=>{n.Modal.showInstance(r.default.createElement(e,{downloadAction:null,onCancel:()=>{},id:"file-viewer-sidebar-modal",initialMode:s.Mode.LOGIN,kind:s.LoginOrRegisterKind.SIDEBAR,signup_tag:"file-viewer-sidebar-modal",onAuthenticateSuccess:()=>g.reload(),encryptionOptions:C}))})}};T.push(r.default.createElement(u.AsyncSignInButton,Object.assign({isPrimaryButton:t},l,{icon:a?r.default.createElement(h.ButtonIcon,{name:"sign-in",isPrimary:!k}):void 0}))),P||M||T.push(r.default.createElement(u.AsyncSignInButton,{isPrimaryButton:!1,title:_.intl.formatMessage({id:"C4FJfI",defaultMessage:"Sign up"}),href:void 0,onClick:()=>{m.logUserAction(o.UserAction.SignUp,A),new Promise((t,i)=>{e(["modules/clean/auth/login_or_register/modal"],t,i)}).then(i.__importStar).then(({LoginOrRegisterModal:e})=>{n.Modal.showInstance(r.default.createElement(e,{downloadAction:null,onCancel:()=>{},id:"file-viewer-sidebar-modal",initialMode:s.Mode.REGISTER,kind:s.LoginOrRegisterKind.SIDEBAR,signup_tag:"file-viewer-sidebar-modal",encryptionOptions:C}))})}}))}return a&&S&&(e=>e.linkType===c.SharedLinkType.Content)(b)&&T.push(r.default.createElement("div",{className:"control__button"},r.default.createElement(u.AsyncExtensionsMenuNoUnity,{file:t,user:a,triggerType:y&&(P||0!==T.length)?d.TriggerType.CollapsedButton:void 0,isInFVSidebar:y}))),b&&E&&S&&!p.isCloudDocPreview(t)&&T.push(r.default.createElement(u.AsyncShareDownloadButton,{copyable:t,location:y?l.FileViewerPane.Sidebar:l.FileViewerPane.TitleBar,sharedLinkInfo:w,sharePermission:E,shareToken:b,user:a,isCollapsed:y&&(P||0!==T.length),encryptionOptions:C})),T},t.renderVersionHistoryActions=function(e,t,i,s,n,o=!1,d=!1){if(!i)return[];const c=[];return s&&c.push(r.default.createElement(f.RestoreButton,{key:"restore",onClick:n,isCollapsed:d})),c.push(r.default.createElement(a.AsyncOpenButton,{key:"open",file:e,user:t,isUnityDisabled:!0,isOpenWithDisabled:!0,isCloudEditorDisabled:!0,location:o?l.FileViewerPane.Sidebar:l.FileViewerPane.TitleBar,isCollapsed:o})),c}}));__createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t};define("modules/clean/react/file_viewer_sidebar/replay_prompt/async_replay_prompt",["require","exports","modules/clean/react/async/loadable"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncReplayPrompt=void 0,t.AsyncReplayPrompt=i.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer_sidebar/replay_prompt/replay_prompt"],t,i)}).then(__importStar).then(({ReplayPrompt:e})=>e)})})),define("modules/clean/react/file_viewer_sidebar/sidebar",["require","exports","tslib","react","react-redux","typescript/libraries/file-viewer/src/modes/sidebar/sidebar","modules/clean/integrations/data/selectors","modules/clean/pro_analytics/data/util","modules/clean/react/file_viewer_sidebar/utils","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","lodash","modules/clean/react/workflows/markup/utils","modules/clean/react/watermarking/utils","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer_sidebar/panes/documentation_pane","modules/clean/react/file_viewer_sidebar/panes/metadata_pane","modules/clean/react/file_viewer_sidebar/panes/commenting_pane","modules/clean/react/file_viewer_sidebar/panes/pro_analytics_pane","modules/clean/react/file_viewer_sidebar/panes/loadable_activity_pane","modules/clean/react/file_viewer_sidebar/panes/markup_pane","modules/clean/react/file_viewer_sidebar/panes/watermarking_pane","modules/clean/react/user_notifications/dropdown","modules/clean/react/extensions/file","typescript/libraries/file-viewer/src/modes/index","modules/clean/cloud_docs/constants","modules/clean/react/file_viewer/constants","modules/clean/viewer","modules/clean/react/file_viewer/logging","modules/clean/integrations/data/selectors","modules/clean/react/size_class/size_class","modules/clean/previews/constants","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer_sidebar/render_utils/call_to_action","modules/clean/react/file_viewer_sidebar/widgets/seen_states","classnames","modules/clean/react/file_viewer/ml_experiment","modules/clean/file_store/utils","modules/core/i18n","modules/clean/react/file_viewer_sidebar/esign_upsell/async_esign_upsell","modules/clean/react/file_viewer_sidebar/replay_prompt/async_replay_prompt","modules/clean/reel/lib/utils","typescript/libraries/file-viewer/src/core/data/modes/types","typescript/libraries/file-viewer/src/core/data/preview_key"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f,g,_,v,w,b,E,S,y,P,C,M,k,T,A,I,F,O,x,D,L,R,N,U,B,W,V,K,j){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sidebar=t.UnconnectedSidebar=void 0,r=i.__importDefault(r),o=i.__importStar(o),u=i.__importStar(u),L=i.__importDefault(L);var q;(function(e){e[e.MOUNTED_FILE=0]="MOUNTED_FILE",e[e.SHARED_FILE=1]="SHARED_FILE",e[e.VERSION_HISTORY=2]="VERSION_HISTORY"})(q||(q={}));class H extends r.default.PureComponent{constructor(e){super(e),this.callToActionType=e=>e.sharedLinkInfo?q.SHARED_FILE:e.isVersionHistoryMode?q.VERSION_HISTORY:q.MOUNTED_FILE,this.renderSidebarNotificationsFn=()=>{const{sharedLinkInfo:e,user:t}=this.props;return e||!t||t.is_guest_admin?null:r.default.createElement(S.UserNotificationsDropdown,{onClick:()=>T.logUserAction(M.UserAction.ClickNotifications,M.UserActionContext.Sidebar)})},this.registerSidebarPanesFn=e=>{const{brandingInfo:t,encryptionOptions:i,file:s,isViewingFileSubpath:n,isVersionHistoryMode:a=!1,previewType:o,sharedLinkInfo:l,sizeClass:d,user:c}=this.props,u=s,S={[K.SidebarPaneId.Documentation]:r.default.createElement(f.DocumentationPane,{key:"documentation-pane",coreFVUiProps:e,file:u,user:c,brandingInfo:t,sharedLinkInfo:l,maxFilenameEmLength:M.SizeClassFilenameLengthMap[d],isVersionHistoryMode:a,encryptionOptions:i}),[K.SidebarPaneId.Metadata]:r.default.createElement(g.MetadataPane,{key:"metadata-pane",coreFVUiProps:e,file:u,user:c,sharedLinkInfo:l,previewType:o}),[K.SidebarPaneId.Activity]:r.default.createElement(w.LoadableActivityPane,{key:"activity-pane",coreFVUiProps:e,file:u,user:c,isVersionHistoryMode:a})};if(n||(S[K.SidebarPaneId.Comments]=r.default.createElement(_.CommentingPane,{coreFVUiProps:e,encryptionOptions:i,user:c,key:"commenting-pane"})),c&&s){if(this.isProAnalyticsPaneEnabled){const t=c.is_team?k.Viewer.get_viewer().team_name:void 0;S[K.SidebarPaneId.ProAnalytics]=r.default.createElement(v.ProAnalyticsPane,{coreFVUiProps:e,user:c,fileId:s.file_id,isCollapsed:d===I.SizeClass.Medium,teamName:t})}m.allowWatermarkOrTrial(s,c)&&h.isFileEditable(s)&&(S[K.SidebarPaneId.Watermarking]=r.default.createElement(E.WatermarkingPane,{key:"watermarking-pane",coreFVUiProps:e,file:s,user:c})),p.allowMarkup(s)&&(S[K.SidebarPaneId.Markup]=r.default.createElement(b.MarkupPane,{key:"markup-pane",coreFVUiProps:e,file:s,user:c}))}return S},this.handleWatermarkControlClick=()=>{this.setState({watermarkControlHasBeenClicked:!0})},this.createRenderSidebarControlsFn=u.memoize(e=>t=>{const i=[r.default.createElement(P.DocumentationControl,Object.assign({key:"documentation-control"},t))],{docClassification:s,docClassificationVariant:n,file:a,hellosignAppAction:o,isHelloSignAppActionInSidebarEnabled:l,isHelloSignDeepIntegrationInSidebarEnabled:d,isSendForSignatureEnabled:c,isVersionHistoryMode:u,isViewingFileSubpath:f,onHelloSignAppActionLaunch:g,onHelloSignDeepIntegrationLaunch:_,previewType:v,user:w}=this.props;if(f||i.push(r.default.createElement(P.CommentControl,Object.assign({disabled:e[K.FileViewerMode.Commenting],key:"comment-control"},t))),this.isProAnalyticsPaneEnabled){const s=(null==w?void 0:w.is_team)?P.ProAnalyticsTeamUserControl:P.ProAnalyticsIndividualUserControl;i.push(r.default.createElement(s,Object.assign({disabled:e[K.FileViewerMode.ProAnalytics],key:"pro-analytics-control"},t)))}if(h.isFileEditable(a)&&(m.isWatermarkingEnabled(w)||m.allowWatermarkTrial(w))&&!u){const e=!m.fileIsWatermarkable(a);i.push(r.default.createElement(P.WatermarkControl,Object.assign({key:"watermarking-control",disabled:e,labelText:m.getWatermarkingLabelText(e,v),onClick:this.handleWatermarkControlClick},t)))}if(p.userCanMarkup()&&h.isFileEditable(a)&&!u){const e=!p.fileIsMarkupable(a);i.push(r.default.createElement(P.MarkupControl,Object.assign({key:"markup-control",disabled:e,labelText:p.getMarkupLabelText(e,v)},t)))}const b=void 0!==a&&R.ML_EXPERIMENT_EXTENSIONS.includes(N.getExtension(a));let E;if(n&&R.ML_ENDPOINT_FETCH_TYPES.includes(n)&&s&&s.predicted_types&&s.predicted_types.length>0)E=L.default({"hs-classification-esign":s.predicted_types.includes(R.ML_EXPERIMENT_TYPES.esign)&&n===R.ML_EXPERIMENT_TYPES.esign,"hs-classification-contract":s.predicted_types.includes(R.ML_EXPERIMENT_TYPES.contract)&&n===R.ML_EXPERIMENT_TYPES.contract});else if(n===R.ML_EXPERIMENT_TYPES.file&&a&&b){["contract","agreement","nda","proposal","offer","form","application","terms"].forEach((function(e){-1!==N.getFilename(a).toLowerCase().indexOf(e)&&(E=L.default({"hs-classification-file":!0}))}))}else n===R.ML_EXPERIMENT_TYPES.control&&b&&(E=L.default({"hs-classification-control":!0}));return d&&c&&a&&C.isHellosignFileByExtension(y.getFileExt(Object.assign(Object.assign({},a),{bytes:0})))?i.push(r.default.createElement(P.HelloSignControl,Object.assign({key:"hellosign-control",onClick:_,className:E},t))):w&&o&&l&&g&&i.push(r.default.createElement(P.HelloSignControl,Object.assign({key:"hellosign-control",className:E,onClick:g},t))),i}),this.renderSidebarCallToActionsFn=({fileViewerUiData:{sidebar:{visibility:e}}})=>{const t=this.callToActionType(this.props),i=e===K.SidebarVisibility.Closed||this.props.sizeClass===I.SizeClass.Medium;switch(t){case q.SHARED_FILE:const{sharedLinkInfo:e,shareToken:t,sharePermission:r}=this.props;return x.renderSharedFileActions(this.props.file,this.props.user,this.props.sizeClass,e,t,r,!0,!0,i,this.props.encryptionOptions,this.props.isCapture);case q.MOUNTED_FILE:return x.renderMountedFileActions(this.props.file,this.props.user,this.props.sizeClass,!0,this.props.extensionsEnabled,!0,i);case q.VERSION_HISTORY:return x.renderVersionHistoryActions(this.props.file,this.props.user,!0,!!this.props.canRestoreRevision,this.props.onRestoreRevision||(()=>{}),!0,i)}return[]},this.renderSidebarPASSFn=({fileViewerUiData:{sidebar:{visibility:e}}})=>r.default.createElement(D.AsyncSeenStateFacepileConsumer,{isCollapsed:e===K.SidebarVisibility.Closed}),this.renderSidebarUpsellFn=({fileViewerUiData:{sidebar:{visibility:e}}})=>{var t,i;return this.props.user?this.props.previewType===F.PreviewType.Video&&V.reelEntrypointsEnabled()&&e!==K.SidebarVisibility.Closed&&this.props.sizeClass!==I.SizeClass.Medium?r.default.createElement(W.AsyncReplayPrompt,{fileId:null===(t=this.props.file)||void 0===t?void 0:t.file_id}):r.default.createElement(B.AsyncEsignUpsell,{isCollapsed:e===K.SidebarVisibility.Closed||this.props.sizeClass===I.SizeClass.Medium,file:this.props.file,userId:null===(i=this.props.user)||void 0===i?void 0:i.id,launchHelloSignDeepIntegration:this.props.onHelloSignDeepIntegrationLaunch}):null},this.getPASSProviderProps=()=>{const{user:e=null,file:t,isVersionHistoryMode:i,sizeClass:r,sharePermission:s,isSeenStatesEnabled:n,isViewingFileSubpath:a,sharedLinkInfo:o}=this.props;return t?{user:e,file:t,isVersionHistoryMode:i,sizeClass:r,isViewMetadataDisabled:void 0!==s&&0===s.canViewMetadataRoles.length,isSeenStatesEnabled:n,isViewingFileSubpath:a,sharedLinkInfo:o}:null},this.state={watermarkControlHasBeenClicked:!1}}sidebarWidth(){switch(this.props.sizeClass){case I.SizeClass.ExtraLarge:return 490;case I.SizeClass.Large:return 440;case I.SizeClass.Medium:return 320;case I.SizeClass.Small:return 0}}componentWillUnmount(){this.props.resetSidebarPaneStack()}render(){const{handleSidebarDispatch:e,fileViewerUiData:t}=this.props,i={renderSidebarNotificationsFn:this.renderSidebarNotificationsFn,renderSidebarCallToActionsFn:this.renderSidebarCallToActionsFn,renderSidebarOverflowMenuFn:this.props.renderSidebarOverflowMenuFn,renderSidebarPASSFn:this.renderSidebarPASSFn,renderSidebarUpsellFn:this.renderSidebarUpsellFn},s=r.default.createElement(n.Sidebar,Object.assign({fileViewerUiData:t,fileId:"",previewKey:j.getPreviewKey("",void 0,void 0),intl:U.intl,dispatch:e,fileViewerId:"dummy",registerSidebarPanesFn:this.registerSidebarPanesFn,renderSidebarControlsFn:this.createRenderSidebarControlsFn(this.props.disabledModes),width:t.sidebar.visibility===K.SidebarVisibility.Open?this.sidebarWidth():void 0,pluginMode:{type:"default"}},i));let a;return(a=this.getPASSProviderProps())?r.default.createElement(D.AsyncSeenStatesProviderWrapper,Object.assign({},a),s):s}get isProAnalyticsPaneEnabled(){const{file:e,isViewingFileSubpath:t,sharedLinkInfo:i,user:r}=this.props;return void 0!==e&&!t&&!i&&o.isProAnalyticsEnabled(r)}}t.UnconnectedSidebar=H,H.displayName="UnconnectedSidebar",t.Sidebar=s.connect((e,{file:t})=>{const i=void 0!==t&&N.isBrowseFile(t);return{docClassification:t&&c.getDocClassificationForFile(e,t.file_id),docClassificationVariant:a.getHelloSignMLClassificationVariant(e),disabledModes:c.getDisabledModes(e),extensionsEnabled:O.getExtensionsEnabled(e),fileViewerUiData:{currentMode:c.getMode(e),sidebar:c.getSidebar(e)},isSendForSignatureEnabled:a.isSendForSignatureEnabled(e),hellosignAppAction:t&&c.getHelloSignAppActionForFile(e,t),isHelloSignAppActionInSidebarEnabled:i&&A.isHelloSignAppActionInFileViewerSidebarEnabled(e),isHelloSignDeepIntegrationInSidebarEnabled:i&&A.isHelloSignDeepIntegrationInFileViewerSidebarEnabled(e)}},e=>({handleSidebarDispatch:l.createSidebarDispatchHandler(e),changeMode:t=>e(d.changeMode(t)),resetSidebarPaneStack:()=>e(d.resetSidebarPaneStack())}))(H)})),define("modules/clean/react/file_viewer_sidebar/utils",["require","exports","modules/clean/react/file_viewer/data/actions","typescript/libraries/file-viewer/src/core/data/actions","typescript/libraries/file-viewer/src/core/data/modes/types"],(function(e,t,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSecondFromTopSidebarPaneId=t.isSidebarPaneIdAtTopOfStack=t.isSidebarOpen=t.createSidebarDispatchHandler=void 0;const n={[s.SidebarControlId.Documentation](e){e(i.changeMode(s.FileViewerMode.Documentation))},[s.SidebarControlId.Comments](e){e(i.changeMode(s.FileViewerMode.Commenting))},[s.SidebarControlId.Watermarking](e){e(i.changeMode(s.FileViewerMode.Watermarking))},[s.SidebarControlId.Zoom](e){e(i.changeMode(s.FileViewerMode.Zoom))},[s.SidebarControlId.Slack](e){e(i.changeMode(s.FileViewerMode.Slack))},[s.SidebarControlId.Markup](e){e(i.changeMode(s.FileViewerMode.Markup))},[s.SidebarControlId.HelloSign](e){e(i.changeMode(s.FileViewerMode.HelloSign))},[s.SidebarControlId.ProAnalytics](e){e(i.changeMode(s.FileViewerMode.ProAnalytics))}};t.createSidebarDispatchHandler=e=>t=>{if((function(e){return e.type===r.Action.SidebarControlClick})(t)){const i=t.payload.controlId;return(0,n[i])(e,t)}return t.type===r.Action.CloseSidebar?e(i.setSidebarVisibility(s.SidebarVisibility.Closed)):t.type===r.Action.OpenSidebar?e(i.setSidebarVisibility(s.SidebarVisibility.Open)):void 0},t.isSidebarOpen=e=>e.visibility===s.SidebarVisibility.Open,t.isSidebarPaneIdAtTopOfStack=(e,t)=>{const i=t.paneStack;return i.length>0&&i[i.length-1]===e},t.getSecondFromTopSidebarPaneId=e=>{const t=e.paneStack;return t.length<2?null:t[t.length-2]}})),define("modules/clean/react/file_viewer_sidebar/widgets/seen_states",["require","exports","tslib","react","modules/clean/react/async/loadable","modules/clean/previews/util"],(function(e,t,i,r,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncSeenStatesProviderWrapper=t.AsyncSeenStateFacepileConsumer=t.AsyncSeenStateFacepileProvider=void 0,r=i.__importDefault(r),t.AsyncSeenStateFacepileProvider=s.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/pass/seen_state_facepile_controller"],t,i)}).then(i.__importStar).then(({SeenStateFacepileProvider:e})=>e)}),t.AsyncSeenStateFacepileConsumer=s.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/pass/seen_state_facepile_consumer"],t,i)}).then(i.__importStar).then(({SeenStateFacepileConsumer:e})=>e)}),t.AsyncSeenStatesProviderWrapper=({children:e,file:i,source:s,isSeenStatesEnabled:a,isVersionHistoryMode:o,isViewingFileSubpath:l,isViewMetadataDisabled:d,sharedLinkInfo:c,sizeClass:u,soloAccessText:p,user:m})=>!a||o||null===i.ns_id||n.isCloudDocPreview(i)?r.default.createElement(r.default.Fragment,null,e):r.default.createElement(t.AsyncSeenStateFacepileProvider,{file:i,source:s,isViewMetadataDisabled:d,isViewingFileSubpath:!!l,sharedLinkInfo:c,sizeClass:u,soloAccessText:p,user:m},e),t.AsyncSeenStatesProviderWrapper.displayName="AsyncSeenStatesProviderWrapper"})),define("modules/clean/react/file_viewer_titlebar/edit_mode_titlebar",["require","exports","tslib","react","classnames","typescript/libraries/file-viewer/src/titlebar/index","modules/clean/file_store/utils","modules/clean/em_string","modules/clean/react/file_viewer/feedback_form/feedback_form_modal","spectrum/button/index","modules/core/i18n","modules/clean/react/workflows/markup/api","typescript/libraries/file-viewer/src/core/data/modes/types","modules/clean/react/size_class/constants","modules/constants/file_viewer"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditModeTitlebar=void 0,r=i.__importDefault(r),s=i.__importDefault(s);class f extends r.default.PureComponent{constructor(e){super(e),this.openFeedbackModal=()=>{this.setState({isFeedbackModalOpen:!0})},this.closeFeedbackModal=()=>{this.setState({isFeedbackModalOpen:!1})},this.renderFeedbackFormModal=()=>{if(this.props.mode===p.FileViewerMode.Markup){const e=c.intl.formatMessage({id:"eWxZ5f",defaultMessage:"How satisfied are you with Dropbox Markup?"}),t=c.intl.formatMessage({id:"Oi1tCv",defaultMessage:"Tell us what you liked and didn’t like about Dropbox Markup."});return r.default.createElement(l.FeedbackFormModal,{user:this.props.user,title:e,commentPrompt:t,open:this.state.isFeedbackModalOpen,onRequestClose:this.closeFeedbackModal,submitFeedback:u.submitMarkupFeedback})}return null},this.state={isFeedbackModalOpen:!1}}render(){const e=h.FILE_MARKUP_FEEDBACK_FORM&&this.props.mode===p.FileViewerMode.Markup&&this.props.sizeClass!==m.SizeClass.Small;return r.default.createElement("div",{className:"files2-title-bar"},r.default.createElement(n.Titlebar,{className:s.default("title"),title:r.default.createElement(r.default.Fragment,null,e&&r.default.createElement(d.Button,{className:"files2-title-bar__feedback-button",size:"large",variant:"primary",onClick:this.openFeedbackModal},c.intl.formatMessage({id:"yNdnfh",defaultMessage:"Feedback"})),r.default.createElement("h1",{className:s.default("filename")},r.default.createElement("div",{className:"filename--text"},r.default.createElement("span",{className:"filename--prefix"},this.props.title+": "),o.Emstring.em_snippet(a.getFilename(this.props.file),this.props.maxFilenameEmLength),this.props.beta?r.default.createElement("span",{className:"filename--beta-tag"},"beta"):null),this.renderFeedbackFormModal()))}))}}t.EditModeTitlebar=f,f.displayName="EditModeTitlebar"})),define("modules/clean/react/file_viewer_titlebar/loadable_icon",["require","exports","tslib","react","modules/clean/react/async/loadable"],(function(e,t,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableTitleIcon=void 0,r=i.__importDefault(r),t.LoadableTitleIcon=s.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/title_bar/title_bar_title"],t,i)}).then(i.__importStar).then(({TitleBarTitle:e})=>e),loading:r.default.createElement("div",{className:"react-title-icon"})}),t.LoadableTitleIcon.displayName="LoadableTitleIcon"})),define("modules/clean/react/file_viewer_titlebar/loadable_title",["require","exports","tslib","react","modules/clean/react/async/loadable"],(function(e,t,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadableTitle=void 0,r=i.__importDefault(r),t.LoadableTitle=s.Loadable({loader:()=>new Promise((t,i)=>{e(["modules/clean/react/file_viewer/title_name"],t,i)}).then(i.__importStar).then(({TitleName:e})=>e),loading:r.default.createElement("div",{className:"react-title-name"})})})),define("modules/clean/react/file_viewer_titlebar/titlebar",["require","exports","tslib","typescript/libraries/file-viewer/src/titlebar/index","modules/clean/file_store/utils","modules/clean/react/file_viewer/title_utils","modules/clean/react/file_viewer_titlebar/loadable_icon","modules/clean/react/file_viewer_titlebar/loadable_title","modules/clean/react/size_class/constants","react","spectrum/file_icon/index","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/constants","modules/clean/react/size_class/size_class","classnames"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileTitleBar=t.Titlebar=void 0,d=i.__importDefault(d),h=i.__importDefault(h);class f extends d.default.PureComponent{constructor(){super(...arguments),this.overrideIcon=this.props.hidePageChrome?d.default.createElement("div",{className:"file-icon"},d.default.createElement(c.FileIcon,{path:s.getFilename(this.props.file)})):null}render(){return d.default.createElement("div",{className:"files2-title-bar"},d.default.createElement(r.Titlebar,Object.assign({className:h.default("title",{isSidebarOpen:this.props.isSidebarOpen}),title:d.default.createElement(o.LoadableTitle,{file:this.props.file,fileSubpath:this.props.fileSubpath,hidePageChrome:this.props.hidePageChrome,isViewingFileSubpath:this.props.isViewingFileSubpath,maxFilenameEmLength:this.props.maxFilenameEmLength,sharedLinkInfo:this.props.sharedLinkInfo,sizeClass:this.props.sizeClass,user:this.props.user}),icon:this.props.hideIcon?null:d.default.createElement(a.LoadableTitleIcon,{closeTitle:n.closeButtonTitle({file:this.props.file,fileViewAction:this.props.fileViewAction,fileViewOrigin:this.props.fileViewOrigin,sharedLinkInfo:this.props.sharedLinkInfo,isVersionHistoryMode:this.props.isVersionHistoryMode}),canClose:this.props.canClose,closeUrl:this.props.closeUrl,file:this.props.file,isSendForSignatureMode:!1,isSigningMode:!1,onClose:this.props.onClose,shouldShowIcon:!this.props.isViewingFileSubpath,sizeClass:this.props.sizeClass,overrideIcon:this.overrideIcon})},{renderTitleOverflowMenuFn:this.props.sizeClass===l.SizeClass.Small?this.props.renderTitlebarOverflowMenuFn:void 0})))}}t.Titlebar=f,f.displayName="Titlebar",t.FileTitleBar=m.withSizeClass(f,{isResponsiveEnabled:u.isResponsiveEnabled,responsiveClassName:p.ResponsiveClassName})})),define("modules/clean/react/file_viewer_sidebar/panes/pro_analytics_pane",["require","exports","tslib","react","typescript/libraries/file-viewer/src/modes/index","typescript/libraries/file-viewer/src/core/data/modes/types","typescript/component_libraries/pro-ui/src/components/sidebar_pane/analytics_pane/index","typescript/component_libraries/pro-ui/src/data/amp-logger","react-redux","modules/clean/pro_analytics/data/store","modules/core/i18n","react-intl","modules/clean/metrics/index","modules/core/user_i18n","modules/clean/pro_analytics/data/util","modules/clean/react/pass/utils","modules/core/browser","dig-components/banner","dig-components/buttons","modules/constants/file_viewer","modules/core/persistence/storage","modules/core/exception"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f,g,_,v,w,b,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProAnalyticsPane=void 0,r=i.__importDefault(r),m=i.__importStar(m);t.ProAnalyticsPane=({coreFVUiProps:e,user:t,fileId:i,isCollapsed:S,teamName:y})=>{const[P,C]=r.default.useState(()=>{try{const e=b.UserLocalStorage.get(t.id,"pro_analytics_deprecation_banner_last_dismissed")||0;return Date.now()-e<864e5}catch(e){return E.reportException({err:e,severity:"non-critical"}),!1}}),M=w.MARKUP_ANALYTICS_DEPRECATION_BANNER,k=c.intl.formatMessage({id:"+3NTOE",defaultMessage:"Traffic and insights is going away in October, but we’re bringing you even more with DocSend."}),T=c.intl.formatMessage({id:"gk12sS",defaultMessage:"Learn more"}),A={fileId:i,getUserInitials:(e,t)=>f.AnonymousViewerUtils.isAnonymousUserId(e)?f.AnonymousViewerUtils.getAnonymousViewerInitials(t):m.getInitials(t),collapsed:S,displayStreamItemLocations:h.isProAnalyticsExperimentalEnabled(t),openTab:g.open_tab,teamName:y};return o.AmpLogger.conditionallySetSingleton(()=>p.getMetricsReporter()),r.default.createElement(l.Provider,{store:d.getProAnalyticsStore(t)},r.default.createElement(u.RawIntlProvider,{value:c.intl},r.default.createElement("div",null,r.default.createElement(s.Pane,Object.assign({paneId:n.SidebarPaneId.ProAnalytics},e),r.default.createElement(a.AnalyticsComponentPicker,Object.assign({},A))),!P&&M&&r.default.createElement(_.Banner,{withCloseButton:"Close",variant:"basic",onRequestClose:()=>{try{C(!0),b.UserLocalStorage.set(t.id,"pro_analytics_deprecation_banner_last_dismissed",Date.now())}catch(e){E.reportException({err:e,severity:"non-critical"})}},style:{position:"absolute",bottom:"0px",margin:"24px",zIndex:11,backgroundColor:"rgb(245,230,235)"}},r.default.createElement(_.Banner.Message,null,k),r.default.createElement(_.Banner.Actions,null,r.default.createElement(v.Button,{variant:"transparent",href:"https://help.dropbox.com/files-folders/share/traffic-insights"},T))))))},t.ProAnalyticsPane.displayName="ProAnalyticsPane"})),define("modules/clean/react/pass/store",["require","exports","tslib","lodash","modules/clean/flux/base_store","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/core/assert","modules/core/exception"],(function(e,t,i,r,s,n,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.passStore=t.PassStore=void 0,r=i.__importStar(r),l=i.__importStar(l);class d{constructor(){this.userIdToUniqueIds={}}addUniqueUser(e,t){e in this.userIdToUniqueIds||(this.userIdToUniqueIds[e]={}),this.userIdToUniqueIds[e][t]=!0}removeUniqueUser(e,t){e in this.userIdToUniqueIds&&t in this.userIdToUniqueIds[e]&&(delete this.userIdToUniqueIds[e][t],Object.keys(this.userIdToUniqueIds[e]).length||delete this.userIdToUniqueIds[e])}getOnlineUserIds(){return Object.keys(this.userIdToUniqueIds)}}class c extends s.Store{constructor(e){super(e),this.seenStateInfos={},this.seenStateCursors={},this.presenceInfos={},this.passFetchingStatusMap={},this.userIdsWithoutSeenStateInfoMap={},this.userIdsWithoutTeamInteractionInfoMap={},this.userTeamInteractionInfoMap={},this.passPermissions={}}presence(e){return e in this.presenceInfos?this.presenceInfos[e].getOnlineUserIds():null}seenStateInfo(e){return this.seenStateInfos[e]||null}identifiedSeenStateInfo(e){if(e in this.seenStateInfos){return{seen_states:r.reject(this.seenStateInfos[e].seen_states,a.AnonymousViewerUtils.isAnonymousSeenState)}}return null}seenStateCursorHasNext(e){return e in this.seenStateCursors?this.seenStateCursors[e].has_next:null}seenStateCursorState(e){return e in this.seenStateCursors?this.seenStateCursors[e].cursor_state:null}passFetchingStatus(e){return this.passFetchingStatusMap[e]||n.PassFetchingStatus.NOT_YET_KNOWN}getLinkAndGroupSeenStateInfo(e){let t=null,i=null;if(!this.seenStateInfos[e])return{linkSeenStateInfo:t,groupSeenStateInfo:i};t=[],i={};for(const r of this.seenStateInfos[e].seen_states)if(!a.AnonymousViewerUtils.isAnonymousSeenState(r)){const{seen_state_user:{sharing_access_type:e}}=r;if(e)switch(e.type){case"link_only":case"view_link_access":case"edit_link_access":t.push(r);break;case"view_member_access":case"edit_member_access":const s=e.value.group_ids;for(const e of s)e in i||(i[e]=[]),i[e].push(r)}}return{linkSeenStateInfo:t,groupSeenStateInfo:i}}anonymousPresence(e){return e in this.presenceInfos?a.AnonymousViewerUtils.getAnonymousUserIds(this.presenceInfos[e].getOnlineUserIds()):null}userIdsWithoutSeenStateInfo(e){return this.userIdsWithoutSeenStateInfoMap[e]||[]}userIdsWithoutTeamInteractionInfo(e){return this.userIdsWithoutTeamInteractionInfoMap[e]||[]}userTeamInteractionInfo(e){return this.userTeamInteractionInfoMap[e]||{}}isPassPermissionsPending(e){const t=this.passPermissions[e];return null!=t&&!(t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState")&&t.hasOwnProperty("canWritePresence"))}getPassPermissions(e){if(!e)return null;const t=this.passPermissions[e];return null==t||this.isPassPermissionsPending(e)?null:t}resetPassInfo(e){delete this.seenStateInfos[e],delete this.seenStateCursors[e],delete this.presenceInfos[e],delete this.passFetchingStatusMap[e],delete this.passPermissions[e],delete this.userIdsWithoutSeenStateInfoMap[e],this.emit_change()}setPassPermissionRequest(e){this.passPermissions[e]={},this.setPassFetchingStatus(e,n.PassFetchingStatus.FETCHING)}updatePermissions(e,t){this.passPermissions.hasOwnProperty(e)&&(this.passPermissions[e]=Object.assign(Object.assign({},this.passPermissions[e]),t),this.emit_change())}markPassConcludedIfNecessary(e){const t=this.passPermissions[e];!(t&&t.hasOwnProperty("canReadPresence")&&t.hasOwnProperty("canReadSeenState"))||t.canReadPresence||t.canReadSeenState||(this.resetPassInfo(e),this.setPassFetchingStatus(e,n.PassFetchingStatus.CONCLUDED),this.updateSeenStateInfoWithEmptyData(e))}receivePresenceDelta(e,t,i,r){o.assert(-1===[n.PassFetchingStatus.FETCHING,n.PassFetchingStatus.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t)),"Before handling a presence delta, you must call assurePresenceSuccessRegistered");const s=this.getOnlineUsersForFileId(t);this.updatePresenceInfos(t,i,r),this.updateUserIdsWithoutSeenStateInfo(e,t,s),this.emit_change()}receivePresenceSnapshot(e,t,i){o.assert(-1===[n.PassFetchingStatus.FETCHING,n.PassFetchingStatus.NOT_YET_KNOWN].indexOf(this.passFetchingStatus(t)),"Before handling a presence delta, you must call assurePresenceSuccessRegistered");const r=this.getOnlineUsersForFileId(t);this.presenceInfos[t]=new d,this.updatePresenceInfos(t,i,{}),this.updateUserIdsWithoutSeenStateInfo(e,t,r),this.emit_change()}getOnlineUsersForFileId(e){return e in this.presenceInfos||(this.presenceInfos[e]=new d),this.presenceInfos[e].getOnlineUserIds()}updatePresenceInfos(e,t,i){for(const t of Object.keys(i))for(const r of Object.keys(i[t]))this.presenceInfos[e].removeUniqueUser(t,r);for(const i of Object.keys(t))for(const r of Object.keys(t[i]))this.presenceInfos[e].addUniqueUser(i,r)}updateUserIdsWithoutSeenStateInfo(e,t,i){let s;const o=a.AnonymousViewerUtils.filterAnonymousUserIds(this.getOnlineUsersForFileId(t)),l=a.AnonymousViewerUtils.filterAnonymousUserIds(i),d=r.difference(l,o),c=r.difference(o,l);if(t in this.seenStateInfos){let e;const i=this.passFetchingStatus(t);if(-1!==[n.PassFetchingStatus.SEEN_STATE_DISALLOWED,n.PassFetchingStatus.PASS_MIXED_SUCCESS].indexOf(i))({userIdsWithoutSeenStateInfo:s,baseSeenStateInfo:e}=this.createMinimalBaseSeenStateInfo(t,o)),this.updateSeenStateInfo(t,e);else{const i=this.makeSeenStateAgreeWithUpdatedPresence(t,o,d,c);({userIdsWithoutSeenStateInfo:s,baseSeenStateInfo:e}=i)}}else s=[];this.userIdsWithoutSeenStateInfoMap[t]=s}makeSeenStateAgreeWithUpdatedPresence(e,t,i,r){const s=[],n=this.seenStateInfos[e],a=n.seen_states,o=[],l=[],d=[],c=Date.now()/1e3;for(const e of a){const t=e.seen_state_user.user_id;t&&(s.push(t),r.includes(t)?(e.when_last_seen=c,e.seen_events=e.seen_events||[],l.push(e)):i.includes(t)?(e.when_last_seen=c,e.seen_events=e.seen_events||[],e.seen_events.push({ts:c}),d.push(e)):o.push(e))}return n.seen_states=[...l,...d,...o],{userIdsWithoutSeenStateInfo:t.filter(e=>!s.includes(e)),baseSeenStateInfo:n}}createMinimalBaseSeenStateInfo(e,t){const i=[],s=[];for(const r of this.seenStateInfos[e].seen_states){const e=r.seen_state_user.user_id;e&&t.includes(e)&&(i.push(r),s.push(e))}return{userIdsWithoutSeenStateInfo:r.difference(t,s),baseSeenStateInfo:{seen_states:i}}}updateSeenStateInfo(e,t,i=!1){o.assert(-1===[null,n.PassFetchingStatus.FETCHING].indexOf(this.passFetchingStatus(e)),"Before updating seen state info, you must call assureSeenStateSuccessRegistered or onFetchSeenStateDisabled"),i&&e in this.seenStateInfos?this.seenStateInfos[e].seen_states=this.seenStateInfos[e].seen_states.concat(t.seen_states):this.seenStateInfos[e]=t,this.userIdsWithoutTeamInteractionInfoMap[e]=this.userIdsWithoutSeenStateInfoMap[e],this.userIdsWithoutSeenStateInfoMap[e]=[],this.emit_change()}updateSeenStateInfoWithEmptyData(e){this.updateSeenStateInfo(e,{seen_states:[]})}setPassFetchingStatus(e,t){this.passFetchingStatusMap[e]=t,this.emit_change()}updateSeenStateCursor(e,t){t&&(this.seenStateCursors[e]=t,this.emit_change())}assureSeenStateSuccessRegistered(e){switch(this.passFetchingStatus(e)){case n.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,n.PassFetchingStatus.SEEN_STATE_SUCCESS);break;case n.PassFetchingStatus.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,n.PassFetchingStatus.PASS_SUCCESS);break;case n.PassFetchingStatus.SEEN_STATE_DISALLOWED:l.reportStack("Debugging FETCHING_STATUS: pass fetching status is seen state disallowed",{severity:l.SEVERITY.NONCRITICAL,tags:["pass:fetch_seen_state_disallowed"],exc_extra:{storeHasPresence:e in this.presenceInfos,storeHasSeenState:e in this.seenStateInfos,passPermissions:JSON.stringify(this.passPermissions[e]),fetchingStatus:this.passFetchingStatusMap[e]}});break;case n.PassFetchingStatus.NOT_YET_KNOWN:l.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}}onFetchSeenStateDisabled(e){switch(this.passFetchingStatus(e)){case n.PassFetchingStatus.PRESENCE_SUCCESS:this.setPassFetchingStatus(e,n.PassFetchingStatus.PASS_MIXED_SUCCESS);break;case n.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,n.PassFetchingStatus.SEEN_STATE_DISALLOWED);break;case n.PassFetchingStatus.NOT_YET_KNOWN:l.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_seen_state_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}}assurePresenceSuccessRegistered(e){switch(this.passFetchingStatus(e)){case n.PassFetchingStatus.SEEN_STATE_SUCCESS:this.setPassFetchingStatus(e,n.PassFetchingStatus.PASS_SUCCESS);break;case n.PassFetchingStatus.SEEN_STATE_DISALLOWED:this.setPassFetchingStatus(e,n.PassFetchingStatus.PASS_MIXED_SUCCESS);break;case n.PassFetchingStatus.FETCHING:this.setPassFetchingStatus(e,n.PassFetchingStatus.PRESENCE_SUCCESS);break;case n.PassFetchingStatus.NOT_YET_KNOWN:l.reportStack("Debugging FETCHING_STATUS: pass fetching status is not yet known",{severity:l.SEVERITY.CRITICAL,tags:["pass:fetch_presence_success"],exc_extra:{fetchingStatus:this.passFetchingStatusMap[e]}})}}updateUserTeamInteractionInfo(e,t){if(e in t)for(const i of Object.keys(t))this.userTeamInteractionInfoMap[e][i]=t[i];else this.userTeamInteractionInfoMap[e]=t;this.userIdsWithoutTeamInteractionInfoMap[e]=[],this.emit_change()}_new_payload(e){const{type:t,data:i}=e.action;if(!i)return;let{userId:r,fileId:s,teamId:a,seenStateInfo:o,seenStateCursor:l,onlineUniqueUsers:d,offlineUniqueUsers:c,partialPermission:u,userTeamInteractionInfo:p,userTeamInteractionUserIds:m}=i;switch(r=r,s=s,a=a,o=o,l=l,d=d,c=c,u=u,p=p,m=m,t){case n.ActionTypes.FETCH_PASS_ERROR:this.setPassFetchingStatus(s,n.PassFetchingStatus.ERROR);break;case n.ActionTypes.FETCH_PASS_CONCLUDED:this.setPassFetchingStatus(s,n.PassFetchingStatus.CONCLUDED),this.updateSeenStateInfoWithEmptyData(s);break;case n.ActionTypes.PASS_PERMISSION_REQUEST:this.setPassPermissionRequest(s);break;case n.ActionTypes.RECEIVE_PRESENCE_DELTA:this.assurePresenceSuccessRegistered(s),this.receivePresenceDelta(r,s,d,c);break;case n.ActionTypes.RECEIVE_PRESENCE_SNAPSHOT:this.assurePresenceSuccessRegistered(s),this.receivePresenceSnapshot(r,s,d);break;case n.ActionTypes.RESET_PASS_INFO:this.resetPassInfo(s);break;case n.ActionTypes.UPDATE_PERMISSIONS:this.updatePermissions(s,u),this.markPassConcludedIfNecessary(s);break;case n.ActionTypes.DISCONTINUE_SEEN_STATE_INFO:l={cursor_state:"",has_next:!1},this.updateSeenStateCursor(s,l);break;case n.ActionTypes.UPDATE_SEEN_STATE_INFO:this.assureSeenStateSuccessRegistered(s),this.updateSeenStateInfo(s,o),this.updateSeenStateCursor(s,l);break;case n.ActionTypes.UPDATE_SEEN_STATE_INFO_CONTINUE:this.assureSeenStateSuccessRegistered(s),this.updateSeenStateInfo(s,o,!0),this.updateSeenStateCursor(s,l);break;case n.ActionTypes.UPDATE_SEEN_STATE_UNAVAILABLE:this.onFetchSeenStateDisabled(s),this.updateSeenStateInfoWithEmptyData(s),this.updateUserIdsWithoutSeenStateInfo(r,s,[]);break;case n.ActionTypes.UPDATE_USER_TEAM_INTERACTION_INFO:this.updateUserTeamInteractionInfo(s,p)}}}t.PassStore=c,t.passStore=new c})),define("modules/clean/pro_analytics/data/util",["require","exports","modules/constants/file_viewer"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isProAnalyticsExperimentalEnabled=t.isProAnalyticsEnabled=void 0,t.isProAnalyticsEnabled=function(e){return Boolean(e&&i.SMART_LINKS_ANALYTICS_BY_USER_ID[e.id])},t.isProAnalyticsExperimentalEnabled=function(e){return!1}})),define("modules/clean/auth/login_or_register/types",["require","exports"],(function(e,t){"use strict";var i,r,s,n;Object.defineProperty(t,"__esModule",{value:!0}),t.Mode=t.LoginOrRegisterKind=t.DownloadAction=t.CommentTextVariant=void 0,(function(e){e.COMMENT="comment",e.DOWNLOAD="download",e.IMMEDIATE="immediate",e.SIDEBAR="sidebar",e.POSTDOWNLOAD="postdownload",e.MOUNT="mount"})(i||(i={})),t.LoginOrRegisterKind=i,(function(e){e.DIRECT_DOWNLOAD="direct_download",e.SAVE_TO_DROPBOX="add_to_dropbox"})(r||(r={})),t.DownloadAction=r,(function(e){e[e.LOGIN=0]="LOGIN",e[e.REGISTER=1]="REGISTER"})(s||(s={})),t.Mode=s,(function(e){e.DEFAULT="",e.POST="post_comment_variant",e.SUBSCRIBE="subscribe_variant"})(n||(n={})),t.CommentTextVariant=n})),define("modules/clean/react/keyboard_binding/keyboard_binding",["require","exports","tslib","lodash","ts-keycode-enum"],(function(e,t,i,r,s){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.withPreventDefault=t.isKeyboardEvent=t.getPrintKeyBindings=t.getMinusKeyBindings=t.getEqualsKeyBindings=t.addLegacyPropertiesToSimpleKeyboardEvent=t.getSimpleKeyboardEvent=t.getKeyboardEventCriteria=t.hydrateKeyboardBinding=t.generateUnmodifiedSimpleKeyboardEvent=t.generateUnmodifiedKeyboardEventCriteria=t.KeyboardEventCriteriaKeys=t.SimpleKeyboardEventKeys=t.genericKeyboardEventCriteria=t.ExtraKeyCodes=void 0,r=i.__importStar(r),(function(e){e[e.EQUALS=61]="EQUALS",e[e.PLUS_EQUALS_FF=107]="PLUS_EQUALS_FF",e[e.PLUS_EQUALS_FF_GERMAN=171]="PLUS_EQUALS_FF_GERMAN",e[e.MINUS_FF_MAC=173]="MINUS_FF_MAC",e[e.MINUS_FF=109]="MINUS_FF"})(n=t.ExtraKeyCodes||(t.ExtraKeyCodes={})),t.genericKeyboardEventCriteria={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};const a={altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1,which:0};t.SimpleKeyboardEventKeys=Object.keys(a),t.KeyboardEventCriteriaKeys=Object.keys(t.genericKeyboardEventCriteria),t.generateUnmodifiedKeyboardEventCriteria=function(e){return Object.assign(Object.assign({},t.genericKeyboardEventCriteria),{which:e})},t.generateUnmodifiedSimpleKeyboardEvent=function(e){return Object.assign(Object.assign({},a),{which:e})};const o=()=>{};function l(e){return{keyboardEventCriteria:Object.assign(Object.assign({},t.genericKeyboardEventCriteria),e.keyboardEventCriteria),callback:null!=e.callback?e.callback:o}}function d(e){return r.flatten(e.map((t="shiftKey",e=>(function(e,t){return[{which:e,[t]:!0},{which:e,[t]:!1}]})(e,t))));var t}function c(e,t){return e.map(e=>l({keyboardEventCriteria:e,callback:t}))}t.hydrateKeyboardBinding=l,t.getKeyboardEventCriteria=function(e){return{altKey:!!e.altKey,ctrlKey:!!e.ctrlKey,metaKey:!!e.metaKey,shiftKey:!!e.shiftKey,which:e.which||e.keyCode}},t.getSimpleKeyboardEvent=function(e){return{altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,which:e.which||e.keyCode}},t.addLegacyPropertiesToSimpleKeyboardEvent=function(e){return Object.assign(Object.assign({},e),{keyCode:null!=e.keyCode?e.keyCode:e.which})};const u=d([n.EQUALS,n.PLUS_EQUALS_FF,s.Key.PlusSign,n.PLUS_EQUALS_FF_GERMAN]),p=d([s.Key.Dash,n.MINUS_FF_MAC,n.MINUS_FF]),m=[{which:s.Key.P},{which:s.Key.P,ctrlKey:!0},{which:s.Key.P,metaKey:!0}];function h(e){return void 0!==e.preventDefault}t.getEqualsKeyBindings=function(e){return c(u,e)},t.getMinusKeyBindings=function(e){return c(p,e)},t.getPrintKeyBindings=function(e){return c(m,e)},t.isKeyboardEvent=h,t.withPreventDefault=function(e){return function(t){e(),t&&h(t)&&t.preventDefault()}}})),define("modules/clean/react/keyboard_binding/keyboard_binding_connector",["require","exports","tslib","react","modules/clean/react/keyboard_binding/keyboard_binding_provider"],(function(e,t,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardBindingConnector=void 0,r=i.__importDefault(r);class n extends r.default.Component{constructor(e,t){if(super(e,t),!t.registerKeyBindings||!t.unregisterKeyBindings)throw new Error("KeyboardBindingConnector must be a child of a KeyboardBindingProvider")}componentDidMount(){this.registrationIdentifier=this.context.registerKeyBindings(this.props.keyboardBindings),this.context.registerAllKeyCallback(this.registrationIdentifier,this.props.allKeyCallback)}UNSAFE_componentWillReceiveProps(e){this.props.keyboardBindings!==e.keyboardBindings&&this.context.updateKeyBindings(this.registrationIdentifier,e.keyboardBindings),this.props.allKeyCallback!==e.allKeyCallback&&this.context.registerAllKeyCallback(this.registrationIdentifier,e.allKeyCallback)}componentWillUnmount(){this.context.unregisterKeyBindings(this.registrationIdentifier)}render(){return null}}t.KeyboardBindingConnector=n,n.contextTypes=s.KeyboardBindingProviderContextTypes,n.displayName="KeyboardBindingConnector"})),define("modules/clean/react/keyboard_binding/keyboard_binding_provider",["require","exports","tslib","react","prop-types","modules/clean/callback_chain/callback_chain","ts-keycode-enum","modules/clean/react/keyboard_binding/keyboard_binding"],(function(e,t,i,r,s,n,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.simulateKeyEvent=t.generateKeyboardBindingsByCriteriaFromKeyboardBindings=t.getIndexForkeyboardBindingsByCriteria=t.KeyboardBindingProvider=t.noop=t.KeyboardBindingProviderContextTypes=void 0,r=i.__importDefault(r),s=i.__importDefault(s),t.KeyboardBindingProviderContextTypes={registerAllKeyCallback:s.default.func,registerKeyBindings:s.default.func,unregisterKeyBindings:s.default.func,updateKeyBindings:s.default.func};const l=[];t.noop=e=>{};class d extends r.default.Component{constructor(e){super(e),this.registrationIdentifier=0,this.registeredBindings=[],this.keyboardBindingsByCriteria={},this.allKeyHandlers=[],this.registerKeyBindings=e=>{const i=this.registrationIdentifier++;return this.updateKeyBindings(i,e),this.allKeyHandlers[i]||(this.allKeyHandlers[i]=t.noop),i},this.registerAllKeyCallback=(e,i)=>{this.allKeyHandlers[e]=null!=i?i:t.noop},this.unregisterKeyBindings=e=>{this.updateKeyBindings(e,[]),this.allKeyHandlers[e]=t.noop},this.updateKeyBindings=(e,t)=>{this.registeredBindings[e]=null!=t?t:[],this.keyboardBindingsByCriteria=u(this.registeredBindings)},this.onKeyDown=e=>{if(!e)return;if(o.isKeyboardEvent(e)&&!(function(e){const t=e.target||e.srcElement;if(!t)return!0;const i=t.tagName,r=e.which,s="INPUT"===i||"SELECT"===i||"TEXTAREA"===i,n=-1!==["submit","button"].indexOf(t.type),o=t.hasAttribute&&t.hasAttribute("contenteditable")&&"false"!==t.getAttribute("contenteditable").toLowerCase();if(s&&!n||o)return r===a.Key.Escape||r===a.Key.Tab;return!0})(e))return;const t=this.getCallbacksForKey(e);new n.CallbackChain(t).run(e)},this.allKeyHandlers=[],this.registeredBindings=[]}componentDidMount(){document.addEventListener("keydown",this.onKeyDown),this.providerIdentifier=l.length,l.push(this.onKeyDown),this.props.onSetup&&this.props.onSetup()}componentWillUnmount(){document.removeEventListener("keydown",this.onKeyDown),l[this.providerIdentifier]=t.noop,this.props.onDestroy&&this.props.onDestroy()}getChildContext(){return{registerAllKeyCallback:this.registerAllKeyCallback,registerKeyBindings:this.registerKeyBindings,unregisterKeyBindings:this.unregisterKeyBindings,updateKeyBindings:this.updateKeyBindings}}getCallbacksForKey(e){const t=c(e);return(this.keyboardBindingsByCriteria[t]||[]).concat(this.allKeyHandlers)}render(){return r.default.Children.only(this.props.children)}}function c(e){const t=o.getKeyboardEventCriteria(e);let i="";return o.KeyboardEventCriteriaKeys.forEach(e=>{i+=`${e}:${t[e]},`}),i}function u(e){return e.reduce((e,t)=>t.reduce((e,{keyboardEventCriteria:t,callback:i})=>{const r=c(t);return e[r]=e[r]||[],e[r].push(i),e},e),{})}t.KeyboardBindingProvider=d,d.childContextTypes=t.KeyboardBindingProviderContextTypes,d.displayName="KeyboardBindingProvider",t.getIndexForkeyboardBindingsByCriteria=c,t.generateKeyboardBindingsByCriteriaFromKeyboardBindings=u,t.simulateKeyEvent=function(e){const t=o.addLegacyPropertiesToSimpleKeyboardEvent(e);new n.CallbackChain(l).run(t)}})),define("modules/clean/react/previews/video/audio_waveform/utils",["require","exports","modules/clean/react/previews/video/audio_waveform/average_counter"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.returnWaveform=t.buildFromBuffer=void 0,t.buildFromBuffer=function(e,t,r,s,n){const a=e.getChannelData(0),o=new Array(t);setTimeout((function e(l){return function(){if(l>=t)return void n(o);const d=[],c=Math.ceil(l*a.length/t),u=Math.ceil((l+1)*a.length/t),p=u-c;if(p>r)for(let e=0;e<r;e++){const e=Math.floor(Math.random()*p)+c;d.push(Math.abs(a[e]))}else for(let e=c;e<u;e++){const t=Math.floor(Math.abs(a[e]));d.push(t)}const m=new i.AverageCounter;m.addArray(d),o[l]=m.getAverage(),s()&&setTimeout(e(l+1),0)}})(0),0)},t.returnWaveform=function(e,t,r=1){const s=[];if(0===e.length||t<=0||isNaN(t))return s;const n=[];for(let e=0;e<t;e++)n.push(new i.AverageCounter);let a=0,o=0;for(let i=0;i<e.length;i++){const r=e[i],l=Math.floor(i*t/e.length),d=n[l];d.add(r),s[l]=d.getAverage(),l!==o&&(a=Math.max(a,s[o]),o=l)}return a=Math.max(a,s[t-1]),s.map(e=>e*r/a)}})),define("modules/clean/react/file_sidebar/managed_comments_tab",["require","exports","tslib","react","react-redux","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/components/comments_tab","modules/clean/file_store/utils"],(function(e,t,i,r,s,n,a,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ManagedCommentsTab=t.streamFromProps=void 0,r=i.__importDefault(r),t.streamFromProps=({currentFile:e,currentFile:{bytes:t,file_id:i,ns_id:r,sjid:s},sharedLinkInfo:n,isVersionHistoryMode:a,reelId:o})=>({id:i,linkUrl:n&&n.url,ns_id:r,sjid:s,type:"file",fq_path:"fq_path"in e?e.fq_path:void 0,isVersionHistoryMode:a,bytes:t,filename:l.getFilename(e),reel_id:o});class d extends r.default.Component{constructor(e){super(e),this.setContext=e=>{this.store.dispatch(n.Actions.setFileContext({stream:t.streamFromProps(e),viewer:e.user}))},this.store=a.getStoreForComments2()}componentDidMount(){this.setContext(this.props)}UNSAFE_componentWillUpdate(e){this.setContext(e)}render(){return this.store?r.default.createElement(s.Provider,{store:this.store},r.default.createElement(o.CommentsTab,Object.assign({},this.props))):null}}t.ManagedCommentsTab=d,d.displayName="ManagedCommentsTab"})),define("modules/clean/react/comments2/data/sidebar_watcher",["require","exports","tslib","eventemitter3"],(function(e,t,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMMENTS_HIDDEN_SIGNAL=t.COMMENTS_VISIBLE_SIGNAL=t.sideChannelEventEmitter=void 0,r=i.__importDefault(r),t.sideChannelEventEmitter=new r.default,t.COMMENTS_VISIBLE_SIGNAL="comments_visible",t.COMMENTS_HIDDEN_SIGNAL="comments_hidden"})),define("modules/clean/reel/lib/utils",["require","exports","modules/constants/reel"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reelOpenWithEnabled=t.reelNewStackEnabled=t.reelFoldersEnabled=t.reelBetaSyncCollabEnabled=t.reelBetaEnabled=t.reelEntrypointsEnabled=void 0,t.reelEntrypointsEnabled=()=>"ON"===i.REEL_ENTRYPOINTS_ENABLED,t.reelBetaEnabled=()=>"OFF"!==i.REEL_FEATURE_FLAG,t.reelBetaSyncCollabEnabled=()=>"BETA_SYNC"===i.REEL_FEATURE_FLAG||"BETA_SYNC_FOLDERS"===i.REEL_FEATURE_FLAG,t.reelFoldersEnabled=()=>"BETA_SYNC_FOLDERS"===i.REEL_FEATURE_FLAG||"BETA_FOLDERS"===i.REEL_FEATURE_FLAG,t.reelNewStackEnabled=()=>"OFF"!==i.REEL_NEW_STACK_LANDING_PAGE,t.reelOpenWithEnabled=()=>"ON"===i.REEL_OPEN_WITH_ENABLED})),define("file-transfers/common/constants",["require","exports","file-transfers/common/types"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VALID_EMAIL_REGEX=t.SEND_BY_EMAIL_LIMIT_MESSAGE_LENGTH=t.SEND_BY_EMAIL_LIMIT_NUM_RECIPIENTS=t.FEEDBACK_FORM_MAX_COMMENT_LENGTH=t.S3_STATIC_URL=t.DEFAULT_MAX_UNEXPIRED_DAYS=t.DEFAULT_EXPIRATION_OPTION_PAID=t.DEFAULT_EXPIRATION_OPTION_FREE=t.DEFAULT_EXPIRATION_OPTION=t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=t.COLOR_STONE=t.BYTES_IN_GIGABYTE=t.BYTES_IN_MEGABYTE=t.BYTES_IN_KILOBYTE=t.MILLISECONDS_IN_DAY=void 0,t.MILLISECONDS_IN_DAY=864e5,t.BYTES_IN_KILOBYTE=1024,t.BYTES_IN_MEGABYTE=1048576,t.BYTES_IN_GIGABYTE=1073741824,t.COLOR_STONE="#637282",t.NOT_APPLICABLE_SATISFACTION_RATING_VALUE=-1,t.DEFAULT_EXPIRATION_OPTION=i.ExpirationOption.SEVEN_DAYS,t.DEFAULT_EXPIRATION_OPTION_FREE=i.ExpirationOption.SEVEN_DAYS,t.DEFAULT_EXPIRATION_OPTION_PAID=i.ExpirationOption.THIRTY_DAYS,t.DEFAULT_MAX_UNEXPIRED_DAYS=365,t.S3_STATIC_URL="https://showcase-marketing.dropboxstatic.com/file_transfers/backgrounds/",t.FEEDBACK_FORM_MAX_COMMENT_LENGTH=2e3,t.SEND_BY_EMAIL_LIMIT_NUM_RECIPIENTS=50,t.SEND_BY_EMAIL_LIMIT_MESSAGE_LENGTH=2e3,t.VALID_EMAIL_REGEX=/^['&A-Za-z0-9\._%+-]+@[A-Za-z0-9-][A-Za-z0-9\.-]*\.[A-Za-z]{2,15}$/i})),define("file-transfers/common/types",["require","exports"],(function(e,t){"use strict";var i,r;Object.defineProperty(t,"__esModule",{value:!0}),t.TransferShareStatus=t.ExpirationOption=void 0,(i=t.ExpirationOption||(t.ExpirationOption={}))[i.SEVEN_DAYS=7]="SEVEN_DAYS",i[i.THIRTY_DAYS=30]="THIRTY_DAYS",i[i.NINETY_DAYS=90]="NINETY_DAYS",i[i.CUSTOM=0]="CUSTOM",(r=t.TransferShareStatus||(t.TransferShareStatus={})).EXPIRED="expired",r.SHARED="shared"})),define("file-transfers/feedback-form/index",["require","exports","tslib","react","spectrum/radio_button/index","spectrum/input/index","react-intl","file-transfers/common/constants"],(function(e,t,i,r,s,n,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeedbackForm=void 0,r=i.__importStar(r),t.FeedbackForm=({comment:e,rating:t,commentPrompt:i,onRatingChange:s,onCommentsChange:d})=>{const c=a.useIntl(),u=e=>{s(parseInt(e.target.value,10))};return r.createElement("div",{className:"feedback-form"},r.createElement("div",{className:"feedback-form__satisfaction-rating-container"},r.createElement("div",{className:"feedback-form__satisfaction-rating-radio-buttons"},r.createElement(l,{currentRating:t,buttonRating:1,text:r.createElement(a.FormattedMessage,{id:"Ak0AwV",defaultMessage:"Extremely dissatisfied"}),onChange:u}),r.createElement(l,{currentRating:t,buttonRating:2,onChange:u}),r.createElement(l,{currentRating:t,buttonRating:3,text:r.createElement(a.FormattedMessage,{id:"WAMYrD",defaultMessage:"Neutral"}),onChange:u}),r.createElement(l,{currentRating:t,buttonRating:4,onChange:u}),r.createElement(l,{currentRating:t,buttonRating:5,text:r.createElement(a.FormattedMessage,{id:"WAXhkk",defaultMessage:"Extremely satisfied"}),onChange:u}),r.createElement(l,{currentRating:t,buttonRating:o.NOT_APPLICABLE_SATISFACTION_RATING_VALUE,text:r.createElement(a.FormattedMessage,{id:"TFC4CE",defaultMessage:"N/A"}),onChange:u}))),r.createElement("div",{className:"feedback-form__comments-container"},r.createElement("span",{className:"feedback-form__comments-prompt"},r.createElement("label",{htmlFor:"feedback-form__comments-textarea"},i)),r.createElement(n.TextArea,{className:"feedback-form__comments-textarea",id:"feedback-form__comments-textarea",placeholder:c.formatMessage({id:"r60TD+",defaultMessage:"Optional"}),value:e,onChange:e=>{d(e.currentTarget.value)},maxLength:o.FEEDBACK_FORM_MAX_COMMENT_LENGTH})))};const l=e=>r.createElement("div",{className:"satisfaction-rating-radio-button-block"},r.createElement(s.RadioButton,{name:"satisfaction-rating-radio-button","aria-checked":e.currentRating===e.buttonRating,checked:e.currentRating===e.buttonRating,id:e.buttonRating.toString(),onChange:e.onChange,value:e.buttonRating,className:"satisfaction-rating-radio-button"}),r.createElement("div",{className:"satisfaction-rating-radio-button-block__label"},r.createElement("span",{className:"satisfaction-rating-radio-button-block__rating-number"},e.buttonRating!==o.NOT_APPLICABLE_SATISFACTION_RATING_VALUE&&e.buttonRating),e.text&&r.createElement("span",{className:"satisfaction-rating-radio-button-block__rating-description"},e.text)));l.displayName="SatisfactionRatingRadioButtonBlock"})),define("spectrum/tabbed_header/index",["require","exports","tslib","spectrum/tabbed_header/tabbed_header","spectrum/tabbed_header/tab"],(function(e,t,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i.__exportStar(r,t),i.__exportStar(s,t)})),define("spectrum/tabbed_header/tab",["require","exports","tslib","classnames","react","react-aria-tabpanel"],(function(e,t,i,r,s,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tab=void 0,r=i.__importDefault(r),s=i.__importStar(s),t.Tab=e=>{const{children:t,className:a,id:o,ref:l}=e,d=i.__rest(e,["children","className","id","ref"]),c=r.default("mc-tabbed-header-tab",a);return s.createElement(n.Tab,Object.assign({id:o,tag:"div",className:c,ref:l},d),({isActive:e})=>{const i=r.default("mc-tabbed-header-tab-content",{"mc-tabbed-header-tab-content-selected":e});return[s.createElement("span",{key:"space",className:"mc-tabbed-header-tab-content-space"},t),s.createElement("span",{key:"content",className:i},t)]})},t.Tab.displayName="Tab"})),define("spectrum/tabbed_header/tabbed_header",["require","exports","tslib","react","react-aria-tabpanel"],(function(e,t,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TabbedHeader=void 0,r=i.__importStar(r),t.TabbedHeader=e=>{const{children:t,onSelection:n}=e,a=i.__rest(e,["children","onSelection"]);return r.createElement(s.Wrapper,Object.assign({className:"mc-tabbed-header",onChange:n},a),r.createElement(s.TabList,{tag:"ul",className:"mc-tabbed-header-list"},t&&r.Children.map(t,e=>r.createElement("li",{className:"mc-tabbed-header-item",key:e.key||void 0,role:"presentation"},e))))},t.TabbedHeader.displayName="TabbedHeader"})),define("modules/clean/react/file_viewer/surface_existing_teams_header",["require","exports","tslib","react","react-intl","dig-components/buttons","modules/clean/react/components/css","modules/core/i18n","modules/clean/react/sprite","modules/clean/react/teams/team_discovery/data/model","modules/clean/react/teams/team_discovery/data/client","modules/clean/react/teams/team_discovery/data/logger","modules/core/notify","modules/clean/react/teams/team_discovery/data/logger","modules/core/browser","api_v2/user_client"],(function(e,t,i,r,s,n,a,o,l,d,c,u,p,m,h,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SurfaceExistingTeamsHeader=t.SurfaceExistingTeamsHeaderComponent=void 0,r=i.__importStar(r),h=i.__importStar(h);const g=s.defineMessage({id:"JTdDYP",defaultMessage:"Request sent. Watch for your invite at {user_email}"}),_=s.defineMessage({id:"wFT2+k",defaultMessage:"Success! Watch for your invite at {user_email}"}),v=o.intl.formatMessage({id:"xFjOJt",defaultMessage:"Couldn’t send request. Try asking to join in person."}),w=o.intl.formatMessage({id:"cL+GSY",defaultMessage:"Couldn’t send request. Check your connection."});class b extends r.Component{constructor(e){super(e),this.state={submitting:!1},this.logger=new u.Logger}recordHeaderDismissed(e,t){return i.__awaiter(this,void 0,void 0,(function*(){const i=(new f.UserApiV2Client).ns("team_discovery");yield i.rpc("joinable_teams/dismiss",{team_id:t.id},{subjectUserId:e.id})}))}requestToJoin(e,t,i){const r=new c.LegacyClient,s=o.intl.formatMessage(g,{user_email:e.email}),n=o.intl.formatMessage(_,{user_email:e.email});r.joinTeam(t.id,"preview").then(e=>{switch(e?e.result:void 0){case d.JoinApiResultEnum.RequestSent:p.Notify.success(s),i();break;case d.JoinApiResultEnum.RequestNotSent:e.reason===d.JoinApiRetReason.Conflict?p.Notify.success(s):p.Notify.error(v),i();break;case d.JoinApiResultEnum.CanJoin:p.Notify.success(n),i();break;case void 0:p.Notify.error(w),this.setState({submitting:!1});break;default:p.Notify.error(v),i()}},()=>{p.Notify.error(w),this.setState({submitting:!1})})}render(){const{suggestTeamInfo:e,dismissHeader:t,user:i}=this.props,s=o.intl.formatMessage({id:"mkG9ta",defaultMessage:"Are you part of {team_name}?"},{team_name:e.joinableTeam.name}),a=o.intl.formatMessage({id:"xIv/b5",defaultMessage:"Join this Dropbox team for easier collaboration and instant access to team files."});return r.createElement("div",{className:"surface-existing-teams-header"},r.createElement("div",{className:"surface-existing-teams-header__primary-text"},s," "),r.createElement("div",{className:"surface-existing-teams-header__secondary-text"},a," "),r.createElement("div",{className:"surface-existing-teams-header__buttons"},r.createElement(n.Button,{inverse:!0,variant:"primary",className:"surface-existing-teams-header__primary-button",disabled:this.state.submitting,onClick:()=>{this.setState({submitting:!0}),this.requestToJoin(i,e.joinableTeam,t);const r="1"===h.get_uri().getQuery().new_user;this.logger.logClickedRequestToJoinEvent(e.joinableTeam.id,i.id,m.TeamJoinRequestOrigin.Preview,r)}},"can_auto_join"===e.joinableTeam.joinTeamRequestState[".tag"]?o.intl.formatMessage({id:"TL22S6",defaultMessage:"Join"}):o.intl.formatMessage({id:"Ugdb/e",defaultMessage:"Ask to Join"})),r.createElement(n.Button,{variant:"transparent",className:"close-button dismiss-x-icon",onClick:()=>{this.recordHeaderDismissed(i,e.joinableTeam),t()},"aria-label":o.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"})},r.createElement(l.Sprite,{group:"web",name:"close_small",alt:o.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"})}))))}}t.SurfaceExistingTeamsHeaderComponent=b,b.displayName="SurfaceExistingTeamsHeaderComponent",t.SurfaceExistingTeamsHeader=a.requireCssWithComponent(b,["/static/css/file_viewer/surface_existing_teams_header-vflN4Ae2w.css","/static/css/dig-components/index.web-vflm67Rix.css"])})),define("modules/clean/react/teams/team_discovery/data/action",["require","exports","tslib","lodash","modules/core/browser","modules/core/i18n","modules/core/notify","modules/clean/react/teams/team_discovery/data/model","modules/clean/react/teams/team_discovery/data/logger","react","modules/clean/react/snackbar","modules/clean/react/teams/team_discovery/data/utils"],(function(e,t,i,r,s,n,a,o,l,d,c,u){"use strict";var p;function m(e){const t=d.default.createElement(c.Snackbar,Object.assign({},e,{closeButtonText:"Close",id:"teamDiscovery"}));c.Snackbar.show(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ActionCreator=t.MEMBER_TO_FETCH_LIMIT=t.showSnackbar=t.ActionType=void 0,r=i.__importStar(r),s=i.__importStar(s),d=i.__importDefault(d),(function(e){e.FetchInitData="FetchInitData",e.AskToJoinTeam="AskToJoinTeam",e.PopulateServerProps="PopulateServerProps",e.UpdateRequestState="UpdateRequestState",e.LoadUserData="LoadUserData",e.LoadCurrentAccountData="LoadCurrentAccountData"})(p=t.ActionType||(t.ActionType={})),t.showSnackbar=m,t.MEMBER_TO_FETCH_LIMIT=5;t.ActionCreator=class{constructor(e,t,i,r,s,n=!1){this.apiClient=e,this.logger=t,this.selector=i,this.contUrl=r||"/install",this.signupTag=s,this.isViralFlow=n}redirectAndNotify(e,t){const i=()=>s.redirect(this.contUrl);e?a.Notify.success(n.intl.formatMessage({id:"5lxkC0",defaultMessage:"Your request to join the team was sent successfully! Redirecting..."}),t,i):a.Notify.error(n.intl.formatMessage({id:"ZPbWOT",defaultMessage:"Something went wrong with your team join request. Redirecting..."}),t,i)}joinTeamAction(e,t,i,r=!0,n,a,d=3){return(c,u)=>{c({type:p.UpdateRequestState,payload:{teamId:e.id,requestState:o.RequestState.Sending}});const h=l.TeamSuggestPageDesign.New;return this.apiClient.ns("team_discovery").rpc("joinable_teams/join",{team_id:e.id,source:t,extra:{design:h,origin:t,signup_tag:void 0===this.signupTag?"":this.signupTag,preselect_team_id:void 0===a?"":a.toString()}},{subjectUserId:i}).then(i=>{let l,f;const g=i?i.result[".tag"]:void 0;switch(g){case o.JoinApiResultEnum.RequestSent:c({type:p.AskToJoinTeam}),l="ask_to_join",f="request_sent",c({type:p.UpdateRequestState,payload:{teamId:e.id,requestState:o.RequestState.PendingApproval}}),r?this.redirectAndNotify(!0,d):m({title:o.JoinApiRetReasonToLabel(f),variant:"complete"});break;case o.JoinApiResultEnum.RequestNotSent:f=i.result.reason[".tag"],f===o.JoinApiV2RetReason.Conflict?(c({type:p.AskToJoinTeam}),l="ask_to_join",r?this.redirectAndNotify(!0,d):m({title:o.JoinApiRetReasonToLabel(f),variant:"fail"})):(this.logger.logAskToJoinErrorEvent(e.id,this.selector.getTeamDiscoveryStoreState(u()).userId,g||"unknown",f||"unknown",t),r?this.redirectAndNotify(!1,d):m({title:o.JoinApiRetReasonToLabel(f),variant:"fail"})),c({type:p.UpdateRequestState,payload:{teamId:e.id}});break;case o.JoinApiResultEnum.CanJoin:l="can_auto_join",f="can_join",r?this.isViralFlow?this.redirectAndNotify(!0,d):s.redirect(i.result.url):m({title:"Joined team",variant:"complete"}),c({type:p.UpdateRequestState,payload:{teamId:e.id,requestState:o.RequestState.Joined}});break;default:this.logger.logAskToJoinErrorEvent(e.id,this.selector.getTeamDiscoveryStoreState(u()).userId,"unknown","other",t),c({type:p.UpdateRequestState,payload:{teamId:e.id}}),r?this.redirectAndNotify(!1,d):m({title:o.JoinApiRetReasonToLabel("other"),variant:"fail"})}this.logger.logAskToJoinEvent({teamId:e.id,userId:this.selector.getTeamDiscoveryStoreState(u()).userId,joinState:l,reason:f,origin:t,team_index:n,url:"team/discover/suggest",design:h,signupTag:this.signupTag,preselectTeamId:a})})}}fetchInitialData(e,i=t.MEMBER_TO_FETCH_LIMIT,l=!0,d=""){return(t,c)=>(t({type:p.PopulateServerProps,payload:{userEmail:e.userEmail,userId:e.userId}}),this.apiClient.ns("team_discovery").rpc("joinable_teams/list",{member_to_fetch_limit:i,sharer_dbx_team_id:e.sharerDbxTeamId,include_user_collab_teams:!0,include_rejections:!l},{subjectUserId:e.userId}).then(s=>{var n,a,d;const m=r.map(s.values,o.toJoinableTeam);l&&this.logger.logExposedToSETOnSignupPage(this.selector.getTeamDiscoveryStoreState(c()).userId,e.origin,e.signupTag,m.length,null===(n=u.preselectTeam(m,e.sharerName,e.sharerDbxTeamId))||void 0===n?void 0:n.id,i,null===(a=m[0])||void 0===a?void 0:a.isSameDomain,null===(d=m[0])||void 0===d?void 0:d.isCollaborator),t({type:p.FetchInitData,payload:{joinableTeams:m,domainName:s.domain_name}})}).catch(e=>{if(!d)throw e;{const e=n.intl.formatMessage({id:"/uOUwu",defaultMessage:"We encountered an error trying to fetch teams for you to join. Redirecting to the next page..."}),t=3;a.Notify.error(e,t,()=>s.redirect(d))}}))}fetchUserData(e,t){return(i,r)=>this.apiClient.ns("team_discovery").rpc("joinable_teams/user",{dbx_account_id:t},{subjectUserId:e}).then(e=>{i({type:p.LoadUserData,payload:{userId:t,teamId:e.dbx_team_id}})})}fetchCurrentAccount(e){return(t,i)=>this.apiClient.ns("users").rpc("get_current_account",void 0,{subjectUserId:e}).then(e=>{var i;t({type:p.LoadCurrentAccountData,payload:{suggestMembersEnabled:!!(null===(i=e.team)||void 0===i?void 0:i.team_user_permissions.suggest_members_enabled)}})})}continueToNextPage(e,t){return(i,r)=>{e.preventDefault(),this.logger.logContinueToInstallEvent(this.selector.getTeamDiscoveryStoreState(r()).userId,t),e.metaKey?s.open_tab(this.contUrl):s.redirect(this.contUrl)}}}})),define("modules/clean/react/teams/team_discovery/data/client",["require","exports","modules/clean/deprecated_ajax/ajax_as_promised_jquery"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyClient=void 0;t.LegacyClient=class{joinTeam(e,t,r,s,n){return i.WebRequest({url:"/team/discover/join_ajax",data:{team_id:e,isServerView:!1,skip_email_verify:!0,source:t,design:r,origin:t,signup_tag:s,preselect_team_id:n}}).then(e=>{if(e)return JSON.parse(e)})}}})),define("modules/clean/react/teams/team_discovery/data/logger",["require","exports","tslib","modules/clean/analytics","modules/core/browser"],(function(e,t,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.AMPNamespace=t.TeamSuggestPageDesign=t.TeamJoinRequestOrigin=void 0,s=i.__importStar(s);var n,a;(function(e){e.Signup="signup",e.Preview="preview",e.Requests="requests",e.Pass="pass",e.ExistingViralInband="existing_viral_inband",e.SignupViralInband="signup_viral_inband",e.SignupViralLinksharing="signup_viral_linksharing",e.SurfaceExistingTeamHomepage="surface_existing_teams_homepage",e.ShareRequestAccessPage="share_request_access_page",e.TeamDiscoveryPageRefresh="team_discovery_page_refresh"})(n=t.TeamJoinRequestOrigin||(t.TeamJoinRequestOrigin={})),(function(e){e.New="new",e.Old="old"})(a=t.TeamSuggestPageDesign||(t.TeamSuggestPageDesign={})),(function(e){e.TEAM_DISCOVERY="team_discovery"})(t.AMPNamespace||(t.AMPNamespace={}));t.Logger=class{logAskToJoinEvent(e){const{teamId:t,userId:i,joinState:s,reason:n,origin:a,team_index:o,url:l,design:d,signupTag:c,preselectTeamId:u,numAskToJoin:p,numAutoJoin:m}=e;r.TeamsWebActionsLogger.log("clicked_req_to_join",{team_id:t,user_id:i,url:l,join_state:s,reason:n,origin:a,design:d,signup_tag:c,preselect_team_id:u,team_index:o+1,num_ask_to_join:p,num_auto_join:m})}logAskToJoinErrorEvent(e,t,i,s,n){r.TeamsWebActionsLogger.log("requested_access_to_team_error",{team_id:e,user_id:t,url:"team/discover/suggest",join_state:i,reason:s,origin:n})}logAcceptInvitation(e){r.TeamsWebActionsLogger.log("clicked_accept_invite",{team_id:e})}logTeamDiscoveryPageSeen(e,t,i){let n={};const a=[],o=[],l=[],d=[];for(const t of e)"request_approved"===t.joinTeamRequestState[".tag"]?a.push(t):"waiting_for_approval"===t.joinTeamRequestState[".tag"]?o.push(t):"can_auto_join"===t.joinTeamRequestState[".tag"]?l.push(t):"approval_required"===t.joinTeamRequestState[".tag"]&&d.push(t);n={has_pending_invite:!!t,has_outstanding_request:o.length>0,has_approved_request:a.length>0,num_auto_join:l.length,num_ask_to_join:d.length,verified:i,_tk:s.get_pathname(),url:s.get_uri().toString()},r.TeamsWebActionsLogger.log_for_category("saw_team_promo_page",r.TeamsWebActionsLogger.LOG_CATEGORY.PROMO_TEAMS,n)}logClickCancelJoinRequest(e,t){r.TeamsWebActionsLogger.log("cancel_request_to_join",{num_team_members:t,origin:n.TeamDiscoveryPageRefresh,source:"team_discovery_page",team_id:e})}logClickStartNewTeamLink(){r.TeamsWebActionsLogger.log("clicked_create_team_cta")}logEmailVerificationModalShown(e,t){r.TeamsWebActionsLogger.log("email_verification_modal_shown",{user_id:e,team_id:t})}logEmailVerifiedSnackbarShown(e){r.TeamsWebActionsLogger.log("email_verified_snackbar_shown",{user_id:e})}logContinueToInstallEvent(e,t=!1){r.TeamsWebActionsLogger.log("surface_existing_team_continue_to_install",{user_id:e,url:"team/discover/suggest",is_cancel:t},()=>{},e)}logExposedToSETOnPreviewEvent(e,t,i,s,n,a,o){r.TeamsWebActionsLogger.log("exposed_to_set_on_preview",{team_id:n,user_id:e,url:"scl/fi/:sckey/:file_name",is_cdm_member:t,user_root_permissions:i,team_member_count:a,saw_ask_to_join:s,is_new_user:o},()=>{},e)}logClickedRequestToJoinEvent(e,t,i,s){r.TeamsWebActionsLogger.log("clicked_req_to_join",{team_id:e,user_id:t,url:"scl/fi/:sckey/:file_name",origin:i,is_new_user:s},()=>{},t)}logExposedToSETOnSignupPage(e,t,i,s,n,o,l,d){r.TeamsWebActionsLogger.log("exposed_to_set_on_signup_page",{design:a.New,origin:t,signup_tag:i,number_of_teams:s,preselect_team_id:n,member_to_fetch_limit:o,first_team_same_domain:l,first_team_tc:d},()=>{},e)}logExposedToSETOnSignupPageLoadingScreen(e,t){r.TeamsWebActionsLogger.log("exposed_to_set_on_signup_page_loading",{origin:t},()=>{},e)}logUserSelectedJoinableTeam(e,t,i,r,s){this._logUserJoinableTeamChoice("user_selected_joinable_team",e,t,i,r,s)}logUserUnselectedJoinableTeam(e,t,i,r,s){this._logUserJoinableTeamChoice("user_unselected_joinable_team",e,t,i,r,s)}_logUserJoinableTeamChoice(e,t,i,s,n,o){r.TeamsWebActionsLogger.log(e,{team_id:t,design:a.New,origin:s,signup_tag:n,preselect_team_id:o},()=>{},i)}}})),define("modules/clean/react/teams/team_discovery/data/model",["require","exports","tslib","lodash","modules/core/i18n"],(function(e,t,i,r,s){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.toTeamInvite=t.toJoinableTeam=t.Pages=t.RequestState=t.JoinApiRetReasonToLabel=t.JoinApiV2RetReason=t.JoinApiRetReason=t.JoinApiResultEnum=void 0,r=i.__importStar(r),(function(e){e.RequestSent="request_sent",e.RequestNotSent="request_not_sent",e.CanJoin="can_join"})(t.JoinApiResultEnum||(t.JoinApiResultEnum={})),(function(e){e[e.Conflict=5]="Conflict"})(t.JoinApiRetReason||(t.JoinApiRetReason={})),(function(e){e.ExistsSameTeam="exists_same_team",e.ExistsDifferentTeam="exists_different_team",e.Conflict="conflict",e.MaxTeamSizeAchieved="max_team_size_achieved",e.Rejected="rejected",e.Other="other"})(t.JoinApiV2RetReason||(t.JoinApiV2RetReason={})),t.JoinApiRetReasonToLabel=function(e){return{request_sent:s.intl.formatMessage({id:"sQbTsQ",defaultMessage:"Request sent. Once it’s approved, you’ll get an invite from the team."}),exists_same_team:s.intl.formatMessage({id:"oZNXJZ",defaultMessage:"Looks like you’ve already asked to join this team."}),exists_different_team:s.intl.formatMessage({id:"mHIpiE",defaultMessage:"Looks like you already asked to join a different team."}),rejected:s.intl.formatMessage({id:"H8TlMC",defaultMessage:"Looks like this team already denied your request."}),max_team_size_achieved:s.intl.formatMessage({id:"dEJ+SP",defaultMessage:"Looks like this team size has already been reached"})}[e]||s.intl.formatMessage({id:"s86tt6",defaultMessage:"Couldn’t send request. Try asking to join in person."})},(function(e){e.Sending="sending",e.PendingApproval="pending_approval",e.Joined="joined"})(n=t.RequestState||(t.RequestState={})),(function(e){e.Suggest="TeamDiscovery/Suggest",e.Confirm="TeamDiscovery/Confirm"})(t.Pages||(t.Pages={})),t.toJoinableTeam=function(e){return{dbxTeamId:e.dbx_team_id,id:e.team_id,name:e.team_name,adminsCount:e.admins_count,membersCount:e.members_count,requestState:e.pending_request?n.PendingApproval:void 0,joinTeamRequestState:e.join_request_state,joinRequestStateDate:e.join_request_state_date,isSameDomain:e.is_same_domain,isCollaborator:e.is_collaborator,sharedFolderCount:e.shared_folder_count,sharedFileCount:e.shared_file_count,lastShareTimestamp:e.last_share_timestamp,members:r.map(e.members,e=>({memberId:e.member_id,name:e.member_name,isAdmin:e.is_admin,avatarURL:e.photo_url}))}},t.toTeamInvite=function(e){return null==e?null:{teamId:e.team_id,userName:e.inviting_user_name,signupKey:e.signup_key,isNewInviteLinkInvitation:e.is_new_invite_link_invitation}}})),define("modules/clean/react/teams/team_discovery/data/utils",["require","exports","tslib","react","modules/core/i18n","dig-components/avatar"],(function(e,t,i,r,s,n){"use strict";function a(e,t,i){const r=s.intl.formatMessage({id:"Om3b8J",defaultMessage:"{remainder, plural, =0{{adminName}} one{{adminName} + {remainder} more} few{{adminName} + {remainder} more} other{{adminName} + {remainder} more}}"},{adminName:e,remainder:t-1});return i?s.intl.formatMessage({id:"LQZIyx",defaultMessage:"{teamAdminCount, plural, one{Admin: {adminList}} other{Admins: {adminList}}}"},{teamAdminCount:t,adminList:r}):s.intl.formatMessage({id:"T2wYhx",defaultMessage:"{teamAdminCount, plural, one{Team admin: {adminList}} other{Team admins: {adminList}}}"},{teamAdminCount:t,adminList:r})}Object.defineProperty(t,"__esModule",{value:!0}),t.getSharedContentCountsText=t.toFacepileMember=t.MemberFacepileItem=t.getLastShareTimeStr=t.getSharedFolderCountStr=t.getAdminNamesStrForTeam=t.getAdminNamesStr=t.shouldShowTeamCollabContext=t.preselectTeam=void 0,r=i.__importDefault(r),t.preselectTeam=function(e,t,i){const r=e[0],s=1===e.length,n=t&&i&&r&&r.dbxTeamId===i;return s||n?r:void 0},t.shouldShowTeamCollabContext=function(e){return Array.isArray(e)||(e=[e]),e.length>0&&e.every(e=>void 0!==e.sharedFolderCount)},t.getAdminNamesStr=a,t.getAdminNamesStrForTeam=function(e,t){return a((function(e){const t=e.members.find(e=>e.isAdmin);if(void 0===t)throw new Error("No admin on team given to team card");return t.name})(e),e.adminsCount,t)},t.getSharedFolderCountStr=function(e){return s.intl.formatMessage({id:"8Izk7L",defaultMessage:"Shared {sharedFolderCount} {sharedFolderCount, plural, one {folder} other {folders}} with you"},{sharedFolderCount:e})},t.getLastShareTimeStr=function(e){return s.intl.formatMessage({id:"1Yl7QT",defaultMessage:"Last worked together {lastShareDate, date, medium}"},{lastShareDate:new Date(1e3*e)})},t.MemberFacepileItem=e=>{const{member:t}=e;return r.default.createElement(n.Facepile.Item,{backgroundColor:n.avatarColorForUserIdentifier(t.name),src:t.avatarURL},t.name.charAt(0))},t.MemberFacepileItem.displayName="MemberFacepileItem",t.toFacepileMember=function(e){return{memberKey:e.memberId.toString(),active:!0,alt:null,avatarColorSeed:e.memberId.toString(),initials:e.name.charAt(0),photoUrl:void 0===e.avatarURL?null:e.avatarURL,tooltipContent:r.default.createElement("div",null,e.name)}},t.getSharedContentCountsText=function(e){var t,i;const r=(null!==(t=e.sharedFolderCount)&&void 0!==t?t:0)>0,n=(null!==(i=e.sharedFileCount)&&void 0!==i?i:0)>0,{sharedContextText:a,getFolderInfoText:o,getFileInfoText:l}={sharedContextText:s.intl.formatMessage({id:"VbL6qJ",defaultMessage:"Shared with you:"}),getFolderInfoText:e=>s.intl.formatMessage({id:"RUN5MW",defaultMessage:"{folderCount, plural, one {# folder} other {# folders}}"},{folderCount:e.sharedFolderCount}),getFileInfoText:e=>s.intl.formatMessage({id:"7Ql6Hu",defaultMessage:"{fileCount, plural, one {# file} other {# files}}"},{fileCount:e.sharedFileCount})};return r&&n?`${a} ${o(e)}, ${l(e)}`:r?`${a} ${o(e)}`:n?`${a} ${l(e)}`:null}}));
//# sourceMappingURL=pkg-file_viewer.min.js-vflSYlY3c.map