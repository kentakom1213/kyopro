define(["require","exports","tslib","typescript/component_libraries/files_components/src/blades/file_activity/data/types","typescript/component_libraries/files_components/src/blades/file_activity/strings","typescript/component_libraries/files_components/src/blades/file_activity/types","typescript/component_libraries/files_components/src/common/filepath"],(function(e,t,a,i,s,n,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldIncludeActivity=t.countSelected=t.getActivityDisplayText=t.processEvents=void 0;t.processEvents=(e,t)=>{if(e.status!==i.EventState.loaded)return[];return e.activity.sort((e,t)=>e.timestamp<t.timestamp?1:e.timestamp>t.timestamp?-1:0).map(r(t)).reduce(E(t.intl),[])};const r=e=>a=>{const i=t.getActivityDisplayText(Object.assign({activity:a},e));return i?Object.assign({type:n.CardType.event,id:a.id,user:a.user,timestamp:a.timestamp},i):void 0},_=(e,t)=>{const a=new Date;a.setHours(0,0,0,0);const i=a.getTime(),s=i-864e5,n=new Date(t),c=n.getTime();return c>=i?e.formatMessage({id:"ihD7Zm",defaultMessage:"Today"}):c>=s?e.formatMessage({id:"ZA9ZwS",defaultMessage:"Yesterday"}):e.formatDate(n,{year:"numeric",month:"short",day:"numeric"})},E=e=>(t,a)=>{if(void 0===a)return t;const i=0===t.length?void 0:t[t.length-1],s=_(e,a.timestamp);return!i||"timestamp"in i&&_(e,i.timestamp)!==s?t.concat({type:n.CardType.dateBanner,eventCardDate:s},a):t.concat(a)},o=(e,t,a)=>t===a.id?e.formatMessage({id:"fGE/Cv",defaultMessage:"You"}):a.display_name;function d(e,t,a,i={},s){const{intl:n,viewingUserId:c,activity:{user:r}}=e;return{eventHeadline:c===r.id?n.formatMessage(t,i):n.formatMessage(a,Object.assign(Object.assign({},i),{name:r.display_name})),cardSubheading:s}}t.getActivityDisplayText=e=>{var{activity:t}=e,i=a.__rest(e,["activity"]);switch(t[".tag"]){case"add":return d(Object.assign({activity:t},i),s.YOU_ADDED_FILE,s.OTHER_ADDED_FILE);case"edit":return d(Object.assign({activity:t},i),s.YOU_EDITED_FILE,s.OTHER_EDITED_FILE);case"move":return l(Object.assign({activity:t},i));case"rename":return O(Object.assign({activity:t},i));case"view":return d(Object.assign({activity:t},i),s.YOU_VIEWED_FILE,s.OTHER_VIEWED_FILE);case"file_settings_change":return m(Object.assign({activity:t},i));case"shared_content_change":return u(Object.assign({activity:t},i));case"shared_content_invite":return p(Object.assign({activity:t},i));case"file_lock_change":return y(Object.assign({activity:t},i));case"comment_new":return d(Object.assign({activity:t},i),s.YOU_NEW_COMMENT,s.OTHER_NEW_COMMENT);case"comment_reply":return d(Object.assign({activity:t},i),s.YOU_REPLIED_COMMENT,s.OTHER_REPLIED_COMMENT);case"trello_file_activity":case"shared_link_change":case"slack_link_share":case"zoom_screen_share":return}};const l=e=>{const{activity:t,rootNamespaceName:a}=e;if("path"in t){const i=c.parentDirName(t.path)||a,n=t.last_path&&(c.parentDirName(t.last_path)||a);return n?d(e,s.YOU_MOVED_FILE_FROM_TO,s.OTHER_MOVED_FILE_FROM_TO,{source:n,destination:i}):d(e,s.YOU_MOVED_FILE_TO,s.OTHER_MOVED_FILE_TO,{destination:i})}return d(e,s.YOU_MOVED_FILE,s.OTHER_MOVED_FILE)},O=e=>{const{activity:t}=e;return"filename"in t&&t.last_filename?d(e,s.YOU_RENAMED_FILE_FROM_TO,s.OTHER_RENAMED_FILE_FROM_TO,{source:t.last_filename,destination:t.filename}):d(e,s.YOU_RENAMED_FILE,s.OTHER_RENAMED_FILE)},m=e=>{const{activity:t}=e,a="changed_viewer_info_policy"in t?t.changed_viewer_info_policy:void 0;switch(null==a?void 0:a[".tag"]){case"enabled":return d(e,s.YOU_ENABLED_VIEWER_INFO,s.OTHER_DISABLED_VIEWER_INFO);case"disabled":return d(e,s.YOU_DISABLED_VIEWER_INFO,s.OTHER_DISABLED_VIEWER_INFO);default:return d(e,s.YOU_CHANGED_FILE_SETTINGS,s.OTHER_CHANGED_FILE_SETTINGS)}};const u=e=>{const{activity:t}=e;if(!("access_type"in t))return;const a=(function(e){return e.changed_group?e.changed_group.name:e.changed_user?e.changed_user.display_name:e.changed_email?e.changed_email:void 0})(t);if(!a)return;const i={entity:a};switch(t.access_type[".tag"]){case"writer":case"owner":case"reader":return d(e,s.YOU_ENABLED_COMMENTING,s.OTHER_ENABLED_COMMENTING,i);case"reader_no_comment":return d(e,s.YOU_GAVE_VIEW_ONLY_ACCESS,s.OTHER_GAVE_VIEW_ONLY_ACCESS,i);case"no_access":return d(e,s.YOU_REMOVED_ACCESS,s.OTHER_REMOVED_ACCESS,i)}},p=e=>{const{activity:t,intl:a,viewingUserId:i}=e;if(!("shared_users"in t))return;const{shared_users:n,shared_emails:c,shared_groups:r}=t;n.sort((e,t)=>o(a,i,e).localeCompare(o(a,i,t))),c.sort(),r.sort((e,t)=>e.name.localeCompare(t.name));const _=[...n.map(e=>o(a,i,e)),...c,...r.map(e=>e.name)],E={entity:_[0],count:_.length-1};return 1===_.length?d(e,s.YOU_SHARED_WITH_ONE,s.OTHER_SHARED_WITH_ONE,E):_.length>1?d(e,s.YOU_SHARED_WITH_MANY,s.OTHER_SHARED_WITH_MANY,E):void 0},y=e=>{const{activity:t}=e;if("activity_type"in t)return"lock"===t.activity_type[".tag"]?d(e,s.YOU_LOCKED_FILE,s.OTHER_LOCKED_FILE):d(e,s.YOU_UNLOCKED_FILE,s.OTHER_UNLOCKED_FILE)};t.countSelected=e=>i.ALL_FILTER_TYPES.reduce((t,a)=>e[a]?t+1:t,0),t.shouldIncludeActivity=e=>(e=0===t.countSelected(e)?i.INCLUDE_ALL_FILTER:e,t=>{switch(t[".tag"]){case"add":return e[i.FilterType.added];case"edit":return e[i.FilterType.edited];case"move":return e[i.FilterType.moved];case"rename":return e[i.FilterType.renamed];case"view":return e[i.FilterType.viewed];case"file_settings_change":case"file_lock_change":case"shared_content_change":case"shared_content_invite":return e[i.FilterType.shared];case"comment_new":case"comment_reply":return e[i.FilterType.commented];case"trello_file_activity":case"shared_link_change":case"slack_link_share":case"zoom_screen_share":return!1}})}));
//# sourceMappingURL=utils.amd.min.js-vfl8G03F6.map