define(["require","exports","tslib","react","modules/core/i18n","spectrum/modal/index","modules/clean/static_urls","dig-components/buttons","modules/clean/ux_analytics_modal_tracking","modules/clean/react/components/css","modules/clean/react/components/modal","react-modal","lodash","modules/clean/react/extensions/common","modules/clean/react/extensions/data/helpers","modules/clean/react/extensions/data/selectors","modules/clean/react/app_actions/redirect","modules/clean/react/file_viewer/open_button/types","modules/clean/react/extensions/cloud_docs_compat","dig-components/typography","dig-components/text_fields","dig-components/icons","dig-components/icons/src","modules/clean/react/app_directory/client","dig-components/progress_indicators","classnames","lodash","modules/clean/react/app_actions/developers_site/types"],(function(e,t,a,s,n,i,r,o,c,l,d,p,m,u,h,f,_,y,g,E,x,v,M,S,A,C,N,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.showExtensionsMiniDirectoryModal=t.ExtensionsMiniDirectoryModal=t.AppDirectoryEntryPoint=void 0,s=a.__importDefault(s),p=a.__importDefault(p),m=a.__importStar(m),S=a.__importStar(S),C=a.__importDefault(C);const I=e=>"api_app"===e[".tag"]?`${e[".tag"]}/${e.api_app}`:"first_party_app"===e[".tag"]?`${e[".tag"]}/${e.first_party_app}`:`${e[".tag"]}`;function D(){return s.default.createElement("div",{className:"extensions-mini-directory-modal__directory-entry-point"},s.default.createElement(E.Link,{href:"/apps",hasNoUnderline:!0,variant:"monochromatic",className:"extensions-mini-directory-modal__directory-entry-point-text-border"},s.default.createElement(E.Text,{isBold:!0},n.intl.formatMessage({id:"LbLi52",defaultMessage:"View all apps"}))))}t.AppDirectoryEntryPoint=D;class T extends s.default.Component{constructor(e){super(e),this.hasUsedSearchBar=!1,this.onScroll=N.throttle(e=>{e>0&&!this.state.showTopBorder&&this.setState({showTopBorder:!0}),0===e&&this.state.showTopBorder&&this.setState({showTopBorder:!1})},20),this.createClickHandler=e=>()=>{d.Modal.close();const{user:t,file:a,featureFlags:s,currentSession:n,telemetryContext:i,updateLinkState:r,onProfileServiceAuth:o}=this.props;if(_.redirectToActionOrShowAuth(t,[a],e,s,i,r,o),"redirect"===e.handler[".tag"])u.logEvent(n,"select_action",u.getAppActionExtras(e));else if("cloud_editor"===e.handler[".tag"]){const t=g.isWopiAction(e)?y.OpenButtonAction.OPEN_WITH:y.OpenButtonAction.OPEN_WITH_CLOUD_DOC;u.logEvent(this.props.currentSession,"select_legacy_action",{type:t})}},this.handleQueryChange=e=>{const t=e.currentTarget.value;this.setState({searchKey:t}),this.hasUsedSearchBar||(u.logEvent(this.props.currentSession,"start_searching",{}),this.hasUsedSearchBar=!0)},this.filterActions=()=>{const{appActions:e,categoryIdToInfos:t}=this.props,a=this.state.searchKey.trim().toLowerCase(),s=e.map(e=>e.category).map(e=>t[e]).filter(e=>-1!==e.display_name.toLowerCase().indexOf(a)).map(e=>e.id);return e.filter(e=>{const t=this.getAppDirectoryPageInfo(e);return((e,t)=>t||e.app_directory_id&&"first_party_app"===e.app_directory_id[".tag"]||e.developer_state===w.DeveloperState.IN_DEVELOPMENT)(e,t)&&(-1!==e.description.toLowerCase().indexOf(a)||(e=>!(!e||!e.short_description)&&-1!==e.short_description.toLowerCase().indexOf(a))(t)||s.includes(e.category))})},this.clearSearch=()=>{this.setState({searchKey:""})},this.renderExtensionItem=e=>{const t=e.icon,a=t.is_static?r.static_url("/static/images/generic_app_icon-vflIPYT1H.png"):t.url,i=u.isLinked(e),c=i?"primary":"opacity",l=i?f.isShareAction(e)?n.intl.formatMessage({id:"NoV3Co",defaultMessage:"Share"}):n.intl.formatMessage({id:"CNPdm5",defaultMessage:"Open"}):n.intl.formatMessage({id:"vV9l+M",defaultMessage:"Connect"});return s.default.createElement("div",{className:"extension-section",key:e.description},s.default.createElement("img",{src:a,className:"extensions-icon",alt:""}),this.renderActionInfo(e),s.default.createElement("div",{className:"extensions-mini-directory-modal__redirect_button_wrapper"},s.default.createElement(o.Button,{variant:c,onClick:this.createClickHandler(e),className:"extensions-mini-directory-modal__redirect_button"},l)))},this.getAppDirectoryPageInfo=e=>{const t=e.app_directory_id&&I(e.app_directory_id);return t?this.state.appDirectoryPageInfo.get(t):void 0},this.renderActionInfo=e=>{const t=this.getAppDirectoryPageInfo(e),a=t&&t.short_description,n=t&&t.page_url,i=s.default.createElement(s.default.Fragment,null,s.default.createElement(E.Text,{tagName:"div",isBold:!0},e.description),s.default.createElement(E.Text,{color:"faint",className:"extensions-short-description",size:"small"},a));return n?s.default.createElement("div",{className:"extensions-description"},s.default.createElement(E.Link,{href:n,target:"_blank",rel:"noreferrer",variant:"monochromatic",hasNoUnderline:!0,className:"extensions-description__link"},i)):s.default.createElement("div",{className:"extensions-description"},i)},this.renderEmptySearch=()=>{const e=this.state.searchKey,t=e?`/apps/search?query=${e}`:"/apps",a=e?n.intl.formatMessage({id:"4fGTX4",defaultMessage:"Search “{search_key}” in App Center"},{search_key:e}):n.intl.formatMessage({id:"C5jY7c",defaultMessage:"Search in App Center"});return s.default.createElement("div",{className:"extensions-mini-directory-modal__empty-search-app-center"},s.default.createElement(E.Text,null,n.intl.formatMessage({id:"niuDq6",defaultMessage:"Looking for something?"})),s.default.createElement(E.Link,{href:t,variant:"monochromatic"},s.default.createElement(E.Text,null,a)))},this.state={searchKey:"",appDirectoryPageInfo:new Map,loading:!0}}componentDidMount(){const e=this.props.appActions.map(e=>e.app_directory_id).filter(e=>void 0!==e);this.fetchAppDirectoryPageInfoMap(e).then(e=>this.setState({appDirectoryPageInfo:e,loading:!1}))}fetchAppDirectoryPageInfoMap(e){return a.__awaiter(this,void 0,void 0,(function*(){return(yield S.getPageInfos(e,this.props.user.id)).reduce((function(e,t){for(const a of t.app_identifiers)e.set(I(a),t);return e}),new Map)}))}render(){const{onRequestClose:e,modalTitle:t}=this.props,a=this.filterActions().sort(h.actionCompareFn);return s.default.createElement(i.Modal,{ariaLabel:n.intl.formatMessage({id:"wjwJvt",defaultMessage:"App actions"}),className:"extensions-mini-directory-modal",displayCloseButton:!0,open:!0,overlayClassName:"file-viewer-modal-overlay",overlayFixed:!1,onRequestClose:()=>e()},this.state.loading?s.default.createElement("div",{className:"extensions-mini-directory-modal__body-loading"}," ",s.default.createElement(A.Spinner,{"aria-valuetext":"Loading Apps"})," "):s.default.createElement("div",{className:"extensions-mini-directory-modal__body-wrapper"},s.default.createElement("div",{className:C.default({"extensions-mini-directory-modal__header-border":this.state.showTopBorder})},s.default.createElement("div",{className:"extensions-mini-directory-modal__title"},s.default.createElement(E.Title,null,t)),s.default.createElement("div",{className:"extensions-mini-directory-modal__search-bar"},s.default.createElement(x.TextInput,{"aria-label":"Search Apps",withLeftAccessory:s.default.createElement(v.UIIcon,{src:M.SearchLine}),withRightAccessory:this.state.searchKey&&s.default.createElement(o.IconButton,{size:"small",variant:"transparent",onClick:this.clearSearch},s.default.createElement(v.UIIcon,{src:M.FailFill})),placeholder:n.intl.formatMessage({id:"+enW1p",defaultMessage:"Search by action or app name"}),value:this.state.searchKey,onChange:this.handleQueryChange}))),s.default.createElement("div",{className:"extensions-container",onScroll:({currentTarget:{scrollTop:e}})=>this.onScroll(e)},a.length>0?a.map(e=>this.renderExtensionItem(e)):this.renderEmptySearch()),s.default.createElement(D,null)),s.default.createElement(c.UXAnalyticsModalTracking,{id:"extensions-mini-directory-modal"}))}}T.displayName="ExtensionsMiniDirectoryModalComponent",t.ExtensionsMiniDirectoryModal=l.requireCssWithComponent(T,["/static/js/typescript/component_libraries/deep-integrations/src/index.web-vflCGVVCA.css","/static/css/app_actions/index-vflb8K3Re.css"]);const L=m.once(()=>{p.default.setAppElement(document.body)});t.showExtensionsMiniDirectoryModal=(e,a,n,i,r,o,c,l,p,m)=>{L(),d.Modal.showInstance(s.default.createElement(t.ExtensionsMiniDirectoryModal,{modalTitle:e,user:a,file:n,onRequestClose:d.Modal.close,appActions:i,categoryIdToInfos:r,featureFlags:o,updateLinkState:c,telemetryContext:l,currentSession:p,onProfileServiceAuth:m}));const{connected_apps:h,unconnected_apps:f}=u.partitionActionsByLinkStatus(i);u.logEvent(p,"view_scaling_modal",{connected_apps:h,unconnected_apps:f})}}));
//# sourceMappingURL=extensions_mini_directory_modal.min.js-vflKTke-h.map