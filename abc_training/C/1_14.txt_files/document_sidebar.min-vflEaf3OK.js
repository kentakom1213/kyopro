define(["require","exports","tslib","modules/clean/react/integrations/pdf_editor/redux/features/page_actions/page_actions_slice","classnames","modules/clean/react/integrations/pdf_editor/redux/features/sidebar_actions/sidebar_actions_slice","modules/clean/react/integrations/pdf_editor/redux/features/thunks_across_multiple_slices","modules/clean/react/integrations/pdf_editor/strings","react-beautiful-dnd","react-window","dig-components/icons/src","dig-components/buttons","react","modules/clean/react/integrations/pdf_editor/utils/reorder_util","modules/clean/react/components/css","modules/clean/react/integrations/pdf_editor/components/thumbnail","dig-components/tooltips","dig-components/icons","react-redux","react-intl","modules/clean/react/integrations/pdf_editor/redux/features/logging/logging_actions_slice","modules/clean/logging/hive/schemas/web-edit_mode"],(function(e,t,a,n,i,r,s,l,o,d,c,g,u,m,f,p,b,E,D,S,h,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DocumentSidebar=void 0,i=a.__importDefault(i),u=a.__importStar(u);t.DocumentSidebar=f.requireCssWithComponent(()=>{const e=S.useIntl(),t=D.useDispatch(),a=Object.keys(D.useSelector(e=>e.pageActions.selectedPages)).map(Number),f=D.useSelector(e=>+e.pageActions.firstSelectedPage),_=D.useSelector(e=>e.sidebarActions.pagesData),P=D.useSelector(e=>e.pageActions.totalPages),x=D.useSelector(e=>e.documentActions.fileDownloading),w=D.useSelector(e=>e.application.isNewActionAllowed);t(h.setEditViewForLogging(v.PDFEditingEditView.LIST));const[A,I]=u.useState(!1),[N,y]=u.useState(),[L,C]=u.useState(),R=u.useRef(null),[T,O]=u.useState(),[j,F]=u.useState(),V=u.useRef(null),[M,k]=u.useState(1),z=(e,n)=>{t(h.logUserAction({eventName:v.PDFEditingEventNames.SELECT_PDF_PAGE,extra:{no_of_pages_selected:a.length}})),n.defaultPrevented||0===n.button&&(n.preventDefault(),H(e,n))},G=(e,t,a)=>{t.defaultPrevented||a.isDragging||(t.preventDefault(),H(e,t))},H=(e,i)=>{U(i)?a.includes(e)?t(n.removeSelectedPage(e)):t(n.addSelectedPage(e)):K(i)?q(e):t(n.setPageSelection([e]))},U=e=>navigator.platform.indexOf("Mac")>=0?e.metaKey:e.ctrlKey,K=e=>e.shiftKey,W=e=>{if(!w)return;const a=e?v.PDFEditingEventNames.SELECT_GRID_VIEW:v.PDFEditingEventNames.SELECT_THUMBNAIL_VIEW;t(h.logUserAction({eventName:a})),A!==e&&I(e),t(e?h.setEditViewForLogging(v.PDFEditingEditView.GRID):h.setEditViewForLogging(v.PDFEditingEditView.LIST))},q=e=>{const i=a.slice(-1)[0];if(e>i){const a=e-i+1,r=Array.from({length:a},(e,t)=>t+i);for(const e of r)t(n.addSelectedPage(e))}else if(e<i){const a=i-e,r=Array.from({length:a},(t,a)=>a+e);for(const e of r)t(n.addSelectedPage(e))}else;},B=()=>{if(!R.current)return;const e=R.current.clientWidth;O(e);const t=R.current.clientHeight;F(t);const a=Math.floor((e-212)/198);y(Math.max(a,1))};u.useEffect(()=>{B()}),u.useEffect(()=>{window.addEventListener("resize",B),t(r.setInitialPageOrder(P)),t(n.setPageSelection([0]))},[]),u.useEffect(()=>{C(_.length)},[_]),u.useEffect(()=>{if(!V.current||!N)return;const e=A?Math.floor(f/N):f;V.current.scrollToItem(e)},[N,f]),u.useEffect(()=>{const e=Array.from(new Set(a));k(e.length)},[a]),u.useEffect(()=>{x&&t(r.cancelAllThumbnailRequestsAtAfterIndex(0))},[x]);const J=e=>{const i=+e.draggableId.replace("page","");a.includes(i)||t(n.setPageSelection([i]))},Q=e=>{if(!e.destination)return;if(e.source.index===e.destination.index)return;t(h.logUserAction({eventName:v.PDFEditingEventNames.SELECT_REORDER_PAGE,extra:{no_of_pages_selected:a.length}}));const{result:n,indicesAfterDrag:i,afterIndex:r}=m.reorder(_,a,e.destination.index,!0);t(s.reorderPages({newPageOrder:n,indicesAfterReorder:i,afterIndex:r}))},X=a=>{const n=a.index,{isSelected:i,isLoading:r,thumbnailData:l}=(e=>{const a=D.useSelector(t=>!!t.pageActions.selectedPages[e.toString()]),n=D.useSelector(t=>!!t.sidebarActions.pagesData[e]&&t.sidebarActions.pagesData[e].isLoading),i=D.useSelector(t=>!!t.sidebarActions.pagesData[e]&&t.sidebarActions.pagesData[e].thumbnailID),r=D.useSelector(e=>i?e.sidebarActions.thumbnailCache[i]:p.emptyThumbnail);return r&&r.data||x||t(s.createThumbnail(e)),{isSelected:a,isLoading:n,thumbnailData:r||p.emptyThumbnail}})(n);return u.default.createElement(p.Thumbnail,{key:n,index:n,isSelected:i,isLoading:r,onClick:z,onKeyDown:G,snapshot:a.snapshot,inGridView:A,thumbnailData:l,intl:e})},Y=({index:e,style:t})=>u.default.createElement("div",{className:"thumbnail-outer",style:t},u.default.createElement(o.Draggable,{draggableId:"page"+e,index:e,isDragDisabled:!w},(t,a)=>u.default.createElement("div",Object.assign({},t.draggableProps,t.dragHandleProps,{ref:t.innerRef}),u.default.createElement(X,{index:e,snapshot:a})))),Z=({index:t,style:a})=>{if(!N||!L)return u.default.createElement("div",{className:"thumbnail-outer",style:a});const n=t*N,i=(t+1)*N-1,r=_.slice(n,i+1).map((e,t)=>e?u.default.createElement("li",{key:n+t,className:"grid-list"},u.default.createElement(o.Draggable,{draggableId:"page"+(n+t),index:n+t,key:n+t,isDragDisabled:!w},(e,a)=>u.default.createElement("div",Object.assign({className:"grid-horizontal-list"},e.draggableProps,e.dragHandleProps,{ref:e.innerRef}),u.default.createElement(X,{index:n+t,snapshot:a})))):u.default.createElement("div",{className:"thumbnail-outer",style:a})),s=M>1?l.DocumentSidebarStrings.pluralDragTooltip:l.DocumentSidebarStrings.singularDragTooltip,d={isPortaled:!1};return u.default.createElement("div",{className:"grid-row",style:a},u.default.createElement(o.Droppable,{key:t,droppableId:"droppable"+t,direction:"horizontal",mode:"virtual",renderClone:(t,a,n)=>u.default.createElement("div",Object.assign({className:"clone-drag"},t.draggableProps,t.dragHandleProps,{ref:t.innerRef}),u.default.createElement(X,{index:n.source.index,snapshot:a}),u.default.createElement(b.Tooltip.Control,Object.assign({id:"dragging-page",triggerRef:t.innerRef,open:a.isDragging,placement:"right",inverse:!1},d),e.formatMessage(Object.assign({},s),{val:M})))},(e,t)=>u.default.createElement("div",Object.assign({style:{display:"flex"},ref:e.innerRef},e.droppableProps),u.default.createElement("ol",null,r))))};return u.default.createElement("div",{className:i.default("sidebar",{"grid-view":A}),ref:R},u.default.createElement("div",{className:i.default("sidebar-inner",{"grid-view":A})},((t,a,n)=>{if(t&&N){const e=Math.floor(10/N);return u.default.createElement(o.DragDropContext,{onDragEnd:Q,onDragStart:J},u.default.createElement(d.FixedSizeList,{className:"page-list",height:a-64-48-184,width:n,overscanCount:e,itemCount:Math.ceil(_.length/N),itemSize:208,ref:V},Z))}const i=M>1?l.DocumentSidebarStrings.pluralDragTooltip:l.DocumentSidebarStrings.singularDragTooltip,r={isPortaled:!1};return u.default.createElement(o.DragDropContext,{onDragEnd:Q,onDragStart:J},u.default.createElement(o.Droppable,{droppableId:"droppable",mode:"virtual",renderClone:(t,a,n)=>u.default.createElement("div",Object.assign({},t.draggableProps,t.dragHandleProps,{ref:t.innerRef,className:"clone-drag"}),u.default.createElement(X,{index:n.source.index,snapshot:a}),u.default.createElement(b.Tooltip.Control,Object.assign({id:"dragging-page",triggerRef:t.innerRef,open:a.isDragging,placement:"right",inverse:!1},r),e.formatMessage(Object.assign({},i),{val:M})))},(e,t)=>u.default.createElement(d.FixedSizeList,{className:"page-list",height:a-64-48-32,width:n,overscanCount:5,itemCount:L,itemSize:164,ref:V,outerRef:e.innerRef},Y)))})(A,j,T)),u.default.createElement("div",{className:"sidebar-view-toggle-buttons"},u.default.createElement(g.IconButton,{variant:"transparent",inverse:!0,className:i.default("list-view","view-change",{selected:!A}),onClick:()=>W(!1),"aria-label":e.formatMessage(Object.assign({},l.DocumentSidebarStrings.listViewAriaLabel))},u.default.createElement(E.UIIcon,{src:c.ListViewLine,size:"small"})),u.default.createElement(g.IconButton,{variant:"transparent",inverse:!0,className:i.default("grid-view","view-change",{selected:A}),onClick:()=>W(!0),"aria-label":e.formatMessage(Object.assign({},l.DocumentSidebarStrings.gridViewAriaLabel))},u.default.createElement(E.UIIcon,{src:c.GridViewLine,size:"small"}))))},["/static/css/pdf_editor/document_sidebar-vfl1dtlO-.css"])}));
//# sourceMappingURL=document_sidebar.min.js-vflkWhfvR.map