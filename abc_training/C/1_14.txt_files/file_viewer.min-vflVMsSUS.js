define(["require","exports","tslib","react","classnames","react-redux","api_v2/default_user_client","api_v2/noauth_client","modules/clean/file_store/utils","modules/clean/react/components/css","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/data/helpers","modules/clean/react/file_viewer/data/actions","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/data/store","modules/clean/react/file_viewer/exp_file_viewer_upsell_banner","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/copy_plugin","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/download_plugin","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/starred_plugin","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/move_plugin","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/delete_plugin","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/rename_plugin","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/restore_plugin","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/open_dropdown_plugin","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/open_in_desktop_plugin","modules/clean/react/file_viewer/sdk_file_viewer/comments","modules/clean/integrations/hellosign_deep_integration/send_file_viewer_plugin","modules/clean/react/flows/conversions/conversion_plugin","modules/clean/react/file_viewer/sdk_file_viewer/file_system","modules/clean/react/file_viewer/sdk_file_viewer/full_screen","modules/clean/react/file_viewer/sdk_file_viewer/print","modules/clean/react/file_viewer/sdk_file_viewer/navigation","modules/clean/react/file_viewer/sdk_file_viewer/utils","modules/clean/react/file_viewer/sdk_file_viewer/pass","modules/clean/web_timing_logger","modules/core/i18n","modules/core/browser","typescript/libraries/file-viewer/src/core/data/riviera/api","typescript/libraries/file-viewer/src/core/logging/constants","typescript/libraries/file-viewer/src/public/index","modules/clean/react/file_viewer/sdk_file_viewer/url","modules/clean/react/file_viewer/sdk_file_viewer/cloud_docs","modules/clean/react/file_viewer/sdk_file_viewer/constants","typescript/libraries/file-viewer/src/info_blade/info_blade_plugin","modules/clean/react/pass/plugin/loader","typescript/libraries/file-viewer/src/info_blade/loader","modules/clean/react/file_viewer/sdk_file_viewer/preview_logger","modules/clean/react/file_viewer/sdk_file_viewer/feature_config","modules/clean/react/share_download/util","modules/clean/react/extensions/cloud_docs_compat","modules/clean/react/previews/print_helpers","typescript/libraries/file-viewer/src/file_activity_blade/file_activity_blade_plugin","typescript/libraries/file-viewer/src/file_activity_blade/loader","modules/clean/react/file_viewer/sdk_file_viewer/preferences","modules/clean/react/previews/sharing_plugin/loader","modules/clean/react/branding/branding_modal_controller","typescript/libraries/file-viewer/src/watermarking/edit_plugin/loader","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/unzip_plugin","modules/clean/react/file_viewer/sdk_file_viewer/upsell/upsell_dialog_manager","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/version_history_plugin","modules/clean/react/integrations/pdf_editor/plugin/loader","modules/constants/file_viewer","keymaster","modules/clean/loggers/device_type","typescript/libraries/file-viewer/src/watermarking/edit_plugin/plugin","modules/clean/react/file_viewer/sdk_file_viewer/toolbar_plugins/star_plugin","modules/clean/react/file_viewer/sdk_file_viewer/toolbar_plugins/snackbar_manager_plugin","modules/clean/react/watermarking/utils","typescript/libraries/file-viewer/src/watermarking/edit_plugin/action_plugin","modules/clean/browse_uri_interface","modules/clean/react/previews/constants","modules/core/dom","modules/clean/user_survey/user_survey","modules/clean/react/file_viewer/toggle_browse_elements_util","modules/clean/react/file_viewer/sdk_file_viewer/replay_prompt/async_replay_dialog","modules/clean/react/flows/approval/api","modules/clean/sharing/ui_util","modules/clean/react/file_viewer/sdk_file_viewer/report_exception","modules/clean/react/file_viewer/sdk_file_viewer/app_download_interstitial","modules/clean/react/flows/approval/request_approval_plugin","modules/clean/react/comments2/util","modules/clean/react/file_viewer/sdk_file_viewer/action_plugins/mobile_plugin","typescript/libraries/file-viewer/src/comments2/plugin/types","typescript/libraries/file-viewer/src/core/constants","modules/clean/react/snackbar","modules/clean/react/snackbar_manager","modules/core/browser_detection"],(function(e,i,r,a,t,n,l,s,o,c,_,d,u,S,f,I,v,p,w,m,P,O,N,D,E,g,C,A,R,T,b,L,k,U,h,K,y,F,G,V,M,x,B,H,W,j,Y,Q,q,z,Z,J,X,$,ee,ie,re,ae,te,ne,le,se,oe,ce,_e,de,ue,Se,fe,Ie,ve,pe,we,me,Pe,Oe,Ne,De,Ee,ge,Ce,Ae,Re,Te,be,Le,ke,Ue){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.FileViewer=i.UnconnectedFileViewer=void 0,a=r.__importDefault(a),t=r.__importDefault(t),K=r.__importStar(K),F=r.__importStar(F),ce=r.__importDefault(ce),we=r.__importStar(we);const he=(e,i,r,a,t,n,c,_,d,u,S,f,I,V=!1,H=!0,z=!1,Z,J,re,ne,ce,we,Pe)=>{var Oe;let Ae;const be=_?new l.DefaultUserApiV2Client(_):new s.NoAuthApiV2Client,Le=q.getFeatureConfig(e,z,V,H,_),ke=e=>v.showAuthModal(Object.assign(Object.assign({},e),{encryptionOptions:I})),he=ee.makePreferencesClient(_);Ue.is_supported_mobile_browser()||(me.UserSurvey.addAttribute("previewPageRevamp",oe.PREVIEW_PAGE_REVAMP),me.UserSurvey.trackEvent("preview_viewed","previews")),o.isSharedFile(i().file)&&setTimeout(()=>{De.trackReceiverUserLeapEvent(De.ReceiverUserLeapEvent.VIEWED_SHARED_FILE)},5e3);const Ke=o.isBrowseFile(i().file)&&fe.isWatermarkingEnabled(_);switch(e){case U.SDKPreviewSurface.BROWSE:case U.SDKPreviewSurface.HOME:case U.SDKPreviewSurface.HELLOSIGN:case U.SDKPreviewSurface.SEARCH:case U.SDKPreviewSurface.RECENTS:case U.SDKPreviewSurface.STARRED:case U.SDKPreviewSurface.STANDALONE_PREVIEW:case U.SDKPreviewSurface.PHOTOS:case U.SDKPreviewSurface.COLLECTIONS:if(!_)throw new Error("Must be logged in to browse");Ae={presenceBeaconIOClient:h.getPresenceBeaconIOClient(_,i),fileSystemClient:T.makeFileSystemClient(_,i,{allowCopyToDropbox:!1,shareToken:r,encryptionOptions:I,authModalKind:J}),fullScreenClient:b.makeFullScreenClient(),printClient:L.makePrintClient(),navigationClient:k.makeBrowseNavigationClient(_,i,t,d,u,S),urlClient:x.makeUrlClient(_),preferencesClient:he};break;case U.SDKPreviewSurface.VERSION_HISTORY:if(!_)throw Error("user required for version history");Ae={presenceBeaconIOClient:h.getPresenceBeaconIOClient(_,i),fileSystemClient:void 0,fullScreenClient:b.makeFullScreenClient(),printClient:L.makePrintClient(),navigationClient:k.makeVersionHistoryNavigationClient(_,i,t,d,u,S),urlClient:x.makeUrlClient(_),preferencesClient:he};break;case U.SDKPreviewSurface.SHARED_LINK:Ae={fullScreenClient:b.makeFullScreenClient(),printClient:L.makePrintClient(),navigationClient:k.makeInbandShareNavigationClient(t,d,u,S,ke),urlClient:x.makeUrlClient(_),fileSystemClient:T.makeFileSystemClient(_,i,{allowCopyToDropbox:!0,shareToken:r,encryptionOptions:I,sharePermission:a,authModalKind:J}),presenceBeaconIOClient:_&&h.getPresenceBeaconIOClient(_,i),preferencesClient:he};break;case U.SDKPreviewSurface.SHARED_LINK_EMBED:case U.SDKPreviewSurface.COMMERCE:case U.SDKPreviewSurface.TRANSFER:Ae={fullScreenClient:b.makeFullScreenClient(),printClient:L.makePrintClient(),urlClient:x.makeUrlClient(_),fileSystemClient:T.makeFileSystemClient(_,i,{allowCopyToDropbox:!0,shareToken:r,encryptionOptions:I,sharePermission:a,authModalKind:J})};break;case U.SDKPreviewSurface.SHARED_CONTENT_LINK:case U.SDKPreviewSurface.INBAND_SHARE:if(!_)throw new Error("Must be logged in to view inband shared files");Ae={presenceBeaconIOClient:h.getPresenceBeaconIOClient(_,i),fileSystemClient:T.makeFileSystemClient(_,i,{allowCopyToDropbox:!0,shareToken:r,encryptionOptions:I,sharePermission:a,authModalKind:J}),fullScreenClient:b.makeFullScreenClient(),printClient:L.makePrintClient(),navigationClient:k.makeInbandShareNavigationClient(t,d,u,S),urlClient:x.makeUrlClient(_),preferencesClient:he}}const ye={logTTI:K.mark_time_to_interactive,logTTV:K.mark_time_to_view,logVideo:Q.logVideo,log:Q.logEvent},Fe=M.createFileViewerFactory({batteries:{intl:y.intl,coreIOClients:{apiv2ClientBase:be,rivieraIOClient:new G.WebRivieraIOClient},logger:ye,optionalIOClients:Object.assign(Object.assign({},Ae),{showAuthModal:ke,cloudDocsClient:_?B.makeCloudDocsClient(_,i,r):void 0,reportExceptionClient:Ee.makeReportExceptionClient()})},callbacks:{onRenderSucceeded:()=>{v.cleanupPrerenderPreview(),Ue.is_supported_mobile_browser()&&(me.UserSurvey.addAttribute("mobileWebRevamp",oe.MOBILE_WEB_FVSDK_VARIANT),me.UserSurvey.trackEvent("mobile_web_preview_viewed","previews"))}},initData:{accountId:_?_.account_id:void 0,deviceType:_e.getDeviceType()},featureConfig:Le,platformConfig:{osModifierKey:"ctrlKey"}});if(Fe.registerPlugins(Object.assign(Object.assign({[Re.MOBILE_PLUGIN_ID]:Re.makeMobilePluginLoader({previewSurface:e,sharedLinkInfo:ne,getActiveFile:i,user:_,encryptionOptions:I,authModalKind:J,shareToken:r,sharePermission:a}),[W.INFO_BLADE_PLUGIN_ID]:Y.makeInfoBladePluginLoader(_?String(_.id):void 0,f,_&&oe.APPROVAL_FLOW_BY_USER_ID[_.id]?e=>Ne.getFileApprovalStatus(_.id,e):void 0),[Te.COMMENTS_PLUGIN_ID]:C.makeComments2MetaserverLoader(_)},_&&{[X.FILE_ACTIVITY_PLUGIN_ID]:$.makeFileActivityPluginLoader(_,null===(Oe=Ae.navigationClient)||void 0===Oe?void 0:Oe.openVersionHistory)}),Ke&&{[de.WATER_MARKING_PLUGIN_ID]:ae.makeWatermarkLoader(ye,({fqPath:i,overwrite:r})=>{r&&e===U.SDKPreviewSurface.BROWSE||(i&&_?F.replace_location(ve.preview_uri_for_fq_path(_,i,{context:pe.PreviewSourceContext.Workflow})):F.reload())})})),Fe.registerPlugins({[j.PASS_PLUGIN_ID]:j.makePASSMetaserverLoader(i,e,_),[ie.SHARE_PLUGIN_ID]:ie.makeShareMetaserverLoader(i,e,_,we,Pe),[w.DOWNLOAD_ACTION_PLUGIN_ID]:w.makeDownloadActionLoader(i,_,r,a,I,J),[ge.APP_DOWNLOAD_PLUGIN_ID]:ge.makeOpenInAppPluginLoader(i,_,re)}),Fe.registerPlugins({[Se.SNACKBAR_MANAGER_PLUGIN_ID]:Se.makeSnackbarManagerLoader()}),_){const r=E.makeOpenDropdownActionLoader(i,_),a=P.makeMoveActionLoader(i,_,null==n?void 0:n.currentFQPath,c),t=p.makeCopyActionLoader(i,_,null==n?void 0:n.currentFQPath,c),l=m.makeStarredActionLoader(i,_),s=N.makeRenameActionLoader(i,_),o=O.makeDeleteActionLoader(i,_),d=Ie.makeWaterMarkingActionPluginLoader(i),u=g.makeOpenInDesktopActionLoader(i,_,n),f=te.makeUnzipActionLoader(i,_),I=le.makeVersionHistoryActionLoader(i,_),w=R.makeFileConversionsLoader(i,_),C=A.makeSendForSignatureLoader(i,_),T=D.makeRestoreActionLoader(S,Z),b=ue.makeStarToolbarButtonLoader(i,_),L=Ce.makeRequestApprovalLoader(i,_),k=se.makePdfEditorPluginLoader(i,_),h=oe.APPROVAL_FLOW_BY_USER_ID[_.id];switch(e){case U.SDKPreviewSurface.BROWSE:Fe.registerPlugins(Object.assign(Object.assign(Object.assign(Object.assign({[E.OPEN_DROPDOWN_ACTION_PLUGIN_ID]:r,[P.MOVE_ACTION_PLUGIN_ID]:a,[p.COPY_ACTION_PLUGIN_ID]:t,[N.RENAME_ACTION_PLUGIN_ID]:s,[O.DELETE_ACTION_PLUGIN_ID]:o},Ke&&{[Ie.WATERMARKING_ACTION_PLUGIN_ID]:d}),v.isFvsdkPdfEditorEnabled()&&{[se.PDF_EDITOR_PLUGIN_ID]:k}),{[m.STARRED_ACTION_PLUGIN_ID]:l,[le.VERSION_HISTORY_ACTION_PLUGIN_ID]:I,[g.OPEN_IN_DESKTOP_ACTION_PLUGIN_ID]:u,[te.UNZIP_ACTION_PLUGIN_ID]:f,[R.CONVERSION_ACTION_PLUGIN_ID]:w,[A.SEND_FOR_SIGNATURE_ACTION_PLUGIN_ID]:C,[ue.STAR_TOOLBAR_PLUGIN_ID]:b}),h&&{[Ce.REQUEST_APPROVAL_ACTION_PLUGIN_ID]:L}));break;case U.SDKPreviewSurface.SEARCH:Fe.registerPlugins(Object.assign(Object.assign(Object.assign(Object.assign({[E.OPEN_DROPDOWN_ACTION_PLUGIN_ID]:r},Ke&&{[Ie.WATERMARKING_ACTION_PLUGIN_ID]:d}),v.isFvsdkPdfEditorEnabled()&&{[se.PDF_EDITOR_PLUGIN_ID]:k}),{[m.STARRED_ACTION_PLUGIN_ID]:l,[le.VERSION_HISTORY_ACTION_PLUGIN_ID]:I,[te.UNZIP_ACTION_PLUGIN_ID]:f,[R.CONVERSION_ACTION_PLUGIN_ID]:w,[A.SEND_FOR_SIGNATURE_ACTION_PLUGIN_ID]:C,[ue.STAR_TOOLBAR_PLUGIN_ID]:b}),h&&{[Ce.REQUEST_APPROVAL_ACTION_PLUGIN_ID]:L}));break;case U.SDKPreviewSurface.STANDALONE_PREVIEW:if(Fe.registerPlugins(Object.assign(Object.assign(Object.assign(Object.assign({[E.OPEN_DROPDOWN_ACTION_PLUGIN_ID]:r},Ke&&{[Ie.WATERMARKING_ACTION_PLUGIN_ID]:d}),v.isFvsdkPdfEditorEnabled()&&{[se.PDF_EDITOR_PLUGIN_ID]:k}),{[m.STARRED_ACTION_PLUGIN_ID]:l,[le.VERSION_HISTORY_ACTION_PLUGIN_ID]:I,[te.UNZIP_ACTION_PLUGIN_ID]:f,[R.CONVERSION_ACTION_PLUGIN_ID]:w,[A.SEND_FOR_SIGNATURE_ACTION_PLUGIN_ID]:C,[D.RESTORE_ACTION_PLUGIN_ID]:T,[ue.STAR_TOOLBAR_PLUGIN_ID]:b}),h&&{[Ce.REQUEST_APPROVAL_ACTION_PLUGIN_ID]:L})),Le.enable_fvsdk_dynamic_actions){const e=P.makeMoveActionLoader(i,_,null==n?void 0:n.currentFQPath,c,ce),r=N.makeRenameActionLoader(i,_,ce),a=O.makeDeleteActionLoader(i,_,ce);Fe.registerPlugins({[P.MOVE_ACTION_PLUGIN_ID]:e,[p.COPY_ACTION_PLUGIN_ID]:t,[N.RENAME_ACTION_PLUGIN_ID]:r,[O.DELETE_ACTION_PLUGIN_ID]:a})}break;case U.SDKPreviewSurface.INBAND_SHARE:case U.SDKPreviewSurface.SHARED_CONTENT_LINK:case U.SDKPreviewSurface.SHARED_LINK:case U.SDKPreviewSurface.HOME:case U.SDKPreviewSurface.HELLOSIGN:case U.SDKPreviewSurface.RECENTS:case U.SDKPreviewSurface.STARRED:case U.SDKPreviewSurface.PHOTOS:Fe.registerPlugins(Object.assign(Object.assign(Object.assign(Object.assign({[E.OPEN_DROPDOWN_ACTION_PLUGIN_ID]:r},Ke&&{[Ie.WATERMARKING_ACTION_PLUGIN_ID]:d}),v.isFvsdkPdfEditorEnabled()&&{[se.PDF_EDITOR_PLUGIN_ID]:k}),{[m.STARRED_ACTION_PLUGIN_ID]:l,[le.VERSION_HISTORY_ACTION_PLUGIN_ID]:I,[te.UNZIP_ACTION_PLUGIN_ID]:f,[R.CONVERSION_ACTION_PLUGIN_ID]:w,[A.SEND_FOR_SIGNATURE_ACTION_PLUGIN_ID]:C,[D.RESTORE_ACTION_PLUGIN_ID]:T,[ue.STAR_TOOLBAR_PLUGIN_ID]:b}),h&&{[Ce.REQUEST_APPROVAL_ACTION_PLUGIN_ID]:L}));break;case U.SDKPreviewSurface.VERSION_HISTORY:Fe.registerPlugins({[D.RESTORE_ACTION_PLUGIN_ID]:T});break;case U.SDKPreviewSurface.COLLECTIONS:Fe.registerPlugins(Object.assign({[E.OPEN_DROPDOWN_ACTION_PLUGIN_ID]:r,[le.VERSION_HISTORY_ACTION_PLUGIN_ID]:I,[A.SEND_FOR_SIGNATURE_ACTION_PLUGIN_ID]:C},h&&{[Ce.REQUEST_APPROVAL_ACTION_PLUGIN_ID]:L}));break;case U.SDKPreviewSurface.SHARED_LINK_EMBED:case U.SDKPreviewSurface.COMMERCE:case U.SDKPreviewSurface.TRANSFER:break;default:(e=>{throw new Error})()}}return Fe.createFileViewer()},Ke=({showOverQuotaUpsell:e})=>e?a.default.createElement(I.ExpFileViewerUpsellBannerV2,null):null;i.UnconnectedFileViewer=e=>{const{fetchShowOverQuotaUpsell:i,file:l,sharedLinkInfo:s,sharePermission:c,shareToken:u,brandingInfo:S,showOverQuotaUpsell:f,user:I,previewSurface:p,encryptionOptions:w,closeFile:m,flipToNextFile:P,flipToPreviousFile:O,fileIndex:N=0,fileCount:D=1,previewContentOnly:E=!1,showCloudDocPreview:g=!0,onRestoreRevision:C,canRestoreRevision:A,canShowFileFlippers:R,authModalKind:T,containerId:b,usePreloadedMetadata:L,onFileChanged:k}=e,h=(e=>{switch(e){case U.SDKPreviewSurface.BROWSE:return V.SourceContext.Browse;case U.SDKPreviewSurface.SEARCH:return V.SourceContext.Search;case U.SDKPreviewSurface.INBAND_SHARE:case U.SDKPreviewSurface.SHARED_LINK:case U.SDKPreviewSurface.SHARED_CONTENT_LINK:return V.SourceContext.SharedLinkFile;case U.SDKPreviewSurface.SHARED_LINK_EMBED:return V.SourceContext.EmbeddedSharedLinkFile;case U.SDKPreviewSurface.VERSION_HISTORY:return V.SourceContext.VersionHistory;case U.SDKPreviewSurface.HOME:return V.SourceContext.Home;case U.SDKPreviewSurface.RECENTS:return V.SourceContext.Recents;case U.SDKPreviewSurface.STARRED:return V.SourceContext.Starred;case U.SDKPreviewSurface.STANDALONE_PREVIEW:return V.SourceContext.StandalonePreview;case U.SDKPreviewSurface.PHOTOS:return V.SourceContext.Photos;case U.SDKPreviewSurface.COLLECTIONS:return V.SourceContext.Collections;case U.SDKPreviewSurface.HELLOSIGN:return V.SourceContext.HelloSign;case U.SDKPreviewSurface.COMMERCE:return V.SourceContext.Commerce;case U.SDKPreviewSurface.TRANSFER:return V.SourceContext.Transfer}})(p),[K,F]=a.default.useState(!1),G=a.default.useRef({file:l,sharedLinkInfo:s,sharePermission:c,shareToken:u,encryptionOptions:w}),M=a.default.createRef(),x=a.default.useCallback(()=>G.current,[]),B=a.default.useRef(void 0),j=n.useSelector(e=>_.getOpenActionsForFile(e,l),n.shallowEqual),Y=a.default.useMemo(()=>d.partitionActions(j).cloudEditors,[j]),Q=a.default.useMemo(()=>b&&document.getElementById(b)||void 0,[b,K]),q=a.default.useCallback(e=>{B.current=e,F(!0);const i=["dragenter","dragover","dragleave","drop"],r=e=>{e.stopPropagation(),e.preventDefault()};for(const a of i)null==e||e.addEventListener(a,r)},[]),X=e.previewSurface===U.SDKPreviewSurface.BROWSE?e.browseContext:void 0,$=e.previewSurface===U.SDKPreviewSurface.BROWSE?e.browseExceptions:void 0,ee=e.previewSurface===U.SDKPreviewSurface.BROWSE?e.shouldFocusApproval:void 0,ie=e.previewSurface===U.SDKPreviewSurface.BROWSE?e.shouldFocusComment:void 0,ae="activeCommentThreadId"in e&&e.activeCommentThreadId?e.activeCommentThreadId:void 0,te=e.previewSurface===U.SDKPreviewSurface.SHARED_LINK||e.previewSurface===U.SDKPreviewSurface.SHARED_CONTENT_LINK?e.inCopyLinkButtonOOBPreviews:void 0,le=e.previewSurface===U.SDKPreviewSurface.SHARED_LINK||e.previewSurface===U.SDKPreviewSurface.SHARED_CONTENT_LINK?e.parsedSharedCopyLink:void 0,se=a.default.useMemo(()=>he(p,x,u,c,m,X,$,I,P,O,C,S,w,E,g,R,A,T,void 0,s,k,te,le),[I,p]),_e=a.default.useMemo(()=>((e,i,r,a,t,n,l,s,c,_)=>{const d=r.map(e=>({displayName:e.description,editorName:"cloud_editor"===e.handler[".tag"]?Z.cloudEditorNameToParams(e.handler.editor_name):"",iconUrl:e.icon.url}));if(o.isSharedFile(i)){const e=n?z.getToDropboxOptions(n,l,i,s):[];return{cloud_open_with_buttons:d,download_button:{enable_download_button:!a,enable_open_with_button:!a,can_download:!!n&&z.isDownloadAllowed(n),copy_targets:e.map(({text:e,role:i,isDisabled:r})=>({isDisabled:r,role:i,text:e}))},enable_pass:!!n&&n.canViewMetadataRoles.length>0,enable_print:J.canPrint(n),enable_share_button:!1,enable_open_button:!1,enable_restore_button:c,enable_prefetch_metadata_usage:_||!1}}return{cloud_open_with_buttons:d,download_button:{enable_download_button:!a,enable_open_with_button:!a,can_download:!0,copy_targets:[]},enable_pass:!0,enable_print:!0,enable_share_button:e!==U.SDKPreviewSurface.VERSION_HISTORY,enable_open_button:e!==U.SDKPreviewSurface.VERSION_HISTORY,enable_restore_button:c,enable_prefetch_metadata_usage:_||oe.FVSDK_PREFETCH_ALLOWED}})(p,l,Y,E,0,c,u,w,!!A,L),[p,l,Y,s,c,u,w,A]);a.default.useEffect(()=>{const e=p===U.SDKPreviewSurface.VERSION_HISTORY;return r.__awaiter(void 0,void 0,void 0,(function*(){if(se&&K&&B.current){G.current={file:l,sharedLinkInfo:s,sharePermission:c,shareToken:u,encryptionOptions:w};const i=a.default.createElement(a.default.Fragment,null,a.default.createElement(re.BrandingModalController,{brandingInfo:S,sharedLinkInfo:s,closeButtonText:y.intl.formatMessage({id:"D/tUrq",defaultMessage:"View file"})}));yield((e,i,a,t,n,l,s,c,_,d,u,S,f)=>r.__awaiter(void 0,void 0,void 0,(function*(){const r=Ae.parseActiveCommentFromUrl(),I={fileInfo:{file_id:i.file_id,sj_id:i.sjid,ns_id:i.ns_id},fileMetadata:{file_id:i.file_id,file_name:o.getFilename(i),file_path:o.isBrowseFile(i)?i.fq_path:void 0,file_last_modified_date:i.ts?new Date(1e3*i.ts).toISOString():void 0,file_collection_context:{file_index:l,parent_files_count:s}},previewMetadata:i.preview,fileConfig:a,fileSize:i.bytes,supportedPreviewTypes:[...be.DEFAULT_SUPPORTED_PREVIEW_TYPES,...U.INBAND_SUPPORTED_TYPES],sharedLinkInfo:_&&Object.assign(Object.assign({},_),{hasPublicAudienceOrVisibility:!!_.hasPublicAudienceOrVisibility}),sourceSession:{source_action:V.SourceAction.Visit,source_context:c,page_start_ts:performance.timing.navigationStart},pluginParams:{shouldFocusApproval:d,shouldFocusComment:u,threadId:S,commentId:r},defaultRightRailPlugin:d||u||!v.isPreviewPageRevampEnabled()||S||r?Te.COMMENTS_PLUGIN_ID:W.INFO_BLADE_PLUGIN_ID};yield e.initialize(I),e.render(t,void 0,n,f)})))(se,l,_e,B.current,Q||B.current,N,D,h,s,ee,ie,ae,i),e||Pe.hideElementsBehindFileViewer(),document.title=o.getFilename(l)}})),e?()=>null:Pe.showElementsBehindFileViewer},[l,K]),a.default.useEffect(()=>{i(I)},[I]),a.default.useEffect(()=>{Le.Snackbar.manager=M.current;const e=ce.default.getScope();return ce.default.setScope("fvsdk_scope"),we.scroll_lock_document(),()=>{se.unmount(),we.scroll_unlock_document(),ce.default.setScope(e)}},[]);const de="AD_FREE"!==oe.PREVIEW_PAGE_REVAMP,ue=a.default.useRef(null);return a.default.createElement("div",{ref:ue,className:t.default("fvsdk-container",{"fvsdk-embed-viewport":!!Q})},a.default.createElement(ke.SnackbarManager,{ref:M,getParentElement:()=>ue.current,useDigSnackbars:!0}),a.default.createElement(Ke,{showOverQuotaUpsell:f}),a.default.createElement("div",{className:H.FVSDK_MOUNT_POINT,id:H.FVSDK_MOUNT_POINT,ref:q}),de&&a.default.createElement(ne.UpsellDialogManager,{file:l,user:I}),de&&a.default.createElement(Oe.AsyncReplayDialog,{file:l,user:I}))},i.UnconnectedFileViewer.displayName="UnconnectedFileViewer",i.UnconnectedFileViewer.displayName="UnconnectedFileViewer";const ye={fetchShowOverQuotaUpsell:u.fetchShowOverQuotaUpsell},Fe=n.connect(e=>({showOverQuotaUpsell:S.getShowOverQuotaUpsell(e)}),ye)(i.UnconnectedFileViewer);Fe.displayName="ConnectedFileViewer";const Ge=f.getStoreForFileViewer(),Ve=e=>a.default.createElement(n.Provider,{store:Ge},a.default.createElement(Fe,Object.assign({},e)));Ve.displayName="FileViewerWithProvider";const Me=c.requireCssWithComponent(Ve,["/static/js/typescript/libraries/file-viewer/src/index.web-vfl9bj7wa.css","/static/js/typescript/libraries/comments2/src/index-vflZRkrBv.css","/static/css/dig-components/index.web-vflm67Rix.css","/static/css/preview/sdk_file_viewer-vfljWfFpE.css","/static/js/typescript/component_libraries/files_components/src/index.web-vfldNb6um.css","/static/js/dig-experimental/index.web-vfl_TJZKT.css","/static/js/typescript/component_libraries/retrieval-components/src/index.web-vfl2-_sIb.css","/static/js/typescript/component_libraries/flows/src/index.web-vfl5W8hER.css","/static/css/dig-illustrations/index.web-vflCpkDG_.css"]);i.FileViewer=Me,Me.displayName="FileViewer"}));
//# sourceMappingURL=file_viewer.min.js-vflqNwmxJ.map