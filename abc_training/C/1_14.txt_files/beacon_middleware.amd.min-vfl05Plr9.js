define(["require","exports","tslib","typescript/libraries/file-viewer/src/pass/types","typescript/libraries/file-viewer/src/pass/actions","api_v2/redux/users"],(function(e,i,t,s,n,r){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.beaconMiddleware=void 0,i.beaconMiddleware=function(e){return({dispatch:i})=>{const c=(function(e){return(i,t=!0)=>{const c=i.events.filter(e=>e.info.status!==s.PresenceStatus.offline).map(e=>e.agent.userId);e(t?n.updateViewingUsers({[i.fileId]:i.events}):n.updateViewingUsersWithDelta({[i.fileId]:i.events})),c.length&&e(r.getAccountBatchAction({arg:{account_ids:c}}))}})(i);return e.onBeacon(c),i=>s=>t.__awaiter(this,void 0,void 0,(function*(){const t=i(s);if(s.type===n.Action.SubscribePresence)e.subscribe(s.payload.fileId,s.payload.previewSessionId);else if(s.type===n.Action.UnsubscribePresence)e.unsubscribe(s.payload);else if(s.type===n.Action.GetFilePresence)try{if(e.getPresence){const i=yield e.getPresence(s.payload);c(i)}}catch(e){}return t}))}}}));
//# sourceMappingURL=beacon_middleware.amd.min.js-vflJJciBI.map