define(["require","exports","tslib","react","dig-components/buttons","classnames","typescript/component_libraries/flows/src/components/spacer/index","react-intl","react-intl","typescript/component_libraries/flows/src/components/contact-typeahead/index","typescript/component_libraries/flows/src/components/contact-typeahead/index","dig-components/text_fields","dig-components/typography","dig-components/avatar","dig-components/tooltips","dig-components/badges","typescript/component_libraries/flows/src/components/approval-forms/feedback_menu"],(function(e,a,t,l,r,o,s,n,p,i,d,u,m,c,v,f,g){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ApprovalRequestForm=a.ApprovalRequestFormInternal=void 0,l=t.__importStar(l),o=t.__importDefault(o);a.ApprovalRequestFormInternal=({onCancel:e,onRequestSuccess:a,onEditSuccess:n,ioClient:_,user:b,fileId:h,inlineWithComments:y,editArgs:q,threadId:A})=>{var M;const[E,S]=l.useState(q&&q.approvalMetadata.approver_email?[{email:q.approvalMetadata.approver_email,name:q.approvalMetadata.approver_display_name,validationResult:d.ValidationResult.OK}]:[]),[R,I]=l.useState(null!==(M=null==q?void 0:q.content)&&void 0!==M?M:""),[T,x]=l.useState(!1),{suggestions:C,onQueryChange:F}=_.useSuggestions(E),[w,L]=l.useState(!1),N=l.default.useRef(null),{title:B,requestSubmitButtonLabel:k,cancelButtonLabel:O,detailsInputLabel:P,detailsInputPlaceholder:z,approverInputPlaceholder:D,approverInputLabel:U,genericError:K,editSubmitButtonLabel:H,addAnApproverTooltip:Q,createNewRequestTooltip:W,onlyOneApproverAllowedTooltip:j,betaBadgeLabel:V}=(function(){const e=p.useIntl();return{title:e.formatMessage({id:"SbRB6f",defaultMessage:"Request Approval"}),requestSubmitButtonLabel:e.formatMessage({id:"TLlK3S",defaultMessage:"Request approval"}),cancelButtonLabel:e.formatMessage({id:"KQ8scR",defaultMessage:"Cancel"}),detailsInputLabel:e.formatMessage({id:"HDv0DD",defaultMessage:"Details"}),detailsInputPlaceholder:e.formatMessage({id:"6TM4L0",defaultMessage:"Tell the approver what you need their approval on."}),approverInputPlaceholder:e.formatMessage({id:"CNwO3W",defaultMessage:"Add approver"}),approverInputLabel:e.formatMessage({id:"v53Uf+",defaultMessage:"Approver"}),genericError:e.formatMessage({id:"vK1TiB",defaultMessage:"Something went wrong. Please try again later."}),editSubmitButtonLabel:e.formatMessage({id:"WGyt7S",defaultMessage:"Save changes"}),addAnApproverTooltip:e.formatMessage({id:"CoADMJ",defaultMessage:"Add an approver to your request"}),createNewRequestTooltip:e.formatMessage({id:"2hpgtD",defaultMessage:"Create a new request to get approval from another person"}),onlyOneApproverAllowedTooltip:e.formatMessage({id:"6CxwHA",defaultMessage:"You can only have one approver per request"}),betaBadgeLabel:e.formatMessage({id:"PbRgl7",defaultMessage:"Beta"})}})(),G=_.getLogger();l.default.useEffect(()=>{G.logShownRequestForm(h)},[h]);const J=()=>{var e,l;x(!1),L(!0);const r={type:"approval",status:"pending",approver_email:null!==(e=null==q?void 0:q.approvalMetadata.approver_email)&&void 0!==e?e:E[0].email,requester_email:null==q?void 0:q.approvalMetadata.requester_email,approval_type:"request",actor:"requester",approver_display_name:null!==(l=null==q?void 0:q.approvalMetadata.approver_display_name)&&void 0!==l?l:E[0].name};q?_.editApprovalRequest(h,q.commentId,R).then(e=>{n&&(n(q.commentId,A,{text:R,metadata:[r]}),G.logEditApprovalRequestSuccess(h,R.length,A,e.comment_id))}).catch(()=>{x(!0),L(!1)}):_.createApproval(h,R,E[0].email).then(e=>{a&&a({text:R,metadata:[r]}),G.logSubmitApprovalSuccess(h,R.length,e.comment_id),t.__awaiter(void 0,void 0,void 0,(function*(){_.getSubmittedApprovalsCount().then(e=>{1==e.num_requested_approvals?_.trackUserSurveyEvent("approval_requested_one_time"):5==e.num_requested_approvals?_.trackUserSurveyEvent("approval_requested_five_times"):25==e.num_requested_approvals&&_.trackUserSurveyEvent("approval_requested_twenty_five_times")})}))}).catch(()=>{x(!0),L(!1)})},Y=E.length>0&&E.length<=1&&0==E.filter(e=>e.validationResult!=d.ValidationResult.OK).length,$=e=>l.default.createElement(r.Button,{onClick:J,variant:"primary",disabled:e,size:"small",className:"approval-form__footer_primary-action",isLoading:w},q?H:k);return l.default.createElement("div",{className:o.default("approval-form",{"inline-with-comments":y}),ref:N},l.default.createElement("div",{className:"approval-form__title-section"},l.default.createElement("div",{className:"approval-form__title"},l.default.createElement(c.Avatar,{src:b.photoUrl,backgroundColor:c.avatarColorForUserIdentifier(b.initials),hasNoOutline:!0,size:"small",style:{marginRight:"6px"}},b.initials),l.default.createElement(m.Text,{isBold:!0,tagName:"h1"},B),l.default.createElement(f.AccessoryBadge,null,V)),l.default.createElement(g.ApprovalFeedbackMenu,{ioClient:_})),l.default.createElement("div",{className:"approval-form__body"},q?l.default.createElement(l.default.Fragment,null,l.default.createElement(u.FormLabel,{htmlFor:"approval-form__approver"},l.default.createElement(m.Text,{isBold:!0,size:"small",tagName:"label"},U)),l.default.createElement(v.Tooltip,{title:W,boundary:N,placement:"top-start",auto:!0},l.default.createElement(m.Text,{id:"approval-form__approver",size:"small",className:"approval-form__approver-display-name"},`@${q.approvalMetadata.approver_display_name}`))):l.default.createElement(i.ContactTypeahead,{placeholder:D,recipients:E,onRecipientsChange:e=>{x(!1),e.length>E.length&&G.logAddApprover(h),S(e)},suggestions:C,onQueryChange:F,renderTypeaheadSuggestion:e=>l.default.createElement(i.TypeaheadSuggestion,{suggestion:e,getInitials:_.getInitials}),recipientNumLimit:1,label:U,suggestionOnly:!0,maxNumTooltip:j,onFocus:()=>G.logFocusApproverTypeahead(h)}),l.default.createElement(s.Spacer,{multiplier:2}),l.default.createElement(u.FormLabel,{htmlFor:"approval-request-form__details-input"},l.default.createElement(m.Text,{isBold:!0,size:"small",tagName:"label"},P)),l.default.createElement(u.TextArea,{className:"approval-forms__text-area",id:"approval-request-form__details-input",placeholder:z,"aria-label":z,value:R,onChange:e=>{x(!1),I(e.currentTarget.value)},style:{boxSizing:"border-box"}}),T&&l.default.createElement(u.FormHelperText,{isInvalid:!0},K)),l.default.createElement("div",{className:"approval-form__footer"},l.default.createElement(r.Button,{onClick:()=>{G.logCancelApproval(h,"request_approval_form"),_.trackUserSurveyEvent("approval_request_abandoned"),e()},variant:"transparent",size:"small",disabled:w},O),Y?$(!1):l.default.createElement(v.Tooltip,{title:Q,placement:"top-start",auto:!0,boundary:N},l.default.createElement("span",{style:{display:"inline-block"},tabIndex:0},$(!0)))))},a.ApprovalRequestFormInternal.displayName="ApprovalRequestFormInternal",a.ApprovalRequestForm=e=>l.default.createElement(n.RawIntlProvider,{value:e.intl},l.default.createElement(a.ApprovalRequestFormInternal,Object.assign({},e))),a.ApprovalRequestForm.displayName="ApprovalRequestForm"}));
//# sourceMappingURL=request_form.amd.min.js-vflhOpR7Q.map