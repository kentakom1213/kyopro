define("modules/clean/clipboard_v3",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.copyToClipboard=void 0,t.copyToClipboard=function(e,t,r){const a=document.createElement("input");a.type="text",a.value=e,document.body.appendChild(a),a.select();let n=!1;try{n=document.execCommand("copy")}catch(e){}document.body.removeChild(a),n?null==t||t():null==r||r()}})),define("modules/clean/open_in_mobile_app",["require","exports","tslib","react","dig-components/typography","modules/clean/clipboard_v3","modules/core/i18n","modules/clean/analytics","modules/core/browser","modules/core/browser_detection","modules/core/assert","spectrum-sharing/utils/sharing_constants"],(function(e,t,r,a,n,i,o,s,c,l,d,u){"use strict";function m(){return l.iOS&&(window.location.pathname.startsWith("/s/")||window.location.pathname.startsWith("/sh/")||window.location.pathname.startsWith("/scl/"))}Object.defineProperty(t,"__esModule",{value:!0}),t.CopyUrlLabelText=void 0,a=r.__importDefault(a),s=r.__importStar(s),c=r.__importStar(c),l=r.__importStar(l),t.CopyUrlLabelText=e=>m()?a.default.createElement(n.Text,Object.assign({color:"faint",tagName:"div"},e),o.intl.formatMessage({id:"EvntjN",defaultMessage:"Tapping Get the app will copy a link and open the content in the app"})):null,t.CopyUrlLabelText.displayName="CopyUrlLabelText";class g{static initClass(){this.vischange_listener=void 0,this.open_app_mode=!0,this.try_open_ios_9=e=>{((null==e?void 0:e.startsWith("https://itunes.apple.com/"))||(null==e?void 0:e.startsWith("https://app.adjust.com/")))&&(this._onInstallLoggingHandler(),c.unsafeRedirect(e))},this.fallback_will_launch=!1,this.try_open=(e,t,r)=>{if(this._onOpenLoggingHandler(),this.fallback_will_launch)return;let a=!1;const n=()=>a=!0;document.addEventListener("visibilitychange",n);let i=!1;const o=()=>i=!0;window.addEventListener("pagehide",o),null!=r&&s.ShareTibEventLogger.log_unauth("CLICK_MOBILE_OPEN",u.SHARE_ACTION_ORIGIN_TYPE.WEB_MOBILE,{scl_url:r}),(function(){const t=document.createElement("iframe");t.src=e||"",t.style.display="none",document.body.append(t)})();const c=Date.now();return setTimeout(()=>{this.fallback_will_launch=!1,document.removeEventListener("visibilitychange",n),window.removeEventListener("pagehide",o),!i&&!a&&Date.now()<c+4700&&(null!=r&&s.ShareTibEventLogger.log_unauth("CLICK_MOBILE_INSTALL",u.SHARE_ACTION_ORIGIN_TYPE.WEB_MOBILE,{scl_url:r}),t&&window.location.replace(t))},3200),this.fallback_will_launch=!0}}static _onOpenLoggingHandler(){}static _onInstallLoggingHandler(){}static registerLoggingHandlers(e,t){return this._onOpenLoggingHandler=e,this._onInstallLoggingHandler=t}static open_on_click(e,t,r,a,n,i){const o=r=>{r.preventDefault(),i?this.open_android_intent(i):this.open_ios(e,t,a)};r&&r.addEventListener("click",o)}static open_ios(e,t,r){return m()&&i.copyToClipboard(window.location.href),r?this.try_open_ios_9(t):this.try_open(e,t)}static open_android_intent(e){d.assert(e.startsWith("intent://www.dropbox.com/sm/launch_intent_or_fallback_page"),"intentUrl must use intent:// protocol"),this._onOpenLoggingHandler&&this._onOpenLoggingHandler(),window.location.href=e}static cleanup(){if(this.vischange_listener)return document.removeEventListener("visibilitychange",this.vischange_listener)}}g.initClass(),t.default=g})),define("modules/clean/react/file_viewer/ml_experiment",["require","exports","api_v2/user_client"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchDocClassification=t.ML_EXPERIMENT_EXTENSIONS=t.ML_ENDPOINT_FETCH_TYPES=t.ML_EXPERIMENT_TYPES=void 0,t.ML_EXPERIMENT_TYPES={contract:"CONTRACT",esign:"ESIGN",control:"CONTROL",file:"FILE"},t.ML_ENDPOINT_FETCH_TYPES=["CONTRACT","ESIGN"],t.ML_EXPERIMENT_EXTENSIONS=["pdf","docx"],t.fetchDocClassification=function(e,t){const a={file_id:t};return(new r.UserApiV2Client).ns("hellosign").rpc("get_classification",a,{subjectUserId:e})}})),define("modules/clean/react/file_sidebar/store/instance",["require","exports","tslib","redux","modules/clean/react/file_sidebar/store/app/reducer","modules/clean/react/file_sidebar/store/file_activity/reducer","modules/clean/react/file_sidebar/store/sidebar/reducer","modules/clean/react/file_sidebar/store/middleware/thunk","modules/clean/react/file_sidebar/store/middleware/reactor","modules/clean/react/file_sidebar/store/sidebar/reactors","modules/clean/redux/unsupported","modules/clean/redux/devtools"],(function(e,t,r,a,n,i,o,s,c,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.store=void 0;const m=(a=r.__importStar(a)).combineReducers({app:n.reducer,fileActivity:i.reducer,sidebar:o.reducer});function g(e,t){return"::RESET"===t.type&&(e=void 0),m(e,t)}t.store=d.createStore(g,u.composeEnhancersWithDevTools(a.applyMiddleware(s.thunk(),c.reactor(l.reactors))))})),define("modules/clean/react/file_sidebar/store/sidebar/actions",["require","exports","tslib","modules/clean/react/file_sidebar/store/file_activity/selectors","modules/clean/react/file_sidebar/store/sidebar/helpers","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/types","typescript/libraries/file-viewer/src/core/data/modes/types"],(function(e,t,r,a,n,i,o,s,c){"use strict";function l(e){return(t,r)=>{t({type:s.ActionType.SidebarOpen,payload:{reason:e}})}}function d(){return(e,t)=>{const r=t(),{user:n}=i.getSidebarContext(r);i.getSidebarState(r).open&&(e({type:s.ActionType.SidebarClose}),o.logSidebarClosed({num_comments:i.getTabState(r,"comments").extra.commentCount,num_events:a.getVisibleActivityCount(r),viewing_user_id:n?n.id:null}))}}function u(){return{type:s.ActionType.SidebarIndicateNewFileNav}}Object.defineProperty(t,"__esModule",{value:!0}),t.OverrideInitialState=t.setCommentingOnNewFile=t.setComments2ShownState=t.setComments2DisabledState=t.openFile=t.thirdpartyBlueDotOnboard=t.selectTab=t.completeToggleOpen=t.toggle=t.close=t.open=t.reset=void 0,a=r.__importStar(a),n=r.__importStar(n),i=r.__importStar(i),t.reset=function(){return{type:s.ActionType.SidebarReset}},t.open=l,t.close=d,t.toggle=function(){return(e,t)=>{const r=t();i.getSidebarState(r).open?e(d()):e(l("toggle_button"))}},t.completeToggleOpen=function(){return e=>{e(l("toggle_button_after_transition"))}},t.selectTab=function(e){return{type:s.ActionType.SidebarSelectTab,payload:{tabName:e}}},t.thirdpartyBlueDotOnboard=function(){return{type:s.ActionType.SidebarSetThirdPartyBlueDotOnboardState}},t.openFile=function(e){return(t,r)=>{const a=r(),o=i.getSidebarContext(a);n.isContextChanged(o,e)&&(t({type:s.ActionType.SidebarOpenFile,payload:e}),t(u()))}},t.setComments2DisabledState=function(){return{type:s.ActionType.SidebarSetComments2DisabledState}},t.setComments2ShownState=function(e){return{type:s.ActionType.SidebarSetComments2ShownState,payload:e}},t.setCommentingOnNewFile=u,t.OverrideInitialState=function(e){const t=e===c.FileViewerMode.Documentation?"metadata":"comments";return{type:s.ActionType.SidebarOverrideInitialState,payload:{open:!0,tab:t}}}})),define("modules/clean/react/comments2/data/action_helper",["require","exports","tslib","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/util"],(function(e,t,r,a,n){"use strict";function i(e){return{error:`${e}.Error`,request:`${e}.Request`,success:`${e}.Success`}}function o(e){return{actionTypes:i(e),name:e,type:"async"}}function s(e){return{actionType:e,name:e,type:"sync",zero:!1}}function c(e){return{actionType:e,name:e,type:"sync",zero:!0}}function l(){return(e,t)=>r.__awaiter(this,void 0,void 0,(function*(){const{action:r,args:i,dispatch:o,context:s,getState:c}=t;if(!n.isContextSame(s,a.getContext(c())))return yield e(t);o({type:r.actionTypes.request,payload:i,meta:{args:i}});try{const a=yield e(t);return o({type:r.actionTypes.success,payload:a,meta:{args:i}}),a}catch(e){throw o({type:r.actionTypes.error,error:e,meta:{args:i}}),e}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncHandler=t.thunkHandler=t.dispatchMiddleware=t.createAsyncHandler=t.syncHandler=t.namespacedActions=t.syncAction0=t.syncAction=t.asyncAction=t.asyncActionConstants=t.errorReduxAction=t.successReduxAction=t.requestReduxAction=t.syncReduxAction=void 0,a=r.__importStar(a),t.syncReduxAction=function(e,t){return e.zero?{type:e.actionType}:{type:e.actionType,payload:t}},t.requestReduxAction=function(e,t){return{type:e.actionTypes.request,payload:t,meta:{args:t}}},t.successReduxAction=function(e,t,r){return{type:e.actionTypes.success,payload:r,meta:{args:t}}},t.errorReduxAction=function(e,t,r){return{type:e.actionTypes.error,error:r,meta:{args:t}}},t.asyncActionConstants=i,t.asyncAction=o,t.syncAction=s,t.syncAction0=c,t.namespacedActions=function(e){return{asyncAction:t=>o(`${e}/${t}`),syncAction:t=>s(`${e}/${t}`),syncAction0:t=>c(`${e}/${t}`)}},t.syncHandler=function(e){return e.zero?()=>({type:e.name}):t=>({payload:t,type:e.name})},t.createAsyncHandler=(...e)=>(t,n)=>i=>(o,s)=>r.__awaiter(void 0,void 0,void 0,(function*(){const c=a.getContext(s()),l=e.reduceRight((e,t)=>a=>r.__awaiter(void 0,void 0,void 0,(function*(){return yield t(e,a)})),e=>n(i,e));try{return yield l({action:t,args:i,dispatch:o,getState:s,context:c})}catch(e){}})),t.dispatchMiddleware=l,t.thunkHandler=t.createAsyncHandler(),t.asyncHandler=t.createAsyncHandler(l())})),define("modules/clean/react/file_activity_stream/tti_logger",["require","exports","modules/clean/react/file_sidebar/file_sidebar_logger"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.faStreamTTILogger=void 0;t.faStreamTTILogger=new class{constructor(){this.hasLogged=!1}recordStart(e){this.startTs=(new Date).getTime(),this.fileId=e,this.hasLogged=!1}recordInteractive(e){if(this.hasLogged)return;if(e!==this.fileId||!this.startTs)return;const t=(new Date).getTime();r.logActivityStreamInteractivity({time_start:this.startTs,time_interactive:t}),this.hasLogged=!0}}})),define("modules/clean/react/file_sidebar/store/sidebar/reactors",["require","exports","tslib","modules/clean/react/file_sidebar/file_sidebar_logger","modules/clean/react/file_sidebar/store/sidebar/selectors","modules/clean/react/file_sidebar/store/file_activity/selectors"],(function(e,t,r,a,n,i){"use strict";function o(e){const{open:t,ready:r}=n.getSidebarState(e);return t&&r}function s(e){return!o(e)}function c(e){const t=n.getSidebarContext(e).user;a.logSidebarOpened({reason:n.getOpenReason(e),num_comments:n.getTabState(e,"comments").extra.commentCount,num_events:i.getVisibleActivityCount(e),viewing_user_id:t?t.id:null})}Object.defineProperty(t,"__esModule",{value:!0}),t.reactors=void 0,n=r.__importStar(n),i=r.__importStar(i),t.reactors=function(e){e({changesFrom:s,changesTo:o},({nextState:e})=>{c(e)}),e({changes:(e,t)=>{if(o(e)&&o(t)){const r=t.sidebar.tabs,a=e.sidebar.tabs;return!(a.activity.ready&&a.comments.ready)&&r.activity.ready&&r.comments.ready}return!1}},({nextState:e})=>{c(e)})}})),define("modules/clean/react/comments2/data/selectors",["require","exports","tslib","lodash","reselect","modules/clean/redux/selectors","modules/clean/redux/namespaces","modules/clean/react/comments2/data/types","modules/clean/react/comments2/data/util","modules/clean/react/comments2/util","modules/clean/react/file_viewer/data/selectors","modules/clean/previews/constants","modules/clean/previews/data/preview_type_util","modules/clean/react/file_viewer/data/selectors","typescript/libraries/comments2/src/transforms/index"],(function(e,t,r,a,n,i,o,s,c,l,d,u,m,g,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getThirdPartySource=t.getIsEditorFocusRequested=t.getDocumentMetadata=t.getStreamSettings=t.getDisplayedThreadsWithNumberedAnnotations=t.getDisplayedThreadsWithImageAnnotations=t.getDisplayedThreadsWithDocumentAnnotationsOnPage=t.getDisplayedThreadsForLayer=t.getVisibleInSidebar=t.getHasPendingNumberedAnnotation=t.getPendingNumberedAnnotation=t.getCurrentPageNumber=t.getPlayerCurrentTimeSec=t.getPlayerCurrentTime=t.getStreamId=t.getStream=t.getIsSubscribed=t.getCanSubscribe=t.getCanEnable=t.getStickers=t.getIsPlayerIntegrationEnabled=t.getStatuses=t.getShowResolved=t.getUnresolvedTimecodeThreads=t.getFocusedThreadId=t.getHoverThreadId=t.getListCommentsError=t.getDocumentRectangleToMakeVisibleIfComments2Ready=t.getActivatedTimecodeThread=t.getActivatedThread=t.getActivatedThreadId=t.getFrameRate=t.getFramePreciseCommentsEnabled=t.getHasShownAnyModalVariant=t.getOnboardingVariants=t.getShowOnboardingOnCommentsPane=t.getShowShareAsCommentOnboarding=t.getShowOnboardingOnVideo=t.getUnmarkedOnboardingKeysRelevantToCurrentFile=t.getCursor=t.getThreads=t.getThreadMap=t.getEditorIsEmpty=t.getSort=t.getRevision=t.getData=t.getIsComments2Ready=t.getPreviewTypeForCurrentFile=t.canCreateAnnotations=t.getViewerId=t.getViewer=t.getFQPath=t.isEnabled=t.getContextStatus=t.getContext=t.getState=t.IMAGE_SENTINEL=void 0,a=r.__importStar(a),l=r.__importStar(l),g=r.__importStar(g);t.IMAGE_SENTINEL="IMAGE_SENTINEL",t.getState=e=>i.getStateAtNamespace(e,o.COMMENTS2_NAMESPACE_KEY);t.getContext=e=>{const r=t.getState(e).context;return r?{stream:r.stream,viewer:r.viewer}:void 0},t.getContextStatus=e=>{const r=t.getState(e).context;return r?r.status:void 0};const _=n.createSelector(t.getContextStatus,e=>e===s.Comments2ContextStatus.FullyEnabled),f=n.createSelector(t.getContextStatus,e=>e===s.Comments2ContextStatus.ReadOnly);function S(e){return m.getPreviewType(g.getPreviewApiDataForCurrentFile(e))}function b(e){return n.createSelector(t.getData,t=>t[e])}t.isEnabled=n.createSelector([_,f],(e,t)=>e||t),t.getFQPath=e=>{const r=t.getContext(e);return r?r.stream.fq_path:void 0},t.getViewer=e=>{const r=t.getContext(e);return r?r.viewer:void 0},t.getViewerId=e=>{const r=t.getViewer(e);return r?r.id:void 0},t.canCreateAnnotations=e=>{const r=t.getContext(e);return!(!r||!r.viewer)&&!l.isComments2Mobile()&&t.getVisibleInSidebar(e)},t.getPreviewTypeForCurrentFile=S,t.getIsComments2Ready=e=>{const t=e[o.COMMENTS2_NAMESPACE_KEY];return!(!t||!t.context||t.context.status!==s.Comments2ContextStatus.FullyEnabled&&t.context.status!==s.Comments2ContextStatus.ReadOnly)},t.getData=e=>t.getState(e).data,t.getRevision=n.createSelector(t.getContext,e=>e&&p.streamToRevision(e.stream)),t.getSort=n.createSelector(S,e=>{switch(e){case u.PreviewType.Audio:case u.PreviewType.Video:return s.SortType.VideoTimeCode;default:return s.SortType.Chronological}}),t.getEditorIsEmpty=b("editorIsEmpty"),t.getThreadMap=b("threads");const h=n.createSelector(t.getThreadMap,e=>a.values(e)),y=n.createSelector(t.getContext,e=>e&&e.stream.isVersionHistoryMode);function v(e){return t.isEnabled(e)&&!l.isComments2Mobile()&&(function(e){const{onboardingVariants:r}=t.getData(e);switch(S(e)){case u.PreviewType.Audio:case u.PreviewType.Video:return t.getIsPlayerIntegrationEnabled(e)?r.premium_av_comments_pane_surface:r.non_premium_av_comments_pane_surface;case u.PreviewType.SsrDoc:case u.PreviewType.Image:return r.how_to_at_mention_comments_pane_surface;case void 0:return!1;default:return r.not_annotatable_file_comments_pane_surface}})(e)}t.getThreads=n.createSelector([h,t.getSort,y,t.getRevision],(e,t,r,n)=>{const i=((e,t)=>{switch(t){case s.SortType.Chronological:return a.sortBy(e,[e=>e.timestamp.getTime()]);case s.SortType.VideoTimeCode:const[t,r]=a.partition(e,c.isThreadWithTimecodeAnnotation);return[...a.sortBy(t,[e=>e.annotation.time,e=>e.timestamp.getTime()]),...a.sortBy(r,[e=>e.timestamp.getTime()])]}})(e,t);return r?(function(e,t){return e.filter(e=>{const r=e.comments[0].revisionInfo;return r.isCurrent||!t||r.revision&&r.revision.nsId===t.ns_id&&r.revision.sjId<=t.sjid})})(i,n):i}),t.getCursor=b("cursor"),t.getUnmarkedOnboardingKeysRelevantToCurrentFile=function(e){let r;const{onboardingVariants:a}=t.getData(e);switch(S(e)){case u.PreviewType.SsrDoc:case u.PreviewType.Image:r=["how_to_at_mention_comments_pane_surface"];break;case u.PreviewType.Audio:case u.PreviewType.Video:r=t.getIsPlayerIntegrationEnabled(e)?["premium_av_comments_pane_surface","premium_av_preview_surface"]:["non_premium_av_comments_pane_surface"];break;case void 0:return[];default:r=["not_annotatable_file_comments_pane_surface"]}return r.filter(e=>a[e])},t.getShowOnboardingOnVideo=function(e){const{onboardingVariants:r}=t.getData(e),a=!d.getIsMediaPlaying(e),n=d.getPauseCount(e);return t.isEnabled(e)&&!l.isComments2Mobile()&&t.getIsPlayerIntegrationEnabled(e)&&a&&!v(e)&&r.premium_av_preview_surface&&n%5==1&&n<15},t.getShowShareAsCommentOnboarding=function(e){return t.getData(e).onboardingVariants.share_as_comment},t.getShowOnboardingOnCommentsPane=v,t.getOnboardingVariants=function(e){return t.getData(e).onboardingVariants},t.getHasShownAnyModalVariant=function(e){const{modalVariantsShown:r}=t.getData(e);return r[s.ModalVariant.EmailVerifyModal]||r[s.ModalVariant.SignUpModal]},t.getFramePreciseCommentsEnabled=function(e){return t.getData(e).framePreciseCommentsEnabled},t.getFrameRate=function(e){return t.getData(e).frameRate},t.getActivatedThreadId=b("activatedThreadId"),t.getActivatedThread=n.createSelector(t.getActivatedThreadId,t.getThreadMap,(e,t)=>e&&t[e]),t.getActivatedTimecodeThread=function(e){const r=t.getActivatedThread(e);return r&&c.isThreadWithTimecodeAnnotation(r)?r:void 0};const w=b("documentRectangleToMakeVisible");t.getDocumentRectangleToMakeVisibleIfComments2Ready=function(e){return t.getIsComments2Ready(e)?w(e):void 0},t.getListCommentsError=b("listCommentsError"),t.getHoverThreadId=b("hoverThreadId"),t.getFocusedThreadId=b("focusedThreadId"),t.getUnresolvedTimecodeThreads=function(e){return(function(e){return t.getThreads(e).filter(e=>!e.resolvedInfo)})(e).filter(({annotation:e})=>e&&("video"===e.type||"audio"===e.type))},t.getShowResolved=b("showResolved"),t.getStatuses=e=>t.getState(e).statuses,t.getIsPlayerIntegrationEnabled=b("playerIntegrationEnabled"),t.getStickers=function(e){return t.getData(e).stickers},t.getCanEnable=function(e){return t.getData(e).enabledStatus.canEnable},t.getCanSubscribe=function(e){return t.getData(e).subscriptionStatus.canSubscribe},t.getIsSubscribed=function(e){return t.getData(e).subscriptionStatus.isSubscribed},t.getStream=function(e){const r=t.getContext(e);return r&&r.stream},t.getStreamId=function(e){const r=t.getContext(e);return r&&r.stream.id};const T=b("pendingAnnotationInfo");function E(e){return T(e).numberedAnnotation}t.getPlayerCurrentTime=function(e){return T(e).playerCurrentTime},t.getPlayerCurrentTimeSec=function(e){return T(e).playerCurrentTimeSec},t.getCurrentPageNumber=function(e){return T(e).currentPageNumber},t.getPendingNumberedAnnotation=E,t.getHasPendingNumberedAnnotation=function(e){return t.getIsComments2Ready(e)&&!!E(e)},t.getVisibleInSidebar=b("visibleInSidebar");const A=n.createSelector([t.getVisibleInSidebar,t.isEnabled,t.getShowResolved,h],(e,t,r,a)=>e&&t?(r?a:a.filter(e=>!e.resolvedInfo)).filter(e=>e.comments.some(({deleted:e})=>!e)):[]),C=n.createSelector(A,e=>e.filter(c.isThreadWithDocumentAnnotation)),M=n.createSelector(C,e=>a.groupBy(e,e=>e.annotation.regions[0].page));function I(e,t){return a.get(M(e),t,[])}function k(e){const{annotation:t}=e;return!!t&&("document"===t.type||"image"===t.type)}function O(e){return A(e).filter(e=>e&&void 0!==e.annotation&&"image"===e.annotation.type)}t.getDisplayedThreadsForLayer=function(e,t){return void 0===t?O(e):I(e,t)},t.getDisplayedThreadsWithDocumentAnnotationsOnPage=I,t.getDisplayedThreadsWithImageAnnotations=O,t.getDisplayedThreadsWithNumberedAnnotations=function(e){return A(e).filter(k)};const F=b("canSeeCommentEditor");t.getStreamSettings=n.createSelector([_,t.getViewer,F],(e,t,r)=>({canComment:e,canModifyThreads:r&&!!t,canShowEditor:r,canShowEditorMeatball:!1})),t.getDocumentMetadata=function(e){switch(S(e)){case u.PreviewType.SsrDoc:return t.getData(e).documentMetadata;case u.PreviewType.Image:return t.IMAGE_SENTINEL;default:return}},t.getIsEditorFocusRequested=b("requestEditorFocus"),t.getThirdPartySource=b("thirdPartySource")})),define("modules/clean/react/comments2/data/actions",["require","exports","tslib","lodash","modules/core/browser","modules/core/i18n","modules/clean/redux/constants","modules/clean/react/comments2/data/api","modules/clean/react/file_sidebar/store/instance","typescript/libraries/comments2/src/transforms/index","modules/clean/react/comments2/data/types","modules/clean/react/comments2/components/snackbars","modules/clean/react/comments2/util","modules/clean/react/comments2/util","modules/clean/react/comments2/data/logger","modules/clean/react/comments2/data/perf_util","modules/clean/react/comments2/data/selectors","typescript/libraries/comments2/src/components/utils/throttle-debounce","modules/clean/bolt/bolt","modules/clean/browse_interface","modules/clean/react/comments2/data/action_helper","modules/clean/react/file_sidebar/store/sidebar/actions","modules/clean/react/file_viewer/data/actions","typescript/libraries/file-viewer/src/core/data/modes/types"],(function(e,t,r,a,n,i,o,s,c,l,d,u,m,g,p,_,f,S,b,h,y,v,w,T){"use strict";function E({clientFn:e,successCallback:t,eventToLog:a}){return(n,i)=>r.__awaiter(this,void 0,void 0,(function*(){const r=f.getContext(i());if(!r||!r.viewer)throw new Error;const o=new s.Comments2Api(r.viewer.id,r.stream);try{const s=yield e(o);p.logEvent(a,{stream:r.stream}),t(n,i,s)}catch(e){p.logErrorEvent("error trying to execute client event "+a,{stream:r.stream})}}))}function A(e){return(r,a)=>{r(z(e));const{thread:n}=e,i=a(),o=f.getStream(i);p.logEvent("activate_thread",{stream:o,thread:n}),n.read||n.readonly||r(t.Actions.markThreadRead({threadId:n.id,origin:d.MarkThreadReadOrigin.ThreadActivated}))}}function C(){return E({clientFn:e=>e.enableCommenting(),successCallback:M,eventToLog:"enable_comments"})}function M(e,t,a){return r.__awaiter(this,void 0,void 0,(function*(){f.getStreamId(t())===a.id&&(yield e(K(d.Comments2ContextStatus.Pending)),e(Y(!0,!1)))}))}function I(){return E({clientFn:e=>e.disableCommenting(),successCallback:k,eventToLog:"disable_comments"})}function k(e,t,a){return r.__awaiter(this,void 0,void 0,(function*(){if(f.getStreamId(t())!==a.id)return;const r=f.getContext(t());O(e,r,!0)}))}function O(e,t,a){return r.__awaiter(this,void 0,void 0,(function*(){yield e(K(d.Comments2ContextStatus.Disabled)),e(w.disableMode(T.FileViewerMode.Commenting)),yield c.store.dispatch(v.setComments2DisabledState())}))}Object.defineProperty(t,"__esModule",{value:!0}),t.Actions=t.ActionTypes=t.perfLoggingMiddleware=t.statusHandlingMiddleware=t.setFileContext=t.bolt=t.disableCommenting=t.enableCommenting=void 0,a=r.__importStar(a),n=r.__importStar(n),g=r.__importStar(g),p=r.__importStar(p),_=r.__importStar(_),f=r.__importStar(f),v=r.__importStar(v),t.enableCommenting=C,t.disableCommenting=I,t.bolt={client:null,subscribe({app_id:e,revision:r,token:a,unique_id:n},i,o){const s=new b.SignedChannelState(e,n,r,a);t.bolt.client?t.bolt.client.update_states([s]):(t.bolt.client=new b.BoltClient([s],i,o),t.bolt.client.start())},unsubscribe(){t.bolt.client&&(t.bolt.client.unsubscribe(),t.bolt.client=null)}};const{backoff:F,resetBackoff:R}=g.createBackoff();function P(e){return(a,n)=>r.__awaiter(this,void 0,void 0,(function*(){const r=n(),i=f.getContext(r);if(!g.isContextSame(i,e)&&(t.bolt.unsubscribe(),a(j(e)),a(Ge({setContextTime:+new Date,listCompleteTime:0})),e)){const n=i&&i.viewer;e.viewer&&!g.isUserSame(n,e.viewer)&&(a(t.Actions.checkOnboardingStatus(void 0)),a(t.Actions.getMediaFeatures(void 0))),f.getStickers(r)||a(t.Actions.getStickers(void 0)),e.stream&&a(t.Actions.getFileMetadata({fileId:e.stream.id,linkUrl:e.stream.linkUrl})),yield a(Y(!0))}}))}t.setFileContext=P;const{asyncAction:D,syncAction:x,syncAction0:L}=y.namespacedActions("Comments2");function U({handleError:e,handleSuccess:t}){return(a,n)=>r.__awaiter(this,void 0,void 0,(function*(){return yield(function o(){return r.__awaiter(this,void 0,void 0,(function*(){let r;try{r=yield a(n)}catch(t){const r=(function(e,t){if(t instanceof s.Comments2Error&&(t.code===s.ErrorCode.FILE_NOT_FOUND||t.code===s.ErrorCode.PERMISSION_DENIED)&&e!==re.name)return{message:i.intl.formatMessage({id:"CKj3RT",defaultMessage:"Either that file was deleted or you no longer have access to it."}),isRetriable:!1};switch(e){case fe.name:case he.name:case Te.name:return{message:i.intl.formatMessage({id:"3hOA04",defaultMessage:"We were unable to post the comment."}),isRetriable:!0};case ve.name:return{message:i.intl.formatMessage({id:"CiZnrG",defaultMessage:"We were unable to delete the comment."}),isRetriable:!0};case ke.name:return{message:i.intl.formatMessage({id:"+YPQ5/",defaultMessage:"We were unable to resolve the thread."}),isRetriable:!0};case Fe.name:return{message:i.intl.formatMessage({id:"QUs54P",defaultMessage:"We were unable to unresolve the thread."}),isRetriable:!0};case Ae.name:return{message:i.intl.formatMessage({id:"Vgd16U",defaultMessage:"We were unable to mark the thread as read."}),isRetriable:!0};case Me.name:return{message:i.intl.formatMessage({id:"4apXur",defaultMessage:"We were unable to mark the thread as unread."}),isRetriable:!0};case Ye.name:return{message:i.intl.formatMessage({id:"RmXnr0",defaultMessage:"We were unable to subscribe to the file."}),isRetriable:!0};case $e.name:return{message:i.intl.formatMessage({id:"oz0V3s",defaultMessage:"We were unable to unsubscribe from the file."}),isRetriable:!0};case Q.name:case ee.name:case re.name:case de.name:case je.name:default:return null}})(n.action.name,t);throw r&&e({message:r.message,retryFn:r.isRetriable?o:void 0}),t}const c=(function(e){switch(e){case Ye.name:return{message:i.intl.formatMessage({id:"WQpgoO",defaultMessage:"You have subscribed to the file."})};case $e.name:return{message:i.intl.formatMessage({id:"8o4LmU",defaultMessage:"You have unsubscribed from the file."})};default:return null}})(n.action.name);return c&&t(c),r}))})()}))}function N(){return+new Date}function V(e){return(t,a)=>r.__awaiter(this,void 0,void 0,(function*(){function r(t){const r=e(a.action.name,t);if(r){const e=N();a.dispatch(vt(r,a.context,e-n))}}const n=N();let i;try{i=yield t(a)}catch(e){throw r(e instanceof s.Comments2Error?e.code:"unknown_error"),e}return r(),i}))}t.statusHandlingMiddleware=U,t.perfLoggingMiddleware=V;const W=y.createAsyncHandler(U({handleError:u.showErrorSnackbar,handleSuccess:u.showSuccessSnackbar}),(e,t)=>{const{context:r}=t;if(!r)throw new Error("Bad state");const n=new s.Comments2LoggedOutApi(r.stream);return e(a.merge({},t,{api:n,context:r}))},y.dispatchMiddleware()),B=y.createAsyncHandler(U({handleError:u.showErrorSnackbar,handleSuccess:u.showSuccessSnackbar}),(e,t)=>{const{context:r}=t;if(!r||!r.viewer)throw new Error("Bad state");const n=new s.Comments2Api(r.viewer.id,r.stream);return e(a.merge({},t,{api:n,context:r}))},(function(e){return(t,n)=>r.__awaiter(this,void 0,void 0,(function*(){try{const r=yield t(n);return e(a.merge({},n,{payload:r,status:o.ApiClientStatus.Success})),r}catch(t){throw e(a.merge({},n,{error:t,status:o.ApiClientStatus.Error})),t}}))})(e=>{var t,r;const a=e.context.stream,n=f.getThreadMap(e.getState());if(e.status===o.ApiClientStatus.Error)p.logErrorEvent("encountered an error with async api call "+e.action.name,{stream:a});else if(e.status===o.ApiClientStatus.Success){const i=e.args,o=e.payload;switch(e.action.name){case fe.name:{const e=n[o.id],r=!(null===(t=i.content)||void 0===t||!t.metadata[0]||"sticker"!==i.content.metadata[0].type);p.logEvent("new_comment",{commentId:o.id,stream:a,thread:e,isSticker:r});break}case he.name:{const e=n[i.threadId],t=!(null===(r=i.content)||void 0===r||!r.metadata[0]||"sticker"!==i.content.metadata[0].type);p.logEvent("reply_to_comment",{commentId:o.id,stream:a,thread:e,isSticker:t});break}case ve.name:{const e=n[i.threadId];p.logEvent("delete_comment",{commentId:i.commentId,stream:a,thread:e});break}case Te.name:{const e=n[i.threadId];p.logEvent("edit_comment",{commentId:i.commentId,stream:a,thread:e});break}case ke.name:{const e=n[i.threadId];p.logEvent("resolve_thread",{stream:a,thread:e});break}case Fe.name:{const e=n[i];p.logEvent("unresolve_thread",{stream:a,thread:e});break}case Ae.name:{const e=i.origin===d.MarkThreadReadOrigin.ThreadActivated?"read_thread":"mark_thread_as_read",t=n[i.threadId];p.logEvent(e,{stream:a,thread:t});break}case Me.name:{const e=n[i];p.logEvent("mark_thread_as_unread",{stream:a,thread:e});break}case Ye.name:p.logEvent("subscribe",{stream:a});break;case $e.name:p.logEvent("unsubscribe",{stream:a})}}}),V((e,t)=>{switch(e){case fe.name:case he.name:case Ae.name:case Me.name:case ke.name:case Fe.name:return _.threadActionCompleted(e,t);case ve.name:case Te.name:return _.commentActionCompleted(e,t)}}),y.dispatchMiddleware()),H=x("SetContext"),j=y.syncHandler(H),G=x("SetContextStatus"),K=y.syncHandler(G),q=D("ListComments"),Y=(e=!1,a=!0)=>(n,o)=>r.__awaiter(void 0,void 0,void 0,(function*(){const r=o(),_=f.getContext(r);if(!_)return;n({type:q.actionTypes.request});const{stream:b,viewer:h}=_,y=h?new s.Comments2Api(h.id,b):new s.Comments2LoggedOutApi(b);try{const{bolt_info:s,cursor:p,status:h,supported_enhancements:A,threads:C,users:M,permissions:I}=yield y.listComments(e,f.getCursor(r)),k=+new Date,P=f.getContextStatus(r),D=h[".tag"],x="enabled"===D||"readonly"===D;if(P===d.Comments2ContextStatus.Pending&&x){const e=f.getData(r),a=e.perfEvents&&e.perfEvents.setContextTime||0;n(t.Actions.logSimplePerfEvent("initial_list_completed_ms",k-a))}const L=o(),U=f.getContext(L);if(!g.isContextSame(U,_))return;if(I&&(n(He({canEnable:I.can_enable_commenting})),n(qe({canSubscribe:I.can_subscribe,isSubscribed:I.is_subscribed})),n(We(I.can_see_comment_editor)),n(x?w.enableMode(T.FileViewerMode.Commenting):w.disableMode(T.FileViewerMode.Commenting))),A){const{third_party_source:e,time_based_annotations:t,time_based_annotations_upsell_tooltip_variant:{".tag":r}={".tag":"other"}}=A;t&&n(De()),"other"!==r&&n(Le(r)),e&&n(Ne(e[".tag"]))}const N=a?m.parseActiveCommentFromUrl():void 0;if(P===d.Comments2ContextStatus.Pending)switch(h[".tag"]){case"disabled":null!=I&&I.can_enable_commenting;O(n),N&&u.showErrorSnackbar({message:i.intl.formatMessage({id:"cwWK1c",defaultMessage:"Comments are disabled on this file."})});break;case"enabled":n(Ge({listCompleteTime:k})),n(K(d.Comments2ContextStatus.FullyEnabled)),c.store.dispatch(v.setComments2ShownState({commentCount:C.filter(e=>!e.resolved).length}));break;case"readonly":n(Ge({listCompleteTime:k})),n(K(d.Comments2ContextStatus.ReadOnly)),c.store.dispatch(v.setComments2ShownState({commentCount:C.filter(e=>!e.resolved).length}));break;case"comments1":n(K(d.Comments2ContextStatus.Comments1))}if(f.isEnabled(r)||P===d.Comments2ContextStatus.Pending&&("enabled"===h[".tag"]||"readonly"===h[".tag"])){yield n((E=s,e=>{if(g.useBolt()){const r=S.debounce(()=>{R(),e(Y(!1,!1))},2e3),a=()=>{t.bolt.unsubscribe(),F(()=>{e(Y(!1,!1))})};t.bolt.subscribe(E,r,a)}}));const e=l.streamToRevision(b);yield n({type:q.actionTypes.success,payload:{authors:M,cursor:p,threads:C,currentRevision:e}}),N&&n(t.Actions.activateComment(N))}}catch(e){e instanceof s.Comments2Error&&(e.code===s.ErrorCode.FILE_NOT_FOUND?n(K(d.Comments2ContextStatus.Disabled)):h&&y instanceof s.Comments2Api&&p.logErrorEvent((e.message,": "+e.message),{stream:b})),n({type:q.actionTypes.error,error:e})}var E})),X=x("ActivateThread"),z=y.syncHandler(X),Z=L("DeactivateAllThreads"),$=y.syncHandler(Z),Q=D("CheckOnboardingStatus"),J=B(Q,(e,{api:t})=>t.checkOnboardingStatus()),ee=D("GetMediaFeatures"),te=B(ee,(e,{api:t})=>t.getMediaFeatures()),re=D("GetFileMetadata"),ae=B(re,({fileId:e,linkUrl:t},{api:r})=>r.getFileMetadata(e,t)),ne=D("GetStickers"),ie=B(ne,(e,{api:t})=>t.getStickers()),oe=x("HoverAnnotation"),se=y.syncHandler(oe),ce=x("FocusAnnotation"),le=y.syncHandler(ce),de=D("MarkOnboarded"),ue=B(de,(e,{api:t})=>t.markHasOnboarded(e)),me=x("DismissOnboarding"),ge=y.syncHandler(me),pe=x("MarkModalVariantShown"),_e=y.syncHandler(pe),fe=D("CreateThread"),Se=B(fe,({annotation:e,author:t,content:r,guid:a,source:n},{api:i,context:{stream:o}})=>{const s=l.iCommentContentToUserSubmittedComment({annotation:e,content:r,stream:o});return i.createThread(s,n)}),be=W(D("LoggedOutCreateThread"),({annotation:e,content:t,guid:r,source:a},{api:n,context:{stream:i}})=>{const o=l.iCommentContentToUserSubmittedComment({annotation:e,content:t,stream:i});return n.createThread(o,a)}),he=D("ReplyToThread"),ye=B(he,({author:e,content:t,guid:r,threadId:a},{api:n,context:{stream:i}})=>{const o=l.iCommentContentToUserSubmittedComment({content:t,stream:i});return n.replyToThread(o,a)}),ve=D("DeleteComment"),we=B(ve,({commentId:e,threadId:t},{api:r})=>r.deleteComment(e)),Te=D("EditComment"),Ee=B(Te,({commentId:e,content:t,threadId:r},{api:a,context:{stream:n}})=>{const i=l.iCommentContentToUserSubmittedComment({content:t,stream:n});return a.editComment(e,i)}),Ae=D("MarkThreadRead"),Ce=B(Ae,({origin:e,threadId:t},{api:r})=>r.markThreadRead(t)),Me=D("MarkThreadUnread"),Ie=B(Me,(e,{api:t})=>t.markThreadUnread(e)),ke=D("MarkThreadResolved"),Oe=B(ke,({threadId:e},{api:t})=>t.markThreadResolved(e)),Fe=D("MarkThreadUnresolved"),Re=B(Fe,(e,{api:t})=>t.markThreadUnresolved(e)),Pe=L("EnablePlayerIntegration"),De=y.syncHandler(Pe),xe=x("SetUpsellTooltipVariant"),Le=y.syncHandler(xe),Ue=x("SetThirdPartySource"),Ne=y.syncHandler(Ue),Ve=x("SetCanSeeCommentEditor"),We=y.syncHandler(Ve),Be=x("RecordEnabledStatus"),He=y.syncHandler(Be),je=x("SetPerfData"),Ge=y.syncHandler(je),Ke=x("SetSubscriptionStatus"),qe=y.syncHandler(Ke),Ye=D("Subscribe"),Xe=B(Ye,(e,{api:t})=>t.subscribe()),ze=L("ToggleShowResolved"),Ze=y.syncHandler(ze),$e=D("Unsubscribe"),Qe=B($e,(e,{api:t})=>t.unsubscribe()),Je=x("UpdateDocumentCurrentPage"),et=y.syncHandler(Je),tt=x("UpdateEditorIsEmpty"),rt=y.syncHandler(tt),at=x("UpdatePlayerCurrentTime"),nt=y.syncHandler(at),it=x("DocMetadataLoad"),ot=y.syncHandler(it),st=x("SetPendingNumberedAnnotation"),ct=y.syncHandler(st),lt=L("ClearPendingNumberedAnnotation"),dt=y.syncHandler(lt),ut=L("SetPendingNumberedAnnotationMayBeOffscreen"),mt=y.syncHandler(ut),gt=L("RequestEditorFocus"),pt=y.syncHandler(gt),_t=L("FulfillEditorFocusRequest"),ft=y.syncHandler(_t),St=x("TrackSidebarCommentsVisibility"),bt=y.syncHandler(St),ht=x("ResetStore"),yt=y.syncHandler(ht);function vt(e,t,a){return()=>r.__awaiter(this,void 0,void 0,(function*(){if(!t)return;const{viewer:r,stream:n}=t;(r?new s.Comments2Api(r.id,n):new s.Comments2LoggedOutApi(n)).logPerfEvent(e,a)}))}t.ActionTypes={SetContext:H,SetContextStatus:G,ActivateThread:X,CheckOnboardingStatus:Q,CreateThread:fe,DeactivateAllThreads:Z,DeleteComment:ve,EditComment:Te,EnablePlayerIntegration:Pe,ListComments:q,HoverThread:oe,FocusThread:ce,MarkOnboarded:de,DismissOnboarding:me,GetMediaFeatures:ee,GetFileMetadata:re,GetStickers:ne,MarkModalVariantShown:pe,MarkThreadRead:Ae,MarkThreadResolved:ke,MarkThreadUnread:Me,MarkThreadUnresolved:Fe,RecordEnabledStatus:Be,ReplyToThread:he,SetCanSeeCommentEditor:Ve,SetPerfData:je,SetSubscriptionStatus:Ke,SetThirdPartySource:Ue,SetUpsellTooltipVariant:xe,Subscribe:Ye,ToggleShowResolved:ze,Unsubscribe:$e,UpdateDocumentCurrentPage:Je,UpdateEditorIsEmpty:tt,UpdatePlayerCurrentTime:at,DocMetadataLoad:it,SetPendingNumberedAnnotation:st,ClearPendingNumberedAnnotation:lt,SetPendingNumberedAnnotationMayBeOffscreen:ut,RequestEditorFocus:gt,FulfillEditorFocusRequest:_t,TrackSidebarCommentsVisibility:St,ResetStore:ht},t.Actions={setContextStatus:K,setFileContext:P,activateComment:e=>(t,r)=>{const a=f.getThreads(r()),n=g.findCommentThread(a,e);!n||n.comment.deleted?u.showErrorSnackbar({message:i.intl.formatMessage({id:"/83u+2",defaultMessage:"That comment has been deleted."})}):n.thread.resolved&&u.showErrorSnackbar({message:i.intl.formatMessage({id:"Uu2ETy",defaultMessage:"That comment has been resolved."})}),n&&t(A({thread:n.thread,pendingAnnotationInfo:g.getAnnotationInfoForThread(n.thread)}))},activateThread:z,activateThreadAndMarkAsRead:A,activateThreadByLayerClick:(e,t)=>(r,a)=>{const n=a();if(!f.getIsComments2Ready(n))return;const i=f.getDisplayedThreadsForLayer(n,e.page);r($());const o=g.getThreadForNumberedAnnotationAtPoint(e,i,t);o&&r(A({thread:o,wasPreviewLayerClick:!0}))},activateThreadByMarkerClick:e=>t=>r.__awaiter(void 0,void 0,void 0,(function*(){const r=c.store.getState().sidebar;r.open||(yield c.store.dispatch(v.open("annotation_select"))),"comments"!==r.activeTab&&(yield c.store.dispatch(v.selectTab("comments"))),t(A(e))})),checkOnboardingStatus:J,createThread:Se,loggedOutCreateThread:be,deactivateAllThreads:$,deleteComment:we,disableCommenting:I,editComment:Ee,enableCommenting:C,enablePlayerIntegration:De,hoverThread:se,focusThread:le,hoverThreadByLayer:(e,t)=>(r,a)=>{const n=a();if(!f.getIsComments2Ready(n))return;const i=f.getDisplayedThreadsForLayer(n,e.page),o=g.getThreadForNumberedAnnotationAtPoint(e,i,t);f.getHoverThreadId(n)!==(o&&o.id)&&r(se(o&&o.id))},getMediaFeatures:te,getFileMetadata:ae,getStickers:ie,listComments:Y,markOnboarded:ue,markOnboardedIfUnmarked:e=>(t,r)=>{f.getOnboardingVariants(r())[e]&&t(ue(e))},dismissOnboarding:ge,markModalVariantShown:_e,markThreadRead:Ce,markThreadResolved:Oe,markThreadUnread:Ie,markThreadUnresolved:Re,recordEnabledStatus:He,replyToThread:ye,setCanSeeCommentEditor:We,setPerfData:Ge,setSubscriptionStatus:qe,setThirdPartySource:Ne,setUpsellTooltipVariant:Le,subscribe:Xe,toggleShowResolved:Ze,unsubscribe:Qe,updateDocumentCurrentPage:et,updateEditorIsEmpty:rt,updatePlayerCurrentTime:nt,setPendingNumberedAnnotation:ct,clearPendingNumberedAnnotation:dt,setPendingNumberedAnnotationMayBeOffscreen:mt,requestEditorFocus:pt,fulfillEditorFocusRequest:ft,trackSidebarCommentsVisibility:bt,openVersionHistory:function(){return(e,t)=>{const r=t(),a=f.getViewerId(r),i=f.getFQPath(r);if(i&&a){const e=h.getFileHistoryUrl({fqPath:i,userId:a});n.redirect(e)}}},docMetadataLoad:ot,logPerfEvent:function(e,t){return(a,n)=>r.__awaiter(this,void 0,void 0,(function*(){const r=f.getContext(n());a(vt(e,r,t))}))},logSimplePerfEvent:function(e,t){return(a,n)=>r.__awaiter(this,void 0,void 0,(function*(){const r=n(),a=f.getContext(r);if(a&&a.viewer){new s.Comments2Api(a.viewer.id,a.stream).logSimplePerfEvent(e,t)}}))},resetStore:yt}})),define("modules/clean/react/file_sidebar/file_sidebar_logger",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","modules/clean/react/file_viewer/models"],(function(e,t,r,a,n){"use strict";function i(e,t){const r=n.FileViewerSession.currentSession,i=n.FilePreviewSession.currentSession;if(i&&r){const n={event_name:e,file_viewer_session_id:r.id,file_preview_session_id:i.id,file_ns_id:i.file.ns_id,file_sjid:i.file.sjid,extra:JSON.stringify(t)};a.SilentBackgroundRequest({url:"/log/file_sidebar",data:n})}}Object.defineProperty(t,"__esModule",{value:!0}),t.logFileViewActivityCardExpanded=t.logActivityStreamInteractivity=t.logSidebarClosed=t.logSidebarOpened=t.logSidebarTabSelected=void 0,a=r.__importStar(a),t.logSidebarTabSelected=function(e){i("sidebar_tab_selected",e)},t.logSidebarOpened=function(e){i("sidebar_opened",e)},t.logSidebarClosed=function(e){i("sidebar_closed",e)},t.logActivityStreamInteractivity=function(e){i("activity_stream_interactivity",e)},t.logFileViewActivityCardExpanded=function(e){i("file_view_activity_expanded",e)}})),define("modules/clean/react/file_viewer/controller_mode",["require","exports","api_v2/noauth_client","api_v2/user_client"],(function(e,t,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchControllerMode=void 0,t.fetchControllerMode=function(e,t){return null!=t?(function(e,t){return(new a.UserApiV2Client).ns("file_viewer").rpc("get_mode",e,{subjectUserId:t.id})})(e,t):(function(e){return(new r.NoAuthApiV2Client).ns("file_viewer").rpc("logged_out/get_mode",e,{})})(e)}})),define("modules/clean/react/file_viewer/data/actions",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","modules/clean/react/file_viewer/constants","modules/clean/file_store/actions","modules/clean/previews/data/actions","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/data/selectors","modules/clean/file_store/utils","modules/clean/react/file_viewer/data/types","modules/clean/previews/data/util","modules/clean/react/file_viewer/constants","modules/clean/downloads","modules/core/uri","modules/core/browser","modules/clean/react/file_viewer/controller_mode","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/watermarking/utils","typescript/libraries/file-viewer/src/core/data/modes/types","modules/clean/react/workflows/markup/fabric","modules/clean/react/workflows/markup/selectors","modules/clean/react/file_viewer/prompt/campaign_api","modules/clean/react/size_class/constants","modules/clean/react/watermarking/selectors","modules/clean/react/file_viewer/ml_experiment","modules/clean/react/branding/api"],(function(e,t,r,a,n,i,o,s,c,l,d,u,m,g,p,_,f,S,b,h,y,v,w,T,E,A,C,M){"use strict";function I(e){return{type:d.Actions.OpenFile,payload:{fileId:e}}}function k(e){return(t,r)=>{const a={[y.FileViewerMode.Default]:B,[y.FileViewerMode.Documentation]:j,[y.FileViewerMode.Commenting]:G,[y.FileViewerMode.Watermarking]:K,[y.FileViewerMode.Zoom]:q,[y.FileViewerMode.Slack]:Y,[y.FileViewerMode.Markup]:X,[y.FileViewerMode.Plugins]:Z,[y.FileViewerMode.HelloSign]:$,[y.FileViewerMode.ProAnalytics]:z};a[e]&&a[e](t,r)}}function O(e){return b.filePreviewEventEmitter.emit(m.EventType.SidebarModeSelected,S.FilePreviewSession.currentSession,{selected_mode:e}),{type:d.Actions.UpdateMode,payload:{mode:e}}}function F(e){return(t,r)=>{const a=c.getCurrentFileId(r());a&&t((function(e,t){return{type:d.Actions.UpdateRenderStatus,payload:{fileId:e,renderStatus:t}}})(a,e))}}function R(e){return b.filePreviewEventEmitter.emit(m.EventType.SidebarPaneSelected,S.FilePreviewSession.currentSession,{selected_pane:e}),{type:d.Actions.PushSidebarPane,payload:{paneId:e}}}function P(){return{type:d.Actions.ResetSidebarPaneStack}}function D(){return{type:d.Actions.ResetSelectedSidebarControlId}}function x(e){return{type:d.Actions.SetSelectedSidebarControlId,payload:{controlId:e}}}function L(e){const t=e===y.SidebarVisibility.Open?m.EventType.SidebarOpened:m.EventType.SidebarClosed;return b.filePreviewEventEmitter.emit(t,S.FilePreviewSession.currentSession),{type:d.Actions.SetSidebarVisibility,payload:{visibility:e}}}function U(e){return(t,r)=>{t({type:d.Actions.UpdateWatermarkOptions,payload:{options:e}}),h.setLocalStorageWatermarkingState(c.getCurrentUser(r()),A.getWatermarkState(r()))}}function N(e){return(t,r)=>{t({type:d.Actions.SwitchWatermarkingMode,payload:{mode:e}}),h.setLocalStorageWatermarkingState(c.getCurrentUser(r()),A.getWatermarkState(r()))}}function V(e,t,a){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield h.getUserMetadataTextWatermarkingState(e),n=yield h.getLocalStorageWatermarkingState(e);if(n){U({textWatermarkingOptions:Object.assign(Object.assign({},n.textWatermarkingOptions),r),imageWatermarkingOptions:n.imageWatermarkingOptions})(t,a),N(n.mode)(t,a)}else if(r)U({textWatermarkingOptions:r})(t,a);else{U({textWatermarkingOptions:{text:h.getDefaultText(e)}})(t,a)}}))}function W(e){return{type:d.Actions.SetTrialMode,payload:{isTrialMode:e}}}function B(e,t){const r=t(),a=c.getMode(r);e(W(!1)),e(D()),a!==y.FileViewerMode.Default&&e(O(y.FileViewerMode.Default))}function H(e,t,r,a){return(n,i)=>{const o=i(),s=c.getSidebar(o).visibility,l=c.getMode(o);s===y.SidebarVisibility.Closed&&n(L(y.SidebarVisibility.Open)),l!==e&&(n(W(!!a&&a(o))),n(x(t)),n(P()),n(R(r)),n(O(e)))}}Object.defineProperty(t,"__esModule",{value:!0}),t.overflowZoomOff=t.overflowZoomOn=t.loadWatermarkingStateFromStorage=t.registerUser=t.pageUp=t.pageDown=t.updateCurrentPageIndex=t.fetchDocClassificationAction=t.fetchBestCampaignsAction=t.fetchActiveUserBrandingInfoAction=t.fetchControllerModeAction=t.disableForceHideToolbar=t.forceHideToolbar=t.resetFileViewerStore=t.setMediaPaused=t.setMediaPlaying=t.pendingFileUploaded=t.download=t.saveForwardRevision=t.restoreRevisionAction=t.switchRevisionAction=t.resetMarkupState=t.setMarkupFormatSubmenu=t.setMarkupFill=t.setMarkupStroke=t.setMarkupDrawingMode=t.updateMarkupCanvasScale=t.setMarkupCanvas=t.switchWatermarkingMode=t.updateWatermarkOptions=t.setPageDimensions=t.setSidebarVisibility=t.setSelectedSidebarControlId=t.resetSelectedSidebarControlId=t.resetSidebarPaneStack=t.popSidebarPane=t.pushSidebarPane=t.fetchShowOverQuotaUpsell=t.setRenderStatusSuccessForCurrentFile=t.setRenderStatusForCurrentFile=t.openFile=t.updateMode=t.enableMode=t.disableMode=t.changeMode=t.closeFile=t.openFileById=t.dismissAppDownloadInterstitial=t.closeSidebar=t.openSidebar=t.closeFullScreen=t.openFullScreen=void 0,a=r.__importStar(a),g=r.__importStar(g),_=r.__importStar(_),t.openFullScreen=()=>({type:d.Actions.OpenFullScreen}),t.closeFullScreen=()=>({type:d.Actions.CloseFullScreen}),t.openSidebar=function(e=n.DocType.default,t){return r=>{r({type:d.Actions.OpenSidebar,payload:{type:e}}),s.logUserAction(n.UserAction.ToggleSidebarOn,t)}},t.closeSidebar=function(e=n.DocType.default,t){return r=>{r({type:d.Actions.CloseSidebar,payload:{type:e}}),s.logUserAction(n.UserAction.ToggleSidebarOff,t)}},t.dismissAppDownloadInterstitial=function(){return{type:d.Actions.DismissAppDownloadInterstitial}},t.openFileById=I,t.closeFile=function(){return{type:d.Actions.CloseFile}},t.changeMode=k,t.disableMode=function(e){return{type:d.Actions.DisableMode,payload:{mode:e}}},t.enableMode=function(e){return{type:d.Actions.EnableMode,payload:{mode:e}}},t.updateMode=O,t.openFile=function(e){return(t,a)=>r.__awaiter(this,void 0,void 0,(function*(){const r=l.getFileStoreId(e),n=i.putFile(e);t(n),!u.previewDataPresentForFile(a(),e)&&!u.previewDataInFlight(a(),e)&&(n.payload.file.preview?t(o.populateFilesPreviewData([n.payload.file])):t(o.fetchPreviewData([n.payload.file]))),t(I(r))}))},t.setRenderStatusForCurrentFile=F,t.setRenderStatusSuccessForCurrentFile=function(){return F(m.PreviewRenderStatus.Succeeded)},t.fetchShowOverQuotaUpsell=function(e){return(t,r)=>{e&&void 0===c.getShowOverQuotaUpsell(r())&&a.SilentBackgroundRequest({url:"/should_show_file_preview_upsell",data:{_subject_uid:e.id},success:e=>{try{const a=JSON.parse(e);a&&t((r=a.shouldShowFilePreviewUpsell,{type:d.Actions.SetShowOverQuotaUpsell,payload:r}))}catch(e){}var r}})}},t.pushSidebarPane=R,t.popSidebarPane=function(){return{type:d.Actions.PopSidebarPane}},t.resetSidebarPaneStack=P,t.resetSelectedSidebarControlId=D,t.setSelectedSidebarControlId=x,t.setSidebarVisibility=L,t.setPageDimensions=function(e){return{type:d.Actions.SetPageDimensions,payload:{pageDimensions:e}}},t.updateWatermarkOptions=U,t.switchWatermarkingMode=N,t.setMarkupCanvas=function(e,t,r){return{type:d.Actions.SetMarkupCanvas,payload:{page:e,fabric:t,scale:r}}},t.updateMarkupCanvasScale=function(e,t){return{type:d.Actions.UpdateMarkupCanvasScale,payload:{page:e,scale:t}}},t.setMarkupDrawingMode=function(e){return(t,r)=>{t({type:d.Actions.SetMarkupDrawingMode,payload:{isDrawingMode:e}}),v.setDrawingMode(w.getMarkupState(r()),e)}},t.setMarkupStroke=function(e){return t=>{t({type:d.Actions.SetMarkupStroke,payload:{color:e}}),v.setBaseBrushColor(e)}},t.setMarkupFill=function(e){return{type:d.Actions.SetMarkupFill,payload:{color:e}}},t.setMarkupFormatSubmenu=function(e){return{type:d.Actions.SetMarkupSubmenuType,payload:{formatSubmenu:e}}},t.resetMarkupState=function(){return(e,t)=>{v.disposeCanvas(w.getMarkupState(t())),e({type:d.Actions.ResetMarkupState})}},t.switchRevisionAction=function(e){return t=>{e.preview&&t(o.overridePreviewForComments(e,e.preview)),t({type:d.Actions.SwitchRevision,payload:{file:e}})}},t.restoreRevisionAction=function(){return(e,t)=>{const r=c.getActiveFile(t());r&&e(o.clearCommentsPreviewOverride(r)),e({type:d.Actions.RestoreRevision})}},t.saveForwardRevision=function(e){return t=>{t(i.putFile(e,e.revision_id)),e.preview&&t(o.overridePreviewForComments(e,e.preview)),t({type:d.Actions.SaveForwardRevision,payload:{revisionKey:e.revision_id}})}},t.download=function(e){const t=p.URI.parse(e.href);t.updateQuery({dl:"1"}),g.get({url:t.toString()})},t.pendingFileUploaded=function(){_.reload(!0)},t.setMediaPlaying=function(){return e=>{e({type:d.Actions.PlayMedia})}},t.setMediaPaused=function(){return e=>{e({type:d.Actions.PauseMedia})}},t.resetFileViewerStore=function(){return e=>{e({type:d.Actions.ResetStore})}},t.forceHideToolbar=function(){return{type:d.Actions.ForceHideToolbar}},t.disableForceHideToolbar=function(){return{type:d.Actions.DisableForceHideToolbar}},t.fetchControllerModeAction=function(e,t,a){return(n,i)=>r.__awaiter(this,void 0,void 0,(function*(){n({type:d.Actions.FetchControllerModeRequest});try{const{mode:r}=yield f.fetchControllerMode(e,t);if(b.filePreviewEventEmitter.emit(m.EventType.FilePreviewModeDetermined,S.FilePreviewSession.currentSession,{mode:r}),a===E.SizeClass.Small||a===E.SizeClass.Medium)return n(x(y.SidebarControlId.Documentation)),n(R(y.SidebarPaneId.Documentation)),void n(O(y.FileViewerMode.Documentation));const o=(function(e){let t=y.FileViewerMode.Default;if(e)switch(e[".tag"]){case"commenting_mode":t=y.FileViewerMode.Commenting;break;case"documentation_mode":t=y.FileViewerMode.Documentation;break;case"other":t=y.FileViewerMode.Default}return t})(r),s=c.getMode(i());s&&s!==y.FileViewerMode.Default||n(k(o))}catch(e){n({type:d.Actions.FetchControllerModeError,payload:e})}}))},t.fetchActiveUserBrandingInfoAction=function(e){return(t,a)=>r.__awaiter(this,void 0,void 0,(function*(){var r;try{const[a,n]=yield Promise.all([M.getLogo(e.id),M.getName(e.id)]);let i=null;const o=null===(r=null==a?void 0:a.graphic)||void 0===r?void 0:r.value;"image"===(null==o?void 0:o[".tag"])&&o.original_url&&(i=o.original_url),t({type:d.Actions.SetActiveUserBrandingInfo,payload:{activeUserBrandingInfo:{logoUrl:i,organizationName:n}}})}catch(e){}}))},t.fetchBestCampaignsAction=function(e,t){return(a,n)=>r.__awaiter(this,void 0,void 0,(function*(){const{campaigns:r}=yield T.fetchBestCampaigns(e.id,t);a({type:d.Actions.SetBestCampaign,payload:{campaign:r[0]}})}))},t.fetchDocClassificationAction=function(e,t){return(a,n)=>r.__awaiter(this,void 0,void 0,(function*(){const{predicted_types:r}=yield C.fetchDocClassification(e,t);a({type:d.Actions.SetDocClassification,payload:{docClassification:{predicted_types:r},fileId:t}})}))},t.updateCurrentPageIndex=function(e){return{type:d.Actions.UpdateCurrentPageIndex,payload:{currentPageIndex:e}}},t.pageDown=function(){return{type:d.Actions.PageDown}},t.pageUp=function(){return{type:d.Actions.PageUp}},t.registerUser=function(e){return(t,r)=>{t({type:d.Actions.RegisterUser,payload:{user:e}}),V(e,t,r)}},t.loadWatermarkingStateFromStorage=V;const j=H(y.FileViewerMode.Documentation,y.SidebarControlId.Documentation,y.SidebarPaneId.Documentation),G=H(y.FileViewerMode.Commenting,y.SidebarControlId.Comments,y.SidebarPaneId.Comments),K=H(y.FileViewerMode.Watermarking,y.SidebarControlId.Watermarking,y.SidebarPaneId.Watermarking,e=>h.allowWatermarkTrial(c.getCurrentUser(e))),q=H(y.FileViewerMode.Zoom,y.SidebarControlId.Zoom,y.SidebarPaneId.Zoom),Y=H(y.FileViewerMode.Slack,y.SidebarControlId.Slack,y.SidebarPaneId.SlackHome),X=H(y.FileViewerMode.Markup,y.SidebarControlId.Markup,y.SidebarPaneId.Markup),z=H(y.FileViewerMode.ProAnalytics,y.SidebarControlId.ProAnalytics,y.SidebarPaneId.ProAnalytics),Z=()=>{},$=()=>{};t.overflowZoomOn=function(){return{type:d.Actions.OverflowZoomOn}},t.overflowZoomOff=function(){return{type:d.Actions.OverflowZoomOff}}})),define("modules/clean/react/file_viewer/data/selectors",["require","exports","tslib","modules/clean/redux/namespaces","modules/clean/redux/selectors","modules/clean/file_store/selectors","modules/clean/previews/data/selectors","modules/clean/react/file_viewer/constants","modules/clean/previews/data/preview_type_util","reselect","lodash","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/client","typescript/libraries/file-viewer/src/core/data/modes/types"],(function(e,t,r,a,n,i,o,s,c,l,d,u,m,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDocClassificationForFile=t.getHelloSignAppActionForFile=t.isOverflowZoomMode=t.getExtensionsEnabled=t.shouldForceHideToolbar=t.getIsFlippingEnabled=t.getPreviewApiDataForCurrentFile=t.getPauseCount=t.getIsMediaPlaying=t.getRenderStatusForCurrentFile=t.getActiveUserBrandingInfo=t.getSelectedPromptCampaign=t.getShowOverQuotaUpsell=t.getActiveFile=t.getPageDimensions=t.getIsMarkupMode=t.getIsWatermarkingMode=t.getIsEditMode=t.getIsTrialMode=t.getAnnotationAllowed=t.getSidebar=t.getDisabledModes=t.getMode=t.getCurrentUser=t.getPastFile=t.getCurrentFile=t.getCurrentFileId=t.getAppDownloadInterstitial=t.getCurrentPageIndex=t.getIsSidebarOpen=t.getIsFullScreen=t.getFileViewerState=void 0,d=r.__importStar(d),t.getFileViewerState=e=>n.getStateAtNamespace(e,a.FILE_VIEWER_NAMESPACE_KEY),t.getIsFullScreen=e=>t.getFileViewerState(e).isFullScreen,t.getIsSidebarOpen=e=>t.getFileViewerState(e).isSidebarOpen,t.getCurrentPageIndex=e=>t.getFileViewerState(e).currentPageIndex,t.getAppDownloadInterstitial=e=>t.getFileViewerState(e).appDownloadInterstitialDismissed,t.getCurrentFileId=e=>t.getFileViewerState(e).currentFileId,t.getCurrentFile=l.createSelector(d.nthArg(0),t.getCurrentFileId,i.getFile),t.getPastFile=e=>t.getFileViewerState(e).fileRevision,t.getCurrentUser=e=>t.getFileViewerState(e).currentUser,t.getMode=e=>t.getFileViewerState(e).mode,t.getDisabledModes=e=>t.getFileViewerState(e).disabledModes,t.getSidebar=e=>t.getFileViewerState(e).sidebar,t.getAnnotationAllowed=l.createSelector(t.getMode,e=>e===g.FileViewerMode.Commenting),t.getIsTrialMode=e=>t.getFileViewerState(e).isTrialMode,t.getIsEditMode=e=>t.getIsMarkupMode(e)||t.getIsWatermarkingMode(e),t.getIsWatermarkingMode=e=>t.getMode(e)===g.FileViewerMode.Watermarking,t.getIsMarkupMode=e=>t.getMode(e)===g.FileViewerMode.Markup,t.getPageDimensions=e=>t.getFileViewerState(e).pageDimensions,t.getActiveFile=e=>t.getPastFile(e)||t.getCurrentFile(e),t.getShowOverQuotaUpsell=e=>t.getFileViewerState(e).showOverQuotaUpsell;t.getSelectedPromptCampaign=e=>t.getFileViewerState(e).campaign,t.getActiveUserBrandingInfo=e=>t.getFileViewerState(e).activeUserBrandingInfo,t.getRenderStatusForCurrentFile=e=>{const r=t.getCurrentFileId(e);if(r)return((e,r)=>t.getFileViewerState(e).renderStatuses[r])(e,r)},t.getIsMediaPlaying=e=>t.getFileViewerState(e).isMediaPlaying,t.getPauseCount=e=>{const r=t.getFileViewerState(e).pauseCount;return r||0},t.getPreviewApiDataForCurrentFile=e=>{const r=t.getCurrentFile(e);return o.getApiDataForFile(e,r).data},t.getIsFlippingEnabled=e=>{const r=t.getPreviewApiDataForCurrentFile(e);return!(t.getIsEditMode(e)||t.getIsMediaPlaying(e)||t.getIsFullScreen(e)&&c.isSsrDoc(r))},t.shouldForceHideToolbar=e=>t.getFileViewerState(e).forceHideToolbar,t.getExtensionsEnabled=e=>{const r=t.getActiveFile(e);return!r||!u.fileExtensionsConfigs(e)[r.file_id]||u.fileExtensionsConfigs(e)[r.file_id].displayState!==m.DisplayState.DISABLED},t.isOverflowZoomMode=e=>!0===t.getFileViewerState(e).overflowZoom,t.getHelloSignAppActionForFile=(e,t)=>u.getShareActionsForFiles(e,[t]).filter(e=>e.app_id===s.HELLOSIGN_PROD_APP_ID)[0],t.getDocClassificationForFile=(e,r)=>{const a=t.getFileViewerState(e);if(a&&a.docClassifications&&a.docClassifications[r])return a.docClassifications[r]}})),define("modules/clean/react/file_viewer/data/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Actions=void 0,(function(e){e.CloseFile="FileViewer/CloseFile",e.CloseFullScreen="FileViewer/CloseFullScreen",e.CloseSidebar="FileViewer/CloseSidebar",e.DismissAppDownloadInterstitial="FileViewer/DismissAppDownloadInterstitial",e.DisableForceHideToolbar="FileViewer/DisableForceHideToolbar",e.ForceHideToolbar="FileViewer/ForceHideToolbar",e.UpdateMode="FileViewer/UpdateMode",e.DisableMode="FileViewer/DisableMode",e.EnableMode="FileViewer/EnableMode",e.OpenFile="FileViewer/OpenFile",e.OpenFullScreen="FileViewer/OpenFullScreen",e.OpenSidebar="FileViewer/OpenSidebar",e.PageDown="FileViewer/PageDown",e.PageUp="FileViewer/PageUp",e.PauseMedia="FileViewer/PauseMedia",e.PlayMedia="FileViewer/PlayMedia",e.PopSidebarPane="FileViewer/PopSidebarPane",e.PushSidebarPane="FileViewer/PushSidebarPane",e.SetSelectedSidebarControlId="FileViewer/SetSelectedSidebarControlId",e.ResetSidebarPaneStack="FileViewer/ResetSidebarPaneStack",e.ResetSelectedSidebarControlId="FileViewer/ResetSelectedSidebarControlId",e.ResetStore="FileViewer/ResetStore",e.UpdateCurrentPageIndex="FileViewer/UpdateCurrentPageIndex",e.RestoreRevision="FileViewer/RestoreRevision",e.SaveForwardRevision="FileViewer/SaveForwardRevision",e.SetCurrentCalloutType="FileViewer/SetCurrentCalloutType",e.SetShowOverQuotaUpsell="FileViewer/SetShowOverQuotaUpsell",e.SetSidebarVisibility="FileViewer/SetSidebarVisibility",e.SetPageDimensions="FileViewer/SetPageDimensions",e.UpdateWatermarkOptions="FileViewer/UpdateWatermarkOptions",e.SwitchWatermarkingMode="FileViewer/SwitchWatermarkingMode",e.SetMarkupCanvas="FileViewer/SetMarkupCanvas",e.UpdateMarkupCanvasScale="FileViewer/UpdateMarkupCanvasScale",e.ResetMarkupState="FileViewer/ResetMarkupState",e.SetMarkupDrawingMode="FileViewer/SetMarkupDrawingMode",e.SetMarkupFill="FileViewer/SetMarkupFill",e.SetMarkupStroke="FileViewer/SetMarkupStroke",e.SetMarkupSubmenuType="FileViewer/SetMarkupSubmenuType",e.SwitchRevision="FileViewer/SwitchRevision",e.UpdateRenderStatus="FileViewer/UpdateRenderStatus",e.RegisterUser="FileViewer/RegisterUser",e.SetTrialMode="FileViewer/SetTrialMode",e.FetchControllerModeRequest="FileViewer/FetchControllerModeRequest",e.FetchControllerModeSuccess="FileViewer/FetchControllerModeSuccess",e.FetchControllerModeError="FileViewer/FetchControllerModeError",e.FetchBestCampaign="FileViewer/FetchBestCampaign",e.SetBestCampaign="FileViewer/SetBestCampaign",e.SetActiveUserBrandingInfo="FileViewer/SetActiveUserBrandingInfo",e.SetDocClassification="FileViewer/SetDocClassification",e.OverflowZoomOn="FileViewer/OverflowZoomOn",e.OverflowZoomOff="FileViewer/OverflowZoomOff"})(t.Actions||(t.Actions={}))})),define("modules/clean/react/file_viewer/open_button/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenButtonAction=void 0,(function(e){e[e.DOWNLOAD=0]="DOWNLOAD",e[e.UNITY_FILE=1]="UNITY_FILE",e[e.UNITY_FOLDER=2]="UNITY_FOLDER",e[e.OPEN_WITH=3]="OPEN_WITH",e[e.OPEN_IN_PAPER=4]="OPEN_IN_PAPER",e[e.APP_ACTION=5]="APP_ACTION",e[e.PREPARE_FOR_SIGNATURE=6]="PREPARE_FOR_SIGNATURE",e[e.SHARE_TO_SLACK=7]="SHARE_TO_SLACK",e[e.PRESENT_IN_ZOOM=8]="PRESENT_IN_ZOOM",e[e.SHARE_TO_TRELLO=9]="SHARE_TO_TRELLO",e[e.INVITE_VIA_EMAIL=10]="INVITE_VIA_EMAIL",e[e.OPEN_WITH_CLOUD_DOC=11]="OPEN_WITH_CLOUD_DOC",e[e.OPEN_MORE_APPS=12]="OPEN_MORE_APPS",e[e.OPEN_ADD_APPS=13]="OPEN_ADD_APPS",e[e.DECOMPRESS_FILE=14]="DECOMPRESS_FILE",e[e.PREVIEW_FILE=15]="PREVIEW_FILE",e[e.TRANSFER=16]="TRANSFER",e[e.OPEN_IN_DESKTOP=17]="OPEN_IN_DESKTOP",e[e.GO_TO_FOLDER=18]="GO_TO_FOLDER",e[e.OPEN_IN_REPLAY=19]="OPEN_IN_REPLAY",e[e.OPEN_IN_NEW_TAB=20]="OPEN_IN_NEW_TAB"})(t.OpenButtonAction||(t.OpenButtonAction={}))})),define("modules/clean/react/file_viewer/prompt/campaign_api",["require","exports","api_v2/user_client"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchBestCampaigns=void 0,t.fetchBestCampaigns=function(e,t){const a={client_context:{platform:"web",locations:["targeted_bubble"],ref_page:["preview","file_viewer"],display_context:"fv_preview_type="+t}};return(new r.UserApiV2Client).ns("prompt").rpc("get_best_campaigns",a,{subjectUserId:e})}})),define("modules/clean/react/location/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Location=void 0;class r{constructor(e,t={}){this.path=e,this.query=t}static fromURI(e){return new r(e.getPath(),e.getQuery())}}t.Location=r})),define("modules/clean/react/size_class/utils",["require","exports","modules/clean/react/size_class/constants"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSmallerThanLarge=void 0,t.isSmallerThanLarge=function(e){return e!==r.SizeClass.Large&&e!==r.SizeClass.ExtraLarge}})),define("modules/clean/react/watermarking/drawing",["require","exports"],(function(e,t){"use strict";function r(e,t,r,a,n=!1){e.save(),e.font=`${r}px ${a}`;const i=e.measureText(t);return e.restore(),n?{width:i.width,height:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent||r}:{width:i.width,height:i.fontBoundingBoxAscent+i.fontBoundingBoxDescent||r}}Object.defineProperty(t,"__esModule",{value:!0}),t.drawImageTile=t.drawTextTile=void 0,t.drawTextTile=function(e,t,a,n,i,o){const s=document.createElement("canvas"),c=s.getContext("2d");if(!c)throw new Error("Cannot draw on canvas");const{width:l,height:d}=r(c,e,t,a);s.width=Math.abs(l*Math.cos(o))+Math.abs(d*Math.sin(o)),s.height=Math.abs(l*Math.sin(o))+Math.abs(d*Math.cos(o)),c.font=`${t}px ${a}`,c.globalAlpha=i,c.fillStyle=n,c.textBaseline="bottom";let u=0,m=s.height;o<.5*Math.PI?u=d*Math.sin(o):o<Math.PI?(u=d*Math.sin(o)-l*Math.cos(o),m+=d*Math.cos(o)):o<1.5*Math.PI?(u=-l*Math.cos(o),m=0):m+=l*Math.sin(o),c.translate(u,m),c.rotate(-o),c.fillText(e,0,0);const{width:g,height:p}=r(c,e,t,a,!0);return{canvas:s,actualUnrotatedHeight:p,actualUnrotatedWidth:g}},t.drawImageTile=function(e,t,r,a){const n=document.createElement("canvas"),i=n.getContext("2d");if(!i)throw new Error("Cannot draw on canvas");const o=a||0,s=e.width*t,c=e.height*t;n.width=Math.round(Math.abs(s*Math.cos(o))+Math.abs(c*Math.sin(o))),n.height=Math.round(Math.abs(s*Math.sin(o))+Math.abs(c*Math.cos(o)));let l=0,d=0;return o<.5*Math.PI?d=s*Math.sin(o):o<Math.PI?(l=-s*Math.cos(o),d=s*Math.sin(o)-c*Math.cos(o)):o<1.5*Math.PI?(l=-s*Math.cos(o)-c*Math.sin(o),d=-c*Math.cos(o)):l=-c*Math.sin(o),i.globalAlpha=r,i.translate(l,d),i.rotate(-o),i.drawImage(e,0,0,s,c),{canvas:n,actualUnrotatedHeight:c,actualUnrotatedWidth:s}}})),define("modules/clean/react/watermarking/selectors",["require","exports","tslib","reselect","lodash","modules/clean/react/watermarking/types","modules/clean/react/watermarking/utils","modules/clean/react/watermarking/drawing","modules/clean/react/file_viewer/data/selectors"],(function(e,t,r,a,n,i,o,s,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWatermarkTilingFunc=t.getWatermarkState=void 0,n=r.__importStar(n),t.getWatermarkState=e=>c.getFileViewerState(e).watermark,t.getWatermarkTilingFunc=a.createSelector(t.getWatermarkState,e=>n.memoize(t=>{const{angle:r,opacity:a,size:n}=i.getWatermarkingOptions(e),c=r%360,l=r/180*Math.PI,d=l%(Math.PI/2),{canvas:u,actualUnrotatedHeight:m,actualUnrotatedWidth:g}=(r=>{if(e.mode===i.WatermarkingMode.TEXT){const{color:i,fontFamily:o,text:c}=e.textWatermarkingOptions;return s.drawTextTile(c,n*t,o,i,a/100,r)}{const{image:i}=e.imageWatermarkingOptions;if(!i)throw new o.WatermarkingError(o.WatermarkingError.TILE_NO_INPUT);return s.drawImageTile(i,n*t,a/100,r)}})(l),p=Math.max(m,g);let _=p/2,f=p/2;if(e.mode===i.WatermarkingMode.TEXT){const{lineHeight:t}=e.textWatermarkingOptions;_=2*m,f=t*m}const S=g+_,b=m+f;let h=0,y=0,v=0;return c%180==0?(h=S,y=b,v=_/-1.2):c%180==90?(h=b,y=S):c>0&&c<90||c>180&&c<270?(h=b/Math.sin(d),y=S*Math.sin(d),v=-S*Math.cos(d)):(c>90&&c<180||c>270&&c<360)&&(h=b/Math.cos(d),y=S*Math.cos(d),v=S*Math.sin(d)),{canvas:u,width:u.width,height:u.height,distanceX:h,distanceY:y,startX:-u.width/2,startY:-u.height/2,offsetXPerRow:v,offsetYPerCol:0}}))})),define("modules/clean/react/watermarking/types",["require","exports"],(function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.getWatermarkingOptions=t.WatermarkPosition=t.WatermarkingMode=void 0,(function(e){e.TEXT="text",e.IMAGE="image"})(r=t.WatermarkingMode||(t.WatermarkingMode={})),(function(e){e.REPEAT="REPEAT",e.CENTER="CENTER",e.NORTHWEST="NORTHWEST",e.NORTHEAST="NORTHEAST",e.SOUTHEAST="SOUTHEAST",e.SOUTHWEST="SOUTHWEST"})(t.WatermarkPosition||(t.WatermarkPosition={})),t.getWatermarkingOptions=function(e){return e.mode===r.TEXT?e.textWatermarkingOptions:e.imageWatermarkingOptions}})),define("modules/clean/react/watermarking/utils",["require","exports","tslib","sjcl","lodash","modules/constants/file_viewer","modules/clean/i18n/formatters","modules/constants/page_load","modules/clean/file_store/utils","modules/core/i18n","modules/clean/previews/constants","modules/clean/react/watermarking/drawing","modules/clean/react/watermarking/types","modules/core/persistence/storage","modules/core/cookies","modules/core/exception","modules/clean/react/user_metadata/api"],(function(e,t,r,a,n,i,o,s,c,l,d,u,m,g,p,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isUnauthorizedAccessError=t.isUnsupportedFileError=t.isFilesystemError=t.isOverQuotaError=t.setUserMetadataTextWatermarkingState=t.getUserMetadataTextWatermarkingState=t.getLocalStorageWatermarkingState=t.setLocalStorageWatermarkingState=t.getWatermarkMilestone=t.getImageFromURL=t.getWatermarkingLabelText=t.getWatermarkScale=t.DEFAULT_WATERMARKING_STATE=t.getImageDefaultSizes=t.getDefaultText=t.allowWatermarkOrTrial=t.allowWatermarkTrial=t.getWatermarkTrialVariant=t.allowWatermark=t.isWatermarkingEnabled=t.fileIsWatermarkable=t.WatermarkingError=t.WATERMARKING_LOCAL_STORAGE_KEY=t.DEFAULT_SIZES=void 0,a=r.__importStar(a),n=r.__importStar(n),_=r.__importStar(_);const S=[".pdf",".jpg",".jpeg",".png",".bmp"];t.DEFAULT_SIZES={size:1,minSize:.2,maxSize:5},t.WATERMARKING_LOCAL_STORAGE_KEY="fileviewer_watermarking_data";class b extends Error{constructor(e){super(e),this.message=e,this.name="WatermarkingError"}}function h(e){return e&&i.WATERMARK_TRIAL_VARIANT_BY_USER_ID?i.WATERMARK_TRIAL_VARIANT_BY_USER_ID[e.id]:""}function y(e){return!t.isWatermarkingEnabled(e)&&["DEACTIVATED_MENU","POPOVER_WM_VALUE_PROPS","POPOVER_PRO_VALUE_PROPS","TOOLTIP_ON_HOVER"].includes(h(e))}function v(e){return new Promise((t,r)=>{const a=new Image;a.onload=()=>{t(a)},a.onerror=e=>{r(e)},a.crossOrigin="anonymous",a.src=e})}function w(e,r){const n=(function(e){try{const t=a.codec.utf8String.toBits(p.Cookies.read("__Host-js_csrf"));return a.encrypt(t,JSON.stringify(e))}catch(e){return void _.reportException({err:e,severity:_.SEVERITY.NONCRITICAL,tags:["watermarking"]})}})(r);n&&g.UserLocalStorage.set(e.id,t.WATERMARKING_LOCAL_STORAGE_KEY,n)}t.WatermarkingError=b,b.TILE_NO_INPUT="Unable to tile: missing text or image",t.fileIsWatermarkable=e=>!!e&&(c.isBrowseFile(e)&&!e.read_only&&!!e.ext&&S.includes(e.ext.toLowerCase())),t.isWatermarkingEnabled=e=>!!(e&&i.WATERMARKING_BY_USER_ID&&i.WATERMARKING_BY_USER_ID[e.id]),t.allowWatermark=(e,r)=>t.isWatermarkingEnabled(r)&&t.fileIsWatermarkable(e),t.getWatermarkTrialVariant=h,t.allowWatermarkTrial=y,t.allowWatermarkOrTrial=function(e,r){return t.allowWatermark(e,r)||y(r)},t.getDefaultText=function(e){if(!e)return"DRAFT";const{formatDate:t}=o.createFormatters(s.USER_LOCALE,{}),r=t(new Date,{});return`${e.display_name} | ${r}`},t.getImageDefaultSizes=function(e,r){if(!e||!r)return t.DEFAULT_SIZES;const a=e.width/r.width,n=e.height/r.height,i=Math.max(a,n);if(i*t.DEFAULT_SIZES.maxSize<=.9)return t.DEFAULT_SIZES;const o=.9/i;return{size:o/5,minSize:o/25,maxSize:o}},t.DEFAULT_WATERMARKING_STATE={mode:m.WatermarkingMode.TEXT,textWatermarkingOptions:{angle:45,color:"black",opacity:30,fontFamily:"Helvetica, sans-serif",size:20,minSize:5,maxSize:200,lineHeight:3,text:"DRAFT",position:m.WatermarkPosition.REPEAT,marginX:40,marginY:40,scale:1},imageWatermarkingOptions:Object.assign({angle:45,opacity:30,position:m.WatermarkPosition.REPEAT,marginX:40,marginY:40,scale:1},t.DEFAULT_SIZES)},t.getWatermarkScale=function(e){return e===d.PreviewType.SsrDoc?300/72:1},t.getWatermarkingLabelText=function(e,t){if(e)return t===d.PreviewType.Image?l.intl.formatMessage({id:"35NidE",defaultMessage:"Watermarking is available on PDFs, PNGs, JPEGs, and BMPs."}):l.intl.formatMessage({id:"HcLjiD",defaultMessage:"Watermarking is available on PDFs and images."})},t.getImageFromURL=v,t.getWatermarkMilestone=function(e){return"M2"},t.setLocalStorageWatermarkingState=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){if(!e||!t)return;const r=(function(e){const t=Object.assign(Object.assign({},e),{imageWatermarkingOptions:Object.assign({},e.imageWatermarkingOptions)});t.imageWatermarkingOptions.image&&!t.imageWatermarkingOptions.imageAsDataURL&&(t.imageWatermarkingOptions.imageAsDataURL=u.drawImageTile(t.imageWatermarkingOptions.image,1,1).canvas.toDataURL());return delete t.imageWatermarkingOptions.image,t})(t);try{w(e,r)}catch(t){if(r.imageWatermarkingOptions.imageAsDataURL){delete r.imageWatermarkingOptions.imageAsDataURL;try{w(e,r)}catch(e){_.reportException({err:t,severity:_.SEVERITY.NONCRITICAL,tags:["watermarking"]})}}}}))},t.getLocalStorageWatermarkingState=function(e){return r.__awaiter(this,void 0,void 0,(function*(){const r=g.UserLocalStorage.get(e.id,t.WATERMARKING_LOCAL_STORAGE_KEY);if(r)try{const e=a.codec.utf8String.toBits(p.Cookies.read("__Host-js_csrf")),t=JSON.parse(a.decrypt(e,r));return t.imageWatermarkingOptions.imageAsDataURL&&(t.imageWatermarkingOptions.image=yield v(t.imageWatermarkingOptions.imageAsDataURL)),t}catch(e){_.reportException({err:e,severity:_.SEVERITY.NONCRITICAL,tags:["watermarking"]})}}))},t.getUserMetadataTextWatermarkingState=function(e){return r.__awaiter(this,void 0,void 0,(function*(){try{const t=yield f.getUserMetadata(["TEXT_WATERMARKING_COLOR","TEXT_WATERMARKING_TEXT","TEXT_WATERMARKING_OPACITY","TEXT_WATERMARKING_ANGLE","TEXT_WATERMARKING_POSITION","TEXT_WATERMARKING_SIZE"],e.id),r={color:t.TEXT_WATERMARKING_COLOR?t.TEXT_WATERMARKING_COLOR:void 0,text:t.TEXT_WATERMARKING_TEXT,opacity:t.TEXT_WATERMARKING_OPACITY,angle:t.TEXT_WATERMARKING_ANGLE,position:t.TEXT_WATERMARKING_POSITION?t.TEXT_WATERMARKING_POSITION:void 0,size:t.TEXT_WATERMARKING_SIZE};return n.omitBy(r,n.isUndefined)}catch(e){return void _.reportException({err:e,severity:_.SEVERITY.NONCRITICAL,tags:["watermarking"]})}}))},t.setUserMetadataTextWatermarkingState=function(e,t){const r=t.textWatermarkingOptions;f.setUserMetadata({TEXT_WATERMARKING_COLOR:r.color,TEXT_WATERMARKING_TEXT:r.text,TEXT_WATERMARKING_OPACITY:r.opacity,TEXT_WATERMARKING_ANGLE:r.angle,TEXT_WATERMARKING_POSITION:r.position,TEXT_WATERMARKING_SIZE:r.size},e.id)},t.isOverQuotaError=function(e){return!(!e||"over_quota_error"!==e[".tag"])},t.isFilesystemError=function(e){return!(!e||"filesystem_error"!==e[".tag"])},t.isUnsupportedFileError=function(e){return!(!e||"unsupported_file_error"!==e[".tag"])},t.isUnauthorizedAccessError=function(e){return!(!e||"unauthorized_access"!==e[".tag"])}})),define("modules/clean/react/workflows/markup/fabric_wrapper",["require","exports","tslib","fabric"],(function(e,t,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fabric=void 0;const n=(a=r.__importDefault(a)).default.fabric||a.default;t.fabric=n})),define("modules/clean/react/workflows/markup/fabric",["require","exports","tslib","modules/clean/react/workflows/markup/fabric_wrapper","modules/clean/previews/constants","modules/clean/react/workflows/markup/types","api_v2/user_client"],(function(e,t,r,a,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFill=t.getStroke=t.setOptionsForActiveObjects=t.saveMarkup=t.disposeCanvas=t.setBaseBrushColor=t.setDrawingMode=t.addMarkupObject=void 0;a.fabric.Object&&(a.fabric.util.object.extend(a.fabric.Object.prototype,{cornerStyle:"circle",cornerColor:"#0052D9",cornerSize:10,cornerStrokeColor:"white",transparentCorners:!1,drawControls:function(e,t){t=t||{};const r=this._calculateCurrentDimensions(),a=r.x,n=r.y,i=t.cornerSize||this.cornerSize,o=-(a+i)/2,s=-(n+i)/2,c=void 0!==t.transparentCorners?t.transparentCorners:this.transparentCorners,l=void 0!==t.hasRotatingPoint?t.hasRotatingPoint:this.hasRotatingPoint,d=c?"stroke":"fill";return e.save(),e.strokeStyle=e.fillStyle=t.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=t.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,t.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",e,d,o,s,t),this._drawControl("tr",e,d,o+a,s,t),this._drawControl("bl",e,d,o,s+n,t),this._drawControl("br",e,d,o+a,s+n,t),l&&this._drawControl("mtr",e,d,o+a/2,s-this.rotatingPointOffset,t),e.restore(),this},_findTargetCorner:function(e){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;const t=e.x,r=e.y;this.__corner=0;for(const e in this.oCoords){if(!this.isControlVisible(e))continue;if("mtr"===e&&!this.hasRotatingPoint)continue;if(this.get("lockUniScaling")&&("mt"===e||"mr"===e||"mb"===e||"ml"===e))continue;let a;switch(e){case"mt":a=this._getHorizontalImageLines(this.oCoords.tl.corner,this.oCoords.tr.corner);break;case"mr":a=this._getVerticalImageLines(this.oCoords.tr.corner,this.oCoords.br.corner);break;case"mb":a=this._getHorizontalImageLines(this.oCoords.bl.corner,this.oCoords.br.corner);break;case"ml":a=this._getVerticalImageLines(this.oCoords.tl.corner,this.oCoords.bl.corner);break;default:a=this._getImageLines(this.oCoords[e].corner)}const n=this._findCrossPoints({x:t,y:r},a);if(0!==n&&n%2==1)return this.__corner=e,e}return!1},_getHorizontalImageLines:function(e,t){return{topline:{o:e.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_getVerticalImageLines:function(e,t){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:e.tl}}}}),a.fabric.util.object.extend(a.fabric.Canvas.prototype,{uniScaleKey:null,_getActionFromCorner:function(e,t,r){if(!t||!e)return"drag";switch(t){case"mtr":return"rotate";case"ml":case"mr":return r.shiftKey?"scale":"scaleX";case"mt":case"mb":return r.shiftKey?"scale":"scaleY";default:return"scale"}}})),a.fabric.BaseBrush&&(c(i.MarkupColor.RED_CHERRY),a.fabric.BaseBrush.prototype.width=3);const s={strokeUniform:!0,strokeWidth:3,stroke:"red"};function c(e){a.fabric.BaseBrush&&(a.fabric.BaseBrush.prototype.color=e)}function l(e){return e&&"group"===e.type}function d(e){return e&&"i-text"===e.type}t.addMarkupObject=function(e,t,r){let n;switch(t){case i.MarkupType.TEXT:n=new a.fabric.IText("Text",Object.assign(Object.assign(Object.assign(Object.assign({},s),{fontSize:22}),r),{fill:r.stroke,stroke:void 0}));break;case i.MarkupType.CIRCLE:n=new a.fabric.Circle(Object.assign(Object.assign(Object.assign({},s),{radius:50,fill:void 0}),r));break;case i.MarkupType.RECT:n=new a.fabric.Rect(Object.assign(Object.assign(Object.assign({},s),{width:100,height:100,fill:void 0}),r));break;case i.MarkupType.ARROW:const{left:e,top:t,stroke:o}=r,c=100,l=[e,t+c,e+c,t],d=180*Math.atan2(c,c)/Math.PI,u=new a.fabric.Triangle(Object.assign(Object.assign({},s),{angle:d,top:l[3],left:l[2]+.03*c,height:.15*c,width:.15*c,originX:"center",originY:"center",stroke:o,fill:o})),m=new a.fabric.Line(l,Object.assign(Object.assign({},s),r));n=new a.fabric.Group([m,u],Object.assign(Object.assign(Object.assign({},s),{lockUniScaling:!0,centeredScaling:!0}),r))}n&&(e.add(n),e.setActiveObject(n))},t.setDrawingMode=function(e,t){for(const r in e)if(e.hasOwnProperty(r)&&"object"==typeof e[r]){const a=e[r].fabric;a&&(a.isDrawingMode=t)}},t.setBaseBrushColor=c,t.disposeCanvas=function(e){for(const t in e)e[t].fabric&&e[t].fabric.dispose()},t.saveMarkup=function(e,t,a,i,s){return r.__awaiter(this,void 0,void 0,(function*(){const r=new o.UserApiV2Client,c=[],l=s===n.PreviewType.SsrDoc?300/72:1;for(const e in i)if(i.hasOwnProperty(e)&&"object"==typeof i[e]){const t=i[e].scale,r=l/t,a=i[e].fabric;if(a)for(const n of a.getObjects()){const a=n.getBoundingRect();c.push({".tag":"burn_image",image:n.toDataURL({multiplier:r}).split(",",2).pop(),x:Math.round(a.left/t),y:Math.round(a.top/t),page:Number(e)})}}const d={path:t,should_overwrite:a,burn_objects:c};return r.ns("workflows").rpc("markup_file",d,{subjectUserId:e})}))},t.setOptionsForActiveObjects=function(e,t){if(!e)return;e.getActiveObjects().forEach(e=>{d(e)?e.set(Object.assign(Object.assign({},t),{stroke:void 0,fill:t.stroke||e.fill})):l(e)?e.forEachObject(e=>e.set(Object.assign(Object.assign({},t),{fill:t.stroke||e.stroke}))):!(function(e){return e&&"path"===e.type})(e)?e.set(t):e.set(Object.assign(Object.assign({},t),{fill:void 0}))}),e.renderAll()},t.getStroke=function(e){if(d(e))return e.fill;if(l(e)){return e.getObjects().filter(e=>"line"===e.type)[0].stroke}return"stroke"in e?e.stroke:void 0},t.getFill=function(e){if((function(e){return e&&"circle"===e.type})(e)||(function(e){return e&&"rect"===e.type})(e))return e.fill}})),define("modules/clean/react/workflows/markup/selectors",["require","exports","modules/clean/react/file_viewer/data/selectors"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getMarkupState=void 0,t.getMarkupState=e=>r.getFileViewerState(e).markup})),define("modules/clean/react/workflows/markup/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MarkupColor=t.FormatSubmenuEntry=t.MarkupType=void 0,(function(e){e[e.TEXT=0]="TEXT",e[e.CIRCLE=1]="CIRCLE",e[e.RECT=2]="RECT",e[e.ARROW=3]="ARROW",e[e.FREEFORM=4]="FREEFORM"})(t.MarkupType||(t.MarkupType={})),(function(e){e.STROKE="stroke",e.FILL="fill"})(t.FormatSubmenuEntry||(t.FormatSubmenuEntry={})),(function(e){e.TRANSPARENT="transparent",e.RED_CHERRY="#D62C0B",e.ORANGE_TANGERINE="#FF8E21",e.GREEN="#00864C",e.DARK_BLUE="#005DD6",e.ULTRAVIOLET="#813BF6",e.WHITE="white",e.BLACK="black"})(t.MarkupColor||(t.MarkupColor={}))})),define("modules/clean/react/branding/api",["require","exports","tslib","modules/clean/react/premium_kit/api","modules/clean/react/premium_kit/types","modules/clean/react/user_metadata/api","modules/core/uri"],(function(e,t,r,a,n,i,o){"use strict";function s(e,t){const r=new o.URI({scheme:"https",authority:"www.dropbox.com",path:`/team/${t}/${e}`,query:{suppress_default_logo:"1"}}).toString();return new Promise((e,a)=>{const n=new XMLHttpRequest;n.open("HEAD",r),n.onload=()=>{switch(n.status){case 200:return e(r);case 404:return e(void 0);default:throw new Error(`Failed to get ${t}`)}},n.onerror=()=>a(new Error(`Failed to get ${t}`)),n.send()})}Object.defineProperty(t,"__esModule",{value:!0}),t.getTeamBackgroundUrl=t.getTeamLogoUrl=t.DISALLOWED=t.saveName=t.getName=t.saveLogoFlag=t.removeLogo=t.getLogo=t.saveSelectedBackgroundAssetId=t.getSelectedBackgroundAssetId=t.getBackgroundAssets=t.USER_METADATA_BRANDING_LOGO_SET_KEY=t.USER_METADATA_BACKGROUND_KEY=t.USER_METADATA_ORG_NAME_KEY=void 0,t.USER_METADATA_ORG_NAME_KEY="PREMIUM_KIT_ORGANIZATION_NAME",t.USER_METADATA_BACKGROUND_KEY="PREMIUM_KIT_BACKGROUND_ASSET_ID",t.USER_METADATA_BRANDING_LOGO_SET_KEY="PREMIUM_KIT_BRANDING_LOGO_SET",t.getBackgroundAssets=function(e){var t,i;return r.__awaiter(this,void 0,void 0,(function*(){const r=yield a.getAssetLibraries(e,[n.AssetLibraryId.BrandingBackground]);return(null===(i=null===(t=r.asset_libraries)||void 0===t?void 0:t[0])||void 0===i?void 0:i.assets)||[]}))},t.getSelectedBackgroundAssetId=function(e){return r.__awaiter(this,void 0,void 0,(function*(){return(yield i.getUserMetadata([t.USER_METADATA_BACKGROUND_KEY],e))[t.USER_METADATA_BACKGROUND_KEY]||""}))},t.saveSelectedBackgroundAssetId=function(e,a){return r.__awaiter(this,void 0,void 0,(function*(){yield i.setUserMetadata({[t.USER_METADATA_BACKGROUND_KEY]:a||""},e)}))},t.getLogo=function(e){var t,i,o;return r.__awaiter(this,void 0,void 0,(function*(){const r=yield a.getAssetLibraries(e,[n.AssetLibraryId.BrandingLogo]);return null===(o=null===(i=null===(t=r.asset_libraries)||void 0===t?void 0:t[0])||void 0===i?void 0:i.assets)||void 0===o?void 0:o[0]}))},t.removeLogo=function(e){return r.__awaiter(this,void 0,void 0,(function*(){yield a.removeAssetLibrary(e,n.AssetLibraryId.BrandingLogo)}))},t.saveLogoFlag=function(e,a){return r.__awaiter(this,void 0,void 0,(function*(){yield i.setUserMetadata({[t.USER_METADATA_BRANDING_LOGO_SET_KEY]:a},e)}))},t.getName=function(e){return r.__awaiter(this,void 0,void 0,(function*(){return(yield i.getUserMetadata([t.USER_METADATA_ORG_NAME_KEY],e))[t.USER_METADATA_ORG_NAME_KEY]||""}))},t.saveName=function(e,a){return r.__awaiter(this,void 0,void 0,(function*(){yield i.setUserMetadata({[t.USER_METADATA_ORG_NAME_KEY]:a},e)}))},t.DISALLOWED={disallowed:!0},t.getTeamLogoUrl=function(e){return r.__awaiter(this,void 0,void 0,(function*(){return s(e,"team_logo")}))},t.getTeamBackgroundUrl=function(e){return r.__awaiter(this,void 0,void 0,(function*(){return s(e,"team_background")}))}})),define("modules/clean/react/premium_kit/api",["require","exports","tslib","api_v2/user_client"],(function(e,t,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeAssetLibrary=t.getAssetLibraries=t.addAssetByBlock=void 0,t.addAssetByBlock=function(e,t,n,i){return r.__awaiter(this,void 0,void 0,(function*(){if(0===n.length)throw new Error("blockTokens list must not be empty");const r={library_assets_to_add:[{asset_library_id:i,assets_to_add:[{asset_id:t,file_args:{".tag":"add_by_blocks",tokens:n}}]}]};return yield(new a.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/add_assets",r,{subjectUserId:e}).then(e=>{var t;const r=e.added_library_assets[0].added_assets[0].result;switch(r[".tag"]){case"asset":return(null===(t=null==r?void 0:r.graphic)||void 0===t?void 0:t.fallback_image_url)?r:void 0;case"asset_error":throw new Error(r.message);default:throw new Error(`unexpected .tag value ${r[".tag"]}`)}})}))},t.getAssetLibraries=function(e,t){const r={asset_library_ids:t};return(new a.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/get",r,{subjectUserId:e})},t.removeAssetLibrary=function(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const r={asset_library_id:t};return yield(new a.UserApiV2Client).ns("premium_kit").rpc("asset_libraries/remove",r,{subjectUserId:e})}))}})),define("modules/clean/react/premium_kit/types",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AssetType=t.AssetId=t.AssetLibraryId=void 0,(function(e){e.BrandingBackground="branding_background",e.BrandingLogo="branding_logo",e.CustomLogo="custom_logo"})(t.AssetLibraryId||(t.AssetLibraryId={})),(function(e){e.BrandingCustomBackground="branding_custom_background",e.BrandingLogo="branding_logo",e.CustomLogo="custom_logo",e.Sapphire="sapphire",e.PinkLibrary="pink_library",e.Wheat="wheat",e.BlackCherry="black_cherry",e.Canopy="canopy",e.Turquoise="turquoise",e.Topaz="topaz",e.Pollen="pollen",e.Azalea="azalea",e.Shark="shark",e.AbstractHands="abstract_hands",e.RedMan="red_man",e.TransferAnimals="transfer_animals",e.BlueStairs="blue_stairs",e.WAVE="wave"})(t.AssetId||(t.AssetId={})),(function(e){e.Image="image",e.Video="video",e.Color="color",e.Other="other"})(t.AssetType||(t.AssetType={}))}));
//# sourceMappingURL=pkg-shared_link_core.min.js-vflMWrEzU.map