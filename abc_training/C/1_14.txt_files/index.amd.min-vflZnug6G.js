define(["require","exports","tslib","react","dig-components/typeahead","dig-components/text_fields","dig-components/chips","dig-components/avatar","react-intl","dig-components/typography","dig-components/tooltips"],(function(e,t,a,n,i,l,s,o,r,u,c){"use strict";var d;Object.defineProperty(t,"__esModule",{value:!0}),t.TypeaheadSuggestion=t.ContactTypeahead=t.getContactKey=t.ValidationResult=void 0,n=a.__importStar(n),(d=t.ValidationResult||(t.ValidationResult={})).OK="OK",d.DUPLICATE="DUPLICATE",d.INVALID="INVALID",d.OVER_RECIPIENTS_LIMIT="OVER_RECIPIENTS_LIMIT",t.getContactKey=function(e){return`CONTACT-${e.email}`};const p=/[ ,]+/,g=/^['&A-Za-z0-9\._%+-]+@[A-Za-z0-9-][A-Za-z0-9\.-]*\.[A-Za-z]{2,15}$/i;t.ContactTypeahead=e=>{const[a,d]=n.useState(""),[m,h]=n.useState(!1),[f,y]=n.useState(!1),[T,E]=n.useState(!1),I=n.useRef(null),{noMatches:C,typeToSearch:R,selectFromSuggestionErrMsg:S}=(function(){const e=r.useIntl();return{noMatches:e.formatMessage({id:"T2ynaE",defaultMessage:"No matches"}),typeToSearch:e.formatMessage({id:"sMt4nm",defaultMessage:"Begin typing to search"}),selectFromSuggestionErrMsg:e.formatMessage({id:"4gphPK",defaultMessage:"Please select an assignee"})}})();n.useEffect(()=>{e.recipients.length>e.recipientNumLimit?y(!0):y(!1),e.recipients.length>0&&e.recipients.filter(e=>e.validationResult!==t.ValidationResult.OK).length>0?h(!0):h(!1)},[e.recipients,e.recipientNumLimit]);const v=t=>{const a=e.recipients.filter(e=>e.email!==t.email);e.onRecipientsChange(a)},O=a=>{if(e.recipients.length>e.recipientNumLimit)return t.ValidationResult.OVER_RECIPIENTS_LIMIT;return e.recipients.find(e=>a.email===e.email)?t.ValidationResult.DUPLICATE:g.test(a.email)?t.ValidationResult.OK:t.ValidationResult.INVALID},N=(a,n,i)=>{if(e.onQueryChange(""),d(""),e.suggestionOnly&&!a)return!1;if(!a&&!i)return!1;const l=a?[a]:i.split(p).filter(Boolean).map(e=>({email:e})),s={},o=[...e.recipients];for(const e of l){if(e.email in s)continue;const a=O(e);if(a===t.ValidationResult.OVER_RECIPIENTS_LIMIT)break;a!==t.ValidationResult.DUPLICATE&&(s[e.email]=null,e.validationResult=a,o.push(e))}return o.length>e.recipients.length&&e.onRecipientsChange(o),0===o.filter(e=>e.validationResult!==t.ValidationResult.OK).length},V=e=>{N(e,0,a)},L=t=>{const a=t.currentTarget.value;d(a),e.onQueryChange(a)},A=t=>{8===t.keyCode&&""===a&&e.recipients.length>0&&v(e.recipients[e.recipients.length-1]),13===t.keyCode&&""!==a&&N(null,0,a)},M=()=>{e.onFocus&&e.onFocus(),E(!0)},_="flows-typeahead__input",b=e.recipients.length>=e.recipientNumLimit,P=()=>n.default.createElement(i.Typeahead.Wrapper,{onSelection:V},({getTriggerProps:r,getContentProps:u})=>n.default.createElement(n.default.Fragment,null,n.default.createElement(l.TextInput.Container,{isInvalid:m||f||e.suggestionOnly&&!T&&!!a,ref:I},n.default.createElement(l.TextInput.ChipsContainer,null,!!e.recipients.length&&e.recipients.map((e,a)=>n.default.createElement(s.InputChip,{key:a,size:"small",isAlert:e.validationResult!==t.ValidationResult.OK,onDelete:()=>v(e),withAvatarLeft:e.avatarUrl&&n.default.createElement(o.Avatar,{hasNoOutline:!0,size:"xsmall",src:e.avatarUrl})},e.name||e.email)),n.default.createElement(l.TextInput.Input,Object.assign({id:_,placeholder:b?void 0:e.placeholder,"aria-label":e.placeholder,value:a},r({onChange:L,onKeyDown:A}),{disabled:b,onBlur:()=>E(!1),onFocus:M,style:{fontSize:"12px"},autoComplete:"off"})))),e.suggestionOnly&&!T&&a&&n.default.createElement(l.FormHelperText,{isInvalid:!0},S),n.default.createElement(i.Typeahead.Container,Object.assign({},u(),{triggerRef:{current:I.current},isEmptyQuery:e.suggestionOnly&&(!Boolean(a)||0==e.suggestions.length),emptyState:n.default.createElement(i.Typeahead.EmptyState,{placeholderText:Boolean(a)?C:R}),onBlur:()=>E(!1),onFocus:()=>E(!0)}),n.default.createElement(i.Typeahead.Results,{results:e.suggestions,renderRow:e.renderTypeaheadSuggestion}))));return n.default.createElement(n.default.Fragment,null,e.label&&n.default.createElement(l.FormLabel,{htmlFor:_},n.default.createElement(u.Text,{isBold:!0,size:"small",tagName:"label"},e.label)),b?n.default.createElement(c.Tooltip,{title:e.maxNumTooltip},n.default.createElement("span",{style:{display:"inline-block",width:"100%"},tabIndex:0},P())):P())},t.ContactTypeahead.displayName="ContactTypeahead",t.TypeaheadSuggestion=({suggestion:e,getInitials:t})=>{const a=t(e.name||e.email);return n.default.createElement(i.Typeahead.Row,{key:e.email,value:e,withTitle:e.name,withSubtitle:e.email,withLeftAccessory:n.default.createElement(o.Avatar,{src:e.avatarUrl,backgroundColor:o.avatarColorForUserIdentifier(a),hasNoOutline:!0},a)})},t.TypeaheadSuggestion.displayName="TypeaheadSuggestion"}));
//# sourceMappingURL=index.amd.min.js-vflj1nhfG.map