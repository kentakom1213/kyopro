define(["require","exports","tslib","modules/clean/security/crypto","modules/clean/security/util","modules/clean/csrf","modules/core/uri"],(function(e,n,t,r,o,i,d){"use strict";function c(e){return t.__awaiter(this,void 0,void 0,(function*(){const n=encodeURIComponent(e),t=o.stringToBytes(n),d=i.readCsrfToken();if(""===d||null===d)throw new Error("Missing CSRF token");const c=o.stringToBytes(d),s=yield r.hmacMessage(c,t);return btoa(o.bytesToString(s))}))}function s(e,n,r){return t.__awaiter(this,void 0,void 0,(function*(){const t=d.URI.parse(e),o=yield c(r);return t.updateQuery({[n]:o}),t.toString()}))}Object.defineProperty(n,"__esModule",{value:!0}),n.readHmacCookieToken=n.addHeaderRedirectToken=n.addUrltoken=n.csrfHmacUrltoken=void 0,n.csrfHmacUrltoken=c,n.addUrltoken=s,n.addHeaderRedirectToken=function(e){return t.__awaiter(this,void 0,void 0,(function*(){return yield s(e,"rtoken","header_redirect")}))},n.readHmacCookieToken=function(e,n){return t.__awaiter(this,void 0,void 0,(function*(){const t=e.split(":");if(3!==t.length)return null;const[d,c,s]=t;if("1"!==d)return null;const u=(new TextEncoder).encode(c);let a=decodeURIComponent(s);try{a=atob(a)}catch(e){return null}const l=o.stringToBytes(a),f=(new TextEncoder).encode(null!=n?n:i.readCsrfToken());return(yield r.verifyMessageHmac(f,u,l))?decodeURIComponent(c):null}))}}));
//# sourceMappingURL=csrf_hmac.min.js-vfla17H0p.map