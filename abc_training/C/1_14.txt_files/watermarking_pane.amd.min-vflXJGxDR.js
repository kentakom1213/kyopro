define(["require","exports","tslib","react","classnames","react-redux","typescript/libraries/file-viewer/src/plugins/index","dig-components/progress_indicators","dig-components/snackbar","dig-components/buttons","dig-components/text_fields","dig-components/tabs","spectrum/dropdown_menu/index","typescript/libraries/file-viewer/src/watermarking/plugin/icons/index","typescript/libraries/file-viewer/src/watermarking/plugin/types","typescript/libraries/file-viewer/src/watermarking/plugin/redux/index","typescript/libraries/file-viewer/src/watermarking/plugin/components/watermarking_option","typescript/libraries/file-viewer/src/css/watermarking_plugin.css","typescript/libraries/file-viewer/src/watermarking/plugin/components/watermarking_image_chooser","typescript/libraries/file-viewer/src/watermarking/plugin/selectors","typescript/libraries/file-viewer/src/watermarking/plugin/utils/index","dig-components/menu","dig-components/icons","dig-components/icons/src"],(function(e,t,a,n,r,i,s,l,o,m,d,c,u,g,p,f,k,M,v,w,E,W,b,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WatermarkingPane=t.UnconnectedWatermarkingPane=t.getPageDimensions=void 0,n=a.__importStar(n),r=a.__importDefault(r),M=a.__importStar(M);t.getPageDimensions=e=>e.previewType===s.PreviewType.Image&&e.file.dimensions?{height:e.ui.scaleFactor*e.file.dimensions.height,width:e.ui.scaleFactor*e.file.dimensions.width}:e.previewType===s.PreviewType.SsrDoc?{height:e.ui.scaleFactor*e.file.pages[0].dimensions.height,width:e.ui.scaleFactor*e.file.pages[0].dimensions.width}:void 0,t.UnconnectedWatermarkingPane=e=>{var{intl:i,context:s,status:f,mode:w,currentWatermarkOptions:S,imageWatermarkOptions:x,textWatermarkOptions:I,setStatusReady:O,setMode:T,setImageWatermarkOptions:h,setTextWatermarkOptions:P,applyWatermark:_,logEvent:C}=e,R=a.__rest(e,["intl","context","status","mode","currentWatermarkOptions","imageWatermarkOptions","textWatermarkOptions","setStatusReady","setMode","setImageWatermarkOptions","setTextWatermarkOptions","applyWatermark","logEvent"]);const{reinitializeFileViewer:N,exitEditMode:D}=s.getPluginData().navigation,{angle:z,angleStep:L,maxSize:U,minSize:A,opacity:B,position:j,size:H}=S,F=e=>{"text"===w?P(e):"image"===w&&h(e)},V="pending"===f.state||"loaded"===f.state;let K=!1;"text"===w?K=V||0===I.text.length:"image"===w&&(K=V||null==x.image);const Y=n.useMemo(()=>[{name:i.formatMessage({id:"5aSWgz",defaultMessage:"Center"}),value:"CENTER",icon:n.default.createElement(g.PositionCenter,null)},{name:i.formatMessage({id:"zbi0wT",defaultMessage:"Upper left"}),value:"NORTHWEST",icon:n.default.createElement(g.PositionUpperLeft,null)},{name:i.formatMessage({id:"x2Kt2r",defaultMessage:"Upper right"}),value:"NORTHEAST",icon:n.default.createElement(g.PositionUpperRight,null)},{name:i.formatMessage({id:"2Y3n9L",defaultMessage:"Lower left"}),value:"SOUTHWEST",icon:n.default.createElement(g.PositionLowerLeft,null)},{name:i.formatMessage({id:"f+D0SV",defaultMessage:"Lower right"}),value:"SOUTHEAST",icon:n.default.createElement(g.PositionLowerRight,null)},{name:i.formatMessage({id:"KIU6pg",defaultMessage:"Repeat"}),value:"REPEAT",icon:n.default.createElement(g.PositionTile,null)}],[i]),G=n.useMemo(()=>[{name:i.formatMessage({id:"o541DB",defaultMessage:"Dark"}),value:"dark",icon:n.default.createElement("div",{className:r.default(M.watermarkingColorIcon,M.watermarkingColorIconDark)})},{name:i.formatMessage({id:"rHOoG3",defaultMessage:"Light"}),value:"light",icon:n.default.createElement("div",{className:r.default(M.watermarkingColorIcon,M.watermarkingColorIconLight)})}],[i]),q=(e=1)=>{let t=z+L*e;t>=360&&(t-=360),t<0&&(t+=360),F({angle:t})};n.useEffect(()=>{if("loaded"===f.state&&null!=f.data.result){const{file_id:e,name:t,size_bytes:a,ns_id:n,sjid:r}=f.data.result.file_metadata;N({fileSize:a,fileId:e,fileName:t,nsId:n,sjId:r,userAction:"visit",sourceContext:"workflow"})}},[f,s,N]);const J=Y.find(({value:e})=>e===j),Q=G.find(({value:e})=>e===I.color);return n.default.createElement("div",{className:M.watermarkingOptions},n.default.createElement(o.Snackbar,{className:M.watermarkingSnackbar,open:"pending"===f.state||"errored"===f.state},"pending"===f.state&&n.default.createElement(l.Spinner,{"aria-valuetext":"Loading",size:"small",inverse:!0}),"errored"===f.state&&n.default.createElement(b.UIIcon,{src:y.FailLine}),n.default.createElement(o.Snackbar.Message,null,"pending"===f.state&&i.formatMessage({id:"6aVZjI",defaultMessage:"Watermarking your file..."}),"errored"===f.state&&f.error.message),"errored"===f.state&&n.default.createElement(o.Snackbar.Actions,null,n.default.createElement(m.Button,{variant:"transparent",inverse:!0,onClick:O},"Dismiss"))),n.default.createElement("div",{className:M.watermarkingActions},n.default.createElement(W.Menu.Wrapper,{onSelection:e=>{(e=>{C(p.WorkflowsEvent.WatermarkApplySaveAsCopy,{watermark_type:w,num_characters:w?String(I.text.length):"0",end_position:j,end_rotation:String(z),end_size:String(H),end_transparency:String(B)}),_(e)})("replace"===e)}},({getTriggerProps:e,getContentProps:t})=>n.default.createElement(m.Button,Object.assign({},e(),{withDropdownIcon:!0,className:M.watermarkingSaveButton,variant:"primary",disabled:K,inverse:!0}),i.formatMessage({id:"xghqSe",defaultMessage:"Save"}),n.default.createElement(W.Menu.Content,Object.assign({},t()),n.default.createElement(W.Menu.Segment,null,n.default.createElement(W.Menu.ActionItem,{value:"copy"},i.formatMessage({id:"IZM92X",defaultMessage:"Make a copy"})),n.default.createElement(W.Menu.ActionItem,{value:"replace"},i.formatMessage({id:"RfzK2R",defaultMessage:"Replace original"})))))),n.default.createElement(m.Button,{variant:"outline",onClick:()=>{C(p.WorkflowsEvent.WatermarkCancel,{watermark_type:w}),D()},disabled:"ready"!==f.state,inverse:!0,className:M.watermarkingExitButton},"Cancel")),n.default.createElement(c.Tabs,{selectedTab:w,onSelection:e=>T(e),inverse:!0},n.default.createElement(c.Tabs.Group,null,n.default.createElement(c.Tabs.Tab,{id:"text"},i.formatMessage({id:"x8R7Bu",defaultMessage:"Text"})),n.default.createElement(c.Tabs.Tab,{id:"image"},i.formatMessage({id:"cw3HAU",defaultMessage:"Image"}))),n.default.createElement(c.Tabs.Panel,{tabId:"text"},n.default.createElement(k.WatermarkingOption,{name:i.formatMessage({id:"S/79Yf",defaultMessage:"Watermark"})},n.default.createElement(d.TextInput,{value:I.text,onChange:e=>{P({text:e.target.value})},placeholder:i.formatMessage({id:"RLlVEd",defaultMessage:"Add watermark text"}),"aria-label":i.formatMessage({id:"ylXIje",defaultMessage:"Text of Watermark"}),autoComplete:"off",disabled:V,inverse:!0,isTransparent:!1}))),n.default.createElement(c.Tabs.Panel,{tabId:"image"},n.default.createElement(k.WatermarkingOption,{name:i.formatMessage({id:"S/79Yf",defaultMessage:"Watermark"})},n.default.createElement(v.WatermarkingImageChooser,{intl:i,image:x.image,onImageChange:e=>{h(Object.assign({image:e},E.getImageDefaultSizes(e,t.getPageDimensions(R))))}})))),n.default.createElement(k.WatermarkingOption,{name:i.formatMessage({id:"/JYexz",defaultMessage:"Position"})},n.default.createElement(u.DropdownMenu,{key:`dropdown-position-${w}`,disabled:K,onSelection:e=>{F({position:e})}},n.default.createElement(u.DropdownMenuButton,{fullWidth:!0},n.default.createElement("span",{className:M.dropdownIcon},null==J?void 0:J.icon),null==J?void 0:J.name),n.default.createElement(u.Menu,{className:M.dropdownMenu},Y.map(({name:e,value:t,icon:a})=>n.default.createElement(u.MenuItem,{key:t,value:t},n.default.createElement("span",{className:M.dropdownIcon},a),e))))),"text"===w&&n.default.createElement(k.WatermarkingOption,{name:i.formatMessage({id:"G32RJ7",defaultMessage:"Color"})},n.default.createElement(u.DropdownMenu,{disabled:K,onSelection:e=>{P({color:e})}},n.default.createElement(u.DropdownMenuButton,{fullWidth:!0},n.default.createElement("span",{className:M.dropdownIcon},null==Q?void 0:Q.icon),null==Q?void 0:Q.name),n.default.createElement(u.Menu,{className:M.dropdownMenu},G.map(({name:e,value:t,icon:a})=>n.default.createElement(u.MenuItem,{key:t,value:t,selected:t===I.color},n.default.createElement("span",{className:M.dropdownIcon},a),e))))),n.default.createElement(k.WatermarkingOption,{name:i.formatMessage({id:"b2mHDQ",defaultMessage:"Rotation"})},n.default.createElement(m.IconButton,{className:M.watermarkingRotateButton,onClick:()=>q(1),variant:"outline",disabled:K,"aria-label":i.formatMessage({id:"QSlcsR",defaultMessage:"Rotate counterclockwise button"}),inverse:!0},n.default.createElement(g.RotateLeftIcon,null)),n.default.createElement(m.IconButton,{className:M.watermarkingRotateButton,onClick:()=>q(-1),variant:"outline",disabled:K,"aria-label":i.formatMessage({id:"HLjGpv",defaultMessage:"Rotate clockwise button"}),inverse:!0},n.default.createElement(g.RotateRightIcon,null))),n.default.createElement(k.WatermarkingOption,{name:i.formatMessage({id:"3KCxAM",defaultMessage:"Opacity"})},n.default.createElement("input",{"aria-label":i.formatMessage({id:"Rm9SCY",defaultMessage:"Opacity slider"}),className:M.watermarkingSlider,type:"range",min:"0",max:"1",step:"0.0001",value:B,onChange:e=>{F({opacity:parseFloat(e.target.value)})},disabled:K})),n.default.createElement(k.WatermarkingOption,{name:i.formatMessage({id:"e0UsOS",defaultMessage:"Size"})},n.default.createElement("input",{"aria-label":i.formatMessage({id:"nHKL5p",defaultMessage:"Size slider"}),className:M.watermarkingSlider,type:"range",min:A,max:U,step:"0.0001",value:H,onChange:e=>{F({size:parseFloat(e.target.value)})},disabled:K})))},t.UnconnectedWatermarkingPane.displayName="UnconnectedWatermarkingPane";t.WatermarkingPane=i.connect((e,{context:{fileViewerId:t}})=>{const{mode:a,status:n,textWatermarkOptions:r,imageWatermarkOptions:i}=e;return{status:n[t],currentWatermarkOptions:w.getCurrentWatermarkOptions(t,e),textWatermarkOptions:r[t],imageWatermarkOptions:i[t],mode:a[t]}},(e,t)=>{const{context:{fileViewerId:a}}=t,n=t.previewType===s.PreviewType.Image||t.previewType===s.PreviewType.SsrDoc?t.file:null;return{setStatusReady:()=>e(f.setStatusReady(a)),setMode:t=>e(f.setMode(a,t)),setImageWatermarkOptions:t=>e(f.setImageWatermarkOptions(a,t)),setTextWatermarkOptions:t=>e(f.setTextWatermarkOptions(a,t)),applyWatermark:t=>{null!==n&&e(f.applyWatermark(a,n,t))},logEvent:(t,n)=>e(f.logEvent({fileViewerId:a,eventName:t,extra:n}))}})(t.UnconnectedWatermarkingPane)}));
//# sourceMappingURL=watermarking_pane.amd.min.js-vfl4w3JoP.map