define("modules/clean/logging/hive/schemas/search-web_search_activity",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchWebSearchActivityRow=void 0;t.SearchWebSearchActivityRow=class{constructor(e){this.category="search-web_search_activity",this.active_user_id=null,this.anon_ip=null,this.authed_user_ids=null,this.country=null,this.identity_gid=null,this.locale_browser_header=null,this.locale_user_selected=null,this.referrer=null,this.session_id=null,this.team_id=null,this.team_type=null,this.ua_browser_name=null,this.ua_browser_version=null,this.ua_dist_name=null,this.ua_dist_version=null,this.ua_os_name=null,this.ua_os_version=null,this.user_agent=null,this.user_id=null,e.hasOwnProperty("action_type")&&void 0!==e.action_type&&(this.action_type=e.action_type),e.hasOwnProperty("active_user_id")&&void 0!==e.active_user_id&&(this.active_user_id=e.active_user_id),e.hasOwnProperty("anon_ip")&&void 0!==e.anon_ip&&(this.anon_ip=e.anon_ip),e.hasOwnProperty("authed_user_ids")&&void 0!==e.authed_user_ids&&(this.authed_user_ids=e.authed_user_ids),e.hasOwnProperty("country")&&void 0!==e.country&&(this.country=e.country),e.hasOwnProperty("deleted_filter")&&void 0!==e.deleted_filter&&(this.deleted_filter=e.deleted_filter),e.hasOwnProperty("deleted")&&void 0!==e.deleted&&(this.deleted=e.deleted),e.hasOwnProperty("event_name")&&void 0!==e.event_name&&(this.event_name=e.event_name),e.hasOwnProperty("extra")&&void 0!==e.extra&&(this.extra=e.extra),e.hasOwnProperty("failure_type")&&void 0!==e.failure_type&&(this.failure_type=e.failure_type),e.hasOwnProperty("file_extension")&&void 0!==e.file_extension&&(this.file_extension=e.file_extension),e.hasOwnProperty("file_is_shared")&&void 0!==e.file_is_shared&&(this.file_is_shared=e.file_is_shared),e.hasOwnProperty("file_last_edited")&&void 0!==e.file_last_edited&&(this.file_last_edited=e.file_last_edited),e.hasOwnProperty("file_name")&&void 0!==e.file_name&&(this.file_name=e.file_name),e.hasOwnProperty("file_nsid")&&void 0!==e.file_nsid&&(this.file_nsid=e.file_nsid),e.hasOwnProperty("file_path")&&void 0!==e.file_path&&(this.file_path=e.file_path),e.hasOwnProperty("file_size")&&void 0!==e.file_size&&(this.file_size=e.file_size),e.hasOwnProperty("file_sjid")&&void 0!==e.file_sjid&&(this.file_sjid=e.file_sjid),e.hasOwnProperty("file_type_filters")&&void 0!==e.file_type_filters&&(this.file_type_filters=e.file_type_filters),e.hasOwnProperty("identity_gid")&&void 0!==e.identity_gid&&(this.identity_gid=e.identity_gid),e.hasOwnProperty("latency")&&void 0!==e.latency&&(this.latency=null!==e.latency?e.latency.toString():null),e.hasOwnProperty("locale_browser_header")&&void 0!==e.locale_browser_header&&(this.locale_browser_header=e.locale_browser_header),e.hasOwnProperty("locale_user_selected")&&void 0!==e.locale_user_selected&&(this.locale_user_selected=e.locale_user_selected),e.hasOwnProperty("match_type")&&void 0!==e.match_type&&(this.match_type=e.match_type),e.hasOwnProperty("paper_folder_id")&&void 0!==e.paper_folder_id&&(this.paper_folder_id=e.paper_folder_id),e.hasOwnProperty("paper_pad_id")&&void 0!==e.paper_pad_id&&(this.paper_pad_id=e.paper_pad_id),e.hasOwnProperty("path_scoped")&&void 0!==e.path_scoped&&(this.path_scoped=null!==e.path_scoped?e.path_scoped.toString():null),e.hasOwnProperty("position")&&void 0!==e.position&&(this.position=null===e.position?null:e.position.toString()),e.hasOwnProperty("preview_request_id")&&void 0!==e.preview_request_id&&(this.preview_request_id=e.preview_request_id),e.hasOwnProperty("query_string")&&void 0!==e.query_string&&(this.query_string=e.query_string),e.hasOwnProperty("query_suggestion_count")&&void 0!==e.query_suggestion_count&&(this.query_suggestion_count=e.query_suggestion_count),e.hasOwnProperty("query_suggestion_strings")&&void 0!==e.query_suggestion_strings&&(this.query_suggestion_strings=e.query_suggestion_strings),e.hasOwnProperty("recent_history_map")&&void 0!==e.recent_history_map&&(this.recent_history_map=e.recent_history_map),e.hasOwnProperty("referrer")&&void 0!==e.referrer&&(this.referrer=e.referrer),e.hasOwnProperty("request_id")&&void 0!==e.request_id&&(this.request_id=e.request_id),e.hasOwnProperty("result_count")&&void 0!==e.result_count&&(this.result_count=null!==e.result_count?e.result_count.toString():null),e.hasOwnProperty("result_id")&&void 0!==e.result_id&&(this.result_id=e.result_id),e.hasOwnProperty("session_id")&&void 0!==e.session_id&&(this.session_id=e.session_id),e.hasOwnProperty("source")&&void 0!==e.source&&(this.source=e.source),e.hasOwnProperty("start")&&void 0!==e.start&&(this.start=null!==e.start?e.start.toString():null),e.hasOwnProperty("team_id")&&void 0!==e.team_id&&(this.team_id=e.team_id),e.hasOwnProperty("team_type")&&void 0!==e.team_type&&(this.team_type=e.team_type),e.hasOwnProperty("timestamp")&&void 0!==e.timestamp&&(this.timestamp=e.timestamp),e.hasOwnProperty("timezone_offset")&&void 0!==e.timezone_offset&&(this.timezone_offset=e.timezone_offset),e.hasOwnProperty("type")&&void 0!==e.type&&(this.type=e.type),e.hasOwnProperty("typeahead_session_id")&&void 0!==e.typeahead_session_id&&(this.typeahead_session_id=e.typeahead_session_id),e.hasOwnProperty("ua_browser_name")&&void 0!==e.ua_browser_name&&(this.ua_browser_name=e.ua_browser_name),e.hasOwnProperty("ua_browser_version")&&void 0!==e.ua_browser_version&&(this.ua_browser_version=e.ua_browser_version),e.hasOwnProperty("ua_dist_name")&&void 0!==e.ua_dist_name&&(this.ua_dist_name=e.ua_dist_name),e.hasOwnProperty("ua_dist_version")&&void 0!==e.ua_dist_version&&(this.ua_dist_version=e.ua_dist_version),e.hasOwnProperty("ua_os_name")&&void 0!==e.ua_os_name&&(this.ua_os_name=e.ua_os_name),e.hasOwnProperty("ua_os_version")&&void 0!==e.ua_os_version&&(this.ua_os_version=e.ua_os_version),e.hasOwnProperty("user_agent")&&void 0!==e.user_agent&&(this.user_agent=e.user_agent),e.hasOwnProperty("user_id")&&void 0!==e.user_id&&(this.user_id=e.user_id),e.hasOwnProperty("view_type")&&void 0!==e.view_type&&(this.view_type=e.view_type),e.hasOwnProperty("viewport")&&void 0!==e.viewport&&(this.viewport=e.viewport),e.hasOwnProperty("search_scoped_to_account_id")&&void 0!==e.search_scoped_to_account_id&&(this.search_scoped_to_account_id=e.search_scoped_to_account_id),e.hasOwnProperty("action_source")&&void 0!==e.action_source&&(this.action_source=e.action_source),e.hasOwnProperty("tag_suggestions_strings")&&void 0!==e.tag_suggestions_strings&&(this.tag_suggestions_strings=e.tag_suggestions_strings),e.hasOwnProperty("tag_suggestions_count")&&void 0!==e.tag_suggestions_count&&(this.tag_suggestions_count=e.tag_suggestions_count),e.hasOwnProperty("dimension_filter")&&void 0!==e.dimension_filter&&(this.dimension_filter=e.dimension_filter),Object.seal(this)}}})),define("modules/clean/react/starred/browse_exports",["require","exports","modules/clean/react/home/resource_id_types","modules/clean/react/starred/actions","modules/clean/react/starred/browse_update","modules/clean/react/starred/constants","modules/clean/react/starred/id_type_pair","modules/clean/react/starred/star","modules/clean/react/starred/store"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarredStore=t.Star=t.itemNameFromStarrableItem=t.idTypePairFromStarrableItem=t.StarredSource=t.checkForMissingStarredData=t.StarredActions=t.HOME_RESOURCE_ID_TYPE=void 0,Object.defineProperty(t,"HOME_RESOURCE_ID_TYPE",{enumerable:!0,get:function(){return s.HOME_RESOURCE_ID_TYPE}}),Object.defineProperty(t,"StarredActions",{enumerable:!0,get:function(){return i.StarredActions}}),Object.defineProperty(t,"checkForMissingStarredData",{enumerable:!0,get:function(){return a.checkForMissingStarredData}}),Object.defineProperty(t,"StarredSource",{enumerable:!0,get:function(){return r.StarredSource}}),Object.defineProperty(t,"idTypePairFromStarrableItem",{enumerable:!0,get:function(){return o.idTypePairFromStarrableItem}}),Object.defineProperty(t,"itemNameFromStarrableItem",{enumerable:!0,get:function(){return o.itemNameFromStarrableItem}}),Object.defineProperty(t,"Star",{enumerable:!0,get:function(){return n.Star}}),Object.defineProperty(t,"StarredStore",{enumerable:!0,get:function(){return l.StarredStore}})})),define("modules/clean/react/starred/browse_update",["require","exports","modules/clean/react/starred/actions","modules/clean/react/starred/id_type_pair","modules/clean/react/starred/store"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkForMissingStarredData=void 0,t.checkForMissingStarredData=function({items:e,isNonUserRelativeContext:t,user:r}){if(!t){const t=e.map(i.idTypePairFromStarrableItem).filter(e=>!(!e.id||a.StarredStore.hasIdTypePair(e)));t.length&&s.StarredActions.fetchStatuses(r.role,t)}}})),define("modules/clean/search/search_results/view",["require","exports","tslib","immutable","lodash","react","dig-components/typography","spectrum/media_table/index","spectrum/table/index","spectrum/tip_card/index","modules/clean/filepath/filepath","modules/clean/history","modules/clean/react/async/loadable","modules/clean/react/browse/browse_files_view","modules/clean/react/browse/models","modules/clean/react/files_view/column_helpers","modules/clean/react/files_view/constants","modules/clean/react/files_view/controller","modules/clean/react/files_view/resizing/column_size_context","modules/clean/react/files_view/types","modules/clean/react/files_view/sort_types","modules/clean/react/files_view/view_type","modules/clean/search/constants","modules/clean/search/search_helpers","modules/clean/search/types","modules/core/i18n"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g,h,p,_,m,S,y,f,E,T,w,v,F,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResultsView=void 0,i=s.__importStar(i),a=s.__importStar(a),r=s.__importDefault(r),d=s.__importStar(d),u=s.__importDefault(u),y=s.__importStar(y),w=s.__importStar(w),v=s.__importStar(v);class b extends r.default.Component{constructor(e){super(e),this.updateScrollContainerWidth=()=>{this.props.scrollContainer&&null!==this.props.scrollContainer.current&&this.setState({scrollContainerWidth:h.getWidthOfElement(this.props.scrollContainer.current)})},this._handleScroll=()=>{this.props.onScroll()},this._ensureFileViewerClosedIfNotPreviewing=()=>{const{qargs:e}=u.default.deconstruct_url();this.props.ensureFileViewerClosedIfNotPreviewing(e)},this._handleRemoveAllFilters=e=>{e.preventDefault(),this.props.onSearchFiltersChanged({path:"/",fileCategories:Object.assign({},w.FILE_CATEGORIES_UNCHECKED),dateTaken:F.DateTaken.Any,selectedDimensions:[]})},this._getRemoveAllFiltersViewUrl=()=>{const{user:e,latestQuery:t,searchSessionId:s}=this.props;return v.buildSearchURL({user:e,searchPath:"/",normalizedQuery:t,searchSessionId:s,searchToken:v.getSearchCsrfToken(),qargs:{file_categories:void 0}}).toString()},this._renderEmptyFolderSubtitle=()=>{const{path:e,fileCategories:t}=this.props;return d.paths_are_equal(e,"/")&&!v.fileCategoriesSet(t)?C.intl.formatMessage({id:"PtdLen",defaultMessage:"Try different keywords"}):C.intl.formatMessage({id:"00FN2D",defaultMessage:"Try <LinkScope>resetting all filters</LinkScope>"},{LinkScope:e=>r.default.createElement("a",{href:this._getRemoveAllFiltersViewUrl(),onClick:this._handleRemoveAllFilters},e)})},this._renderEmptyFolderView=()=>{const e=C.intl.formatMessage({id:"ZY55+d",defaultMessage:"No results found"});return r.default.createElement("div",null,r.default.createElement("div",{className:"u-font-center u-pad-top-xl"},r.default.createElement("div",{className:"search__view--illustration"},r.default.createElement(O,null)),r.default.createElement(o.Title,{className:"u-font-strong empty-folder-table-title"},e),r.default.createElement(o.Text,null,this._renderEmptyFolderSubtitle())))},this.state={viewTypeColumns:this._generateViewTypeColumns(),searchResultsWithUserDefinedItem:this._generateSearchResultsWithUserDefinedItem(e.searchResults)}}componentDidMount(){window.addEventListener("scroll",this._handleScroll),this.props.isColumnResizingEnabled&&(this.updateScrollContainerWidth(),window.addEventListener("resize",this.updateScrollContainerWidth))}componentDidUpdate(){this.props.isColumnResizingEnabled&&!this.state.scrollContainerWidth&&this.updateScrollContainerWidth()}componentWillReceiveProps(e){const{currentSort:t,searchResults:s}=this.props,{viewType:i,currentSort:a,searchResults:r}=e,{viewTypeColumns:o}=this.state;t&&a&&o&&!v.areSortOrdersEqual(t,a)&&this.setState({viewTypeColumns:this._updateViewTypeColumns(o,i,a)}),s!==r&&this.setState({searchResultsWithUserDefinedItem:this._generateSearchResultsWithUserDefinedItem(r)})}componentWillUnmount(){window.removeEventListener("scroll",this._handleScroll),u.default.remove_callback("/search",this._ensureFileViewerClosedIfNotPreviewing),this.props.isColumnResizingEnabled&&window.removeEventListener("resize",this.updateScrollContainerWidth)}_getLoadingState(){const{loadingState:e}=this.props;return e===w.SearchLoadingState.LOADING_FIRST_PAGE?f.LoadingState.LOADING_FIRST_PAGE:e===w.SearchLoadingState.LOADING_ADDITIONAL_PAGE?f.LoadingState.LOADING_REMAINING_PAGES:f.LoadingState.LOADED}_renderSearchResultItems(e){const{getOverflowMenuActions:t,onFocusSearchBar:s,onLocationLinkClick:i,onNavigateToFileOrFolder:o,onNavigateToParentFolder:n,onOpenFileSharedWithMe:l,onOpenPaper:c,context:d,fileRename:u,searchResults:g,getIsFileJumping:h,isFileViewerShown:p,arePostTTIModulesLoaded:_,handleComponentTTI:m,onSelectionChange:E,selectedFiles:T,selection:v,setFileUploaderPath:F,user:C,path:b,filesViewActionHandlers:O,renderSharedWithController:I,hrefForFile:R,starredState:L,onStarClick:P,sharingServiceInfo:D,currentSort:x,onSortChange:M,onRangeInView:N,scrollContainer:Q,filteredContactName:k,viewTypeScope:q,isColumnResizingEnabled:j,useSkinnyCheckboxes:U}=this.props,{viewTypeColumns:V}=this.state;return r.default.createElement(S.FilesViewController,Object.assign({id:w.SEARCH_FILES_VIEW_ID},O,{getOverflowMenuActions:t,onLocationLinkClick:i,onNavigateToFileOrFolder:o,onNavigateToParentFolder:n,onOpenFileSharedWithMe:l,onOpenPaper:c,context:d,customEmptyFolderView:this._renderEmptyFolderView,createNewFolderState:f.NewFolderCreationState.CREATE_FOLDER_INACTIVE,fileRename:u,getIsFileJumping:h,isFileViewerShown:p,isSearchMode:!0,arePostTTIModulesLoaded:_,loadingState:this._getLoadingState(),onComponentTTI:m,onSelectionChange:E,onFocusSearchBar:s,path:b,selectedFiles:T,selection:v,setFileUploaderPath:F,showFileUploaderModal:a.noop,user:C,totalNumFiles:g.size,responsive:e,columns:this._generateColumns(e),renderSharedWithController:I,hrefForFile:R,viewTypes:w.SearchViewTypes,viewTypeScope:q,starredState:L,stickyOffsetTop:-1,sharingServiceInfo:D,onStarClick:P,items:this._generateFilesViewItems(),isStickyColumnHeader:!0,viewTypeColumns:V,onColumnsChanged:a.noop,currentSort:x,onSortChange:M,highDensity:!0,onRangeInView:N,scrollContainer:Q,filteredContactName:k,isActionBarEnabled:!0,inlineActionBar:A,enableUnity:!0,isColumnResizingEnabled:j,columnResizeStorageSetting:y.noStorage,scrollContainerWidth:this.state.scrollContainerWidth,expManualTagging:this.props.searchResultsExperiments.expManualTagging,useSkinnyCheckboxes:U,mediaFiltersVariant:this.props.mediaFiltersVariant}))}_generateColumns(e){const{viewType:t}=this.props,{viewTypeColumns:s}=this.state;return s?s[t]:m.SEARCH_LIST_VIEW_COLUMNS}_generateViewTypeColumns(){const{viewType:e,currentSort:t}=this.props,s={[T.ViewType.List]:m.SEARCH_LIST_VIEW_SORT_ENABLED_COLUMNS,[T.ViewType.Grid]:m.SEARCH_GRID_VIEW_SORT_ENABLED_COLUMNS,[T.ViewType.LargeGrid]:m.SEARCH_GRID_VIEW_SORT_ENABLED_COLUMNS};return t?this._updateViewTypeColumns(s,e,t):s}_isDeletedFile(e){return e instanceof p.File&&e.isDeleted}_generateSearchResultsWithUserDefinedItem(e){const t=e.filter(e=>this._isDeletedFile(e));if(t.size>0){const s=e.filter(e=>!this._isDeletedFile(e)),i=e=>{const{rowIndex:t,topOffset:s}=e;return r.default.createElement(n.CulledMediaRow,{"aria-rowindex":void 0!==t?t+1:void 0,className:"brws-user-defined-item-row",topOffset:s},r.default.createElement(l.TableCell,{key:"checkboxCell",className:"brws-checkbox-cell"}),r.default.createElement(l.TableCell,{className:"mc-media-cell"},r.default.createElement(c.TipCard,{className:"search-results__deleted-files-notice","non-dismissible":!0},C.intl.formatMessage({id:"GYhJ5f",defaultMessage:"Deleted content isn’t sorted by last modified"}))))},a=new p.UserDefinedItem({renderUserDefinedItemRow:i});return s.concat([a]).concat(t)}return i.List()}_generateFilesViewItems(){const{searchResults:e,viewType:t,currentSort:s}=this.props,i=e.filter(e=>this._isDeletedFile(e));return t===T.ViewType.List&&s&&s.sortField!==E.SortField.RELEVANCE&&i.size>0?this.state.searchResultsWithUserDefinedItem:e}_updateViewTypeColumns(e,t,s){const i=e[t];if(t===T.ViewType.List)return Object.assign(Object.assign({},e),{[t]:_.swapColumns(i,i[1].sortField,s.sortField)});{const a=e[T.ViewType.List];return Object.assign(Object.assign({},e),{[t]:_.swapColumns(i,i[0].sortField,s.sortField),[T.ViewType.List]:_.swapColumns(a,a[1].sortField,s.sortField)})}}render(){const{responsive:e}=this.props;return r.default.createElement("div",{className:"search-results"},this._renderSearchResultItems(e))}}t.SearchResultsView=b,b.displayName="SearchResultsView";const A=g.Loadable({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{SearchInlineActionBar:t}=yield new Promise((t,s)=>{e(["modules/clean/search/single_page/search_inline_action_bar"],t,s)}).then(s.__importStar);return t}))}),O=g.Loadable({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{DogDigsSpot:t}=yield new Promise((t,s)=>{e(["dig-illustrations/spot/dog-digs"],t,s)}).then(s.__importStar);return t}))})})),define("modules/clean/search/single_page/api",["require","exports","api_v2/user_client","modules/clean/contacts/data_v2"],(function(e,t,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPeopleSuggestionFromApi=t.getQuerySuggestions=t.getContactApiClient=void 0;class a{constructor(e){this.filterContact=e=>!e.group_id&&!!e.dbx_account_id,this.fetchContacts=e=>new Promise((t,s)=>{""===e?this.dataSource.getAll(t):this.dataSource.search(e,t)}),this.dataSource=new i.ContactsDataSourceV2(e,this.filterContact)}}let r=null;t.getContactApiClient=function(e){return r||(r=new a(e)),r},t.getQuerySuggestions=function(e,t,i,a){return(new s.UserApiV2Client).ns("files").rpc("get_query_suggestions",{query:t,max_results:i,search_session_id:a},{subjectUserId:e})},t.getPeopleSuggestionFromApi=function(e,t){const i={num_items:t||0,return_team_members_if_empty:!0};return(new s.UserApiV2Client).ns("search_suggestion").rpc("get_people_suggestion",i,{subjectUserId:e})}})),define("modules/clean/search/single_page/data/action_creators/index",["require","exports","tslib","modules/clean/browse_uri_interface","modules/clean/cloud_docs/open_with_utils","modules/clean/cloud_docs/preferred_editor_utils","modules/clean/cloud_docs/types","modules/clean/file_operations/notifications","modules/clean/filepath/filepath","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/api","modules/core/browser","modules/core/browser","modules/clean/react/browse/constants","modules/clean/react/browse/data/selectors","modules/clean/react/browse/logger_util","modules/clean/react/browse/models","modules/clean/react/extensions/data/store","modules/clean/react/files_view/data/action_creators","modules/clean/react/files_view/data/selectors/instance_selectors","modules/clean/react/files_view/sort_types","modules/clean/react/files_view/util","modules/clean/react/selection","modules/clean/react/starred/browse_update","modules/clean/search/api","modules/clean/search/api_helpers","modules/clean/search/constants","modules/clean/search/search_helpers","modules/clean/search/single_page/api","modules/clean/search/single_page/constants","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/action_creators/common","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/data/types","modules/clean/search/single_page/logger","modules/clean/search/single_page/navigation","modules/clean/search/single_page/utils","modules/clean/search/store_helpers","modules/clean/search/types","modules/core/persistence/storage","modules/clean/web_timing_logger","modules/clean/web_user_action_events","modules/constants/python","modules/core/exception","modules/clean/tagging/data/action_creators","modules/clean/tagging/data/selectors/index","modules/clean/tagging/experiments","modules/clean/tagging/utils","modules/clean/media_filters/gating","modules/clean/search/single_page/media_filters/media_api","modules/clean/search/single_page/data/action_creators/popular_filters","modules/clean/user_survey/user_survey"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g,h,p,_,m,S,y,f,E,T,w,v,F,C,b,A,O,I,R,L,P,D,x,M,N,Q,k,q,j,U,V,W,H,z,G,B,Y,Z,K,J,$){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleNavigateToFileOrFolder=t.shouldStartNewSearchSession=t.resetFilters=t.setFilters=t.logQueryCompleted=t.setQueryStartTime=t.setHighlightedRow=t.restoreFiles=t.purgeFiles=t.removeResults=t.updateResults=t.setResults=t.setLastQueryWithTagsSuggestionsLoaded=t.dismissTagsSuggestions=t.fetchTagsSuggestions=t.setLastQueryWithQuerySuggestionsLoaded=t.dismissQuerySuggestions=t.fetchQuerySuggestions=t.clearAllHistory=t.addQueryToHistory=t.loadHistory=t.stopAndLogDwellTime=t.startDwellTime=t.handleComponentTTI=t.resetTTI=t.fetchFirstPage=t._performSearch=t.performSearch=t.setSessionId=t.setPreviewCommentsThreadId=t.setPreviewFile=t.clearSelection=t.setSelection=t.fetchNextPage=t.updateFromUrl=t.setMediaData=t.setSelectedDimensions=t.setDateTaken=t.dismissPeopleSuggestions=t.fetchPeopleSuggestions=t.setFilteredSearchSuggestion=t.setFilteredAccountId=t.setSortOrder=t.setSearchType=t.setFileCategories=t.setPath=t.setQuery=t.setExperiments=t.setUser=t.setVariant=t.clear=void 0,n=s.__importStar(n),l=s.__importStar(l),c=s.__importStar(c),d=s.__importStar(d),u=s.__importStar(u),p=s.__importStar(p),_=s.__importStar(_),y=s.__importStar(y),f=s.__importStar(f),R=s.__importStar(R),D=s.__importStar(D),M=s.__importStar(M),k=s.__importStar(k),z=s.__importStar(z),G=s.__importStar(G);let X=null,ee=null,te=null,se=null;function ie(e){const t=D.normalizedQuery(e()),s=D.filteredAccountId(e()),i=Z.isMediaFiltersEnabled(L.mediaFiltersVariant(e())),a=D.dateTaken(e()),r=D.selectedDimensions(e()),o=D.filteredSuggestion(e());return C.skipNonValidSearchArgs(t,s,i,a,r,o)}t.clear=()=>(e,t)=>{let s="/";try{s=p.path(t())}catch(e){}null!==X&&clearTimeout(X),e({type:x.ActionTypes.SET_QUERY,payload:{query:""}}),e({type:x.ActionTypes.CLEAR_RESULTS}),e({type:x.ActionTypes.SET_PATH,payload:{path:s}}),e({type:x.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:b.FILE_CATEGORIES_UNCHECKED}}),e(le({loadingState:b.SearchLoadingState.ZERO_QUERY})),e({type:x.ActionTypes.SET_FILTERED_ACCOUNT_ID,payload:{filteredAccountId:void 0}}),e({type:x.ActionTypes.SET_DATE_TAKEN,payload:{dateTaken:0}}),e({type:x.ActionTypes.SET_SELECTED_DIMENSIONS,payload:{selectedDimensions:[]}})},t.setVariant=({variant:e})=>({type:x.ActionTypes.SET_VARIANT,payload:{variant:e}}),t.setUser=({user:e,options:t})=>({type:x.ActionTypes.SET_USER,payload:{user:e,options:t}}),t.setExperiments=({experiments:e})=>({type:x.ActionTypes.SET_EXPERIMENTS,payload:{experiments:e}}),t.setQuery=({query:e,alwaysTriggerSearch:s})=>(i,a)=>{const r=k.normalize(e),o=r!==D.normalizedQuery(a()),n=""===D.normalizedQuery(a())&&o,l=t.shouldStartNewSearchSession(a(),{query:e}),c=R.isSearchAsYouTypeEnabled(a())||s,d=D.user(a()),u=D.variant(a());if(!d)return;if(i({type:x.ActionTypes.SET_QUERY,payload:{query:e}}),M.logQueryTyped(e),!o)return;i(t.resetTTI()),""===r&&(i(t.setLastQueryWithQuerySuggestionsLoaded({lastQueryWithQuerySuggestionsLoaded:r})),i(ge({lastQueryWithPeopleSuggestionsLoaded:r})),B.isTaggingEnabled(R.manualTaggingVariant(a()))&&i(t.setLastQueryWithTagsSuggestionsLoaded({lastQueryWithTagsSuggestionsLoaded:r}))),l&&i(t.setSessionId({sessionId:Q.generateRandomId()})),c&&(n||l)&&i(le({loadingState:b.SearchLoadingState.LOADING_FIRST_PAGE})),he(),c&&D.isFullPage(a())&&N.searchNavigationManager.set(D.searchUrl(a()));const g=D.filteredAccountId(a()),h=Z.isMediaFiltersEnabled(L.mediaFiltersVariant(a())),p=D.dateTaken(a()),_=D.selectedDimensions(a()),m=D.filteredSuggestion(a());if(C.skipNonValidSearchArgs(r,g,h,p,_,m)&&c)return i(oe()),void i(le({loadingState:b.SearchLoadingState.ZERO_QUERY}));if(r&&"full-page"===u){if(Z.isPopularFiltersSearchEnabled(L.mediaFiltersVariant(a()))&&(se=pe(se),se=setTimeout(()=>{var e;(null===(e=D.filteredSuggestion(a()))||void 0===e?void 0:e.type)||J.fetchPopularFilters(i,a,ie(a)),se=null},I.POPULAR_FILTERS_DEBOUNCE)),te=pe(te),te=setTimeout(()=>{i(t.fetchQuerySuggestions({query:r,maxResults:I.SEARCH_POSTERIOR_QUERY_SUGGESTIONS_CAPACITY})),te=null},I.SEARCH_SUGGESTIONS_DEBOUNCE),B.isTaggingEnabled(R.manualTaggingVariant(a()))){const s=A.normalizeForTagsSuggestions(e);i(t.fetchTagsSuggestions({query:s}))}D.filteredAccountId(a())||i(t.fetchPeopleSuggestions({query:r,user:d}))}c&&(X=setTimeout(()=>{t.fetchFirstPage(i,a),X=null},I.SEARCH_QUERY_DEBOUNCE))},t.setPath=({path:e,viewport:s})=>(i,a)=>{l.paths_are_equal(e,D.path(a()))||(i({type:x.ActionTypes.SET_PATH,payload:{path:e}}),s&&M.logScopeChipChanged(e,s),t._performSearch(i,a))},t.setFileCategories=({fileCategories:e})=>(s,i)=>{if(A.fileCategoriesToString(e)!==D.fileCategoriesString(i())){if(s({type:x.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:e}}),D.isFullPage(i())&&N.searchNavigationManager.set(D.searchUrl(i()),!0),ie(i))return s(oe()),void s(le({loadingState:b.SearchLoadingState.ZERO_QUERY}));t._performSearch(s,i)}},t.setSearchType=({searchType:e})=>(s,i)=>{e!==D.searchType(i())&&(s(t.stopAndLogDwellTime()),s({type:x.ActionTypes.SET_SEARCH_TYPE,payload:{searchType:e}}),t._performSearch(s,i))},t.setSortOrder=({sortOrder:e})=>(s,i)=>{ye(e,D.sortOrder(i()))||(s({type:x.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:e}}),M.logSortOrderChanged(e),D.isFullPage(i())&&N.searchNavigationManager.set(D.searchUrl(i()),!0),s(le({loadingState:b.SearchLoadingState.LOADING_FIRST_PAGE})),t._performSearch(s,i))},t.setFilteredAccountId=({filteredAccountId:e})=>(s,i)=>{if(e===D.filteredAccountId(i()))return;e||M.logPeopleFilterRemoved(),s({type:x.ActionTypes.SET_FILTERED_ACCOUNT_ID,payload:{filteredAccountId:e}}),D.isFullPage(i())&&N.searchNavigationManager.set(D.searchUrl(i()));const a=D.normalizedQuery(i()),r=Z.isMediaFiltersEnabled(L.mediaFiltersVariant(i())),o=D.dateTaken(i()),n=D.selectedDimensions(i()),l=D.filteredSuggestion(i());if(C.skipNonValidSearchArgs(a,e,r,o,n,l))return s(oe()),void s(le({loadingState:b.SearchLoadingState.ZERO_QUERY}));t._performSearch(s,i)},t.setFilteredSearchSuggestion=({type:e,query:s})=>(s||M.logTypeaheadSuggestionRemoved(),(i,a)=>{i({type:x.ActionTypes.SET_FILTERED_SEARCH_SUGGESTION,payload:{type:e,query:s}}),D.isFullPage(a())&&N.searchNavigationManager.set(D.searchUrl(a()));const r=D.normalizedQuery(a()),o=Z.isMediaFiltersEnabled(L.mediaFiltersVariant(a())),n=D.filteredAccountId(a()),l=D.dateTaken(a()),c=D.selectedDimensions(a()),d=D.filteredSuggestion(a());if(C.skipNonValidSearchArgs(r,n,o,l,c,d))return i(oe()),void i(le({loadingState:b.SearchLoadingState.ZERO_QUERY}));t._performSearch(i,a)}),t.fetchPeopleSuggestions=({user:e,query:t})=>function(i,a){return s.__awaiter(this,void 0,void 0,(function*(){const s=k.normalize(t),r=D.peopleSuggestionsCache(a())[s];if(r){const e=r.loadingState;if(e===q.PeopleSuggestionsLoadingState.LOADING)return;if(e===q.PeopleSuggestionsLoadingState.LOADED)return void i(ge({lastQueryWithPeopleSuggestionsLoaded:s}));if(e===q.PeopleSuggestionsLoadingState.DISMISSED)return i(ue({normalizedQuery:s,peopleSuggestionsData:{loadingState:q.PeopleSuggestionsLoadingState.LOADED}})),void i(ge({lastQueryWithPeopleSuggestionsLoaded:s}))}i(ue({normalizedQuery:s,peopleSuggestionsData:{contacts:[],loadingState:q.PeopleSuggestionsLoadingState.LOADING}}));const o=yield O.getContactApiClient(e).fetchContacts(s);M.logPeopleFilterResponse(o.length),i(ue({normalizedQuery:s,peopleSuggestionsData:{contacts:o,loadingState:q.PeopleSuggestionsLoadingState.LOADED}})),i(ge({lastQueryWithPeopleSuggestionsLoaded:s}))}))},t.dismissPeopleSuggestions=({query:e})=>(t,s)=>{const i=k.normalize(e),a=D.peopleSuggestionsCache(s())[i];a&&a.loadingState===q.PeopleSuggestionsLoadingState.LOADED&&t(ue({normalizedQuery:i,peopleSuggestionsData:{loadingState:q.PeopleSuggestionsLoadingState.DISMISSED}}))},t.setDateTaken=({dateTaken:e})=>(s,i)=>{if(e===D.dateTaken(i()))return;s({type:x.ActionTypes.SET_DATE_TAKEN,payload:{dateTaken:e}});const a=D.getPage(i());M.logDateTakenChange(a,e),D.isFullPage(i())&&N.searchNavigationManager.set(D.searchUrl(i()));const r=D.normalizedQuery(i()),o=D.filteredAccountId(i()),n=Z.isMediaFiltersEnabled(L.mediaFiltersVariant(i())),l=D.selectedDimensions(i()),c=D.filteredSuggestion(i());if(C.skipNonValidSearchArgs(r,o,n,e,l,c))return s(oe()),void s(le({loadingState:b.SearchLoadingState.ZERO_QUERY}));t._performSearch(s,i)},t.setSelectedDimensions=({selectedDimensions:e})=>(s,i)=>{if(A.dimensionsToURLParam(e)===A.dimensionsToURLParam(D.selectedDimensions(i())))return;s({type:x.ActionTypes.SET_SELECTED_DIMENSIONS,payload:{selectedDimensions:e}});const a=D.getPage(i());M.logDimensionFilterChange(a,e),D.isFullPage(i())&&N.searchNavigationManager.set(D.searchUrl(i()));const r=D.normalizedQuery(i()),o=D.filteredAccountId(i()),n=Z.isMediaFiltersEnabled(L.mediaFiltersVariant(i())),l=D.dateTaken(i()),c=D.filteredSuggestion(i());if(C.skipNonValidSearchArgs(r,o,n,l,e,c))return s(oe()),void s(le({loadingState:b.SearchLoadingState.ZERO_QUERY}));t._performSearch(s,i)},t.setMediaData=(e,t,i)=>(a,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=yield K.enrichedMediaDataFromApi(e,t);if(M.logEnrichedMediaDataReceived((null==s?void 0:s.enriched_media_data)||[],i),void 0===(null==s?void 0:s.enriched_media_data))return;const r=s.enriched_media_data;a({type:x.ActionTypes.SET_MEDIA_DATA,payload:{filesMediaData:r}})})),t.updateFromUrl=({path:e,query:s,search_session_id:i,preview:a,file_categories:r,search_type:o,search_order_by:n,search_reverse_order:l,search_account_id:c,search_from:d,search_date_taken:u,search_dimensions:g})=>(h,p)=>{let _=!1;const m=s||"",S=r||"";m!==D.query(p())&&(_=!0,h({type:x.ActionTypes.SET_QUERY,payload:{query:m}})),void 0!==e&&e!==D.path(p())&&(_=!0,h({type:x.ActionTypes.SET_PATH,payload:{path:e}})),S!==D.fileCategoriesString(p())&&(_=!0,h({type:x.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:A.fileCategoriesFromString(S)}})),void 0!==o&&o!==D.searchType(p())&&(_=!0,h({type:x.ActionTypes.SET_SEARCH_TYPE,payload:{searchType:o}}));const y=me(d),f={sortField:_e(n),sortDirection:Se(l)};if(ye(f,D.sortOrder(p()))||(h({type:x.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:f}}),M.logSortOrderChanged(f),_=!0),c!==D.filteredAccountId(p())){_=!0,h({type:x.ActionTypes.SET_FILTERED_ACCOUNT_ID,payload:{filteredAccountId:c}});const e=D.user(p());e&&h(t.fetchPeopleSuggestions({query:"",user:e}))}void 0!==i&&i!==D.sessionId(p())&&(_=!0,h(t.setSessionId({sessionId:i}))),a!==D.previewFileId(p())&&h({type:x.ActionTypes.SET_PREVIEW_FILE_ID,payload:{previewFileId:""===a?void 0:a}}),void 0!==u&&""!==u&&Number(u)!==D.dateTaken(p())&&h({type:x.ActionTypes.SET_DATE_TAKEN,payload:{dateTaken:Number(u)}}),void 0!==g&&""!==g&&A.dimensionsToURLParam(D.selectedDimensions(p()))!==g&&h({type:x.ActionTypes.SET_SELECTED_DIMENSIONS,payload:{selectedDimensions:A.parseDimensionsUrlParam(g)}}),_&&(ie(p)?(h(oe()),h(le({loadingState:b.SearchLoadingState.ZERO_QUERY}))):h((e,s)=>t._performSearch(e,s,y)))},t.fetchNextPage=()=>(e,s)=>{const i=D.user(s()),a=D.path(s()),r=D.normalizedQuery(s()),o=D.hasMoreResults(s()),n=D.cursor(s()),l=D.searchType(s()),c=D.fileCategoriesString(s()),d=D.filteredAccountId(s()),u=P.apiCommonFields(s()),g=D.dateTaken(s()),h=D.selectedDimensions(s()),p=D.filteredSuggestion(s()),_=Z.isMediaFiltersEnabled(L.mediaFiltersVariant(s()));i&&o&&!C.skipNonValidSearchArgs(r,d,_,g,h,p)&&(D.numResults(s())>0&&e(le({loadingState:b.SearchLoadingState.LOADING_ADDITIONAL_PAGE})),F.searchApiClient.loadPartialResults(Object.assign(Object.assign({},u),{start:D.nextPageOffset(s()),cursor:n,onSuccess:({searchResults:o})=>{if(P.hasSearchChanged(s(),{query:r,path:a,filteredAccountId:d,searchType:l,fileCategoriesString:c,dateTaken:g,dimensions:h}))return;e(ne({searchResults:o,loadingState:b.SearchLoadingState.LOADED})),B.isTaggingEnabled(R.manualTaggingVariant(s()))&&e(z.fetchTagsForFiles({user:i,files:o.results.filter(T.isFile)})),_&&e(t.setMediaData(i,o.results.filter(fe),r)),e(t.logQueryCompleted(!1)),o.results.length&&S.initializeStore(i,o.results.filter(fe)),v.checkForMissingStarredData({items:o.results,user:i});const n=I.SEARCH_MIN_PAGE_SIZE;o.hasMore&&o.results.length<n&&e(t.fetchNextPage())},onError:e=>{const t=(new Date).getTime()-D.queryStartTime(s());M.logQueryFailed(t,e,b.SearchOriginPathway.WEB),H.reportException({err:new Error(e),severity:"non-critical",tags:["js:search"]})}})))},t.setSelection=({selection:e,actionSource:t,skipLogging:s})=>(i,a)=>{if(!s){const s=a(),{event:i,itemId:r}=_.makeSelectionEvent(D.selection(s),e),o=D.selectResultById(s,{id:r});if(o){const{num_files_selected:a,num_folders_selected:r}=_.countFilesAndFolders(D.selectFilesForSelection(s,{selection:e}));M.logResultAction(i,D.resultsList(s),o,void 0,t,{num_files_selected:String(a),num_folders_selected:String(r)})}}i({type:x.ActionTypes.SET_SELECTION,payload:{selection:e,actionSource:t,skipLogging:s}}),Ee(i,a,e)},t.clearSelection=({actionSource:e,skipLogging:s}={})=>t.setSelection({actionSource:e,skipLogging:s,selection:w.createSelection()}),t.setPreviewFile=({previewFileId:e})=>(s,i)=>{s(void 0===e?t.startDwellTime():t.stopAndLogDwellTime()),s({type:x.ActionTypes.SET_PREVIEW_FILE_ID,payload:{previewFileId:e}}),D.isFullPage(i())&&N.searchNavigationManager.set(D.searchUrl(i()),!0)},t.setPreviewCommentsThreadId=({previewCommentsThreadId:e})=>({type:x.ActionTypes.SET_PREVIEW_COMMENTS_THREAD_ID,payload:{previewCommentsThreadId:e}}),t.setSessionId=({sessionId:e})=>({type:x.ActionTypes.SET_SESSION_ID,payload:{sessionId:e}}),t.performSearch=()=>(e,s)=>{ie(s)?(e(oe()),e(le({loadingState:b.SearchLoadingState.ZERO_QUERY})),D.isFullPage(s())&&N.searchNavigationManager.set(D.searchUrl(s()))):D.isFullPage(s())?(N.searchNavigationManager.set(D.searchUrl(s())),t._performSearch(e,s)):g.redirect(D.searchUrl(s()))},t._performSearch=(e,s,i=b.SearchOriginPathway.WEB)=>{ie(s)||(e(t.resetTTI()),D.isFullPage(s())&&N.searchNavigationManager.set(D.searchUrl(s())),e(le({loadingState:b.SearchLoadingState.LOADING_FIRST_PAGE})),null!==X&&clearTimeout(X),t.fetchFirstPage(e,s,i))},t.fetchFirstPage=(e,s,i=b.SearchOriginPathway.WEB)=>{const a=D.user(s()),r=D.path(s()),o=D.normalizedQuery(s()),n=D.searchType(s()),l=D.variant(s()),c=D.fileCategoriesString(s()),d=D.dateTaken(s()),u=D.selectedDimensions(s()),g=D.filteredAccountId(s()),h=Z.isMediaFiltersEnabled(L.mediaFiltersVariant(s())),p=D.filteredSuggestion(s());a&&!C.skipNonValidSearchArgs(o,g,h,d,u,p)&&(e(t.stopAndLogDwellTime()),e(t.setQueryStartTime({queryStartTime:(new Date).getTime()})),M.logQueryStarted(i),he(),F.searchApiClient.loadPartialResults(Object.assign(Object.assign({},P.apiCommonFields(s())),{start:0,includeBrowseContext:"full-page"===l,onSuccess:({searchResults:i,requestId:p,context:_})=>{if(P.hasSearchChanged(s(),{query:o,path:r,filteredAccountId:g,searchType:n,fileCategoriesString:c,dateTaken:d,dimensions:u}))return;e(t.setResults({searchResults:i,context:_,requestId:p})),B.isTaggingEnabled(R.manualTaggingVariant(s()))&&e(z.fetchTagsForFiles({user:a,files:i.results.filter(T.isFile)})),h&&e(t.setMediaData(a,i.results.filter(fe),o)),i.hasMore||e(t.logQueryCompleted(!0)),"full-page"===l&&(e(t.handleComponentTTI({component:"results",query:o})),e(t.startDwellTime()),e(y.resetScroll())),"full-page"===l&&i.hasMore?e(le({loadingState:b.SearchLoadingState.LOADING_ADDITIONAL_PAGE})):e(le({loadingState:b.SearchLoadingState.LOADED})),"full-page"===l&&(he(),ee=setTimeout(()=>{P.hasSearchChanged(s(),{query:o,path:r,filteredAccountId:g,searchType:n,fileCategoriesString:c,dateTaken:d,dimensions:u})||e(t.fetchNextPage())},I.SEARCH_SECOND_PAGE_DEBOUNCE),i.results.length&&S.initializeStore(a,i.results.filter(fe)),v.checkForMissingStarredData({items:i.results,user:a})),U.get_timer(I.SEARCH_WEB_TIMER).end()},onError:a=>{const r=(new Date).getTime()-D.queryStartTime(s());M.logQueryFailed(r,a,i),H.reportException({err:new Error(a),severity:"non-critical",tags:["js:search"]}),e(le({loadingState:b.SearchLoadingState.LOAD_ERROR})),e(t.handleComponentTTI({component:"results",query:o}))}})))},t.resetTTI=()=>(e,t)=>{e(ce()),U.get_timer(I.SEARCH_WEB_TIMER).restart(),U.get_timer(I.SEARCH_WEB_TIMER).initialize({requireTTI:!0,requireTTV:!1,url:I.SEARCH_WEB_TIMER})},t.handleComponentTTI=({component:e,query:t})=>(s,i)=>{D.ttiComponents(i()).has(e)||k.normalize(t)===D.normalizedQuery(i())&&("results"===e&&U.get_timer(I.SEARCH_WEB_TIMER).fetchedDataRequiredForTTI(),s(de({component:e})),D.ttiComponentsAllLoaded(i())&&U.get_timer(I.SEARCH_WEB_TIMER).markTimeToInteractive())},t.startDwellTime=({startTime:e}={startTime:Date.now()})=>({type:x.ActionTypes.SET_DWELL_TIME,payload:{dwellStartTime:e}}),t.stopAndLogDwellTime=()=>(e,s)=>{const i=s(),a=D.dwellStartTime(i);if(void 0===a)return;const r=Date.now()-a;M.logDwellTime(r,f.selectViewType(i,{instanceId:b.SEARCH_FILES_VIEW_ID})),e(t.startDwellTime({startTime:void 0}))},t.loadHistory=()=>(e,t)=>{const s=D.user(t());if(!s)return;const i=j.UserLocalStorage.get(s.id,b.SEARCH_RECENT_HISTORY_STORAGE_KEY)||[];e({type:x.ActionTypes.SET_QUERY_HISTORY,payload:{queryHistory:i}})},t.addQueryToHistory=()=>(e,t)=>{const s=D.user(t());if(!s)return;const i=D.resultQuery(t());if(!i)return;const a=D.queryHistory(t()),r=a.indexOf(a.find(e=>e.rawQuery===i)),o=[{rawQuery:i,normalizedQuery:i},...a.filter(e=>e.rawQuery!==i)].slice(0,b.SEARCH_RECENT_HISTORY_CAPACITY);e({type:x.ActionTypes.SET_QUERY_HISTORY,payload:{queryHistory:o}}),j.UserLocalStorage.set(s.id,b.SEARCH_RECENT_HISTORY_STORAGE_KEY,o),M.logHistoryAdded(r)},t.clearAllHistory=()=>(e,t)=>{const s=D.user(t());s&&(e({type:x.ActionTypes.SET_QUERY_HISTORY,payload:{queryHistory:[]}}),j.UserLocalStorage.delete(s.id,b.SEARCH_RECENT_HISTORY_STORAGE_KEY),M.logHistoryCleared())},t.fetchQuerySuggestions=function({query:e,maxResults:i}){return(a,r)=>s.__awaiter(this,void 0,void 0,(function*(){const s=D.user(r());if(!s)return;te=null;const o=k.normalize(e),n=D.querySuggestionsCache(r())[o];if(n){const e=n.loadingState;if(e===q.QuerySuggestionsLoadingState.LOADING)return;if(n.lastFetched){if(Date.now()-n.lastFetched<b.TIME_TO_INVALIDATE_QUERY_SUGGESTIONS_CACHE){if(e===q.QuerySuggestionsLoadingState.LOADED)return void a(t.setLastQueryWithQuerySuggestionsLoaded({lastQueryWithQuerySuggestionsLoaded:o}));if(e===q.QuerySuggestionsLoadingState.DISMISSED)return a(ae({normalizedQuery:o,querySuggestionsData:{loadingState:q.QuerySuggestionsLoadingState.LOADED}})),void a(t.setLastQueryWithQuerySuggestionsLoaded({lastQueryWithQuerySuggestionsLoaded:o}))}}}const l=D.sessionId(r());a(ae({normalizedQuery:o,querySuggestionsData:{suggestions:[],loadingState:q.QuerySuggestionsLoadingState.LOADING}}));const c=Date.now();try{const{query_suggestions:e}=yield O.getQuerySuggestions(s.id,o,i,l),r=e||[];a(ae({normalizedQuery:o,querySuggestionsData:{suggestions:r.filter(e=>e.text!==o),loadingState:q.QuerySuggestionsLoadingState.LOADED,lastFetched:Date.now()}})),a(t.setLastQueryWithQuerySuggestionsLoaded({lastQueryWithQuerySuggestionsLoaded:o})),M.logQuerySuggestionsFetched(o,r.length,Date.now()-c)}catch(e){const t=e.raw?new Error(e.raw.responseBody):e;H.reportException({err:t,tags:["search_bar","search_bar_query_suggestions"],severity:"non-critical"}),a(ae({normalizedQuery:o,querySuggestionsData:{loadingState:q.QuerySuggestionsLoadingState.FAILED,lastFetched:Date.now()}})),M.logQuerySuggestionsFailed(o)}}))},t.dismissQuerySuggestions=function({query:e}){return(t,s)=>{const i=k.normalize(e),a=D.querySuggestionsCache(s())[i];a&&a.loadingState===q.QuerySuggestionsLoadingState.LOADED&&(t(ae({normalizedQuery:i,querySuggestionsData:{loadingState:q.QuerySuggestionsLoadingState.DISMISSED}})),M.logQuerySuggestionsDismissed(e))}};const ae=({normalizedQuery:e,querySuggestionsData:t})=>({type:x.ActionTypes.UPDATE_QUERY_SUGGESTIONS_CACHE,payload:{normalizedQuery:e,querySuggestionsData:t}});t.setLastQueryWithQuerySuggestionsLoaded=function({lastQueryWithQuerySuggestionsLoaded:e}){return(t,s)=>{t({type:x.ActionTypes.SET_LAST_QUERY_WITH_QUERY_SUGGESTIONS_LOADED,payload:{lastQueryWithQuerySuggestionsLoaded:e}})}},t.fetchTagsSuggestions=function({query:e}){return(i,a)=>s.__awaiter(this,void 0,void 0,(function*(){if(!B.isTaggingEnabled(R.manualTaggingVariant(a())))return;const s=D.user(a());if(!s)return;const r=G.selectAllTagsSuggestions(a());if(void 0===r)return void i(z.fetchAllTagsSuggestions({user:s,onSuccess:()=>{i(t.fetchTagsSuggestions({query:e}))}}));const o=k.normalize(e),n=D.tagsSuggestionsCache(a())[o];if(n){const e=n.loadingState;if(e===q.TagsSuggestionsLoadingState.LOADING)return;if(e===q.TagsSuggestionsLoadingState.LOADED)return void i(t.setLastQueryWithTagsSuggestionsLoaded({lastQueryWithTagsSuggestionsLoaded:o}));if(e===q.TagsSuggestionsLoadingState.DISMISSED)return i(re({normalizedQuery:o,tagsSuggestionsData:{loadingState:q.TagsSuggestionsLoadingState.LOADED}})),void i(t.setLastQueryWithTagsSuggestionsLoaded({lastQueryWithTagsSuggestionsLoaded:o}))}i(re({normalizedQuery:o,tagsSuggestionsData:{suggestions:[],loadingState:q.TagsSuggestionsLoadingState.LOADING}}));try{const e=7,s=Y.getTagsSuggestions(o,r).slice(0,e);i(re({normalizedQuery:o,tagsSuggestionsData:{suggestions:s,loadingState:q.TagsSuggestionsLoadingState.LOADED}})),i(t.setLastQueryWithTagsSuggestionsLoaded({lastQueryWithTagsSuggestionsLoaded:o})),M.logTagSuggestionsFetched(o,s.length)}catch(e){const t=e.raw?new Error(e.raw.responseBody):e;H.reportException({err:t,tags:["search_bar","search_bar_tags_suggestions"],severity:"non-critical"}),i(re({normalizedQuery:o,tagsSuggestionsData:{loadingState:q.TagsSuggestionsLoadingState.FAILED}})),M.logTagSuggestionsFailed(o)}}))},t.dismissTagsSuggestions=function({query:e}){return(t,s)=>{if(!B.isTaggingEnabled(R.manualTaggingVariant(s())))return;const i=k.normalize(e),a=D.tagsSuggestionsCache(s())[i];a&&a.loadingState===q.TagsSuggestionsLoadingState.LOADED&&(t(re({normalizedQuery:i,tagsSuggestionsData:{loadingState:q.TagsSuggestionsLoadingState.DISMISSED}})),M.logTagSuggestionsDismissed(e))}};const re=({normalizedQuery:e,tagsSuggestionsData:t})=>({type:x.ActionTypes.UPDATE_TAGS_SUGGESTIONS_CACHE,payload:{normalizedQuery:e,tagsSuggestionsData:t}});t.setLastQueryWithTagsSuggestionsLoaded=function({lastQueryWithTagsSuggestionsLoaded:e}){return(t,s)=>{B.isTaggingEnabled(R.manualTaggingVariant(s()))&&t({type:x.ActionTypes.SET_LAST_QUERY_WITH_TAGS_SUGGESTIONS_LOADED,payload:{lastQueryWithTagsSuggestionsLoaded:e}})}},t.setResults=({searchResults:e,requestId:t,context:s})=>({type:x.ActionTypes.SET_RESULTS,payload:{searchResults:e,requestId:t,context:s}}),t.updateResults=({results:e})=>({type:x.ActionTypes.UPDATE_RESULTS,payload:{results:e}}),t.removeResults=({results:e})=>({type:x.ActionTypes.REMOVE_RESULTS,payload:{results:e}}),t.purgeFiles=({files:i,user:a,context:r})=>function(o,n){return s.__awaiter(this,void 0,void 0,(function*(){const{purgeByPathBatch:n}=yield new Promise((t,s)=>{e(["modules/clean/react/trash/actions"],t,s)}).then(s.__importStar);c.showPurgeModal({userId:a.id,context:r,files:i,onPurge:()=>n(a.id,i,e=>{o(t.removeResults({results:e}))})})}))},t.restoreFiles=({files:e,user:i,context:a})=>function(r,o){return s.__awaiter(this,void 0,void 0,(function*(){c.showUnifiedTrashModal({userId:i.id,context:a,files:e,onRestore:(e,s)=>{d.restoreFiles({files:s,userId:i.id,onSuccess:()=>{n.notifyRestoreSuccess(s),(e=>{const s=e.map(e=>e.fq_path),i=D.results(o()).reduce((e,t)=>T.isFile(t)&&s.includes(t.fq_path)?[...e,new m.File(Object.assign(Object.assign({},t),{isDeleted:!1}))]:e,[]);r(t.updateResults({results:i}))})(s)},isSearchMode:!1})}})}))};const oe=()=>({type:x.ActionTypes.CLEAR_RESULTS}),ne=({searchResults:e,loadingState:t})=>({type:x.ActionTypes.APPEND_RESULTS,payload:{searchResults:e,loadingState:t}}),le=({loadingState:e})=>({type:x.ActionTypes.SET_LOADING_STATE,payload:{loadingState:e}}),ce=()=>({type:x.ActionTypes.CLEAR_TTI_COMPONENTS}),de=({component:e})=>({type:x.ActionTypes.ADD_TTI_COMPONENT,payload:{component:e}}),ue=({normalizedQuery:e,peopleSuggestionsData:t})=>({type:x.ActionTypes.UPDATE_PEOPLE_SUGGESTIONS_CACHE,payload:{normalizedQuery:e,peopleSuggestionsData:t}}),ge=({lastQueryWithPeopleSuggestionsLoaded:e})=>({type:x.ActionTypes.SET_LAST_QUERY_WITH_PEOPLE_SUGGESTIONS_LOADED,payload:{lastQueryWithPeopleSuggestionsLoaded:e}});t.setHighlightedRow=({index:e})=>({type:x.ActionTypes.SET_HIGHLIGHTED_ROW,payload:{index:e}}),t.setQueryStartTime=({queryStartTime:e})=>({type:x.ActionTypes.SET_QUERY_START_TIME,payload:{queryStartTime:e}}),t.logQueryCompleted=e=>function(i,a){return s.__awaiter(this,void 0,void 0,(function*(){const s=D.queryStartTime(a());if(s){const r=Z.isMediaMetadataSearchEnabled(R.mediaFiltersVariant(a()));if(B.isTaggingEnabled(R.manualTaggingVariant(a()))){const t=D.query(a()),i=G.selectAllTagsSuggestions(a()),{numOfTags:o,typeOfTagToCount:n}=Y.getTagsInQuery(t,i);e&&o>0&&$.UserSurvey.trackEvent("search_tag","search"),M.logQueryCompleted((new Date).getTime()-s,r,o,n,"search bar")}else M.logQueryCompleted((new Date).getTime()-s,r);i(t.setQueryStartTime({queryStartTime:void 0}))}}))};const he=()=>{X=pe(X),ee=pe(ee)},pe=e=>(null!==e&&clearTimeout(e),null),_e=e=>{switch(e){case h.SEARCH_ORDER_BY_TYPE.LAST_MODIFIED_TIME:return E.SortField.MODIFIED;case h.SEARCH_ORDER_BY_TYPE.RELEVANCE:default:return E.SortField.RELEVANCE}},me=e=>{switch(e){case b.SearchOriginPathway.ASSISTANT:return b.SearchOriginPathway.ASSISTANT;case b.SearchOriginPathway.COLLAB_BROWSE:return b.SearchOriginPathway.COLLAB_BROWSE;default:return b.SearchOriginPathway.WEB}},Se=e=>{switch(e){case h.SEARCH_REVERSE_ORDER_TYPE.TRUE:return E.SortDirection.ASCENDING;case h.SEARCH_REVERSE_ORDER_TYPE.FALSE:default:return E.SortDirection.DESCENDING}},ye=(e,t)=>!e&&!t||!(!e||!t)&&(e.sortField===t.sortField&&e.sortDirection===t.sortDirection);t.setFilters=({path:e,fileCategories:s,searchType:i,filteredAccountId:a,dateTaken:r,selectedDimensions:o})=>(n,c)=>{e&&!l.paths_are_equal(e,D.path(c()))&&n(t.setPath({path:e,viewport:"view"})),s&&n(t.setFileCategories({fileCategories:s})),i&&n(t.setSearchType({searchType:i})),null===a&&n(t.setFilteredAccountId({filteredAccountId:void 0})),void 0!==r&&n(t.setDateTaken({dateTaken:r})),void 0!==o&&n(t.setSelectedDimensions({selectedDimensions:o}))},t.resetFilters=()=>e=>{e(t.setFilters({path:"/",fileCategories:b.FILE_CATEGORIES_UNCHECKED,filteredAccountId:null,dateTaken:q.DateTaken.Any,selectedDimensions:[]})),M.logFiltersReset()};const fe=e=>e instanceof m.File;t.shouldStartNewSearchSession=(e,{query:t})=>!D.sessionId(e)||(!(!D.normalizedQuery(e)||t)||D.normalizedQuery(e).length>=3&&1===t.length);const Ee=(e,t,i)=>s.__awaiter(void 0,void 0,void 0,(function*(){if(!i||0===i.selected.count())return;const s=D.results(t()),a=null==s?void 0:s.filter(e=>T.isFile(e)&&i.selected.has(e.fq_path)&&!e.thumbnail_url_tmpl),r=[];if(null==a||a.forEach(e=>{T.isFile(e)&&r.push({file_id:e.file_id,sj_id:e.sjid,ns_id:e.ns_id})}),r.length>0){const s=D.user(t());s&&e(y.loadPreviewThumbnails(r,s.id,b.SEARCH_FILES_VIEW_ID))}}));t.handleNavigateToFileOrFolder=(e,s={})=>(n,l)=>{const{actionSource:c}=s,d=D.user(l()),g=D.context(l()),h=D.resultsList(l());if(n(t.addQueryToHistory()),n(t.stopAndLogDwellTime()),e instanceof m.FileSharedWithMe)return M.logResultAction(V.WebUserActionLogEvent.FILE_VIEW,h,e),void u.redirect(e.href);if(e.isDeleted)n(t.restoreFiles({files:[e],user:d,context:g}));else{if(e.is_dir)return M.logResultAction(V.WebUserActionLogEvent.FOLDER_OPEN,h,e,void 0,c),void N.searchNavigationManager.set(i.href_for_file(d,e));if(M.logResultAction(V.WebUserActionLogEvent.FILE_VIEW,h,e,void 0,c),e.is_cloud_doc)a.openCloudDoc(e,d,o.WebSearchSource);else if(r.hasPreferredEditorSupport(e)){const s=D.preferredEditors(l());r.openInPreferredEditor(d,e,s,()=>{n(t.setPreviewFile({previewFileId:e.file_id}))},{fileViewAction:W.FileViewActionType.CLICK,fileViewOrigin:W.FileViewOriginType.SEARCH})}else n(t.setPreviewFile({previewFileId:e.file_id}))}}})),define("modules/clean/search/single_page/data/action_creators/file_actions",["require","exports","tslib","lodash","immutable","modules/clean/file_actions/metrics","modules/clean/file_actions/strings","modules/clean/metrics/index","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/browse/logger_util","modules/clean/react/browse/models","modules/clean/react/files_view/data/action_creators","modules/clean/react/files_view/data/selectors/instance_selectors","modules/clean/react/files_view/file_actions/api_v2","modules/clean/react/files_view/file_actions/file_from_metadata","modules/clean/react/files_view/file_actions/rollback","modules/clean/react/files_view/file_actions/snackbars","modules/clean/react/files_view/types","modules/clean/react/files_view/util","modules/clean/react/selection","modules/clean/react/snackbar","modules/clean/search/constants","modules/clean/search/single_page/data/action_creators/index","modules/clean/search/single_page/data/selectors/index","modules/clean/tagging/data/action_creators","modules/clean/undo","modules/clean/web_user_action_events","modules/core/i18n"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g,h,p,_,m,S,y,f,E,T,w,v,F,C,b,A,O){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renameFile=t.renameUndo=t.deleteFiles=t.setIsDeletedOnPathsInResults=void 0,a=s.__importStar(a),l=s.__importStar(l),d=s.__importStar(d),g=s.__importStar(g),h=s.__importStar(h),p=s.__importStar(p),S=s.__importStar(S),F=s.__importStar(F);const I=({state:e,eventName:t,num_files_selected:s,num_folders_selected:i,batch_success_count:a,batch_fail_count:r,lookup_error_type:o,error_summary:n})=>{c.logFileAction({uid:F.user(e).id,action:t,num_files_selected:s,num_folders_selected:i,view_type:h.selectViewType(e,{instanceId:w.SEARCH_FILES_VIEW_ID}),batch_success_count:a,batch_fail_count:r,lookup_error_type:o,error_summary:n})};t.setIsDeletedOnPathsInResults=(e,t,s)=>i.compact(s.toArray().map(s=>{if(f.isFile(s)&&t.includes(s.fq_path))return new u.File(Object.assign(Object.assign({},s),{isDeleted:e,thumbnail_url_tmpl:e?null:s.thumbnail_url_tmpl}))}));t.deleteFiles=({files:e,checkFSWs:i})=>function(a,c){return s.__awaiter(this,void 0,void 0,(function*(){const u=F.user(c()),g=F.context(c());yield(function({files:e,user:t,context:i}){return s.__awaiter(this,void 0,void 0,(function*(){return new Promise(s=>{l.showDelete(t,e,i,"/",s)})}))})({user:u,files:e,context:g});const h=n.getMetricsReporter(),_={surface:"search",batchSizeBucket:r.bucketForBatchSize(e.length),contentType:r.batchContentType(e)},y=h.createTimer({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/latency_total_ms"},_),f=Date.now(),E=h.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/latency_average_ms"},_),w=h.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"delete/batch/completed"},_);T.Snackbar.sync(O.intl.formatMessage(o.deleteSnackbarProgressMessage,{count:e.length}),!0,"browse-action"),I({state:c(),eventName:A.WebUserActionLogEvent.DELETE_REQUEST_ATTEMPT,num_files_selected:e.length,num_folders_selected:0});const C=yield p.deleteFiles(e,u.id,i);if(C.isError&&"path"===C.error[".tag"]&&"file_system_warnings"===C.error.path[".tag"])return void a((({files:e,details:i})=>(a,r)=>s.__awaiter(void 0,void 0,void 0,(function*(){T.Snackbar.close("browse-action"),l.showFileSystemWarningsModal({fsws:i,onFinalAccept:()=>{a(t.deleteFiles({files:e,checkFSWs:!1}))},confirmText:O.intl.formatMessage(o.deleteFswConfirmText)})})))({files:e,details:C.error.path.details}));if(y.record(),E.record((Date.now()-f)/e.length),C.isError)return a((({files:e,result:t})=>(i,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){T.Snackbar.fail(S.deleteError(e.length,t.error),"browse-action");const s=F.selectedFiles(a()),{num_files_selected:i,num_folders_selected:r}=d.countFilesAndFolders(s);I({state:a(),eventName:A.WebUserActionLogEvent.DELETE_REQUEST_FAIL,num_files_selected:i,num_folders_selected:r,batch_success_count:0,batch_fail_count:e.length,error_summary:t.error_summary})})))({files:e,result:C})),void w.record(0);const R=C.result.entries.filter(e=>"success"===e[".tag"]),L=R.map(e=>e.metadata.path_display);a(v.updateResults({results:t.setIsDeletedOnPathsInResults(!0,L,F.results(c()))}));const P=()=>s.__awaiter(this,void 0,void 0,(function*(){T.Snackbar.close("browse-action"),I({state:c(),eventName:A.WebUserActionLogEvent.DELETE_UNDO,num_files_selected:C.result.changeset_data.length,num_folders_selected:0}),m.rollback({changeset_data:C.result.changeset_data,userId:u.id,onSuccess:()=>{T.Snackbar.complete(O.intl.formatMessage(o.deleteUndoSnackbarMessage),"browse-action"),I({state:c(),eventName:A.WebUserActionLogEvent.DELETE_UNDO_REQUEST_SUCCESS,num_files_selected:C.result.changeset_data.length,num_folders_selected:0}),a(v.updateResults({results:t.setIsDeletedOnPathsInResults(!1,L,F.results(c()))}))}})}));b.setHandleUndo(P);const D=C.result.entries.filter(p.isFailure),x=D[0];let M,N;if(void 0!==x){const e=x.failure;M=e[".tag"],p.isPathLookupFailure(e)&&(N=e.path_lookup[".tag"])}const Q=C.result.entries.filter(e=>p.isFailure(e)&&!p.isPathLookupFailure(e.failure)).length;w.record(Q>0?0:1),r.recordPathLookupErrors(D,"delete",_),D.length===C.result.entries.length?(T.Snackbar.fail(S.deleteCompleteError(D),"browse-action"),I({state:c(),eventName:A.WebUserActionLogEvent.DELETE_REQUEST_FAIL,num_files_selected:C.result.changeset_data.length,num_folders_selected:0,batch_success_count:C.result.entries.length-D.length,batch_fail_count:D.length,lookup_error_type:N,error_summary:M})):(T.Snackbar.completeWithUndo(S.deleteCompleteSuccess(e.length,R.length),P,"browse-action"),I({state:c(),eventName:A.WebUserActionLogEvent.DELETE_REQUEST_SUCCESS,num_files_selected:C.result.changeset_data.length,num_folders_selected:0,batch_success_count:C.result.entries.length,batch_fail_count:0,lookup_error_type:N,error_summary:M}))}))};t.renameUndo=({file:e,result:t})=>(i,l)=>s.__awaiter(void 0,void 0,void 0,(function*(){const s=F.user(l()),c=n.getMetricsReporter(),d={surface:"search",contentType:e.is_dir?"folders":"files",batchSizeBucket:"single"},u={latency:c.createTimer({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"undo/latency_ms"},d),completed:c.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"undo/completed"},d)};T.Snackbar.sync(O.intl.formatMessage(o.renameUndoSnackbarProgressMessage),!1,"browse-action"),(yield p.undo(t.result.changeset_data,s)).isError?(T.Snackbar.fail(O.intl.formatMessage(o.renameUndoSnackbarErrorMessage),"browse-action"),u.completed.record(0)):(T.Snackbar.complete(O.intl.formatMessage(o.renameUndoSnackbarSuccessMessage),"browse-action"),i(v.updateResults({results:[e]})),i(v.setSelection({selection:new E.Selection({selected:a.OrderedSet([e.fq_path]),anchor:null}),skipLogging:!0})),u.completed.record(1)),u.latency.record()})),t.renameFile=({file:e,name:i,checkFSWs:c})=>function(d,u){return s.__awaiter(this,void 0,void 0,(function*(){const h=F.user(u()),m=n.getMetricsReporter(),f={surface:"browse",contentType:e.is_dir?"folders":"files"},w={latency:m.createTimer({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/latency_ms"},f),completed:m.createStats({ns:r.FILE_ACTIONS_AMP_NAMESPACE,name:"rename/completed"},f)};if(-1!==i.indexOf("/"))return T.Snackbar.fail(O.intl.formatMessage(o.renameErrorInvalidName),"browse-action"),void d(g.setFileRename({file:e,renameState:null}));d(g.setFileRename({file:e,renameState:y.RenameState.SAVING_INPUT})),T.Snackbar.sync(O.intl.formatMessage(o.renameSnackbarProgressMessage),!1,"browse-action");const A=yield p.renameFile(e.fq_path,i,h.id,c);if(A.isError&&"to"===A.error[".tag"]&&"file_system_warnings"===A.error.to[".tag"])return void d((({file:e,name:i,details:a})=>r=>s.__awaiter(void 0,void 0,void 0,(function*(){T.Snackbar.close("browse-action"),l.showFileSystemWarningsModal({fsws:a,onFinalAccept:()=>{r(t.renameFile({file:e,name:i,checkFSWs:!1}))},onAbortAction:()=>{r(g.setFileRename({file:e,renameState:null}))},confirmText:O.intl.formatMessage(o.renameFswConfirmText)})})))({file:e,name:i,details:A.error.to.details}));if(w.latency.record(),A.isError||"success"!==A.result.entries[0][".tag"]){const t=A.isError?A:p.createUndefinedRpcResult();return d((({file:e,result:t})=>(i,a)=>s.__awaiter(void 0,void 0,void 0,(function*(){i(g.setFileRename({file:e,renameState:null})),T.Snackbar.fail(S.renameError(t.error,e.fq_path),"browse-action")})))({file:e,result:t})),void w.completed.record(0)}const I=A.result.entries[0],R=_.fileFromMetadata(e,I.success);d(v.updateResults({results:[R]})),d(v.setSelection({selection:new E.Selection({selected:a.OrderedSet([R.fq_path]),anchor:null}),skipLogging:!0})),d(C.fileRename({file:e,newFile:R})),d(g.setFileRename({file:e,renameState:null})),w.completed.record(1);const L=()=>{d(t.renameUndo({file:e,result:A}))};b.setHandleUndo(L),T.Snackbar.completeWithUndo(O.intl.formatMessage(o.renameSnackbarSuccessMessage),L,"browse-action")}))}})),define("modules/clean/search/single_page/data/reducer",["require","exports","tslib","immutable","modules/clean/react/browse/models","modules/clean/react/files_view/sort_types","modules/clean/react/selection","modules/clean/search/constants","modules/clean/search/single_page/data/types","modules/clean/search/single_page/utils","modules/clean/search/store_helpers","modules/clean/search/types"],(function(e,t,s,i,a,r,o,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.searchReducer=t.defaultSearchState=void 0,i=s.__importStar(i),t.defaultSearchState={variant:"full-page",loadingState:n.SearchLoadingState.ZERO_QUERY,results:i.OrderedMap(),query:"",resultQuery:"",path:"/",sessionId:"",selection:o.createSelection(),queryHistory:[],previewFileId:void 0,sortOrder:{sortField:r.SortField.RELEVANCE,sortDirection:r.SortDirection.DESCENDING},fileCategories:n.FILE_CATEGORIES_UNCHECKED,context:new a.BrowseContext,ttiComponents:i.Set(),searchType:n.SearchType.ALL,imageSuggestionCount:0,imageSuggestionQuery:"",imageSuggestionRequestId:void 0,imageSuggestionResults:i.OrderedMap(),filteredAccountId:void 0,peopleSuggestionsCache:{},lastQueryWithPeopleSuggestionsLoaded:void 0,querySuggestionsCache:{},spellCorrection:void 0,isCreatingSharedLinkMap:i.Map(),tagsSuggestionsCache:{},selectedDimensions:[],dateTaken:u.DateTaken.Any,mediaData:{},popularFiltersCache:{},filteredSuggestion:void 0,suggestionSectionOrder:n.defaultSuggestionSectionOrder};const g=e=>Object.assign(Object.assign({},e),{results:e.results.clear(),resultQuery:"",hasMoreResults:!0,selection:o.createSelection(),imageSuggestionCount:0,imageSuggestionQuery:"",imageSuggestionRequestId:void 0,spellCorrection:void 0}),h=(e,t)=>Object.assign(Object.assign({},e),{results:e.results.concat(t.searchResults.results.map(e=>[c.getIdForSearchResult(e),e])),cursor:t.searchResults.cursor,resultQuery:d.normalize(e.query),hasMoreResults:t.searchResults.hasMore,loadingState:t.loadingState||e.loadingState}),p=(e,t)=>Object.assign(Object.assign({},e),{spellCorrection:t.searchResults.spellCorrection}),_=(e,t)=>Object.assign(Object.assign({},e),{requestId:t.requestId});t.searchReducer=function(e=t.defaultSearchState,s){switch(s.type){case l.ActionTypes.SET_VARIANT:return((e,t)=>Object.assign(Object.assign({},e),{variant:t.variant}))(e,s.payload);case l.ActionTypes.SET_USER:return((e,t)=>Object.assign(Object.assign({},e),{user:t.user,userOptions:t.options}))(e,s.payload);case l.ActionTypes.SET_EXPERIMENTS:return((e,t)=>Object.assign(Object.assign({},e),{experiments:t.experiments}))(e,s.payload);case l.ActionTypes.SET_PATH:return((e,t)=>Object.assign(Object.assign({},e),{path:t.path}))(e,s.payload);case l.ActionTypes.SET_FILE_CATEGORIES:return((e,t)=>Object.assign(Object.assign({},e),{fileCategories:t.fileCategories}))(e,s.payload);case l.ActionTypes.SET_LOADING_STATE:return((e,t)=>Object.assign(Object.assign({},e),{loadingState:t.loadingState}))(e,s.payload);case l.ActionTypes.SET_QUERY:return((e,t)=>Object.assign(Object.assign({},e),{query:t.query,highlightedRow:void 0}))(e,s.payload);case l.ActionTypes.SET_RESULTS:return((e,{searchResults:t,requestId:s,context:i})=>{let a=Object.assign(Object.assign({},e),{context:i||e.context});return a=g(a),a=h(a,{searchResults:t}),a=_(a,{requestId:s}),a=p(a,{searchResults:t}),a})(e,s.payload);case l.ActionTypes.CLEAR_RESULTS:return g(e);case l.ActionTypes.APPEND_RESULTS:return h(e,s.payload);case l.ActionTypes.SET_SESSION_ID:return((e,t)=>Object.assign(Object.assign({},e),{sessionId:t.sessionId}))(e,s.payload);case l.ActionTypes.SET_REQUEST_ID:return _(e,s.payload);case l.ActionTypes.SET_SELECTION:return((e,t)=>Object.assign(Object.assign({},e),{selection:t.selection}))(e,s.payload);case l.ActionTypes.SET_PREVIEW_FILE_ID:return((e,t)=>Object.assign(Object.assign({},e),{previewFileId:t.previewFileId}))(e,s.payload);case l.ActionTypes.SET_PREVIEW_COMMENTS_THREAD_ID:return((e,t)=>Object.assign(Object.assign({},e),{previewCommentsThreadId:t.previewCommentsThreadId}))(e,s.payload);case l.ActionTypes.SET_SORT_ORDER:return((e,t)=>Object.assign(Object.assign({},e),{sortOrder:t.sortOrder}))(e,s.payload);case l.ActionTypes.ADD_TTI_COMPONENT:return((e,t)=>Object.assign(Object.assign({},e),{ttiComponents:e.ttiComponents.add(t.component)}))(e,s.payload);case l.ActionTypes.CLEAR_TTI_COMPONENTS:return(e=>Object.assign(Object.assign({},e),{ttiComponents:i.Set()}))(e);case l.ActionTypes.SET_SEARCH_TYPE:return((e,t)=>Object.assign(Object.assign({},e),{searchType:t.searchType}))(e,s.payload);case l.ActionTypes.SET_IMAGE_SUGGESTION:return((e,t)=>{const s=e.imageSuggestionResults.clear();return Object.assign(Object.assign({},e),{imageSuggestionResults:s.concat(t.results.map(e=>[c.getIdForSearchResult(e),e])),imageSuggestionCount:t.results.length,imageSuggestionQuery:t.query,imageSuggestionRequestId:t.requestId})})(e,s.payload);case l.ActionTypes.SET_DWELL_TIME:return((e,t)=>Object.assign(Object.assign({},e),{dwellStartTime:t.dwellStartTime}))(e,s.payload);case l.ActionTypes.UPDATE_RESULTS:return((e,t)=>{const s=e.results.map(e=>{const s=t.results.find(t=>c.getIdForSearchResult(e)===c.getIdForSearchResult(t));return void 0===s?e:s});return Object.assign(Object.assign({},e),{results:s})})(e,s.payload);case l.ActionTypes.REMOVE_RESULTS:return((e,t)=>{const s=t.results.map(e=>c.getIdForSearchResult(e)),i=e.results.filter(e=>!s.includes(c.getIdForSearchResult(e)));return Object.assign(Object.assign({},e),{results:i})})(e,s.payload);case l.ActionTypes.SET_QUERY_HISTORY:return((e,t)=>{const{queryHistory:s}=t;return Object.assign(Object.assign({},e),{queryHistory:s})})(e,s.payload);case l.ActionTypes.SET_HIGHLIGHTED_ROW:return((e,t)=>Object.assign(Object.assign({},e),{highlightedRow:t.index}))(e,s.payload);case l.ActionTypes.UPDATE_QUERY_SUGGESTIONS_CACHE:return((e,t)=>{const{normalizedQuery:s,querySuggestionsData:i}=t;return Object.assign(Object.assign({},e),{querySuggestionsCache:Object.assign(Object.assign({},e.querySuggestionsCache),{[s]:Object.assign(Object.assign({},e.querySuggestionsCache[s]),i)})})})(e,s.payload);case l.ActionTypes.SET_LAST_QUERY_WITH_QUERY_SUGGESTIONS_LOADED:return((e,t)=>{const{lastQueryWithQuerySuggestionsLoaded:s}=t;return Object.assign(Object.assign({},e),{lastQueryWithQuerySuggestionsLoaded:s})})(e,s.payload);case l.ActionTypes.SET_FILTERED_ACCOUNT_ID:return((e,t)=>Object.assign(Object.assign({},e),{filteredAccountId:t.filteredAccountId}))(e,s.payload);case l.ActionTypes.UPDATE_PEOPLE_SUGGESTIONS_CACHE:return((e,t)=>{const{normalizedQuery:s,peopleSuggestionsData:i}=t;return Object.assign(Object.assign({},e),{peopleSuggestionsCache:Object.assign(Object.assign({},e.peopleSuggestionsCache),{[s]:Object.assign(Object.assign({},e.peopleSuggestionsCache[s]),i)})})})(e,s.payload);case l.ActionTypes.SET_LAST_QUERY_WITH_PEOPLE_SUGGESTIONS_LOADED:return((e,t)=>Object.assign(Object.assign({},e),{lastQueryWithPeopleSuggestionsLoaded:t.lastQueryWithPeopleSuggestionsLoaded}))(e,s.payload);case l.ActionTypes.SET_QUERY_START_TIME:return((e,t)=>Object.assign(Object.assign({},e),{queryStartTime:t.queryStartTime}))(e,s.payload);case l.ActionTypes.SET_IS_CREATING_SHARED_LINK:return(function(e,t){return Object.assign(Object.assign({},e),{isCreatingSharedLinkMap:e.isCreatingSharedLinkMap.set(t.payload.fileIdOrPath,t.payload.isCreatingSharedLink)})})(e,s);case l.ActionTypes.UPDATE_TAGS_SUGGESTIONS_CACHE:return((e,t)=>{const{normalizedQuery:s,tagsSuggestionsData:i}=t;return Object.assign(Object.assign({},e),{tagsSuggestionsCache:Object.assign(Object.assign({},e.tagsSuggestionsCache),{[s]:Object.assign(Object.assign({},e.tagsSuggestionsCache[s]),i)})})})(e,s.payload);case l.ActionTypes.SET_LAST_QUERY_WITH_TAGS_SUGGESTIONS_LOADED:return((e,t)=>{const{lastQueryWithTagsSuggestionsLoaded:s}=t;return Object.assign(Object.assign({},e),{lastQueryWithTagsSuggestionsLoaded:s})})(e,s.payload);case l.ActionTypes.SET_DATE_TAKEN:return((e,t)=>{const{dateTaken:s}=t;return Object.assign(Object.assign({},e),{dateTaken:s})})(e,s.payload);case l.ActionTypes.SET_SELECTED_DIMENSIONS:return((e,t)=>{const{selectedDimensions:s}=t;return Object.assign(Object.assign({},e),{selectedDimensions:s})})(e,s.payload);case l.ActionTypes.SET_MEDIA_DATA:return((e,{filesMediaData:t})=>{const s={};return t.forEach(e=>{void 0!==e.file_id_or_path&&(s[e.file_id_or_path]=e)}),e.mediaData&&Object.values(e.mediaData).forEach(e=>{void 0!==e.file_id_or_path&&(s[e.file_id_or_path]=e)}),Object.assign(Object.assign({},e),{mediaData:s})})(e,s.payload);case l.ActionTypes.UPDATE_POPULAR_FILTERS_CACHE:return((e,t)=>{const{normalizedQuery:s,popularFiltersData:i}=t;return Object.assign(Object.assign({},e),{popularFiltersCache:Object.assign(Object.assign({},e.popularFiltersCache),{[s]:Object.assign(Object.assign({},e.popularFiltersCache[s]),i)})})})(e,s.payload);case l.ActionTypes.SET_LAST_QUERY_WITH_POPULAR_FILTERS_LOADED:return((e,t)=>{const{lastQueryWithPopularFiltersLoaded:s}=t;return Object.assign(Object.assign({},e),{lastQueryWithPopularFiltersLoaded:s})})(e,s.payload);case l.ActionTypes.SET_FILTERED_SEARCH_SUGGESTION:return((e,t)=>Object.assign(Object.assign({},e),{filteredSuggestion:{type:t.type,query:t.query}}))(e,s.payload);default:return e}}})),define("modules/clean/search/single_page/data/selectors/experiments",["require","exports","tslib","reselect","dropbox/proto/js_init_data/browse_web/browse_web","modules/clean/react/browse/models","modules/clean/redux/namespaces","modules/clean/redux/selectors","modules/clean/search/constants","modules/clean/search/single_page/constants","modules/clean/search/single_page/data/selectors/index","modules/core/i18n","modules/clean/media_filters/gating"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.searchDocClassificationVariant=t.autoTagAwarenessVariant=t.flowsAutoTagUiVariant=t.flowsAutomatedFolderUiVariant=t.manualTaggingVariant=t.actionBarExperimentSelector=t.maxResultsToFetch=t.shouldRenderInlineSearchFilters=t.isEmptyStateExperiment=t.searchEmptyStateVariant=t.mediaFiltersVariant=t.shouldShowFolderOverview=t.shouldShowSelectionPreviewPane=t.shouldRenderEmptyZeroQueryView=t.shouldRenderHistory=t.shouldRenderTabs=t.tabs=t.isSearchAsYouTypeEnabled=t.browseExperiments=t.searchResultsExperiments=t.experiments=void 0,d=s.__importStar(d);t.experiments=e=>(e=>n.getStateAtNamespace(e,o.SEARCH_NAMESPACE_KEY))(e).experiments||{};const h=(e,t)=>!!e&&!0===e[t];t.searchResultsExperiments=i.createSelector(t.experiments,e=>({expImageContentSearch:h(e,"search_image_content"),expManualTagging:e.manual_tagging,expFlowsAutomatedFolderUI:e.flows_automated_folder_ui,expFlowsAutoTagUi:e.flows_auto_tag_ui,expAutoTagAwareness:e.auto_tag_awareness})),t.browseExperiments=i.createSelector(t.experiments,e=>a.browse_web.BrowseExperiments.create({folderHistoryRollbacks:h(e,"folder_history_rollbacks")})),t.isSearchAsYouTypeEnabled=i.createSelector(t.experiments,d.isFullPage,(e,t)=>!t||"ON"!==e.search_experiment_disable_sayt&&"ON_WITH_SUGGESTIONS"!==e.search_experiment_disable_sayt),t.tabs=i.createSelector(t.experiments,e=>e.search_image_content?[{id:l.SearchType.ALL,label:u.intl.formatMessage({id:"yKk1zB",defaultMessage:"Text"})},{id:l.SearchType.IMAGE,label:u.intl.formatMessage({id:"lJEvbU",defaultMessage:"Images"})}]:void 0),t.shouldRenderTabs=i.createSelector(t.tabs,e=>!(!e||!e.length)),t.shouldRenderHistory=i.createSelector(d.loadingState,d.queryHistory,(e,t)=>e===l.SearchLoadingState.ZERO_QUERY&&0!==t.length),t.shouldRenderEmptyZeroQueryView=i.createSelector(t.shouldRenderHistory,e=>!e);const p=(e,{responsive:t})=>!(!t||!t.isResponsive||t.isMatchedLarge);t.shouldShowSelectionPreviewPane=i.createSelector(p,d.numResults,(e,t)=>!(e||!(t>0))),t.shouldShowFolderOverview=i.createSelector(p,d.selectedFiles,(e,t)=>!e&&1===t.size&&t.first().is_dir&&!r.File.isNoAccessSharedFolder(t.first())),t.mediaFiltersVariant=i.createSelector(t.experiments,e=>e.media_filters||"OFF"),t.searchEmptyStateVariant=i.createSelector(t.experiments,e=>e.search_empty_state||"OFF"),t.isEmptyStateExperiment=function(e){return!!e&&["V1"].includes(e)},t.shouldRenderInlineSearchFilters=i.createSelector(d.hasResultQuery,d.filteredAccountId,t.mediaFiltersVariant,(e,t,s)=>Boolean(e||t||g.isMediaFiltersEnabled(s))),t.maxResultsToFetch=i.createSelector(d.variant,d.nextPageOffset,t.isSearchAsYouTypeEnabled,(e,t,s)=>t?c.SEARCH_ADDITIONAL_PAGE_SIZE:"dropdown"===e?c.SEARCH_DROPDOWN_PAGE_SIZE:s?c.SEARCH_FIRST_PAGE_SIZE:c.SEARCH_ADDITIONAL_PAGE_SIZE),t.actionBarExperimentSelector=i.createSelector(t.experiments,e=>({expVaultEnableViewOnlySharing:!1,expSpacesFssDropdown:!1,expShowTransferInShare:!1,expManualPdfConversion:Boolean(e.manual_pdf_conversion),expFlowsFileConversionUI:!1,expFlowsAutomatedFolderUI:!1,expActionBarRedesign:e.browse_action_bar_redesign||"OFF",expFlowsManualVideoRemuxUi:!1,expFlowsManualVideoGifUi:!1,expFssEntryPointForSpaces:!1,expPgEsignDiscoveryFileHover:Boolean(e.pg_esign_discovery_file_hover),expSynchronousSingleFileActions:!1,expEnableSharingNSF:Boolean(e.nsf_web_enabled),expMultiObjectSharingRedesign:e.multi_object_sharing_redesign_exp||"OFF",expFlowsAudioConversionUi:!1})),t.manualTaggingVariant=i.createSelector(t.experiments,e=>e.manual_tagging||"OFF"),t.flowsAutomatedFolderUiVariant=i.createSelector(t.experiments,e=>e.flows_automated_folder_ui||!1),t.flowsAutoTagUiVariant=i.createSelector(t.experiments,e=>e.flows_auto_tag_ui||!1),t.autoTagAwarenessVariant=i.createSelector(t.experiments,e=>e.auto_tag_awareness||!1),t.searchDocClassificationVariant=i.createSelector(t.experiments,e=>e.search_doc_classification||"OFF")})),define("modules/clean/search/single_page/data/selectors/index",["require","exports","tslib","immutable","lodash","reselect","modules/clean/filepath/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/uri_helper","modules/clean/react/files_view/data/selectors/files_view_selectors","modules/clean/react/files_view/sort_types","modules/clean/redux/namespaces","modules/clean/redux/selectors","modules/clean/search/api_helpers","modules/clean/search/constants","modules/clean/search/search_helpers","modules/clean/search/single_page/navigation","modules/clean/search/single_page/utils","modules/clean/search/store_helpers","modules/clean/search/types","modules/core/i18n","modules/clean/react/files_view/constants","modules/clean/tagging/utils","modules/clean/tagging/data/selectors/index","modules/clean/tagging/experiments"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g,h,p,_,m,S,y,f,E,T,w,v,F,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPage=t.browseCommentsEnabled=t.showViewModeToggle=t.selectResultById=t.highlightedSuggestion=t.suggestions=t.highlightedSuggestionData=t.allSuggestionData=t.popularFiltersLoadingState=t.popularFilters=t.lastQueryWithPopularFiltersLoaded=t.popularFiltersCache=t.tagsSuggestionsLoadingState=t.tagsSuggestions=t.lastQueryWithTagsSuggestionsLoaded=t.tagsSuggestionsCache=t.peopleSuggestionsLoadingState=t.peopleSuggestions=t.filteredContactName=t.filteredContact=t.querySuggestionsLoadingState=t.querySuggestions=t.lastQueryWithQuerySuggestionsLoaded=t.querySuggestionsCache=t.hasFiltersSelected=t.ttiComponentsAllLoaded=t.previewableFiles=t.previewFile=t.searchUrlReset=t.searchUrl=t.commonLogFields=t.selectFilesForSelection=t.selectedFilesForSidebar=t.allFilesSelected=t.selectedFiles=t.fileCategoriesLogValue=t.fileCategoriesArray=t.fileCategoriesString=t.preferredEditors=t.isPaperEnabled=t.isNautilusEnabled=t.resultsList=t.results=t.mergeDisplayInfo=t.calculateMediaDataDisplayInfo=t.mediaDataWithHighlights=t.numResults=t.resultsWithTags=t.resultsWithoutTags=t.viewTypeScope=t.isCreatingSharedLinkForFile=t.queriesForFields=t.filteredSuggestion=t.mediaData=t.selectedDimensions=t.dateTaken=t.queryStartTime=t.dwellStartTime=t.lastQueryWithPeopleSuggestionsLoaded=t.peopleSuggestionsCache=t.filteredAccountId=t.suggestionSectionOrder=t.highlightedRow=t.searchType=t.ttiComponents=t.context=t.fileCategories=t.cachedFullResultsSortField=t.cachedFullResults=t.sortOrder=t.previewActiveCommentThreadId=t.previewFileId=t.hasMoreResults=t.spellCorrection=t.cursor=t.nextPageOffset=t.queryHistory=t.selection=t.requestId=t.sessionId=t.path=t.normalizedQuery=t.hasResultQuery=t.resultQuery=t.query=t.loadingState=t.userOptions=t.user=t.isFullPage=t.variant=void 0,i=s.__importStar(i),o=s.__importStar(o);const b=e=>h.getStateAtNamespace(e,g.SEARCH_NAMESPACE_KEY);t.variant=e=>b(e).variant,t.isFullPage=e=>"full-page"===b(e).variant,t.user=e=>b(e).user,t.userOptions=e=>b(e).userOptions,t.loadingState=e=>b(e).loadingState,t.query=e=>b(e).query,t.resultQuery=e=>b(e).resultQuery,t.hasResultQuery=e=>!!b(e).resultQuery,t.normalizedQuery=e=>f.normalize(b(e).query),t.path=e=>b(e).path,t.sessionId=e=>b(e).sessionId,t.requestId=e=>b(e).requestId,t.selection=e=>b(e).selection,t.queryHistory=e=>b(e).queryHistory,t.nextPageOffset=e=>b(e).results.count(),t.cursor=e=>b(e).cursor,t.spellCorrection=e=>b(e).spellCorrection,t.hasMoreResults=e=>b(e).hasMoreResults,t.previewFileId=e=>b(e).previewFileId,t.previewActiveCommentThreadId=e=>b(e).previewCommentsThreadId,t.sortOrder=e=>b(e).sortOrder,t.cachedFullResults=e=>b(e).cachedFullResults,t.cachedFullResultsSortField=e=>b(e).cachedFullResultsSortField,t.fileCategories=e=>b(e).fileCategories,t.context=e=>b(e).context,t.ttiComponents=e=>b(e).ttiComponents,t.searchType=e=>b(e).searchType,t.highlightedRow=e=>b(e).highlightedRow,t.suggestionSectionOrder=e=>b(e).suggestionSectionOrder,t.filteredAccountId=e=>b(e).filteredAccountId,t.peopleSuggestionsCache=e=>b(e).peopleSuggestionsCache,t.lastQueryWithPeopleSuggestionsLoaded=e=>b(e).lastQueryWithPeopleSuggestionsLoaded,t.dwellStartTime=e=>b(e).dwellStartTime,t.queryStartTime=e=>b(e).queryStartTime,t.dateTaken=e=>b(e).dateTaken,t.selectedDimensions=e=>b(e).selectedDimensions,t.mediaData=e=>b(e).mediaData,t.filteredSuggestion=e=>b(e).filteredSuggestion,t.queriesForFields=r.createSelector(t.filteredSuggestion,e=>{if(!(null==e?void 0:e.query))return[];const{type:t,query:s}=e,i="names"===t?E.SearchFields.FileName:"metadata"===t?E.SearchFields.ImageMetadata:void 0;return void 0===i?[]:[{raw_query:s,fields:[i]}]}),t.isCreatingSharedLinkForFile=(e,t)=>Boolean(b(e).isCreatingSharedLinkMap.get(t));const A=()=>m.getSearchCsrfToken();t.viewTypeScope=r.createSelector(t.searchType,e=>e===_.SearchType.IMAGE?w.VIEW_TYPE_SCOPE_IMAGE_SEARCH:w.VIEW_TYPE_SCOPE_TEXT_SEARCH),t.resultsWithoutTags=e=>b(e).results;t.resultsWithTags=r.createSelector(t.resultsWithoutTags,F.selectTagsByFile,e=>{var t;return C.isTaggingEnabled(null===(t=b(e).experiments)||void 0===t?void 0:t.manual_tagging)},t.normalizedQuery,(e,t,s,i)=>s?e.map(e=>{if(e instanceof l.File){const s=t[v.getFileMapKey(e)];void 0!==s&&(e=e.set("tags",s.map(e=>({value:e,highlighted:v.queryContainsTag(i,e.tag_text)}))))}return e}):e),t.numResults=r.createSelector(t.resultsWithoutTags,e=>e.size),t.mediaDataWithHighlights=r.createSelector(t.mediaData,t.normalizedQuery,t.filteredSuggestion,(e,s,i)=>{const a="metadata"===(null==i?void 0:i.type)?i.query:"",r={};for(const i of Object.keys(e)){let o=t.calculateMediaDataDisplayInfo(e[i],s);a&&(o=t.mergeDisplayInfo(e[i],o,t.calculateMediaDataDisplayInfo(e[i],a))),r[i]={data:e[i],display_info:o}}return r});const O=["file_id_or_path","image_height","image_width","date_taken"];t.calculateMediaDataDisplayInfo=(e,t)=>{const s=t.split(/[\s,]+/).filter(e=>""!==e&&!e.startsWith("#"));if(0===s.length)return[];const i=s[s.length-1],a=[];for(const[t,r]of Object.entries(e)){if(O.includes(t)||!r)continue;const e=I(s,i,r);if(e.length){const s=L(e,r);a.push({field_name:t,highlights:s})}}return a},t.mergeDisplayInfo=(e,t,s)=>{const i=[];for(const[r,o]of Object.entries(e)){const e=t.find(e=>e.field_name===r),n=s.find(e=>e.field_name===r);if(!e&&!n)continue;const l=Array(o.length);if(e){let t=0;for(const s of e.highlights)for(const e of s.highlight_str)l[t]=s.is_highlighted,t++}if(n){let e=0;for(const t of n.highlights)for(const s of t.highlight_str)l[e]=l[e]||t.is_highlighted,e++}const c=[];let d=0;for(;-1!==d;){const e=a.findIndex(l,e=>e!==l[d],d);c.push({highlight_str:o.substring(d,-1===e?o.length:e),is_highlighted:l[d]}),d=e}i.push({field_name:r,highlights:c})}return i};const I=(e,t,s)=>{const i=t.toLowerCase(),a=s.toLowerCase(),r=[];for(const t of e){const e=t.toLowerCase(),s=e===i;let o=a.indexOf(e);for(let i=0;i<5&&0<=o;i++){R(e,a,o,s)&&r.push({token:t,index:o}),o=a.indexOf(e,o+1)}}return r},R=(e,t,s,i)=>{const a=s>=0,r=e.length;if(!a||0===r)return!1;const o=s+r===t.length||[" ",","].includes(t[s+r]),n=s>0&&[" ",","].includes(t[s-1]);return(0===s||n)&&(i||o)},L=(e,t)=>{const s=[],i=[...e].sort((e,t)=>e.index-t.index);let a=0;for(const e of i){const{index:i,token:r}=e;if(i<a||t.length<i+r.length)continue;const o=t.substring(i,i+r.length);a===i?s.push({highlight_str:o,is_highlighted:!0}):(s.push({highlight_str:t.substring(a,i),is_highlighted:!1}),s.push({highlight_str:o,is_highlighted:!0})),a=i+o.length}return a<t.length&&s.push({highlight_str:t.substring(a),is_highlighted:!1}),s};t.results=r.createSelector(t.resultsWithTags,t.mediaDataWithHighlights,(e,t)=>t?e.map(e=>{if(e instanceof l.File&&void 0!==t[e.file_id]){const s=t[e.file_id];e=e.set("media_data",s)}return e}):e),t.resultsList=r.createSelector(t.results,e=>e.toList()),t.isNautilusEnabled=r.createSelector(t.userOptions,e=>e&&e.nautilus_enabled),t.isPaperEnabled=r.createSelector(t.userOptions,e=>e&&e.paper_enabled),t.preferredEditors=r.createSelector(t.user,t.userOptions,(e,t)=>e?t&&t.preferred_editors?{[e.id]:t.preferred_editors}:{[e.id]:{}}:{}),t.fileCategoriesString=r.createSelector(t.fileCategories,e=>m.fileCategoriesToString(e)),t.fileCategoriesArray=r.createSelector(t.fileCategories,e=>Object.keys(e).filter(t=>"checked"===e[t])),t.fileCategoriesLogValue=r.createSelector(t.fileCategories,t.isPaperEnabled,(e,t)=>{if(m.allCategoriesUnchecked(e,t))return["all_unchecked"];if(m.allCategoriesChecked(e,t))return["all_checked"];const s=[];return Object.keys(e).forEach(t=>{"checked"===e[t]&&s.push(t)}),s}),t.selectedFiles=r.createSelector(t.results,t.selection,(e,t)=>P(e,t)),t.allFilesSelected=r.createSelector(t.results,t.selectedFiles,(e,t)=>e.size===t.size),t.selectedFilesForSidebar=r.createSelector(t.selectedFiles,d.previewThumbnails,(e,t)=>e.count()>0?e.withMutations(e=>{e.forEach((s,i)=>{var a;if(!s.thumbnail_url_tmpl&&(null===(a=t[s.file_id])||void 0===a?void 0:a.preview_url)){const a=t[s.file_id].preview_url;s instanceof l.File?e.set(i,new l.File(Object.assign(Object.assign({},s),{thumbnail_url_tmpl:a}))):a&&e.set(i,new l.FileSharedWithMe(Object.assign(Object.assign({},s),{thumbnail_url_tmpl:a})))}})}):e),t.selectFilesForSelection=(e,s)=>P(t.results(e),s.selection);const P=(e,t)=>i.OrderedMap(t.selected.toArray().filter(e=>!!e).map(t=>[t,e.find(e=>"fq_path"in e?o.paths_are_equal(e.fq_path,t):e.file_id===t)]).filter(([e,t])=>!!t)),D=r.createSelector(t.resultsList,t.hasMoreResults,(e,t)=>t?e.count()+1:e.count());t.commonLogFields=r.createSelector(t.user,t.path,t.query,t.sessionId,t.requestId,D,t.fileCategoriesLogValue,t.searchType,t.filteredAccountId,(e,t,s,i,a,r,n,l,c)=>e?{user_id:e.id,active_user_id:e.id,path_scoped:!o.paths_are_equal(t),type:l===_.SearchType.IMAGE?"image_search":"single-page",query_string:s,typeahead_session_id:i,timezone_offset:p.getCurrentTimezoneOffset(),request_id:a,result_count:r,file_type_filters:n,search_scoped_to_account_id:c,source:S.searchNavigationManager.source}:{}),t.searchUrl=r.createSelector(t.user,A,t.normalizedQuery,t.path,t.sessionId,t.previewFileId,t.fileCategoriesString,t.searchType,t.sortOrder,t.filteredAccountId,t.dateTaken,t.selectedDimensions,(e,t,s,i,a,r,o,l,d,g,h,p)=>{if(!e)return;const y=c.getQueryArgs().search_from;return m.buildSearchURL({user:e,searchPath:i,searchSessionId:a,searchToken:t,normalizedQuery:s,qargs:{search_from:y&&-1===S.DESKTOP_FROM_PATHS.indexOf(y)?y:void 0,preview:r,file_categories:o||void 0,search_type:l===_.SearchType.ALL?void 0:l,search_order_by:d.sortField===u.SortField.MODIFIED?n.SEARCH_ORDER_BY_TYPE.LAST_MODIFIED_TIME:void 0,search_reverse_order:d.sortDirection===u.SortDirection.ASCENDING?n.SEARCH_REVERSE_ORDER_TYPE.TRUE:void 0,search_account_id:g||void 0,search_date_taken:h!==E.DateTaken.Any?String(h):void 0,search_dimensions:p.length>0?m.dimensionsToURLParam(p):void 0}}).toString()}),t.searchUrlReset=r.createSelector(t.user,A,t.normalizedQuery,t.sessionId,t.searchType,(e,t,s,i,a)=>{if(e)return m.buildSearchURL({user:e,searchPath:"/",searchSessionId:i,searchToken:t,normalizedQuery:s,qargs:{search_from:c.getQueryArgs().search_from||void 0,search_type:a===_.SearchType.ALL?void 0:a}}).toString()}),t.previewFile=r.createSelector(t.previewFileId,t.results,(e,t)=>e?t.find(t=>t instanceof l.File&&t.file_id===e):void 0),t.previewableFiles=r.createSelector(t.resultsList,e=>e.filter(e=>e instanceof l.File&&!e.isDeleted&&!e.is_cloud_doc&&!e.is_dir).toArray()),t.ttiComponentsAllLoaded=r.createSelector(t.ttiComponents,e=>2===e.size),t.hasFiltersSelected=r.createSelector(t.path,t.fileCategoriesArray,t.dateTaken,t.selectedDimensions,(e,t,s,i)=>!(o.paths_are_equal(e,"/")&&0===t.length&&s===E.DateTaken.Any&&0===i.length)),t.querySuggestionsCache=e=>b(e).querySuggestionsCache,t.lastQueryWithQuerySuggestionsLoaded=e=>b(e).lastQueryWithQuerySuggestionsLoaded,t.querySuggestions=r.createSelector(t.querySuggestionsCache,t.normalizedQuery,t.lastQueryWithQuerySuggestionsLoaded,(e,t,s)=>{const i=e[t];return!s||i&&i.loadingState!==E.QuerySuggestionsLoadingState.LOADING?x(e,t):x(e,s)});const x=(e,t)=>{const s=e[t];return s&&s.loadingState===E.QuerySuggestionsLoadingState.LOADED?s.suggestions:void 0};t.querySuggestionsLoadingState=r.createSelector(t.querySuggestionsCache,t.normalizedQuery,(e,t)=>M(e,t));const M=(e,t)=>{const s=e[t];return s?s.loadingState:void 0};t.filteredContact=r.createSelector(t.peopleSuggestionsCache,t.filteredAccountId,(e,t)=>{if(!t)return;const s=e[""];return(s?s.contacts:[]).find(e=>e.dbx_account_id===t)}),t.filteredContactName=r.createSelector(t.filteredContact,e=>e?e.name:void 0),t.peopleSuggestions=r.createSelector(t.peopleSuggestionsCache,t.normalizedQuery,t.lastQueryWithPeopleSuggestionsLoaded,(e,t,s)=>{const i=e[t];return!s||i&&i.loadingState!==E.PeopleSuggestionsLoadingState.LOADING?N(e,t):N(e,s)});const N=(e,t)=>{const s=e[t];return s&&s.loadingState===E.PeopleSuggestionsLoadingState.LOADED?s.contacts.slice(0,Math.min(_.SEARCH_CONTACT_SUGGESTION_CAPACITY,s.contacts.length)):void 0};t.peopleSuggestionsLoadingState=r.createSelector(t.peopleSuggestionsCache,t.normalizedQuery,(e,t)=>{const s=e[t];return s?s.loadingState:void 0}),t.tagsSuggestionsCache=e=>b(e).tagsSuggestionsCache,t.lastQueryWithTagsSuggestionsLoaded=e=>b(e).lastQueryWithTagsSuggestionsLoaded,t.tagsSuggestions=r.createSelector(t.tagsSuggestionsCache,t.normalizedQuery,t.lastQueryWithTagsSuggestionsLoaded,(e,t,s)=>{const i=e[t];return!s||i&&i.loadingState!==E.TagsSuggestionsLoadingState.LOADING?Q(e,t):Q(e,s)});const Q=(e,t)=>{const s=e[t];return s&&s.loadingState===E.TagsSuggestionsLoadingState.LOADED?s.suggestions:void 0};t.tagsSuggestionsLoadingState=r.createSelector(t.tagsSuggestionsCache,t.normalizedQuery,(e,t)=>k(e,t));const k=(e,t)=>{const s=e[t];return s?s.loadingState:void 0};t.popularFiltersCache=e=>b(e).popularFiltersCache,t.lastQueryWithPopularFiltersLoaded=e=>b(e).lastQueryWithPopularFiltersLoaded,t.popularFilters=r.createSelector(t.popularFiltersCache,t.normalizedQuery,t.lastQueryWithPopularFiltersLoaded,t.filteredSuggestion,(e,t,s,i)=>{const a=e[t];if(null==i||!i.type)return!s||a&&a.loadingState!==E.PopularFiltersSuggestionsLoadingState.LOADING?q(e,t):q(e,s)});const q=(e,t)=>{if(t){const s=e[t];return s&&s.loadingState===E.PopularFiltersSuggestionsLoadingState.LOADED?s.counts:void 0}};t.popularFiltersLoadingState=r.createSelector(t.popularFiltersCache,t.normalizedQuery,(e,t)=>j(e,t));const j=(e,t)=>{const s=e[t];return s?s.loadingState:void 0},U=r.createSelector(t.popularFilters,e=>{if(e)return[{searchFilter:"all",count:e.all.count,hasMore:e.all.hasMore},{searchFilter:"names",count:e.names.count,hasMore:e.names.hasMore},{searchFilter:"metadata",count:e.metadata.count,hasMore:e.metadata.hasMore}].filter(e=>e.count>0)});t.allSuggestionData=r.createSelector(t.tagsSuggestions,t.peopleSuggestions,t.querySuggestions,U,(e,t,s,i)=>({[E.SuggestionSection.PEOPLE]:t,[E.SuggestionSection.POPULAR]:i,[E.SuggestionSection.QUERY]:s,[E.SuggestionSection.TAGS]:e})),t.highlightedSuggestionData=r.createSelector(t.allSuggestionData,t.highlightedRow,t.suggestionSectionOrder,(e,t,s)=>{if(void 0===t)return;let i=0;for(const a of s){const s=e[a];if(void 0!==s){if(void 0!==s[t-i])return s[t-i];i+=s.length}}}),t.suggestions=r.createSelector(t.tagsSuggestions,t.peopleSuggestions,t.querySuggestions,U,t.resultQuery,(e,t,s,i,a)=>{const r=[];return i&&r.push({title:T.intl.formatMessage({id:"O8Fciq",defaultMessage:"-"}),suggestionSection:E.SuggestionSection.POPULAR,suggestions:[...i]}),s&&r.push({title:T.intl.formatMessage({id:"A2OQmR",defaultMessage:"Search suggestions"}),suggestionSection:E.SuggestionSection.QUERY,suggestions:s.map(e=>({query:e.text,ariaLabel:T.intl.formatMessage({id:"ZFZrNG",defaultMessage:"Search for {query}"},{query:e.text}),highlightSpans:(e.highlight_spans||[]).map(e=>({string:e.highlight_str,isHighlighted:!!e.is_highlighted}))}))}),t&&r.push({title:T.intl.formatMessage({id:"s3VU9p",defaultMessage:"People"}),suggestionSection:E.SuggestionSection.PEOPLE,suggestions:t.map(e=>({id:e.dbx_account_id,initials:e.name.split(/\s+/).map(e=>"string"==typeof e[0]?e[0].toUpperCase():"").join("").substr(0,2),avatar:e.photo_url||e.avatar_url,name:e.name,nameHighlights:y.getHighlightSpansForName({name:e.name,query:a})||[],emailAddress:e.email,emailAddressHighlights:y.getHighlightSpansForEmail({email:e.email,query:a})||[],ariaLabel:T.intl.formatMessage({id:"1q1f/B",defaultMessage:"Search for {name}"},{name:e.name})}))}),e&&r.push({title:T.intl.formatMessage({id:"hI7tD7",defaultMessage:"Tags"}),suggestionSection:E.SuggestionSection.TAGS,suggestions:e.map(e=>({tag:e.tag_text,isSmartTag:v.isSuggestedTag(e)}))}),r}),t.highlightedSuggestion=r.createSelector(t.suggestions,t.highlightedRow,t.suggestionSectionOrder,(e,t,s)=>{if(void 0===t)return;let i=0;for(const a of s){const s=e.find(e=>e.suggestionSection===a);if(void 0!==s){if(void 0!==s.suggestions[t-i])return s.suggestions[t-i];i+=s.suggestions.length}}}),t.selectResultById=(e,s)=>t.resultsList(e).find(e=>e instanceof l.File?e.fq_path===s.id:e instanceof l.FileSharedWithMe&&e.file_id===s.id),t.showViewModeToggle=e=>!(!t.resultQuery(e)&&!t.filteredAccountId(e)||t.resultsList(e).isEmpty()),t.browseCommentsEnabled=e=>{var t;return"ON"===(null===(t=b(e).experiments)||void 0===t?void 0:t.browse_web_comments)},t.getPage=e=>t.hasResultQuery(e)||t.filteredAccountId(e)?"search_results_page":"front_page"})),define("modules/clean/search/single_page/data/store",["require","exports","modules/clean/react/files_view/data/store","modules/clean/redux/namespaces","modules/clean/redux/store","modules/clean/react/extensions/data/store","modules/clean/search/single_page/data/reducer","modules/clean/tagging/data/store"],(function(e,t,s,i,a,r,o,n){"use strict";let l;Object.defineProperty(t,"__esModule",{value:!0}),t.getStoreForSearch=void 0,t.getStoreForSearch=()=>(l||(l=a.getStoreAndRegisterReducers({[i.SEARCH_NAMESPACE_KEY]:o.searchReducer})),s.getStoreForFilesView(),r.getStore(),n.getStoreForTagging(),l)})),define("modules/clean/search/single_page/filters",["require","exports","tslib","react","react-redux","typescript/component_libraries/retrieval-components/src/file-type-filter/index","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/react/folder_dialog/async","modules/clean/react/path_filter_button","modules/clean/search/constants","modules/clean/search/single_page/constants","modules/clean/search/single_page/data/action_creators/index","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/logger","modules/core/i18n","modules/clean/search/single_page/media_filters/media_filters","modules/clean/search/single_page/data/selectors/experiments","modules/clean/media_filters/gating"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g,h,p,_,m,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchFilters=t.SearchFiltersComponent=void 0,i=s.__importDefault(i),u=s.__importStar(u),g=s.__importStar(g),m=s.__importStar(m);class y extends i.default.PureComponent{constructor(e){super(e),this.handlePathFilterButtonClick=()=>{const{user:e,path:t,setFilters:s}=this.props;e&&n.showFolderDialog({ariaLabel:p.intl.formatMessage({id:"t+qFUO",defaultMessage:"Folder selector"}),canSelectReadonly:!0,initialPath:t,modalName:o.ModalName.SEARCH_FILTER,primaryActionLabel:p.intl.formatMessage({id:"hZgiKR",defaultMessage:"Select"}),title:p.intl.formatMessage({id:"BCJrz5",defaultMessage:"Select a folder"}),user:e,onSuccess:e=>{s({path:e||"/"})},useApiV2:!0})},this.handleFileTypeFilterChange=e=>{const t=Object.assign({},c.FILE_CATEGORIES_UNCHECKED);e.forEach(e=>t[e]="checked"),this.props.setFilters({fileCategories:t}),h.logFileTypeFiltersChanged(e)},this.handleFileTypeFilterDropdownClicked=()=>{this.setState({fileTypeFilterModalOpen:!0})},this.handleFileTypeFilterModalClose=()=>{this.setState({fileTypeFilterModalOpen:!1})},this.setDimensions=e=>{this.props.setFilters({selectedDimensions:e})},this.setDateTaken=e=>{this.props.setFilters({dateTaken:e})},this.state={fileTypeFilterModalOpen:!1}}componentDidMount(){n.prewarmFolderDialog()}get fileTypeFilterEntries(){return this.props.isPaperEnabled?d.FILE_CATEGORIES_PAPER:d.FILE_CATEGORIES_NO_PAPER}render(){const{fileCategories:e,path:t,searchType:s,isScreenWidthMobile:a,selectedDimensions:o,dateTaken:n,shouldShowMediaFilters:d}=this.props,u={entries:this.fileTypeFilterEntries,checkedCategories:e,onChange:this.handleFileTypeFilterChange,strings:{byType:p.intl.formatMessage({id:"Bdz08I",defaultMessage:"By type"}),selectAll:p.intl.formatMessage({id:"Ercy3i",defaultMessage:"Select all"}),clearAll:p.intl.formatMessage({id:"S5TT9D",defaultMessage:"Clear all"})}},{setDimensions:g,setDateTaken:h}=this,m=s!==c.SearchType.IMAGE;return i.default.createElement("div",{className:"search__filters"},i.default.createElement("div",{className:"search__filter search__filter--path"},i.default.createElement(l.PathFilterButton,{path:t,onClick:this.handlePathFilterButtonClick,defaultText:p.intl.formatMessage({id:"1jrD5R",defaultMessage:"Any folder"}),dropdownClasses:"search__filter-button",useDigComponents:!0,fullWidth:!0})),m?i.default.createElement("div",{className:"search__filter search__filter--file-type"},a?i.default.createElement(r.FileTypeFilterButton,Object.assign({},u,{triggerProps:{onClick:this.handleFileTypeFilterDropdownClicked,className:"search__filter-button"}})):i.default.createElement(r.FileTypeFilterDropdown,Object.assign({},u,{triggerProps:{className:"search__filter-button"}})),i.default.createElement(r.FileTypeFilterModal,Object.assign({modalProps:{title:p.intl.formatMessage({id:"197PGq",defaultMessage:"Filter"}),open:this.state.fileTypeFilterModalOpen,onRequestClose:this.handleFileTypeFilterModalClose,withCloseButton:p.intl.formatMessage({id:"2bDlQT",defaultMessage:"Close modal"})}},u))):null,d&&i.default.createElement("div",{className:"search__filter"},i.default.createElement(_.MediaFilters,Object.assign({},{selectedDimensions:o,dateTaken:n,setDimensions:g,setDateTaken:h}))))}}t.SearchFiltersComponent=y,y.displayName="SearchFiltersComponent";const f={setFilters:u.setFilters},E=a.connect(e=>({user:g.user(e),path:g.path(e),fileCategories:g.fileCategoriesArray(e),searchType:g.searchType(e),isPaperEnabled:g.isPaperEnabled(e),hasFiltersSelected:g.hasFiltersSelected(e),dateTaken:g.dateTaken(e),selectedDimensions:g.selectedDimensions(e),shouldShowMediaFilters:S.isMediaFiltersEnabled(m.mediaFiltersVariant(e)),loadingState:g.loadingState(e)}),f);t.SearchFilters=E(y)})),define("modules/clean/search/single_page/header",["require","exports","tslib","react-redux","react","modules/clean/search/constants","modules/clean/search/single_page/data/selectors/index","modules/core/i18n","modules/clean/search/single_page/reset_filters","dig-components/typography","modules/clean/search/single_page/search_view_mode_toggle","modules/clean/react/browse/selection_indicator"],(function(e,t,s,i,a,r,o,n,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchHeader=t.SearchHeaderComponent=void 0,a=s.__importDefault(a),o=s.__importStar(o),t.SearchHeaderComponent=({loadingState:e,hasMoreResults:t,numResults:s,showViewModeToggle:i,responsive:o,selectedFiles:g})=>a.default.createElement("header",{className:"search__header search__header--simplified"},a.default.createElement(c.Title,{className:"search__title"},(function(e,t,s){return e===r.SearchLoadingState.ZERO_QUERY?n.intl.formatMessage({id:"luV4IR",defaultMessage:"Filters"}):e===r.SearchLoadingState.LOADING_FIRST_PAGE?n.intl.formatMessage({id:"uitaX8",defaultMessage:"Searching..."}):t?n.intl.formatMessage({id:"i1llDx",defaultMessage:"{count, plural, one{{count}+ results} other{{count}+ results}}"},{count:s}):n.intl.formatMessage({id:"6J0O1e",defaultMessage:"{count, plural, one{{count} result} other{{count} results}}"},{count:s})})(e,t,s)),a.default.createElement(l.ResetFilters,null),a.default.createElement("div",{className:"search-selection-view-mode-container"},a.default.createElement(u.SelectionIndicator,{responsive:o,selectedFilesCount:g.count(),rightRailCollapsed:!1}),i&&a.default.createElement("div",{className:"search-viewmode-toggle-container"},a.default.createElement(d.SearchViewModeToggle,null)))),t.SearchHeaderComponent.displayName="SearchHeaderComponent";t.SearchHeader=i.connect(e=>({loadingState:o.loadingState(e),hasMoreResults:o.hasMoreResults(e),numResults:o.numResults(e),showViewModeToggle:o.showViewModeToggle(e),selectedFiles:o.selectedFiles(e)}))(t.SearchHeaderComponent)})),define("modules/clean/search/single_page/input/chips",["require","exports","tslib","react","dig-components/chips","dig-components/icons","dig-components/icons/src","dig-components/text_fields","dig-components/tooltips","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/size","modules/clean/filepath/filepath","modules/core/user_i18n"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchChips=void 0,i=s.__importStar(i),c=s.__importDefault(c),g=s.__importStar(g);const p=e=>{var{children:t,tooltipContents:a}=e,r=s.__rest(e,["children","tooltipContents"]);const o=i.createRef(),[n,c]=i.useState(!1);return i.createElement(i.Fragment,null,i.createElement("span",Object.assign({ref:o,onMouseEnter:function(){o.current?o.current.offsetWidth<o.current.scrollWidth&&c(!0):c(!1)},onMouseLeave:function(){c(!1)}},r),t),i.createElement(l.Tooltip.Control,{triggerRef:o,open:n,auto:!0,placement:"bottom"},a))};p.displayName="TooltipIfTruncated";class _ extends i.PureComponent{constructor(){super(...arguments),this.handlePathChipCloseClick=()=>{this.props.setPath({path:"/",viewport:"chip"})},this.handlePeopleFilterChipCloseClick=()=>{const{setFilteredAccountId:e}=this.props;e&&e({filteredAccountId:void 0})},this.handleSuggestionChipCloseClick=()=>{const{setFilteredSearchSuggestion:e}=this.props;e&&e({type:void 0,query:""})}}render(){const{path:e,user:t,filteredContact:s,filteredSuggestion:a,hideText:r}=this.props;return!(g.paths_are_equal(e,"/")&&!s&&(null==a||!a.type))?i.createElement(n.TextInput.ChipsContainer,null,g.paths_are_equal(e,"/")?null:i.createElement(m,{path:g.filename(e),isTeamMemberFolder:g.paths_are_equal(t&&t.cdm_tmf_path,e),onCloseClick:this.handlePathChipCloseClick,hideText:r}),s?i.createElement(S,{filteredContact:s,onCloseClick:this.handlePeopleFilterChipCloseClick,hideText:r}):null,a&&a.type?i.createElement(f,{filteredSuggestion:a,onCloseClick:this.handleSuggestionChipCloseClick,hideText:r}):null):i.createElement(i.Fragment,null)}}t.SearchChips=_,_.displayName="SearchChips";const m=({path:e,onCloseClick:t,hideText:s})=>i.createElement(a.InputChip,{size:"small",className:"search-chips__chip",withIconLeft:i.createElement(r.UIIcon,{src:o.FolderFill,size:"small"}),onDelete:t,onClick:y,type:"button",tabIndex:-1},!s&&i.createElement(p,{className:"search-chips__chip-text",tooltipContents:e},e)),S=({filteredContact:e,onCloseClick:t,hideText:s})=>i.createElement(a.InputChip,{size:"small",className:"search-chips__chip",onClick:y,tabIndex:-1,type:"button",withAvatarLeft:i.createElement(c.default,{dimension:u.AvatarSize.XSMALL,photoUrl:e.photo_url,shape:"CIRCLE",defaultAvatar:i.createElement(d.InitialsAvatarWithColorDerivedFromName,{dimension:u.AvatarSize.XSMALL,name:e.name,initials:h.getInitials(e.name),shape:"CIRCLE"})}),onDelete:t},!s&&i.createElement(p,{className:"search-chips__chip-text",tooltipContents:e.name},e.name));function y(e){e.preventDefault(),e.stopPropagation()}S.displayName="PeopleFilterChip";const f=({filteredSuggestion:e,onCloseClick:t,hideText:s})=>i.createElement(a.InputChip,{size:"small",className:"search-chips__chip",withIconLeft:"metadata"===e.type?i.createElement(r.UIIcon,{src:o.ImageLine,size:"small"}):i.createElement(r.UIIcon,{src:o.FileLine,size:"small"}),onDelete:t,onClick:y,type:"button",tabIndex:-1},!s&&i.createElement(p,{className:"search-chips__chip-text",tooltipContents:e.query||""},e.query||""))})),define("modules/clean/search/single_page/input/connected",["require","exports","tslib","react-redux","modules/clean/search/single_page/data/action_creators/popular_filters","modules/clean/search/single_page/data/action_creators/index","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/input/component","modules/clean/react/files_page/data/action_creators"],(function(e,t,s,i,a,r,o,n,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedSearchInput=void 0,a=s.__importStar(a),r=s.__importStar(r),o=s.__importStar(o),n=s.__importStar(n),c=s.__importStar(c);const d={setQuery:r.setQuery,setPath:r.setPath,clear:r.clear,dismissQuerySuggestions:r.dismissQuerySuggestions,setHighlightedRow:r.setHighlightedRow,setFilteredAccountId:r.setFilteredAccountId,dismissPeopleSuggestions:r.dismissPeopleSuggestions,dismissTagsSuggestions:r.dismissTagsSuggestions,onSearch:r.performSearch,dismissPopularFilters:a.dismissPopularFilters,setFilteredSearchSuggestion:r.setFilteredSearchSuggestion,setIsActiveInGlobalHeader:c.setIsActiveInGlobalHeader};t.ConnectedSearchInput=i.connect(e=>({query:o.query(e),path:o.path(e),highlightedRow:o.highlightedRow(e),highlightedSuggestionData:o.highlightedSuggestionData(e),allSuggestionData:o.allSuggestionData(e),filteredContact:o.filteredContact(e),results:o.resultsList(e),manualTaggingVariant:n.manualTaggingVariant(e),filteredSuggestion:o.filteredSuggestion(e)}),d)(l.SearchInputComponent)})),define("modules/clean/search/single_page/input/suggestions",["require","exports","tslib","react","react-redux","typescript/component_libraries/retrieval-components/src/search-suggestions/index","modules/clean/search/single_page/data/action_creators/index","modules/clean/search/single_page/data/action_creators/popular_filters","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/logger","modules/clean/media_filters/gating","modules/clean/search/types","modules/clean/search/search_helpers","modules/clean/tagging/experiments"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g,h,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectedSearchSuggestions=t.SearchSuggestionsComponent=void 0,i=s.__importDefault(i),o=s.__importStar(o),n=s.__importStar(n),l=s.__importStar(l),c=s.__importStar(c),d=s.__importStar(d);class _ extends i.default.PureComponent{constructor(){super(...arguments),this.dismissSuggestions=()=>{this.props.dismissQuerySuggestions({query:this.props.normalizedQuery}),this.props.dismissPeopleSuggestions({query:this.props.normalizedQuery}),p.isTaggingEnabled(this.props.manualTaggingVariant)&&this.props.dismissTagsSuggestions({query:h.normalizeForTagsSuggestions(this.props.normalizedQuery)}),u.isPopularFiltersSearchEnabled(this.props.mediaFiltersVariant)&&this.props.dismissPopularFilters({query:h.normalizeForTagsSuggestions(this.props.normalizedQuery)}),this.props.setHighlightedRow({index:void 0}),this.props.onFocusInput&&this.props.onFocusInput()},this.handleSuggestionClick=e=>{if(r.isQuerySuggestion(e))d.logQuerySuggestionClicked(this.getGroupIndexOfSuggestion(e),this.props.querySuggestions),this.props.setQuery({query:e.query,alwaysTriggerSearch:!0});else if(r.isTagsSuggestion(e)){d.logTagSuggestionsClicked(this.getGroupIndexOfSuggestion(e),this.props.tagsSuggestions);const t=h.updateQueryWithTagsSuggestion(this.props.normalizedQuery,e.tag);this.props.setQuery({query:t,alwaysTriggerSearch:!0})}else r.isPopularFiltersSuggestion(e)?(d.logTypeaheadSuggestionClicked(e.searchFilter,e.count),h.handleTypeaheadSuggestionClicked(e.searchFilter,this.props.normalizedQuery,this.props.setQuery,this.props.setFilteredSearchSuggestion)):(d.logPeopleFilterClicked(this.getGroupIndexOfSuggestion(e),this.props.peopleSuggestions.length),this.props.setFilteredAccountId({filteredAccountId:e.id}),this.props.setQuery({query:""}));this.dismissSuggestions()},this.handleSuggestionHighlight=e=>{e?this.props.setHighlightedRow({index:this.getGlobalIndexOfSuggestion(e)}):this.props.setHighlightedRow({index:void 0})},this.getGlobalIndexOfSuggestion=e=>{let t=0;for(const s of this.props.suggestionSectionOrder){const i=this.props.suggestions.find(e=>e.suggestionSection===s);if(void 0!==i){for(let s=0;s<=i.suggestions.length;s+=1)if(i.suggestions[s]===e)return s+t;t+=i.suggestions.length}}},this.getGroupIndexOfSuggestion=e=>{for(const t of this.props.suggestions)for(let s=0;s<=t.suggestions.length;s+=1)if(t.suggestions[s]===e)return s}}componentDidMount(){this.shouldLogQuerySuggestionsShown()&&d.logQuerySuggestionsDisplayed(this.props.querySuggestions),this.shouldLogPeopleSuggestionsShown()&&d.logPeopleFilterShown(this.props.peopleSuggestions.length),this.shouldLogTagsSuggestionsShown()&&d.logTagSuggestionsDisplayed(this.props.tagsSuggestions),this.shouldLogPopularFiltersShown()&&d.logTypeaheadSuggestionsDisplayed(this.props.popularFilters)}componentDidUpdate(e){!this.shouldLogQuerySuggestionsShown()||this.shouldLogQuerySuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||d.logQuerySuggestionsDisplayed(this.props.querySuggestions),!this.shouldLogPeopleSuggestionsShown()||this.shouldLogPeopleSuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||d.logPeopleFilterShown(this.props.peopleSuggestions.length),!this.shouldLogTagsSuggestionsShown()||this.shouldLogTagsSuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||d.logTagSuggestionsDisplayed(this.props.tagsSuggestions),!this.shouldLogPopularFiltersShown()||this.shouldLogPopularFiltersShown(e)&&this.props.normalizedQuery===e.normalizedQuery||d.logTypeaheadSuggestionsDisplayed(this.props.popularFilters)}shouldLogQuerySuggestionsShown(e=this.props){return e.querySuggestionsLoadingState===g.QuerySuggestionsLoadingState.LOADED&&this.shouldShowQuerySuggestions(e)}shouldLogPeopleSuggestionsShown(e=this.props){return e.peopleSuggestionsLoadingState===g.PeopleSuggestionsLoadingState.LOADED&&this.shouldShowPeopleSuggestions(e)}shouldShowQuerySuggestions({normalizedQuery:e,querySuggestions:t}=this.props){return!!e&&!!t&&!!t.length}shouldShowPeopleSuggestions({normalizedQuery:e,filteredAccountId:t,peopleSuggestions:s}=this.props){return!(!e||t||!s||!s.length)}shouldLogTagsSuggestionsShown(e=this.props){return e.tagsSuggestionsLoadingState===g.TagsSuggestionsLoadingState.LOADED&&this.shouldShowTagsSuggestions(e)}shouldShowTagsSuggestions({normalizedQuery:e,tagsSuggestions:t,manualTaggingVariant:s}=this.props){return p.isTaggingEnabled(s)&&!!h.normalizeForTagsSuggestions(e)&&!!t&&!!t.length}shouldShowPopularFilters({normalizedQuery:e,popularFilters:t,mediaFiltersVariant:s}=this.props){return u.isPopularFiltersSearchEnabled(s)&&!!e.length&&!!t&&t.all.count>0}shouldLogPopularFiltersShown(e=this.props){return e.popularFiltersLoadingState===g.PopularFiltersSuggestionsLoadingState.LOADED&&this.shouldShowPopularFilters(e)}render(){const{suggestions:e,highlightedSuggestion:t,manualTaggingVariant:s,normalizedQuery:a,suggestionSectionOrder:o}=this.props,n=this.shouldShowQuerySuggestions(),l=this.shouldShowPeopleSuggestions(),c=this.shouldShowTagsSuggestions(),d=this.shouldShowPopularFilters();return n||l||c||d?i.default.createElement("div",{className:"search__dropdown"},i.default.createElement(r.SearchSuggestions,{suggestions:e,suggestionSectionOrder:o,onSuggestionClick:this.handleSuggestionClick,onSuggestionHighlight:this.handleSuggestionHighlight,ariaLabel:"",highlightedSuggestion:t,showTagsSuggestions:p.isTaggingEnabled(s),query:a,popularFilters:d?this.props.popularFilters:void 0})):null}}t.SearchSuggestionsComponent=_,_.displayName="SearchSuggestionsComponent";const m={setQuery:o.setQuery,dismissQuerySuggestions:o.dismissQuerySuggestions,setHighlightedRow:o.setHighlightedRow,dismissPeopleSuggestions:o.dismissPeopleSuggestions,setFilteredAccountId:o.setFilteredAccountId,dismissTagsSuggestions:o.dismissTagsSuggestions,dismissPopularFilters:n.dismissPopularFilters,setFilteredSearchSuggestion:o.setFilteredSearchSuggestion},S=a.connect(e=>({suggestions:c.suggestions(e),highlightedSuggestion:c.highlightedSuggestion(e),suggestionSectionOrder:c.suggestionSectionOrder(e),querySuggestions:c.querySuggestions(e),normalizedQuery:c.normalizedQuery(e),user:c.user(e),querySuggestionsLoadingState:c.querySuggestionsLoadingState(e),peopleSuggestionsLoadingState:c.peopleSuggestionsLoadingState(e),filteredAccountId:c.filteredAccountId(e),peopleSuggestions:c.peopleSuggestions(e),tagsSuggestions:c.tagsSuggestions(e),tagsSuggestionsLoadingState:c.tagsSuggestionsLoadingState(e),popularFilters:c.popularFilters(e),popularFiltersLoadingState:c.popularFiltersLoadingState(e),manualTaggingVariant:l.manualTaggingVariant(e),mediaFiltersVariant:l.mediaFiltersVariant(e)}),m);t.ConnectedSearchSuggestions=S(_)})),define("modules/clean/search/single_page/logger",["require","exports","tslib","lodash","modules/clean/filepath/filepath","modules/clean/logging/hive/schemas/search-web_search_activity","modules/clean/logging/telemetry","modules/clean/react/browse/models","modules/clean/search/constants","modules/clean/search/logger","modules/clean/search/types","modules/clean/web_user_action_events","modules/clean/search/single_page/data/store","modules/clean/search/single_page/data/selectors/index","modules/clean/tagging/utils"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g,h,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logTypeaheadSuggestionRemoved=t.logTypeaheadSuggestionClicked=t.logTypeaheadSuggestionsDisplayed=t.logHistoryClickedInEmptyStateExperiment=t.logEmptyStateLoaded=t.logEnrichedMediaDataReceived=t.logDimensionFilterChange=t.logDateTakenChange=t.logTagSuggestionsFailed=t.logTagSuggestionsFetched=t.logTagSuggestionsDismissed=t.logTagSuggestionsClicked=t.logTagSuggestionsDisplayed=t.logNavigateToResult=t.logQueryTyped=t.logSearchBoxFocus=t.logContextMenuClick=t.logPeopleFilterRemoved=t.logPeopleFilterClicked=t.logPeopleFilterShown=t.logPeopleFilterResponse=t.logSortOrderChanged=t.logFieldsFromResult=t.logQuerySuggestionsFailed=t.logQuerySuggestionsFetched=t.logQuerySuggestionsDismissed=t.logQuerySuggestionClicked=t.logQuerySuggestionsDisplayed=t.logSpellCorrectionClicked=t.logSpellCorrectionShown=t.logFiltersReset=t.logFileTypeFiltersChanged=t.logDwellTime=t.logImageSearchPromptShown=t.logSwitchSearchType=t.logScopeChipChanged=t.logHistoryCleared=t.logHistoryClicked=t.logHistoryClickedInEmptyState=t.logHistoryAdded=t.logHistoryDisplayed=t.logResultAction=t.logQueryFailed=t.logQueryCompleted=t.logQueryStarted=t.hiveLogger=t.SEARCH_EMPTY_STATE_ENTRY_POINT=t.EMPTY_STATE_EXPERIMENT_ENTRY_POINT=void 0,i=s.__importStar(i),o=s.__importStar(o),h=s.__importStar(h),t.EMPTY_STATE_EXPERIMENT_ENTRY_POINT="empty_state_experiment",t.SEARCH_EMPTY_STATE_ENTRY_POINT="search_empty_state",t.hiveLogger=new o.HiveLogger;const _=()=>h.commonLogFields(g.getStoreForSearch().getState()),m=e=>e!==l.SearchOriginPathway.WEB?{pathway:e}:void 0;t.logQueryStarted=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_started"},_()),{start:0,result_count:void 0,extra:m(e)})))},t.logQueryCompleted=(e,i,a,o,n)=>{let l=Object.assign(Object.assign({event_name:"query_completed"},_()),{latency:e});if(void 0!==a&&void 0!==o&&void 0!==n){const e={};Object.entries(o).forEach(([t,s])=>{e[t]=s.toString()}),l=Object.assign(Object.assign({},l),{extra:Object.assign({tag_count:a.toString(),tag_action_surface:n},e)})}if(i){const{extra:e={}}=l,t=s.__rest(l,["extra"]);e.media_metadata_search="ON",l=Object.assign(Object.assign({},t),{extra:e})}t.hiveLogger.log(new r.SearchWebSearchActivityRow(l))},t.logQueryFailed=(e,s,i)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_failed"},_()),{latency:e,failure_type:s,extra:m(i)})))},t.logResultAction=(e,s,i,a,o,n)=>{const l=Object.assign(Object.assign(Object.assign({event_name:"result_action"},_()),t.logFieldsFromResult(i)),{action_type:e,position:s.indexOf(i),action_source:o});l.extra=Object.assign(Object.assign({},n),l.extra),a&&(l.extra=Object.assign(Object.assign({},l.extra),{action_surface:a})),t.hiveLogger.log(new r.SearchWebSearchActivityRow(l))},t.logHistoryDisplayed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"recent_history_displayed"},_()),{recent_history_map:e.map(e=>e.rawQuery).reduce((e,t,s)=>(e[s]=t,e),{})})))},t.logHistoryAdded=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"recent_query_stored"},_()),{position:e})))},t.logHistoryClickedInEmptyState=(e,s)=>{t.logHistoryClicked(e,s,t.SEARCH_EMPTY_STATE_ENTRY_POINT)},t.logHistoryClicked=(e,s,i)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"recent_query_selected"},_()),{query_string:e,position:s,extra:i?{entry_point:i}:void 0})))},t.logHistoryCleared=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"recent_history_cleared"},_())))},t.logScopeChipChanged=(e,s)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"scope_chip_changed"},_()),{file_path:e,viewport:s})))},t.logSwitchSearchType=(e,s,i)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"switch_search_type"},_()),{request_id:e,extra:{search_type:s,ref:i}})))},t.logImageSearchPromptShown=(e,s)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"image_search_prompt_shown"},_()),{request_id:e,extra:{type:s}})))},t.logDwellTime=(e,s)=>{const i=h.resultQuery(g.getStoreForSearch().getState());t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"dwell_time"},_()),{query_string:i,view_type:s,extra:{dwell_time:e.toString()}})))},t.logFileTypeFiltersChanged=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"file_type_filter_changed"},_()),{file_type_filters:e})))},t.logFiltersReset=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"filters_reset"},_())))},t.logSpellCorrectionShown=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"spell_correct_shown"},_()),{request_id:e.requestId,extra:{is_corrected:e.isCorrected.toString()}})))},t.logSpellCorrectionClicked=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"spell_correct_clicked"},_()),{request_id:e.requestId,extra:{is_corrected:e.isCorrected.toString()}})))},t.logQuerySuggestionsDisplayed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_suggestions_displayed"},_()),{result_count:e.length,query_suggestion_strings:e.map(e=>e.text?e.text:"")})))},t.logQuerySuggestionClicked=(e,s)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_suggestions_clicked"},_()),{position:e,result_count:s.length,query_suggestion_strings:s.map(e=>e.text?e.text:"")})))},t.logQuerySuggestionsDismissed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_suggestions_dismissed"},_()),{query_string:e})))},t.logQuerySuggestionsFetched=(e,s,i)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_suggestions_fetched"},_()),{query_string:e,result_count:s,latency:i})))},t.logQuerySuggestionsFailed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_suggestions_failed"},_()),{query_string:e})))},t.logFieldsFromResult=e=>e instanceof n.File?{deleted:e.isDeleted,file_extension:a.file_extension_for_logging(e.fq_path),file_last_edited:e.ts,file_name:a.filename(e.fq_path),file_nsid:`${e.ns_id}`,file_size:e.bytes,file_sjid:`${e.sjid}`,match_type:e.match_type,result_id:`${e.ns_id}:${e.sjid}`}:e instanceof n.Paper?{paper_pad_id:e.pad_id,result_id:e.pad_id}:e instanceof n.PaperFolder?{paper_folder_id:e.folder_id,result_id:e.folder_id}:e instanceof n.FileSharedWithMe?{deleted:!1,file_extension:a.file_extension_for_logging(e.filename),file_last_edited:e.ts,file_name:a.filename(e.filename),file_size:e.bytes,match_type:e.match_type,result_id:e.file_id,extra:{result_type:e.is_cloud_doc?c.SearchLogResultType.SHARED_CLOUD_DOC:c.SearchLogResultType.SHARED_DOC}}:{},t.logSortOrderChanged=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"sort_results"},_()),{extra:{sort_field:e.sortField,sort_direction:e.sortDirection}})))},t.logPeopleFilterResponse=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"people_filter_response"},_()),{result_count:e})))},t.logPeopleFilterShown=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"people_filter_shown"},_()),{result_count:e})))},t.logPeopleFilterClicked=(e,s,i)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"people_filter_clicked"},_()),{position:e,result_count:s,extra:i?{entry_point:i}:void 0})))},t.logPeopleFilterRemoved=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"people_filter_removed"},_())))},t.logContextMenuClick=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"context_menu_click"},_())))},t.logSearchBoxFocus=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"search_box_focus"},_())))},t.logQueryTyped=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"query_typed"},_()),{query_string:e})))},t.logNavigateToResult=(e,s,i,a)=>{const r=s instanceof n.Paper||s instanceof n.PaperFolder?u.WebUserActionLogEvent.PAPER_OPEN:u.WebUserActionLogEvent.FILE_VIEW;t.logResultAction(r,e,s,i,a)},t.logTagSuggestionsDisplayed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"tag_suggestions_displayed"},_()),{tag_suggestions_count:e.length.toString(),tag_suggestions_strings:e.map(e=>e.tag_text)})))},t.logTagSuggestionsClicked=(e,s)=>{const i=s[e],a=p.getTagType(i);t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"tag_suggestions_clicked"},_()),{position:e,tag_suggestions_count:s.length.toString(),tag_suggestions_strings:s.map(e=>e.tag_text),extra:{tag_type:a}})))},t.logTagSuggestionsDismissed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"tag_suggestions_dismissed"},_()),{query_string:e})))},t.logTagSuggestionsFetched=(e,s)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"tag_suggestions_fetched"},_()),{query_string:e,tag_suggestions_count:s.toString()})))},t.logTagSuggestionsFailed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"tag_suggestions_failed"},_()),{query_string:e})))},t.logDateTakenChange=(e,s)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"date_filter_changed"},_()),{extra:{date_filter:d.DateTaken[s],entry_point:e}})))},t.logDimensionFilterChange=(e,s)=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"dimension_filter_changed"},_()),{dimension_filter:s.map(e=>d.Dimensions[e]),extra:{entry_point:e}})))},t.logEnrichedMediaDataReceived=(e,s)=>{const a=i.sumBy(e,e=>i.isEmpty(h.calculateMediaDataDisplayInfo(e,s))?0:1);t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"enriched_media_data_received"},_()),{extra:{num_of_results_with_media_data_highlights:a.toString()}})))},t.logEmptyStateLoaded=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"empty_state_loaded"},_())))},t.logHistoryClickedInEmptyStateExperiment=(e,s)=>{t.logHistoryClicked(e,s,t.EMPTY_STATE_EXPERIMENT_ENTRY_POINT)},t.logTypeaheadSuggestionsDisplayed=e=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"typeahead_suggestions_displayed"},_()),{extra:{search_filters:JSON.stringify(Object.keys(e))}})))},t.logTypeaheadSuggestionClicked=(e,s)=>{const i=s||0;t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign(Object.assign({event_name:"typeahead_suggestions_clicked"},_()),{result_count:i,extra:{search_filter:e}})))},t.logTypeaheadSuggestionRemoved=()=>{t.hiveLogger.log(new r.SearchWebSearchActivityRow(Object.assign({event_name:"typeahead_suggestions_removed"},_())))}})),define("modules/clean/search/single_page/media_filters/media_api",["require","exports","tslib","api_v2/default_user_client","modules/clean/react/files_view/util"],(function(e,t,s,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enrichedMediaDataFromApi=void 0,t.enrichedMediaDataFromApi=function(e,t){return s.__awaiter(this,void 0,void 0,(function*(){const s=t.filter(a.isFile).map(e=>e.file_id);if(0===s.length)return{enriched_media_data:[]};const r=new i.DefaultUserApiV2Client(e),o={file_id_or_paths:s};return yield r.ns("media_tags_search").rpc("get_enriched_media_data",o,{})}))}})),define("modules/clean/search/single_page/preview",["require","exports","tslib","react-redux","react","modules/clean/react/browse/constants","modules/clean/search/single_page/data/action_creators/index","modules/clean/search/single_page/data/selectors/index","modules/constants/python"],(function(e,t,s,i,a,r,o,n,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchPreview=t.SearchPreviewComponent=void 0,a=s.__importDefault(a),o=s.__importStar(o),n=s.__importStar(n);class c extends a.default.PureComponent{constructor(){super(...arguments),this.closeFileViewer=()=>{new Promise((t,s)=>{e(["modules/clean/react/file_viewer/controller"],t,s)}).then(s.__importStar).then(e=>{e.close()})},this.handleFlipNext=()=>{const{previewFile:e,previewableFiles:t,setPreviewFileId:s}=this.props;if(!e||t.length<2)return;let i=t.indexOf(e);i<0||(i+=1,i>=t.length&&(i=0),s({previewFileId:t[i].file_id}))},this.handleFlipPrevious=()=>{const{previewFile:e,previewableFiles:t,setPreviewFileId:s}=this.props;if(!e||t.length<2)return;let i=t.indexOf(e);i<0||(i-=1,i<0&&(i=t.length-1),s({previewFileId:t[i].file_id}))},this.showFileViewer=()=>{const{user:t,previewableFiles:i,setPreviewFileId:a,setPreviewCommentsThreadId:r,previewFile:o,previewActiveCommentThreadId:n}=this.props;t&&o&&new Promise((t,s)=>{e(["modules/clean/react/file_viewer/controller"],t,s)}).then(s.__importStar).then(e=>{e.open(i,i.indexOf(o),t,c.containerId,{fileViewAction:l.FileViewActionType.CLICK,fileViewOrigin:l.FileViewOriginType.SEARCH,fileViewTarget:l.FileViewTargetType.PRIVATE,skipOuterRouting:!0,disableRouting:!0,onCloseViewer:()=>{r({previewCommentsThreadId:void 0}),a({previewFileId:void 0})},onFlipNext:this.handleFlipNext,onFlipPrevious:this.handleFlipPrevious,activeCommentThreadId:n})})}}componentDidMount(){this.showFileViewer()}componentDidUpdate(e){if(e.previewFile&&!this.props.previewFile)return this.props.setPreviewCommentsThreadId({previewCommentsThreadId:void 0}),void this.closeFileViewer();e.previewFile||!this.props.previewFile?e.previewFile&&this.props.previewFile&&this.props.previewFile.file_id!==e.previewFile.file_id&&this.showFileViewer():this.showFileViewer()}static get containerId(){return document.getElementById("react-file-viewer")?"react-file-viewer":r.BROWSE_FILE_VIEWER_ELEMENT_ID}render(){return null}}t.SearchPreviewComponent=c,c.displayName="SearchPreviewComponent";const d={setPreviewFileId:o.setPreviewFile,setPreviewCommentsThreadId:o.setPreviewCommentsThreadId};t.SearchPreview=i.connect(e=>({user:n.user(e),previewFile:n.previewFile(e),previewableFiles:n.previewableFiles(e),previewActiveCommentThreadId:n.previewActiveCommentThreadId(e)}),d)(c)})),define("modules/clean/search/single_page/tabs",["require","exports","tslib","react-redux","react","spectrum/tabbed_header/index","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index"],(function(e,t,s,i,a,r,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchTabs=t.SearchTabsComponent=void 0,a=s.__importDefault(a),o=s.__importStar(o),n=s.__importStar(n);class l extends a.default.PureComponent{render(){const{onSwitchTab:e,searchType:t,tabs:s}=this.props;return s&&s.length?a.default.createElement(r.TabbedHeader,{activeTabId:t,onSelection:e,className:"search__tabs"},s.map(({id:s,label:i})=>a.default.createElement(r.Tab,{id:s,key:s,active:s===t,onClick:()=>e(s,"tab"),className:"search__tab"},a.default.createElement("span",{className:"search__tab--contents"},i)))):null}}t.SearchTabsComponent=l,l.displayName="SearchTabsComponent";t.SearchTabs=i.connect(e=>({searchType:n.searchType(e),tabs:o.tabs(e)}),{})(l)})),define("modules/clean/search/single_page/utils",["require","exports","tslib","modules/clean/browse_uri_interface","modules/clean/react/browse/models","modules/clean/search/store_helpers","modules/core/browser"],(function(e,t,s,i,a,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.navigateToResult=t.getHighlightSpansForEmail=t.getHighlightSpansForName=t.getEscapedSearchQuery=t.getIdForSearchResult=t.generateRandomId=void 0,r=s.__importStar(r),t.generateRandomId=r.generateRandomId,t.getIdForSearchResult=e=>e instanceof a.File?e.file_id||e.fq_path:e instanceof a.Paper?e.pad_id:e instanceof a.PaperFolder?e.folder_id:e instanceof a.FileSharedWithMe?e.file_id:"",t.getEscapedSearchQuery=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),t.getHighlightSpansForName=({name:e,query:s})=>{if(!s)return;const i=t.getEscapedSearchQuery(s),a=new RegExp(`(^${i})|(\\s${i})`,"gi"),r=[];let o;for(;null!==(o=a.exec(e));)r.push({start:o.index,end:o.index+o[0].length});if(0===r.length)return;const n=[];let l=0;for(;l<e.length&&r.length>0;){const t=r.shift();l<t.start&&n.push({string:e.substring(l,t.start),isHighlighted:!1}),n.push({string:e.substring(t.start,t.end),isHighlighted:!0}),l=t.end}return l<e.length&&n.push({string:e.substring(l),isHighlighted:!1}),n},t.getHighlightSpansForEmail=({email:e,query:s})=>{if(!e||!s)return;const i=t.getEscapedSearchQuery(s),a=e.indexOf(i);if(-1===a)return;const r=[];return a>0&&r.push({string:e.substring(0,a),isHighlighted:!1}),r.push({string:e.substring(a,a+i.length),isHighlighted:!0}),a+i.length<e.length&&r.push({string:e.substring(a+i.length),isHighlighted:!1}),r},t.navigateToResult=(e,t,s)=>{const r=s?o.open_tab:o.redirect;e instanceof a.File&&r(i.href_for_file(t,e)),(e instanceof a.Paper||e instanceof a.PaperFolder)&&r(e.url),e instanceof a.FileSharedWithMe&&r(e.href)}})),define("modules/clean/search/single_page/view",["require","exports","tslib","classnames","lodash","react","react-intl","react-redux","dig-components/typography","modules/clean/browse_uri_interface","modules/clean/filepath/filepath","modules/clean/media_filters/gating","modules/clean/react/async/loadable","modules/clean/react/components/css","modules/clean/react/extensions/data/selectors","modules/clean/react/file_viewer/async_controller","modules/clean/react/files_view/data/action_creators","modules/clean/react/files_view/data/selectors/files_view_selectors","modules/clean/react/files_view/data/selectors/instance_selectors","modules/clean/react/files_view/types","modules/clean/react/files_view/util","modules/clean/react/files_view/view_type","modules/clean/search/constants","modules/clean/search/search_results/view","modules/clean/search/single_page/data/action_creators/file_actions","modules/clean/search/single_page/data/action_creators/index","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/data/store","modules/clean/search/single_page/logger","modules/clean/search/single_page/navigation","modules/clean/search/single_page/preview","modules/clean/search/single_page/search_header_container","modules/clean/search/single_page/zero_query/index","modules/clean/sharing/browse_exports","modules/clean/user_survey/user_survey","modules/clean/web_timing_logger","modules/clean/web_user_action_events","modules/constants/python","modules/core/browser","modules/core/i18n","modules/core/uri"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g,h,p,_,m,S,y,f,E,T,w,v,F,C,b,A,O,I,R,L,P,D,x,M,N,Q,k,q,j,U){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncErrorComponent=t.SearchView=t.ConnectedSearchViewWithProvider=t.SearchViewComponent=void 0,i=s.__importDefault(i),a=s.__importStar(a),r=s.__importDefault(r),d=s.__importStar(d),p=s.__importStar(p),m=s.__importStar(m),S=s.__importStar(S),y=s.__importStar(y),F=s.__importStar(F),C=s.__importStar(C),b=s.__importStar(b),A=s.__importStar(A),I=s.__importStar(I),q=s.__importStar(q);class V extends r.default.PureComponent{constructor(t){super(t),this.starredStoreListenerUnsubscribe=()=>{},this.scrollContainer=r.default.createRef(),this.handleGetOverflowMenuActions=(e,t,s)=>[new Array],this.handleRenderSharedWithController=()=>null,this.handleGetIsFileJumping=()=>!1,this.handleIsFileViewerShown=()=>!!this.props.previewFile,this.handleShowShare=(e,t)=>{I.logResultAction(Q.WebUserActionLogEvent.SHARE,this.props.results,e),M.UserSurvey.trackEvent("share_item","browse"),x.asyncShowShareModal(this.props.user,e,{browseContext:this.props.context,origin:t})},this.handleSwitchViewType=e=>{this.props.setViewType({viewType:e,viewTypeScope:this.props.viewTypeScope,user:this.props.user})},this.filesViewActionHandlers={onDelete:t=>{new Promise((t,s)=>{e(["modules/clean/react/browse/file_actions/action_handlers"],t,s)}).then(s.__importStar).then(({handleDelete:e})=>{e({user:this.props.user,files:t,isSearchMode:!0,viewType:this.props.viewType},this.props.context)})},onShowRename:e=>{this.props.setFileRename({file:e,renameState:f.RenameState.PENDING_INPUT})},onSetClipboard:a.noop,onPasteFromClipboard:a.noop,onNewFolderSubmit:a.noop,onNewFolderCancel:a.noop,onRenameSubmit:(e,t)=>{this.props.renameFile({file:e,name:t,checkFSWs:!0})},onRenameCancel:e=>this.props.setFileRename({file:e,renameState:null}),onSwitchViewType:this.handleSwitchViewType,onColumnsChanged:a.noop,onCanDisplayFolderSizesChanged:a.noop,onAddFileJumpKeyCode:a.noop,onResetFileJump:a.noop,onShowShare:this.handleShowShare,onPresentInZoom:e=>{_.asyncOpenPreview({containerId:L.SearchPreviewComponent.containerId,files:[e],indexOfPreviewFile:0,shouldFocusComment:!1,user:this.props.user,onFileViewerDidMount:()=>{},onFileViewerUnmount:()=>{},fileViewAction:k.FileViewActionType.CLICK,fileViewOrigin:k.FileViewOriginType.SEARCH,fileViewTarget:k.FileViewTargetType.PRIVATE,shouldPresentInZoom:!0})}},this.handleSelectionChange=(e,t)=>{this.props.setSelection({selection:e,actionSource:t})},this.handleSearch=(e,t,s)=>{void 0===t||d.paths_are_equal(t,this.props.path)||this.props.setPath({path:t}),e!==this.props.normalizedQuery&&this.props.setQuery({query:e,alwaysTriggerSearch:!0})},this.handleLocationLinkClick=(e,t)=>{I.logResultAction(Q.WebUserActionLogEvent.CLICK_PATH_LINK,this.props.results,e),t||R.searchNavigationManager.set(c.get_browse_root(this.props.user)+U.URI.encode_parts(d.parent_dir(e.fq_path)))},this.handleOpenPaper=e=>{I.logResultAction(Q.WebUserActionLogEvent.PAPER_OPEN,this.props.results,e),q.redirect(e.url)},this.handleFileSharedWithMe=e=>{I.logResultAction(Q.WebUserActionLogEvent.FILE_VIEW,this.props.results,e),q.redirect(e.href)},this.handleRangeInView=(e,t)=>{this.props.loadingState===w.SearchLoadingState.LOADED&&this.props.hasMoreResults&&t===this.props.results.size-(this.props.viewType===T.ViewType.List?1:0)&&this.props.fetchNextPage()},this.handleSortOrderChanged=(e,t)=>{this.props.setSortOrder({sortOrder:{sortField:e,sortDirection:t}})},this.handleFocusSearchBar=()=>{this.props.inputBox.current&&this.props.inputBox.current.focus()},this.handleStarClick=(e,t)=>{I.logResultAction(t?Q.WebUserActionLogEvent.STAR:Q.WebUserActionLogEvent.REMOVE_STAR,this.props.results,e)},this.onContainerClick=e=>{E.shouldClickDeselect(e)&&this.props.clearSelection({actionSource:Q.ActionSourceValue.WHITESPACE})},this.state={arePostTTIModulesLoaded:!1},t.loadViewTypes({user:t.user}),t.loadHistory()}componentDidMount(){return s.__awaiter(this,void 0,void 0,(function*(){this.props.handleComponentTTI({component:"view",query:this.props.resultQuery}),yield N.waitForTTI();const[{StarredStore:t}]=yield Promise.all([new Promise((t,s)=>{e(["modules/clean/react/starred/browse_exports"],t,s)}).then(s.__importStar)]);this.starredStoreListenerUnsubscribe=t.addListener(()=>{this.setState({starredState:t.getLoadingStates()})}),this.setState({arePostTTIModulesLoaded:!0})}))}componentWillMount(){window.addEventListener("beforeunload",this.props.stopAndLogDwellTime)}componentDidUpdate(e){this.props.handleComponentTTI({component:"view",query:this.props.resultQuery}),this.props.onTTI&&this.props.ttiComponentsAllLoaded&&!e.ttiComponentsAllLoaded&&this.props.onTTI()}componentWillUnmount(){window.removeEventListener("beforeunload",this.props.stopAndLogDwellTime),this.starredStoreListenerUnsubscribe(),this.props.stopAndLogDwellTime()}hrefForFile(e,t){return c.href_for_file(e,t,{context:"search"})}render(){const{user:e,responsive:s,results:n,context:l,loadingState:c,resultQuery:d,path:g,searchSessionId:h,viewType:p,selection:_,selectedFiles:m,searchType:S,filteredContactName:y,inputBox:f,requestId:E,setFilters:T,mediaFiltersVariant:F,filteredSuggestion:C}=this.props,b=s.isMatchedLarge;if(c===w.SearchLoadingState.LOAD_ERROR)return r.default.createElement(t.AsyncErrorComponent,null);if(c===w.SearchLoadingState.ZERO_QUERY){const e=u.isMediaFiltersEnabled(F)&&!1,t="/"!==g||!!C&&""!==C.query;return r.default.createElement("div",null,e&&r.default.createElement(P.SearchHeaderContainer,{responsive:s,isRightRailV2Enabled:!0,searchType:S,requestId:E,setFilters:T}),r.default.createElement(D.ZeroQueryView,{inputBox:f,isFilterInSearch:t}))}const A=this.props.results.isEmpty()&&this.props.loadingState===w.SearchLoadingState.LOADED;A&&u.isOrganizedRetrievalSurveyEnabled(F)&&M.UserSurvey.trackEvent("organized_search_no_results","search_bar"),A&&!d.includes("#")&&M.UserSurvey.trackEvent("generic_search_no_results","search");const O=i.default("search__view","maestro-content-scroll",{"maestro-content-scroll_scroll-disabled":c===w.SearchLoadingState.LOADING_FIRST_PAGE,"maestro-content-scroll--horizontal-scrollable":b});return r.default.createElement(o.RawIntlProvider,{value:j.intl},r.default.createElement(L.SearchPreview,null),r.default.createElement("div",{className:"search-view-container",onClick:this.onContainerClick},r.default.createElement(P.SearchHeaderContainer,{responsive:s,isRightRailV2Enabled:!0,searchType:S,requestId:E,setFilters:T}),r.default.createElement("div",{className:O,ref:this.scrollContainer},r.default.createElement("div",null,A?r.default.createElement(B,{hasFiltersSelected:this.props.hasFiltersSelected,resetFiltersUrl:this.props.searchUrlReset,onResetFilters:this.props.resetFilters}):r.default.createElement("div",{className:"search-view--sticky-hack"},r.default.createElement(v.SearchResultsView,{filesViewActionHandlers:this.filesViewActionHandlers,searchResultsExperiments:this.props.searchResultsExperiments,browseExperiments:this.props.browseExperiments,maestroSearchBarProps:{},onFocusSearchBar:this.handleFocusSearchBar,onSearch:this.handleSearch,onScroll:a.noop,setFileUploaderPath:a.noop,onSelectionChange:this.handleSelectionChange,path:g,user:e,handleComponentTTI:a.noop,ensureFileViewerClosedIfNotPreviewing:a.noop,getIsFileJumping:this.handleGetIsFileJumping,isFileViewerShown:this.handleIsFileViewerShown,fileRename:this.props.fileRename,arePostTTIModulesLoaded:this.state.arePostTTIModulesLoaded,getOverflowMenuActions:this.handleGetOverflowMenuActions,onLocationLinkClick:this.handleLocationLinkClick,onNavigateToFileOrFolder:this.props.handleNavigateToFileOrFolder,onNavigateToParentFolder:a.noop,onOpenFileSharedWithMe:this.handleFileSharedWithMe,onOpenPaper:this.handleOpenPaper,context:l,hasMoreResults:!!this.props.hasMoreResults,loadingState:c,latestQuery:d,queryForResultsTitle:d,searchSessionId:h,searchResults:n,selection:_,selectedFiles:m,viewType:p,viewTypeScope:this.props.viewTypeScope,renderSharedWithController:this.handleRenderSharedWithController,hrefForFile:this.hrefForFile,responsive:s,onSearchFiltersChanged:this.props.setFilters,starredState:this.state.starredState,fileCategories:this.props.fileCategories,onSortChange:this.handleSortOrderChanged,searchType:S,sharingServiceInfo:this.props.sharingServiceInfo,onRangeInView:this.handleRangeInView,currentSort:this.props.sortOrder,onStarClick:this.handleStarClick,scrollContainer:this.scrollContainer,filteredContactName:y,isColumnResizingEnabled:b,useSkinnyCheckboxes:!0,mediaFiltersVariant:this.props.mediaFiltersVariant}))))))}}t.SearchViewComponent=V,V.displayName="SearchViewComponent";const W=O.getStoreForSearch(),H={setPath:C.setPath,setQuery:C.setQuery,setViewType:m.setViewType,loadViewTypes:m.loadViewTypes,setSelection:C.setSelection,clearSelection:C.clearSelection,loadHistory:C.loadHistory,setPreviewFile:C.setPreviewFile,setFileRename:m.setFileRename,handleComponentTTI:C.handleComponentTTI,fetchNextPage:C.fetchNextPage,renameFile:F.renameFile,setSortOrder:C.setSortOrder,restoreFiles:C.restoreFiles,setFilters:C.setFilters,resetFilters:C.resetFilters,stopAndLogDwellTime:C.stopAndLogDwellTime,handleNavigateToFileOrFolder:C.handleNavigateToFileOrFolder},z=n.connect(e=>({normalizedQuery:A.normalizedQuery(e),resultQuery:A.resultQuery(e),loadingState:A.loadingState(e),results:A.resultsList(e),path:A.path(e),searchSessionId:A.sessionId(e),requestId:A.requestId(e),viewType:y.selectViewType(e,{instanceId:w.SEARCH_FILES_VIEW_ID}),selectedFiles:A.selectedFiles(e),selection:A.selection(e),history:A.queryHistory(e),previewFile:A.previewFile(e),extensionsFeatureFlags:p.getFeatureFlags(e),sharingServiceInfo:p.sharingServiceInfo(e),fileCategories:A.fileCategories(e),context:A.context(e),fileRename:S.fileRename(e),hasMoreResults:A.hasMoreResults(e),searchType:A.searchType(e),sortOrder:A.sortOrder(e),searchResultsExperiments:b.searchResultsExperiments(e),browseExperiments:b.browseExperiments(e),hasFiltersSelected:A.hasFiltersSelected(e),searchUrlReset:A.searchUrlReset(e),preferredEditors:A.preferredEditors(e),experiments:b.experiments(e),shouldRenderTabs:b.shouldRenderTabs(e),filteredContactName:A.filteredContactName(e),shouldRenderInlineSearchFilters:b.shouldRenderInlineSearchFilters(e),ttiComponentsAllLoaded:A.ttiComponentsAllLoaded(e),viewTypeScope:A.viewTypeScope(e),mediaFiltersVariant:b.mediaFiltersVariant(e),filteredSuggestion:A.filteredSuggestion(e)}),H)(V);t.ConnectedSearchViewWithProvider=e=>r.default.createElement(n.Provider,{store:W},r.default.createElement(z,Object.assign({},e)));const G=g.Loadable({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{DogDigsSpot:t}=yield new Promise((t,s)=>{e(["dig-illustrations/spot/dog-digs"],t,s)}).then(s.__importStar);return t}))});t.SearchView=h.requireCssWithComponent(t.ConnectedSearchViewWithProvider,["/static/css/search/view-vflylZpJv.css","/static/css/browse/browse-vflZqGIkH.css","/static/css/browse/files_view-vfll4fmOM.css","/static/css/search/search_results-vflyvvipJ.css","/static/css/dig-illustrations/index.web-vflCpkDG_.css"]);const B=({hasFiltersSelected:e,resetFiltersUrl:t,onResetFilters:s})=>r.default.createElement("div",{className:"search__view search__view--empty",id:"search-view"},r.default.createElement("div",{className:"search__view--illustration"},r.default.createElement(G,null)),r.default.createElement(l.Title,null,j.intl.formatMessage({id:"ZY55+d",defaultMessage:"No results found"})),r.default.createElement(l.Text,null,e?j.intl.formatMessage({id:"00FN2D",defaultMessage:"Try <LinkScope>resetting all filters</LinkScope>"},{LinkScope:e=>{return r.default.createElement("a",{href:t,onClick:(i=s,e=>{e.preventDefault(),i()})},e);var i}}):j.intl.formatMessage({id:"PtdLen",defaultMessage:"Try different keywords"})));B.displayName="NoResultsView",t.AsyncErrorComponent=g.Loadable({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{ErrorComponent:t}=yield new Promise((t,s)=>{e(["modules/clean/react/browse/components/post_tti/error"],t,s)}).then(s.__importStar);return t})),loading:()=>r.default.createElement("div",null,j.intl.formatMessage({id:"eU2b7o",defaultMessage:"Something went wrong. Please reload the page."})),loadError:()=>r.default.createElement("div",null,j.intl.formatMessage({id:"eU2b7o",defaultMessage:"Something went wrong. Please reload the page."}))})})),define("modules/clean/search/single_page/zero_query/history",["require","exports","tslib","react","react-redux","dig-components/buttons","dig-components/icons","dig-components/icons/src","spectrum/media_table/index","spectrum/table/index","dig-components/typography","ts-key-enum","modules/clean/search/single_page/data/action_creators/index","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/logger","modules/core/i18n"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g,h,p,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SearchHistoryViewInEmptyState=t.SearchHistoryView=t.SearchHistoryRow=t.SearchHistoryComponent=void 0,i=s.__importDefault(i),g=s.__importStar(g),h=s.__importStar(h),p=s.__importStar(p),_=s.__importStar(_);class S extends i.default.PureComponent{constructor(){super(...arguments),this.handleHistoryClick=(e,t)=>{this.props.setQuery({query:e.normalizedQuery,alwaysTriggerSearch:!0}),this.focusInputBox(),_.logHistoryClickedInEmptyState(e.normalizedQuery,t)},this.handleClearClick=()=>{this.props.user&&(this.props.clearHistory(),this.focusInputBox())},this.focusInputBox=()=>{this.props.inputBox.current&&this.props.inputBox.current.focus()}}componentDidMount(){this.props.shouldRenderHistory&&_.logHistoryDisplayed(this.props.history)}componentDidUpdate(e){this.props.shouldRenderHistory&&e.shouldRenderHistory&&_.logHistoryDisplayed(this.props.history)}render(){const{history:e,shouldRenderHistory:t}=this.props;return t?i.default.createElement(c.Table,{className:"search__history",columnFlex:[10,"70px"],"aria-rowcount":e.length,"aria-describedby":"search__history-header"},i.default.createElement(c.TableHead,null,i.default.createElement(c.TableHeadCell,{id:"search__history-header"},m.intl.formatMessage({id:"pz0pE7",defaultMessage:"Recent searches"})),i.default.createElement(c.TableHeadCell,{align:"right"},i.default.createElement(r.Button,{onClick:this.handleClearClick,className:"search__history-clear",variant:"transparent",hasNoUnderline:!0},m.intl.formatMessage({id:"KZTpUR",defaultMessage:"Clear all"})))),i.default.createElement(c.TableBody,null,e.map((e,t)=>i.default.createElement(y,{key:`history-${t}`,history:e,index:t,onClick:this.handleHistoryClick})))):null}}t.SearchHistoryComponent=S,S.displayName="SearchHistoryComponent";class y extends i.default.PureComponent{constructor(){super(...arguments),this.handleClick=()=>{this.props.onClick(this.props.history,this.props.index)},this.handleKeyDown=e=>{switch(e.key){case" ":case u.Key.Enter:this.props.onClick(this.props.history,this.props.index)}}}render(){return i.default.createElement(l.MediaRow,{onClick:this.handleClick,className:"search__history-item",tabIndex:0,onKeyDown:this.handleKeyDown},({isHovered:e})=>[i.default.createElement(l.MediaCell,{key:"text",icon:i.default.createElement(o.UIIcon,{src:n.SearchLine}),title:this.props.history.rawQuery,highlight:e})])}}t.SearchHistoryRow=y,y.displayName="SearchHistoryRow";const f=e=>({history:p.queryHistory(e),shouldRenderHistory:h.shouldRenderHistory(e),user:p.user(e)}),E={setQuery:g.setQuery,clearHistory:g.clearAllHistory};t.SearchHistoryView=a.connect(f,E)(S);const T=e=>{const{history:t,inputBox:s,shouldRenderHistory:a}=e,r=(t,s)=>{e.setQuery({query:t.normalizedQuery,alwaysTriggerSearch:!0}),o(),_.logHistoryClickedInEmptyStateExperiment(t.normalizedQuery,s)},o=()=>{s.current&&s.current.focus()};return a?i.default.createElement(i.default.Fragment,null,t.length>0&&i.default.createElement(d.Title,{size:"small",className:"search_empty_row_header"},m.intl.formatMessage({id:"5ih958",defaultMessage:"Recent searches"})),i.default.createElement(c.Table,{className:"search__history-experiment",columnFlex:[10,"70px"],"aria-rowcount":t.length,"aria-describedby":"search__history-header"},i.default.createElement(c.TableBody,null,t.map((e,t)=>i.default.createElement(y,{key:`history-${t}`,history:e,index:t,onClick:r}))))):null};T.displayName="SearchHistoryInEmptyStateComponent",t.SearchHistoryViewInEmptyState=a.connect(f,E)(T)})),define("modules/clean/search/single_page/zero_query/index",["require","exports","tslib","classnames","react","react-redux","ts-key-enum","modules/clean/search/single_page/logger","modules/clean/tagging/logger","dig-components/typography","modules/clean/tagging/components/tags_container","modules/clean/react/home/recents/components/recent_activity_container","modules/clean/media_filters/gating","modules/clean/react/async/loadable","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/zero_query/history","modules/clean/search/single_page/zero_query/suggested_people","modules/clean/search/single_page/data/action_creators/index","modules/clean/tagging/experiments","modules/core/i18n","modules/clean/tagging/data/selectors/index","modules/clean/tagging/data/action_creators","modules/clean/tagging/utils","modules/clean/tagging/utils","spectrum/media_table_skeleton/index"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g,h,p,_,m,S,y,f,E,T,w,v,F,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZeroQueryView=t.ZeroQueryComponent=t.AsyncLookBinocularsSpot=t.AsyncDogDigsSpot=t.AsyncLookMagnifyingGlassSpot=void 0,i=s.__importDefault(i),a=s.__importDefault(a),n=s.__importStar(n),l=s.__importStar(l),p=s.__importStar(p),y=s.__importStar(y),v=s.__importStar(v),t.AsyncLookMagnifyingGlassSpot=h.Loadable({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{LookMagnifyingGlassSpot:t}=yield new Promise((t,s)=>{e(["dig-illustrations/spot/look-magnifying-glass"],t,s)}).then(s.__importStar);return t}))}),t.AsyncDogDigsSpot=h.Loadable({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{DogDigsSpot:t}=yield new Promise((t,s)=>{e(["dig-illustrations/spot/dog-digs"],t,s)}).then(s.__importStar);return t}))}),t.AsyncLookBinocularsSpot=h.Loadable({loader:()=>s.__awaiter(void 0,void 0,void 0,(function*(){const{LookBinocularsSpot:t}=yield new Promise((t,s)=>{e(["dig-illustrations/spot/look-binoculars"],t,s)}).then(s.__importStar);return t}))});class b extends a.default.PureComponent{constructor(){super(...arguments),this.handleKeyDown=e=>{e.key===o.Key.Escape&&this.props.inputBox.current&&this.props.inputBox.current.focus()}}render(){const{shouldRenderEmptyZeroQueryView:e,inputBox:t,manualTaggingVariant:s,mediaFiltersVariant:r,searchEmptyStateVariant:o,setFilteredAccountId:n,isFilterInSearch:l}=this.props;return p.isEmptyStateExperiment(o)?a.default.createElement(R,{inputBox:t,manualTaggingEnabled:f.isTaggingEnabled(s),setFilteredAccountId:n,isFilterInSearch:l}):a.default.createElement("div",{className:i.default({search__view:!0,"search__view--empty":e}),id:"search-view",onKeyDown:this.handleKeyDown},a.default.createElement(m.SearchHistoryView,{inputBox:t}),a.default.createElement(A,Object.assign({},{shouldRenderEmptyZeroQueryView:e,manualTaggingVariant:s,mediaFiltersVariant:r})))}}t.ZeroQueryComponent=b,b.displayName="ZeroQueryComponent";const A=({shouldRenderEmptyZeroQueryView:e,manualTaggingVariant:t,mediaFiltersVariant:s})=>e?g.isMediaFiltersEnabled(s)?a.default.createElement(D,null):f.isTaggingEnabled(t)?a.default.createElement(P,null):a.default.createElement(L,null):null,O=()=>a.default.createElement("div",{className:"search__view--container"},a.default.createElement(c.Text,{color:"faint"},a.default.createElement(a.default.Fragment,null,E.intl.formatMessage({id:"h9MZVT",defaultMessage:"After your team creates tags, you'll have quick access to them here."}),a.default.createElement(c.Link,{href:"https://help.dropbox.com/files-folders/sort-preview/dropbox-tags",variant:"primary",hasNoUnderline:!0,target:"_blank",rel:"noopener noreferrer"},E.intl.formatMessage({id:"buAEr/",defaultMessage:"Learn about tags"})))));O.displayName="TagsEmptyStateOneLine";const I=({allTagsSuggestions:e,onTagClick:t})=>void 0===e?a.default.createElement("div",{className:"search__view--loading-section"},a.default.createElement(C.MediaTableSkeletonRow,null)):0===e.length?a.default.createElement(O,null):a.default.createElement(d.TagsContainer,{tags:F.textTagsToUserGeneratedTags(e.slice(0,5)),onTagClick:t});I.displayName="TagsSection";const R=({inputBox:t,manualTaggingEnabled:d,setFilteredAccountId:g,isFilterInSearch:h})=>{const p=r.useDispatch(),y=r.useSelector(_.user);a.default.useEffect(()=>{n.logEmptyStateLoaded()},[]);const f=r.useSelector(T.selectAllTagsSuggestions),F=f?f.map(e=>e.tag_text):void 0,C=d&&!h,b=!h;a.default.useEffect(()=>{p(w.fetchAllTagsSuggestions({user:y}))},[]),a.default.useEffect(()=>{s.__awaiter(void 0,void 0,void 0,(function*(){const{loadRecentItems:t,loadPaperRecentItems:i}=yield new Promise((t,s)=>{e(["modules/clean/react/home/recents/store_utils_post_tti"],t,s)}).then(s.__importStar);t(),i(!1)}))},[]);return a.default.createElement("div",{className:i.default({search__view:!0,"search__view--experiment":!0,"home-access":!0}),id:"search-view",onKeyDown:e=>{e.key===o.Key.Escape&&t.current&&t.current.focus()}},a.default.createElement(c.Title,{size:"small",className:"search_empty_page_title"},E.intl.formatMessage({id:"JCuJcm",defaultMessage:"More ways to find your files"})),a.default.createElement(m.SearchHistoryViewInEmptyState,{inputBox:t}),b&&a.default.createElement(M,{title:E.intl.formatMessage({id:"L4YihC",defaultMessage:"People"})},a.default.createElement(S.SuggestedPeopleContainer,{userId:y.id,onSelect:(e,t,s)=>{n.logPeopleFilterClicked(t,s,n.EMPTY_STATE_EXPERIMENT_ENTRY_POINT),g({filteredAccountId:e.account_id})}})),C&&a.default.createElement(M,{title:E.intl.formatMessage({id:"W5QoBG",defaultMessage:"Tags"})},a.default.createElement(I,{allTagsSuggestions:F,onTagClick:e=>{l.logTagClick(y,[],"search_empty_state",e),v.redirectToSearchByTag(y,e.tag_text)}})),a.default.createElement(M,{title:E.intl.formatMessage({id:"vLMeBO",defaultMessage:"Recent files"})},a.default.createElement(u.RecentActivityContainerInSearchEmptyState,{className:"search_empty_page_recent_activity",key:"recent-activity-view",now:new Date,canRenderItems:!0,isHiddenByUser:!1,showHeader:!1,showAll:!1,fullItemView:!1,loggedComponentName:"search_empty_state",showSkeletonWhenLoading:!0})))};R.displayName="SearchEmptyState";const L=()=>a.default.createElement(a.default.Fragment,null,a.default.createElement("div",{className:"search__view--illustration"},a.default.createElement(t.AsyncDogDigsSpot,null)),a.default.createElement(c.Title,null,E.intl.formatMessage({id:"MgR2x6",defaultMessage:"Begin typing to search"})),a.default.createElement(c.Text,{color:"faint",style:{textAlign:"center"}},E.intl.formatMessage({id:"CzRGuP",defaultMessage:"Search for files, folders, and content"})));L.displayName="RegularEmptyState";const P=()=>a.default.createElement(a.default.Fragment,null,a.default.createElement("div",{className:"search__view--illustration"},a.default.createElement(t.AsyncLookMagnifyingGlassSpot,null)),a.default.createElement(c.Title,null,E.intl.formatMessage({id:"HL+qET",defaultMessage:"Find files faster with #tags"})),a.default.createElement(c.Text,{color:"faint",style:{textAlign:"center"}},a.default.createElement(a.default.Fragment,null,E.intl.formatMessage({id:"IkMIV7",defaultMessage:"Search by name, contents, people, or tags."}),a.default.createElement("br",null),E.intl.formatMessage({id:"tqPF/r",defaultMessage:"Want to tag? Select a file or folder to get started."}))));P.displayName="TagsEmptyState";const D=()=>a.default.createElement(a.default.Fragment,null,a.default.createElement("div",{className:"search__view--illustration"},a.default.createElement(t.AsyncLookBinocularsSpot,null)),a.default.createElement(c.Title,null,E.intl.formatMessage({id:"FAygqJ",defaultMessage:"New ways to find your photos"})),a.default.createElement(c.Text,{color:"faint",style:{textAlign:"center"}},E.intl.formatMessage({id:"M6Nh+K",defaultMessage:"Type “dog” to get your dog photos. Looking for{br}pics of a certain size, or from a given date? Try{br}the image properties filter."},{br:a.default.createElement("br",null)})));D.displayName="MediaFiltersEmptyState";const x={setFilteredAccountId:y.setFilteredAccountId};t.ZeroQueryView=r.connect(e=>({shouldRenderEmptyZeroQueryView:p.shouldRenderEmptyZeroQueryView(e),manualTaggingVariant:p.manualTaggingVariant(e),mediaFiltersVariant:p.mediaFiltersVariant(e),searchEmptyStateVariant:p.searchEmptyStateVariant(e)}),x)(b);const M=({title:e,children:t})=>a.default.createElement("div",null,a.default.createElement(c.Title,{size:"small",className:"search_empty_row_header"},e),t);M.displayName="EmptyStateSection"})),define("typescript/component_libraries/retrieval-components/src/file-type-filter/index",["require","exports","tslib","classnames","react","dig-components/buttons","dig-components/controls","dig-components/menu","dig-components/modal","dig-components/tooltips","dig-components/typography","spectrum/icon_content/index","dig-components/chips"],(function(e,t,s,i,a,r,o,n,l,c,d,u,g){"use strict";function h({strings:e,entries:t,checkedCategories:s,onChange:i}){return a.createElement("header",{className:"rc-ftf-header"},a.createElement(d.Text,{size:"small",isBold:!0,color:"faint"},e.byType),a.createElement(r.Button,{variant:"transparent",onClick:()=>{if(E(t,s))i([]);else{const e=t.map(e=>e.category);i(T(e))}},size:"small"},E(t,s)?e.clearAll:e.selectAll))}Object.defineProperty(t,"__esModule",{value:!0}),t.areAllEntriesUnchecked=t.areAllEntriesChecked=t.FileTypeFilterDropdown=t.FileTypeFilterButton=t.FileTypeFilterModal=t.FileTypeFilterRow=t.FileTypeFilter=void 0,i=s.__importDefault(i),a=s.__importStar(a);class p extends a.Component{constructor(){super(...arguments),this.handleChange=(e,t)=>{const{checkedCategories:s,onChange:i}=this.props;let a=s.filter(e=>e!==t);e&&(a=[...a,t]),i(T(a))}}render(){const{entries:e,checkedCategories:t}=this.props;return a.createElement("div",{className:"rc-ftf"},a.createElement(h,Object.assign({},this.props)),a.createElement("ul",{className:"rc-ftf-list"},e.map(e=>a.createElement(_,Object.assign({key:e.label},e,{checked:t.indexOf(e.category)>-1,onChange:this.handleChange})))))}}t.FileTypeFilter=p,p.displayName="FileTypeFilter";class _ extends a.Component{constructor(){super(...arguments),this.handleChange=e=>{const{onChange:t,category:s}=this.props;t(e.currentTarget.checked,s)}}render(){const{label:e,icon:t,checked:s,tooltip:r}=this.props;return a.createElement("li",null,a.createElement(d.Text,{tagName:"label",htmlFor:e,className:i.default({"rc-ftf-list__row":!0,"rc-ftf-list__row--checked":s})},a.createElement(o.Checkbox,{checked:s,onChange:this.handleChange,name:e,id:e}),(n=a.createElement("span",{className:"rc-ftf-list__row-name"},e),l=e,a.cloneElement(n,{onMouseEnter:function(e){e.currentTarget.title=e.currentTarget.scrollWidth>e.currentTarget.clientWidth?l:"",n.props.onMouseEnter&&n.props.onMouseEnter(e)}})),a.createElement(c.Tooltip,{placement:"left",title:r},a.createElement("span",null,a.createElement(f,{icon:t})))));var n,l}}t.FileTypeFilterRow=_,_.displayName="FileTypeFilterRow";class m extends a.Component{render(){const e=this.props,{modalProps:t}=e,i=s.__rest(e,["modalProps"]);return a.createElement(l.Modal,Object.assign({},t),a.createElement(l.Modal.Header,{hasBottomSpacing:"title-small"},a.createElement(d.Title,{size:"small"},t.title)),a.createElement(l.Modal.Body,null,a.createElement(p,Object.assign({},i))))}}t.FileTypeFilterModal=m,m.displayName="FileTypeFilterModal";class S extends a.Component{render(){const{entries:e,checkedCategories:t,strings:s,triggerProps:i}=this.props,r=e.filter(e=>t.indexOf(e.category)>-1),o=1===r.length?r[0].label:s.byType;return a.createElement(g.FilterChip,Object.assign({},i,{withDropdownIcon:!0,className:"rc-ftf-button"}),r.length>1?`${o} • ${r.length}`:o)}}t.FileTypeFilterButton=S,S.displayName="FileTypeFilterButton";class y extends a.Component{constructor(){super(...arguments),this.handleSelection=e=>{this.props.checkedCategories.includes(e)?this.props.onChange([...this.props.checkedCategories].filter(t=>t!==e)):this.props.onChange([...this.props.checkedCategories,e])},this.handleOnMenuToggle=e=>{this.props.onMenuToggle&&this.props.onMenuToggle(e.isOpen)}}render(){const{entries:e,checkedCategories:t}=this.props;return a.createElement(n.Menu.Wrapper,{closeOnSelection:!1,onSelection:this.handleSelection,onToggle:this.handleOnMenuToggle},({getContentProps:s,getTriggerProps:i})=>a.createElement(a.Fragment,null,a.createElement(S,Object.assign({},this.props,{triggerProps:i()})),a.createElement(n.Menu.Content,Object.assign({},s(),{className:"rc-ftf-dropdown"}),a.createElement(h,Object.assign({},this.props)),a.createElement(n.Menu.Segment,null,e.map(({category:e,icon:s,label:i})=>a.createElement(n.Menu.ActionItem,{key:e.toString(),value:e,"data-test-checked":t.indexOf(e)>-1,withLeftAccessory:a.createElement(o.Checkbox,{checked:t.indexOf(e)>-1,readOnly:!0,tabIndex:-1}),withRightAccessory:a.createElement(f,{icon:s})},i))))))}}t.FileTypeFilterDropdown=y,y.displayName="FileTypeFilterDropdown";const f=({icon:e})=>a.createElement("span",{className:"rc-ftf-list__row-icon-content"},"string"==typeof e?a.createElement(u.IconContent,{name:e,role:"presentation"}):e);function E(e,t){return e.every(e=>t.indexOf(e.category)>-1)}function T(e){const t=new Set;e.forEach(e=>t.add(e));const s=[];return t.forEach(e=>s.push(e)),s}f.displayName="FilterEntryIcon",t.areAllEntriesChecked=E,t.areAllEntriesUnchecked=function(e){return 0===e.length}}));
//# sourceMappingURL=pkg-search.min.js-vflw97ROf.map