define(["require","exports","api_v2/redux/previews","typescript/libraries/file-viewer/src/core/data/actions"],(function(e,t,s,r){"use strict";function n(e){return t=>void 0===t||""==t?"":e(new URL(t))}function a(e){return e?e.split(/,\s?/g).map(e=>{const t=e.split(/\s+/g);return[t[0],t[1]]}):[]}function i(e){const t=n(e),s=(function(e){const t=null==e?e=>e.toString():t=>e(t);return e=>{const s=new URL(e);return s.searchParams.append("sheet","SHEET_PLACEHOLDER"),s.searchParams.append("tile","TILE_PLACEHOLDER"),t(s)}})(e),r=(function(e){return t=>{if(!t)return"";const s=new URL(t);return s.pathname=s.pathname.replace("/p/html/","/p/html_desktop/"),e(s)}})(e);return e=>{var n;if(!e.preview||!e.preview.content)return e;const{preview:i}=e;if(!i.content)return e;switch(i.content[".tag"]){case"image":return Object.assign(Object.assign({},e),{preview:Object.assign(Object.assign({},i),{preview_url:t(i.preview_url),content:Object.assign(Object.assign({},i.content),{full_size_src:t(i.content.full_size_src),default_src:t(i.content.default_src),src_set:a(i.content.src_set).map(([e,s])=>`${t(e)} ${s}`).join(","),thumbnail_url_tmpl:null!==(n=t(i.content.thumbnail_url_tmpl))&&void 0!==n?n:""})})});case"excel":{const t=s(i.content.tile_url_tmpl);return Object.assign(Object.assign({},e),{preview:Object.assign(Object.assign({},i),{content:Object.assign(Object.assign({},i.content),{tile_url_tmpl:t})})})}case"html":const c=r(i.preview_url);return Object.assign(Object.assign({},e),{preview:Object.assign(Object.assign({},i),{preview_url:c})})}return e}}Object.defineProperty(t,"__esModule",{value:!0}),t.assetUrlRewrite=void 0;t.assetUrlRewrite=function(e){const t=null!=e?e:e=>e.toString(),c=(e=>{const t=i(e);return e=>{const s=e.results.map(t);return Object.assign(Object.assign({},e),{results:s})}})(t),l=n(t);return e=>e=>t=>(t.type===s.Action.GetPreviewDataBatchResult?t.payload.result&&(t.payload.result=c(t.payload.result)):t.type===r.Action.FetchPageDataWithMetadataResult?t.payload.data&&Array.isArray(t.payload.data.pages)&&t.payload.data.pages.forEach(e=>{e.thumbnailUrl=l(e.thumbnailUrl),e.imgUrls["1x"]=l(e.imgUrls["1x"]),e.imgUrls["4x"]=l(e.imgUrls["4x"]),e.imgUrls.srcset=a(e.imgUrls.srcset).map(([e,t])=>`${l(e)} ${t}`).join(",")}):t.type===r.Action.PrewarmUnifiedPreviewAsset&&t.payload.assetUrl&&(t.payload.assetUrl=l(t.payload.assetUrl)),e(t))}}));
//# sourceMappingURL=asset_url_rewrite.amd.min.js-vflNDLpR2.map