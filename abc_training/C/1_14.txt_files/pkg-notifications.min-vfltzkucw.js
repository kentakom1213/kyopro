define("modules/clean/react/user_notifications/notification_tray_logger",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery"],(function(e,t,i,n){"use strict";function o(e){n.SilentBackgroundRequest({url:"/log/notif_tray_events",data:{event_dict:JSON.stringify(e)}})}Object.defineProperty(t,"__esModule",{value:!0}),t.logMarkAllAsRead=t.logTrayOpen=void 0,n=i.__importStar(n),t.logTrayOpen=function(e){o({event_name:"tray_popup_shown",badge_count:e})},t.logMarkAllAsRead=function(){o({event_name:"mark_all_as_read"})}})),define("modules/clean/photos/batch_thumb_loader",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","modules/constants/env","modules/core/uri"],(function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BatchThumbLoader=void 0,n=i.__importStar(n),o=i.__importStar(o);t.BatchThumbLoader=class{constructor({batch_size:e,max_parallel_requests:t,on_batch:i,batch_logger:n,on_batch_success:o}){this.on_batch=i,this.batch_logger=n,this.on_batch_success=o,this.batch_size=e||16,this.max_parallel_requests=t||6,this.thumb_url_queue=[],this.batch_queue=[],this.callback_by_id={},this.request_ids_by_url={},this.num_requests_in_flight=0,this.flushing=!1,this.last_thumb_request_id=0,this.next_batch_id=0,this.cancelled_urls={},this.outstanding_batches={},this._request_callback_by_request_id={}}vend_request_id(){return this.last_thumb_request_id++,this.last_thumb_request_id.toString()}queue_thumb(e,t,i={}){let{request_id:n,onrequest:s}=i;if(o.BATCH_THUMB_ENDPOINTS.length){if(n||(n=this.vend_request_id()),this.request_ids_by_url[e]&&this.request_ids_by_url[e].length){let t=!1;for(const i in this.outstanding_batches)if(this.outstanding_batches[i]&&this.outstanding_batches[i].urls)for(const n of this.outstanding_batches[i].urls)n===e&&(t=!0);t&&"function"==typeof s&&s()}else this.thumb_url_queue.push(e),this.request_ids_by_url[e]=[];return this.request_ids_by_url[e].push(n),t&&(this.callback_by_id[n]={url:e,callback:t}),this._request_callback_by_request_id[n]=s,this.thumb_url_queue.length>=this.batch_size&&(this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size)),this._send_batch_requests()),n}{"function"==typeof s&&s();const i=!0;return t&&"function"==typeof t&&t(e,i),null}}cancel_thumb(e){if(!this.callback_by_id[e])return;const{url:t}=this.callback_by_id[e];delete this.callback_by_id[e],delete this._request_callback_by_request_id[e];for(let i=0;i<this.request_ids_by_url[t].length;i++){if(this.request_ids_by_url[t][i]===e){this.request_ids_by_url[t].splice(i,1);break}}if(0===this.request_ids_by_url[t].length){let e;delete this.request_ids_by_url[t];for(let i=0;i<this.thumb_url_queue.length;i++)if(e=this.thumb_url_queue[i],e===t)return void this.thumb_url_queue.splice(i,1);for(let i=0;i<this.batch_queue.length;i++){const n=this.batch_queue[i];for(let o=0;o<n.length;o++)if(e=n[o],e===t)return n.splice(o,1),void(0===n.length&&this.batch_queue.splice(i,1))}this.cancelled_urls[t]=1;for(const e in this.outstanding_batches)if(this.outstanding_batches[e]&&this.outstanding_batches[e].urls){const{urls:t,request:i}=this.outstanding_batches[e];let n=!0;for(const e of t)n=null!=this.cancelled_urls[e]&&n;if(n){i.abort();break}}}}flush(){for(;this.thumb_url_queue.length;)this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size));this._send_batch_requests()}reset({batch_size:e,batch_logger:t}){this.batch_logger=t,this.batch_size=e||16}clear(){this.thumb_url_queue=[]}pause(){this.flushing=!1}_send_batch_requests(){if(!(0===this.batch_queue.length||this.num_requests_in_flight>=this.max_parallel_requests)&&this.batch_queue.length>0){this.flushing=!0;const e=this.batch_queue.shift(),{endpoint:t,method:i,data:o}=this._generate_request_params(e);this.on_batch&&"function"==typeof this.on_batch&&this.on_batch(e);for(const t of e)for(const e of this.request_ids_by_url[t]){const t=this._request_callback_by_request_id[e];t&&"function"==typeof t&&t(),delete this._request_callback_by_request_id[e]}const s=this.next_batch_id;this.next_batch_id++,this.num_requests_in_flight++;const a=n.SilentBackgroundRequest({url:t,type:i,data:o,success:this._success.bind(this,e),error:this._error.bind(this,e),complete:this._complete.bind(this,s)});this.outstanding_batches[s]={urls:e,request:a},this._send_batch_requests()}}_success(e,t){const i=t.split("\n"),n={};for(const t of e)n[t]=!1;for(let t=0;t<i.length;t++){const o=i[t],s=o.indexOf(":");if(-1===s)continue;const a=o.substring(0,s).split("-"),r=parseInt(a[0],10),c=o.substring(s+1),l=e[r];n[l]=!0,this._call_callback(l,c),this.batch_logger&&"function"==typeof this.batch_logger&&this.batch_logger(t,e.length)}this.on_batch_success&&"function"==typeof this.on_batch_success&&this.on_batch_success(e);for(const t of e.filter(e=>!n[e]))this.cancelled_urls[t]||this._call_callback(t,t)}_error(e){for(const t of e)this._call_callback(t,t)}_complete(e){this.num_requests_in_flight--;const{urls:t}=this.outstanding_batches[e];for(const e of t)delete this.cancelled_urls[e];delete this.outstanding_batches[e],this.flushing&&this._send_batch_requests()}_call_callback(e,t){let i;if(i=0===t.indexOf("data:image")?t:e,this.request_ids_by_url[e])for(const t of this.request_ids_by_url[e].slice())this.callback_by_id[t]&&(this.callback_by_id[t].callback(i,!1),delete this.callback_by_id[t]);delete this.request_ids_by_url[e]}_generate_request_params(e){const t=e.map(e=>s.URI.parse(e).setScheme().setAuthority().toString()),i=JSON.stringify(t),n=Math.abs(this._hash_string_to_int(i))%o.BATCH_THUMB_ENDPOINTS.length,a=o.BATCH_THUMB_ENDPOINTS[n],r={image_urls:i};return{endpoint:a,method:s.URI.parse(a).setQuery(r).toString().length>6e3?"POST":"GET",data:r}}_hash_string_to_int(e){let t=0;if(0===e.length)return t;for(let i=0;i<e.length;i++){t=(t<<5)-t+e.charCodeAt(i)}return t}}})),define("modules/clean/react/user_notifications/notification_logger",["require","exports","tslib","modules/clean/deprecated_ajax/ajax_jquery","modules/clean/react/user_notifications/models"],(function(e,t,i,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationLogger=t.NotificationLocations=void 0,n=i.__importStar(n),t.NotificationLocations={TRAY:"home",HOME_PAGE:"home_page"};class s{static logReceive(e){const t=[];for(const i of e)t.push(s.getCommonEventData("receive",i));s.log(t)}static logRender(e,t,i){const n=[];e.forEach((e,o)=>{const a=s.getCommonEventData("render",e);a.location=i,a.location_index=t+o,n.push(a)}),s.log(n)}static logAction(e,t,i){const n=s.getCommonEventData("action",e);n.action_taken=t,i&&(n.location=i),s.log([n])}static logMarkAsRead(e,t){const i=[];for(const n of e){const e=s.getCommonEventData("mark_read",n);e.location=t,i.push(e)}s.log(i)}static log(e){0!==e.length&&n.SilentBackgroundRequest({url:"/log/notif_events",data:{event_list:JSON.stringify(e)}})}static getCommonEventData(e,t){return{event_name:e,type_id:t.typeId,campaign_id:o.getCampaignId(t),campaign_version:o.getCampaignVersion(t),instance_id:parseInt(t.id,10),status:o.NotificationStatusStrings[t.status],seen_state:t.seenState,target_object_key:t.targetObjectKey}}}t.NotificationLogger=s})),define("modules/clean/react/user_notifications/actions",["require","exports","tslib","modules/clean/bolt/bolt","modules/clean/react/user_notifications/notification_logger","modules/clean/react/user_notifications/notification_tray_logger","modules/clean/react/user_notifications/api","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dispatcher","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/store","modules/clean/referrer_cleansing_redirect","modules/clean/active_user"],(function(e,t,i,n,o,s,a,r,c,l,u,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=i.__importStar(s),a=i.__importStar(a),d=i.__importStar(d);const _=new class{constructor(){this.onUserNotificationUpdate=()=>{this.load().then(e=>{if(e){const t=this.getBoltChannelStates(e);this.boltClient.update_states(t)}},()=>{})},this.userNotificationRefreshCallback=()=>{this.load().then(e=>{if(e){this.boltClient.unsubscribe();const t=this.getBoltChannelStates(e);t.length>0&&(this.boltClient=new n.BoltClient(t,this.onUserNotificationUpdate,this.userNotificationRefreshCallback),this.boltClient.start())}},()=>{})}}asyncSharingAction(t){new Promise((t,i)=>{e(["modules/clean/react/user_notifications/sharing_actions"],t,i)}).then(i.__importStar).then(t)}asyncGroupAction(t){new Promise((t,i)=>{e(["modules/clean/react/user_notifications/group_actions"],t,i)}).then(i.__importStar).then(t)}load(){return c.userNotificationsDispatcher.dispatch({type:r.ActionTypes.LOAD_REQUEST}),a.getAll(u.userNotificationsStore.getCursor(),this.activeUserOnlyMode).then(e=>{let t=[];return t=t.concat(e.notifications),o.NotificationLogger.logReceive(t),c.userNotificationsDispatcher.dispatch({type:r.ActionTypes.LOAD_SUCCESS,data:e}),e},()=>{c.userNotificationsDispatcher.dispatch({type:r.ActionTypes.LOAD_FAILURE})})}loadOnceAndWatch(e){this.hasLoadedOnce||(this.hasLoadedOnce=!0,this.activeUserOnlyMode=null!=e&&e,this.load().then(e=>{e&&this.watch(e)},()=>{}))}acknowledge(e){c.userNotificationsDispatcher.dispatch({type:r.ActionTypes.ACKNOWLEDGEMENT_REQUEST_SINGLE,data:{notifications:[e]}}),a.ack(e)}markAllAsSeen(){const e=u.userNotificationsStore.getUnseen();0!==e.length&&(a.markAsSeen(e),c.userNotificationsDispatcher.dispatch({type:r.ActionTypes.MARK_AS_SEEN_REQUEST}))}watch(e){const t=this.getBoltChannelStates(e);t.length>0&&(this.boltClient=new n.BoltClient(t,this.onUserNotificationUpdate,this.userNotificationRefreshCallback),this.boltClient.start())}getBoltChannelStates(e){const t=[];for(const i in e.cursor)if(e.cursor.hasOwnProperty(i)){const o=f.getActiveUserId();if(!this.activeUserOnlyMode||o===parseInt(i,10)){const o=new n.SignedChannelState("user_notification",i,e.cursor[i],e.boltToken[i]);t.push(o)}}return t}acknowledgeAll(){0!==u.userNotificationsStore.getUnacknowledgedCount()&&(s.logMarkAllAsRead(),o.NotificationLogger.logMarkAsRead(u.userNotificationsStore.getUnacknowledged(),o.NotificationLocations.TRAY),c.userNotificationsDispatcher.dispatch({type:r.ActionTypes.ACKNOWLEDGEMENT_REQUEST}),a.ackAll(this.activeUserOnlyMode))}viewNotifications(){this.markAllAsSeen()}actionPerformed(e,t){o.NotificationLogger.logAction(e,t),l.isUnread(e)&&this.acknowledge(e)}triggerGenericLegacyNotificationAction(e){this.actionPerformed(e,"click")}dismissLegacySharingNotification(e,t){this.actionPerformed(e,"button_1"),this.asyncSharingAction(e=>{e.registerDismiss(t)})}mountFromLegacySharingNotification(e,t){this.actionPerformed(e,"button_0"),this.asyncSharingAction(e=>{e.registerMount(t)})}upgradeToMountFromLegacySharingNotification(e){this.actionPerformed(e,"button_0"),this.asyncSharingAction(e=>{e.upgradeToMount()})}triggerBluenoteAction(e,t,i,n){this.actionPerformed(t,n),i.actionType===l.BluenoteActionTypes.OpenUrl?(e.preventDefault(),this.performBluenoteOpenUrlAction(e,i.params)):i.actionType===l.BluenoteActionTypes.MountSharedFolder?this.asyncSharingAction(e=>{e.performBluenoteMountSharedFolder(t,i.params)}):i.actionType===l.BluenoteActionTypes.ApproveGroupJoinRequest?this.asyncGroupAction(e=>{e.performBluenoteApproveGroupJoinRequestAction(t,i.params)}):i.actionType===l.BluenoteActionTypes.RemoveGroupJoinRequest&&this.asyncGroupAction(e=>{e.performBluenoteRemoveGroupJoinRequestAction(t,i.params)})}performBluenoteOpenUrlAction(e,t){t.urlPath&&(e.ctrlKey||e.metaKey?d.safe_open_tab_and_redirect(t.urlPath):d.redirect(t.urlPath))}};t.default=_})),define("modules/clean/react/user_notifications/api",["require","exports","tslib","jquery","modules/clean/deprecated_ajax/ajax_as_promised_jquery","modules/clean/deprecated_ajax/ajax_jquery","modules/clean/react/user_notifications/api_helper","modules/clean/active_user"],(function(e,t,i,n,o,s,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.markAsSeen=t.ack=t.ackAll=t.getAll=void 0,n=i.__importDefault(n),o=i.__importStar(o),s=i.__importStar(s);t.getAll=function(e=null,t=!1){const i={count:100,template_version:5};let s;if(null!=e&&(i.last_received_nid_by_user_id=JSON.stringify(e)),t){if(null===e){const e=window.__REGISTER_NOTIFICATIONS_PREFETCH_HANDLER;if(e)return e.prefetchDeferred||(e.prefetchDeferred=n.default.Deferred(),e(t=>{e.prefetchDeferred.resolve(a.parseGetAllResponse(t))},()=>null)),e.prefetchDeferred}s=o.SilentBackgroundRequest({url:"/web/notifications/retrieve_user",data:i,subject_user:r.getActiveUserId(),dataType:"json"})}else s=o.SilentBackgroundRequest({url:"/web/notifications/retrieve",data:i,dataType:"json"});return Promise.resolve(s.then(a.parseGetAllResponse))},t.ackAll=function(e=!1){let t;return t=e?o.SilentBackgroundRequest({url:"/web/notifications/ack_all_user",subject_user:r.getActiveUserId(),dataType:"json"}):o.SilentBackgroundRequest({url:"/web/notifications/ack_all",dataType:"json"}),t.then((function(e){return e.map(a.userNotificationDeserializer)}))},t.ack=function(e){s.SilentBackgroundBeaconRequest({url:"/web/notifications/ack",subject_user:e.userId,data:{nids:JSON.stringify([e.id])},dataType:"json"})},t.markAsSeen=function(e){const t={};for(const i of e)i.userId&&i.id&&(t[i.userId]||(t[i.userId]=[])).push(i.id);const i={nids_by_user_id:JSON.stringify(t)};s.SilentBackgroundRequest({url:"/web/notifications/mark_seen",data:i,dataType:"json"})}})),define("modules/clean/react/user_notifications/api_helper",["require","exports","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/models"],(function(e,t,i,n){"use strict";function o(e){return{id:e.nid,userId:e.user_id,typeId:e.type_id,typeData:s(e),targetObjectKey:e.target_object_key,status:e.status,seenState:e.seen_state,feedTimeInSec:e.feed_time,rawDropdownRowHtml:e.notification_div,roleLabel:e.role_label,bluenoteActor:_(e),bluenoteObject:h(e),bluenoteNotificationTypeId:e.bluenote_notification_type_id,bluenoteTypedData:p(e)}}function s(e){switch(e.type_id){case n.NotificationTypes.SharedFolderInvite:return(function(e){return{overQuotaStatus:e.sf_invite_overquota}})(e);case n.NotificationTypes.Bluenote:return(function(e){const t=e.bluenote_payload;if(null!=t)return{templateType:t.template_type,templateVersion:t.template_version,campaignInfo:l(t.campaign_info),displayMessage:t.home_params.message,icon:u(t.image),surfaceAction:d(t.home_params.surface_action),buttonActions:(t.home_params.button_actions||[]).map(d),preview:a(t.preview)};return})(e)}}function a(e){if(null!=e)return{showThumbnail:e.show_thumbnail||!1,quote:e.quote,tasks:r(e.tasks)}}function r(e){if(null!=e)return{taskEndpoint:e.task_endpoint,tasks:(e.tasks||[]).map(c)}}function c(e){if(null!=e)return{name:e.name,id:e.id,isComplete:e.is_complete}}function l(e){if(null!=e)return{campaignId:e.campaignId,categoryId:e.categoryId,versionId:e.versionId?`${e.versionId}`:void 0,contentId:e.contentId}}function u(e){if(null!=e)return"avatar"===e.type?{avatarInitials:e.avatar_initials,avatarUrl:e.avatar_url}:{lowResIconUrl:e.system_url32,highResIconUrl:e.system_url64}}function d(e){if(null!=e){let t=void 0;if("open_url"===e.action_name?t=n.BluenoteActionTypes.OpenUrl:"mount_shared_folder"===e.action_name?t=n.BluenoteActionTypes.MountSharedFolder:"approve_group_join_request"===e.action_name?t=n.BluenoteActionTypes.ApproveGroupJoinRequest:"remove_group_join_request"===e.action_name&&(t=n.BluenoteActionTypes.RemoveGroupJoinRequest),t)return{buttonLabel:e.label,actionType:t,params:f(t,e.params)}}}function f(e,t){if(null!=t){if(e===n.BluenoteActionTypes.OpenUrl)return{urlPath:t.url_path};if(e===n.BluenoteActionTypes.MountSharedFolder)return{nsId:t.ns_id};if(e===n.BluenoteActionTypes.ApproveGroupJoinRequest||e===n.BluenoteActionTypes.RemoveGroupJoinRequest)return{requestingUserId:t.requesting_user_id,groupId:t.group_id}}}function _(e){const t=e.bluenote_actor;if(null!=t)return{accountId:t.actor_account_id,avatarUrl:t.actor_avatar_url,displayName:t.actor_display_name,initials:t.actor_initials}}function h(e){const t=e.bluenote_object;if(null!=t)return{id:t.id,ignore:t.ignore,name:t.name,thumbnailUrl:t.thumbnail_url,type:t.type,url:t.url}}function p(e){const t=e.bluenote_notification_type_id,n=e.bluenote_typed_data;if(null!=t&&null!=n)switch(t){case i.BNNotificationTypeIdentifier.NONE:return;case i.BNNotificationTypeIdentifier.DROPBOX_FILE_COMMENT:return(function(e){return{commentText:e.comment_text}})(n);case i.BNNotificationTypeIdentifier.DROPBOX_SHARED_CONTENT:case i.BNNotificationTypeIdentifier.PAPER_SHARE:return(function(e){return{shareText:e.share_text}})(n);case i.BNNotificationTypeIdentifier.PAPER_COMMENT:return(function(e){return{commentText:e.comment_text,numOtherCommenters:e.num_other_commenters,numOtherComments:e.num_other_comments}})(n);case i.BNNotificationTypeIdentifier.PAPER_MENTION:return(function(e){return{mentionText:e.mention_text}})(n);case i.BNNotificationTypeIdentifier.PAPER_TASK:return(function(e){return{isComplete:e.is_complete,isNew:e.is_new}})(n);case i.BNNotificationTypeIdentifier.COMMENTS2_COMMENT:return(function(e){return{previewQuote:e.preview_quote}})(n);default:return}}Object.defineProperty(t,"__esModule",{value:!0}),t.userNotificationComparator=t.parseGetAllResponse=t.userNotificationDeserializer=void 0,t.userNotificationDeserializer=o,t.parseGetAllResponse=function(e){const t=e.notifications.map(o);return{cursor:e.latest_nid,boltToken:e.bolt_token,notifications:t}},t.userNotificationComparator=function(e,t){const i=n.getFeedTime(e),o=n.getFeedTime(t);return void 0===i&&void 0===o?0:void 0===i?1:void 0===o?-1:o.getTime()-i.getTime()||n.getKey(e).localeCompare(n.getKey(t))}})),define("modules/clean/react/user_notifications/avatar_icon",["require","exports","tslib","react","modules/clean/avatar/initials_avatar","modules/clean/avatar/size"],(function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AvatarIcon=void 0,n=i.__importDefault(n);class a extends n.default.Component{constructor(e){super(e),this.thumbRequestId=null;let t=null;const i=this.props.avatarIconRecord;null!=i.avatarUrl&&(t=this.props.thumbStore.get_thumb(i.avatarUrl)),this.state={avatarImage:t}}componentDidMount(){this.bindAvatarUrl(this.props)}componentWillUnmount(){this.unbindAvatarUrl()}componentDidUpdate(e){const t=e.avatarIconRecord,i=this.props.avatarIconRecord;t.avatarUrl!==i.avatarUrl&&(this.unbindAvatarUrl(),this.bindAvatarUrl(this.props))}bindAvatarUrl(e){const t=e.avatarIconRecord.avatarUrl;null!=t&&(this.thumbRequestId=e.thumbStore.bind_url(t,{onSuccess:()=>{const i=e.thumbStore.get_thumb(t);this.setState({avatarImage:i})}}))}unbindAvatarUrl(){this.thumbRequestId&&(this.props.thumbStore.unbind_url(this.thumbRequestId),this.thumbRequestId=null)}render(){const e=this.props.avatarIconRecord;return null!=this.state.avatarImage?n.default.createElement("img",{className:this.props.className,src:this.state.avatarImage,alt:"",width:this.props.size,height:this.props.size}):n.default.createElement(o.InitialsAvatarWithColorDerivedFromName,{name:e.avatarInitials,dimension:this.props.size,initials:e.avatarInitials,shape:"CIRCLE",optionalClass:this.props.className})}}t.AvatarIcon=a,a.displayName="AvatarIcon",a.defaultProps={size:s.AvatarSize.MEDIUM}})),define("modules/clean/react/user_notifications/constants",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BluenoteObjectTypes=t.BNNotificationTypeIdentifier=t.EventTypes=t.ActionTypes=void 0,(function(e){e.LOAD_REQUEST="USER_NOTIFICATIONS_LOAD_REQUEST",e.LOAD_SUCCESS="USER_NOTIFICATIONS_LOAD_SUCCESS",e.LOAD_FAILURE="USER_NOTIFICATIONS_LOAD_FAILURE",e.ACKNOWLEDGEMENT_REQUEST="USER_NOTIFICATIONS_ACKNOWLEDGEMENT_REQUEST",e.ACKNOWLEDGEMENT_REQUEST_SINGLE="USER_NOTIFICATIONS_ACKNOWLEDGEMENT_REQUEST_SINGLE",e.MARK_AS_SEEN_REQUEST="USER_NOTIFICATIONS_MARK_AS_SEEN_REQUEST"})(t.ActionTypes||(t.ActionTypes={})),t.EventTypes={RENDERED_NOTIFICATIONS:"USER_NOTIFICATIONS_RENDERED_NOTIFICATIONS"},t.BNNotificationTypeIdentifier={NONE:"NONE",DROPBOX_FILE_COMMENT:"DROPBOX_FILE_COMMENT",DROPBOX_SHARED_CONTENT:"DROPBOX_SHARED_CONTENT",PAPER_SHARE:"PAPER_SHARE",PAPER_COMMENT:"PAPER_COMMENT",PAPER_MENTION:"PAPER_MENTION",PAPER_TASK:"PAPER_TASK",COMMENTS2_COMMENT:"COMMENTS2_COMMENT",GENERIC:"GENERIC"},t.BluenoteObjectTypes={DROPBOX_FILE:"dropbox-file",DROPBOX_FOLDER:"dropbox-folder",PAPER_PAD:"paper-pad",PAPER_FOLDER:"paper-folder"}})),define("modules/clean/react/user_notifications/dispatcher",["require","exports","modules/clean/flux/dispatcher"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userNotificationsDispatcher=void 0,Object.defineProperty(t,"userNotificationsDispatcher",{enumerable:!0,get:function(){return i.Dispatcher}})})),define("modules/clean/react/user_notifications/dropdown",["require","exports","tslib","lodash","react","dig-components/menu","dig-components/typography","spectrum/popover/index","modules/clean/accessibility/tabbable","modules/clean/react/user_notifications/notification_logger","modules/clean/react/user_notifications/notification_tray_logger","modules/clean/react/components/css","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/dropdown_bell","modules/clean/react/user_notifications/renderer","modules/clean/react/user_notifications/shared/tray_chrome","modules/clean/react/user_notifications/store","modules/core/i18n","dig-components/global_header"],(function(e,t,i,n,o,s,a,r,c,l,u,d,f,_,h,p,m,g,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserNotificationsDropdown=void 0,n=i.__importStar(n),o=i.__importDefault(o),c=i.__importDefault(c),u=i.__importStar(u),f=i.__importDefault(f);class N extends o.default.Component{constructor(e){super(e),this.onTrayMount=()=>{u.logTrayOpen(this.state.actionableCount),f.default.viewNotifications()},this.logRenderWrapper=(e,t)=>{l.NotificationLogger.logRender(e,t,l.NotificationLocations.TRAY)},this.onMenuToggle=({isOpen:e})=>{this.setState({isOpen:e}),N.requireAsyncModules()},this.state={actionableCount:m.userNotificationsStore.getActionableCount(),notifications:m.userNotificationsStore.getAllVisible(),isStoreLoading:m.userNotificationsStore.isLoading(),isDisabled:!0,isOpen:!1}}componentDidMount(){f.default.loadOnceAndWatch(this.props.isPagelet),this.removeStoreListener=m.userNotificationsStore.addListener(this.onUpdateFromStore.bind(this)),this.onUpdateFromStore();const e=new h.NotificationRenderer;this.notificationRenderFunc=e.renderNotification.bind(e),this.setState((e,t)=>(e.isDisabled=!1,e)),new c.default}componentWillUnmount(){this.removeStoreListener()}componentDidUpdate(e){this.props.shouldOpenDropdown!==e.shouldOpenDropdown&&this.setState({isOpen:!!this.props.shouldOpenDropdown})}onUpdateFromStore(){this.setState((e,t)=>(e.actionableCount=m.userNotificationsStore.getActionableCount(),e.notifications=m.userNotificationsStore.getAllVisible(),e.isStoreLoading=m.userNotificationsStore.isLoading(),e),()=>{var e,t;null===(t=(e=this.props).handleNotificationCountChange)||void 0===t||t.call(e,this.state.actionableCount)})}renderTrayContent(){return o.default.createElement("div",{id:"event-feed-container"},o.default.createElement("div",{id:"event-feed"},o.default.createElement(p.NotificationsTrayChrome,{unreadSectionTitle:g.intl.formatMessage({id:"B7AytW",defaultMessage:"Unread"}),readSectionTitle:g.intl.formatMessage({id:"du7HYM",defaultMessage:"Recent"}),notifications:this.state.notifications,markAllAsReadButtonTitle:g.intl.formatMessage({id:"G4MWO/",defaultMessage:"Mark all as read"}),markAllAsReadAction:f.default.acknowledgeAll,isLoading:this.state.isStoreLoading,loadingMessage:g.intl.formatMessage({id:"Uwr6W8",defaultMessage:"Loading ..."}),emptyMessage:g.intl.formatMessage({id:"NfgkYn",defaultMessage:"You don’t have any notifications yet."}),notifRenderFunc:this.notificationRenderFunc,notifLogRenderFunc:this.logRenderWrapper,onTrayMount:this.onTrayMount})))}render(){const{actionableCount:e}=this.state,{useSpectrumStyling:t}=this.props;if(t)return o.default.createElement(r.Popover,{onSelection:n.noop,onMenuToggle:this.onMenuToggle},o.default.createElement(r.PopoverTrigger,{"aria-label":e&&e>0?g.intl.formatMessage({id:"RaZY+d",defaultMessage:"Notifications menu, with new notifications"}):g.intl.formatMessage({id:"ewgyb+",defaultMessage:"Notifications menu"}),className:"legacy-notification-button"},o.default.createElement(_.LegacyUserNotificationsDropdownBell,{actionableCount:e,isSelected:this.state.isOpen})),o.default.createElement(r.PopoverContent,{attachment:"right",className:"notifications-popover-content"},o.default.createElement(r.PopoverContentTitle,null,g.intl.formatMessage({id:"dToisu",defaultMessage:"Notifications"})),o.default.createElement("div",{className:"notifications-dropdown"},this.renderTrayContent())));const i=o.default.createElement(o.default.Fragment,null,o.default.createElement(s.Menu.Segment,null,o.default.createElement("div",{className:"notifications-title"},o.default.createElement(a.Text,null,g.intl.formatMessage({id:"dToisu",defaultMessage:"Notifications"})))),o.default.createElement(s.Menu.Segment,null,o.default.createElement("div",{className:"notifications-dropdown"},this.renderTrayContent()))),c=!!(e&&e>1),l=c?g.intl.formatMessage({id:"RaZY+d",defaultMessage:"Notifications menu, with new notifications"}):g.intl.formatMessage({id:"ewgyb+",defaultMessage:"Notifications menu"});return o.default.createElement(b.GlobalHeader.Notifications,{triggerProps:{"aria-label":l},wrapperActionProps:{onToggle:this.onMenuToggle},hasNotifications:c,menuContentProps:{open:this.state.isOpen}},o.default.createElement("div",{className:"notifications-popover-content"},i))}}N.displayName="UserNotificationsDropdown",N.requireAsyncModules=n.once(()=>new Promise((t,i)=>{e(["modules/clean/react/user_notifications/sharing_actions"],t,i)}).then(i.__importStar).then(()=>null)),N.defaultProps={isPagelet:!1,useSpectrumStyling:!1};const y=d.requireCssWithComponent(N,["/static/css/scooter/scooter-scoped-vflpl9JSl.css","/static/css/spectrum/index.web-vfliw9181.css","/static/css/notifications-vfl_wHc76.css","/static/css/dig-components/index.web-vflm67Rix.css"]);t.UserNotificationsDropdown=y})),define("modules/clean/react/user_notifications/dropdown_bell",["require","exports","tslib","react","dig-components/badges","dig-components/icons","dig-components/icons/src","spectrum/icon_global/index","modules/core/i18n"],(function(e,t,i,n,o,s,a,r,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyUserNotificationsDropdownBell=t.UserNotificationsDropdownBell=void 0,n=i.__importDefault(n),t.UserNotificationsDropdownBell=({actionableCount:e,iconSize:t})=>{let i="";return e>0&&(i=c.intl.formatMessage({id:"Dj/752",defaultMessage:"{count, plural, one{{count} new} other{{count} new}}"},{count:e})),n.default.createElement("div",{className:"notification-button-bell-container"},n.default.createElement("span",{className:"ax-visually-hidden"},i),n.default.createElement(s.UIIcon,{src:a.NotificationLine,size:"large"}),e>0&&n.default.createElement(o.NotificationBadge,{className:"notification-button-badge"}))},t.UserNotificationsDropdownBell.displayName="UserNotificationsDropdownBell",t.UserNotificationsDropdownBell.displayName="UserNotificationsDropdownBell";class l extends n.default.Component{renderBell(){return n.default.createElement(r.IconGlobal,{name:"notifications",className:"mcl-notifications-icon",selected:this.props.isSelected})}renderBadge(){return this.props.actionableCount?n.default.createElement("div",{className:"badge-red-dot"}):null}render(){let e="";return this.props.actionableCount>0&&(e=c.intl.formatMessage({id:"Dj/752",defaultMessage:"{count, plural, one{{count} new} other{{count} new}}"},{count:this.props.actionableCount})),n.default.createElement("div",{className:"notification-button-bell-container"},n.default.createElement("span",{className:"ax-visually-hidden"},e),this.renderBell(),this.renderBadge())}}t.LegacyUserNotificationsDropdownBell=l,l.defaultProps={actionableCount:0},l.displayName="LegacyUserNotificationsDropdownBell"})),define("modules/clean/react/user_notifications/dropdown_bluenote_row",["require","exports","tslib","classnames","dompurify","react","ts-key-enum","dig-components/buttons","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/avatar_icon","modules/clean/react/user_notifications/generic_icon","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/single_task_preview","modules/clean/react/user_notifications/thumbnail_preview","modules/clean/referrer_cleansing_redirect"],(function(e,t,i,n,o,s,a,r,c,l,u,d,f,_,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserNotificationsDropdownBluenoteRow=void 0,n=i.__importDefault(n),o=i.__importStar(o),s=i.__importDefault(s),c=i.__importDefault(c);const p=({notification:e})=>{const t=e.typeData.displayMessage;return t?s.default.createElement("div",{className:"feed-text--button-wrapper"},s.default.createElement("button",{tabIndex:-1,className:"u-unbutton u-font-left feed-text__button"},s.default.createElement("div",{className:"feed-text__button-text",dangerouslySetInnerHTML:{__html:o.sanitize(t)}}))):null};p.displayName="UserNotificationText",p.displayName="UserNotificationText";const m=({notification:e,thumbStore:t})=>{const i=e.typeData.icon;return i&&(i.avatarInitials||i.avatarUrl)?s.default.createElement(l.AvatarIcon,{avatarIconRecord:i,thumbStore:t,className:"feed-image feed-image--bluenote"}):s.default.createElement(u.GenericIcon,{genericIconRecord:i,className:"feed-image feed-image--bluenote"})};m.displayName="UserNotificationImage",m.displayName="UserNotificationImage";const g=({notification:e})=>{const t=d.getDisplayTime(e);return s.default.createElement("span",{className:"feed-time"},t)};g.displayName="UserNotificationTimestamp",g.displayName="UserNotificationTimestamp";const b=({notification:e})=>{const t=e.typeData.preview;if(!t)return null;let i=null;t.showThumbnail&&e.bluenoteObject&&(i=s.default.createElement(_.ThumbnailPreview,{object:e.bluenoteObject}));let n=null;t.tasks&&t.tasks.tasks&&t.tasks.tasks.length>0&&t.tasks.tasks[0]&&(n=s.default.createElement(f.SingleTaskPreview,{task:t.tasks.tasks[0]}));let o=null;return t.quote&&(o=s.default.createElement("div",{className:"preview-quote"},t.quote)),s.default.createElement("div",null,i,n,o)};b.displayName="UserNotificationPreview",b.displayName="UserNotificationPreview";const N=({notification:e,buttonLabel:t,buttonIndex:i})=>s.default.createElement(r.Button,{className:"notification u-mar-right-xs u-mar-top-xs",variant:i>0?"outline":"primary",onClick:t=>{t.currentTarget.disabled=!0;const n=(e.typeData.buttonActions||[])[i];c.default.triggerBluenoteAction(t,e,n,"button_"+i),t.stopPropagation(),t.preventDefault()}},t);N.displayName="UserNotificationButton",N.displayName="UserNotificationButton";class y extends s.default.Component{constructor(){super(...arguments),this.handleSurfaceAction=e=>{const t=this.props.notification,i=t.typeData.surfaceAction;null!=i&&c.default.triggerBluenoteAction(e,t,i,"surface")},this.handleKeyDown=e=>{e.key!==a.Key.Enter&&" "!==e.key||this.handleSurfaceAction(e)}}renderButtonActions(e){const t=[];return(e.typeData.buttonActions||[]).forEach((i,n)=>{t.push(s.default.createElement(N,{key:d.getKey(e),notification:e,buttonLabel:i.buttonLabel,buttonIndex:n}))}),t.length>0?s.default.createElement("span",{className:"feed-action action-available"},t):null}render(){const e=this.props.notification,t=e.typeData;if(!t)return null;const i=t.surfaceAction,o=n.default({"feed-row":!0,clickable:null!=t.surfaceAction,read:this.props.isAcknowledged}),a=s.default.createElement("div",{onClick:this.handleSurfaceAction,onKeyDown:this.handleKeyDown,className:o,role:"button",tabIndex:0},s.default.createElement(m,{notification:e,thumbStore:this.props.thumbStore}),s.default.createElement(p,{notification:e}),s.default.createElement(b,{notification:e}),s.default.createElement(g,{notification:e}),this.renderButtonActions(e));if(null!=i&&i.actionType===d.BluenoteActionTypes.OpenUrl){const e=i.params;if(e.urlPath){const t=h.get_redirect_uri(e.urlPath);return s.default.createElement("a",{href:t.toString()},a)}}return a}}t.UserNotificationsDropdownBluenoteRow=y,y.displayName="UserNotificationsDropdownBluenoteRow"})),define("modules/clean/react/user_notifications/dropdown_row",["require","exports","tslib","react","lodash","jquery","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/models","modules/clean/sprite"],(function(e,t,i,n,o,s,a,r,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=i.__importDefault(n),o=i.__importStar(o),s=i.__importDefault(s),a=i.__importDefault(a),c=i.__importDefault(c);class l extends n.default.Component{constructor(){super(...arguments),this._buildLegacyElement=(e,t)=>{var i;const n=s.default(this.refs.dropdownLegacyRow);return n.html(null!==(i=e.rawDropdownRowHtml)&&void 0!==i?i:""),this._initImages(n),this._setTimeLabel(n,e),this._addClientStateClasses(n,e,t),this._initActionHandlers(e,n),n},this._initImages=e=>e.find("img").each((e,t)=>{const i=s.default(t);return i.attr("alt",""),this._loadImage(i)}),this._setTimeLabel=(e,t)=>{const i=e.find("#feed-time-label");if(null!=i)return i.text(r.getDisplayTime(t))},this._loadImage=e=>{const t=e.data("src");if(t)return this.props.legacyThumbLoader.load(t).progress((function(){return e.data("src",null),e.data("loading-src",t)})).then((function(t){e.data("loading-src",null);const i=function(){return e.addClass("thumbnail"),e.parent(".feed-thumbnail").addClass("has-frame")};return 0===t.indexOf("data:image")?i():(e.load(i),e.error(o.once((function(){const t=e.data("fail-src")||c.default.SPACER;return e.attr("src",t)})))),e.attr("src",t)}))},this._addClientStateClasses=(e,t,i)=>{const n=e.hasClass("feed-row")?e:e.find(".feed-row");if(r.isInvisible(t)&&n.addClass("invisible"),i)return n.addClass("read")},this._initActionHandlers=(e,t)=>(t.on("click",(function(){return a.default.triggerGenericLegacyNotificationAction(e),!0})),t.on("click",".share-content-dismiss",(function(){return a.default.dismissLegacySharingNotification(e,this),!1})),t.on("click",".share-content-mount",(function(){return a.default.mountFromLegacySharingNotification(e,this),!1})),t.on("click",".share-content-upgrade-mount",(function(){return a.default.upgradeToMountFromLegacySharingNotification(e),!1})))}componentDidMount(){return this._buildLegacyElement(this.props.notification,this.props.isAcknowledged)}render(){return n.default.createElement("div",{ref:"dropdownLegacyRow"})}}l.displayName="UserNotificationsDropdownRow",t.default=l})),define("modules/clean/react/user_notifications/generic_icon",["require","exports","tslib","react","modules/clean/react/image","modules/clean/static_urls"],(function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GenericIcon=void 0,n=i.__importDefault(n),t.GenericIcon=e=>{const t=e.genericIconRecord;let i=null!=t?t.lowResIconUrl:null,a=null!=t?t.highResIconUrl:null;return null!=i&&null!=a||(i=s.static_url("/static/images/icons32/system_notification_default_icon-vflSQSQdl.png"),a=s.static_url("/static/images/icons64/system_notification_default_icon-vfl0Gu6Pt.png")),n.default.createElement("div",{className:e.className},n.default.createElement(o.Image,{src:i,srcHiRes:a}))},t.GenericIcon.displayName="GenericIcon"})),define("modules/clean/react/user_notifications/legacy_thumb_loader",["require","exports","tslib","lodash","jquery","modules/clean/photos/batch_thumb_loader"],(function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LegacyThumbLoader=void 0,n=i.__importStar(n),o=i.__importDefault(o);t.LegacyThumbLoader=class{constructor(){this._cache={};const e=new s.BatchThumbLoader({batch_size:16,max_parallel_requests:24});this._queueThumb=(t,i,n)=>e.queue_thumb(t,i,{onrequest:n}),this._flushQueue=n.debounce(()=>e.flush(),0)}load(e){if(!this._cache[e]){const t=new o.default.Deferred;this._queueThumb(e,t.resolve,t.notify),this._flushQueue(),this._cache[e]=t.promise()}return this._cache[e]}}})),define("modules/clean/react/user_notifications/models",["require","exports","tslib","modules/clean/datetime/datetime"],(function(e,t,i,n){"use strict";var o,s,a;Object.defineProperty(t,"__esModule",{value:!0}),t.getDisplayTime=t.getCampaignVersion=t.getCampaignId=t.getFeedTime=t.isSeen=t.isInvisible=t.isRead=t.isUnread=t.getKey=t.NotificationTypes=t.SharedFolderInviteOverQuotaStatuses=t.NotificationStatusStrings=t.FolderSuggestionReason=t.NotificationSeenState=t.NotificationStatuses=t.BluenoteActionTypes=void 0,n=i.__importStar(n),(function(e){e[e.OpenUrl=1]="OpenUrl",e[e.MountSharedFolder=2]="MountSharedFolder",e[e.ApproveGroupJoinRequest=3]="ApproveGroupJoinRequest",e[e.RemoveGroupJoinRequest=4]="RemoveGroupJoinRequest"})(t.BluenoteActionTypes||(t.BluenoteActionTypes={})),(function(e){e[e.Unread=0]="Unread",e[e.Read=1]="Read",e[e.Invisible=2]="Invisible"})(o=t.NotificationStatuses||(t.NotificationStatuses={})),(function(e){e[e.Unseen=1]="Unseen",e[e.Seen=2]="Seen"})(s=t.NotificationSeenState||(t.NotificationSeenState={})),(function(e){e.STARRED="starred"})(t.FolderSuggestionReason||(t.FolderSuggestionReason={})),t.NotificationStatusStrings={0:"unread",1:"read",2:"invisible"},t.SharedFolderInviteOverQuotaStatuses={ALREADY_OVER:"overquota",WILL_BE_OVER:"will_be_overquota"},(function(e){e[e.SharedFolderInvite=100]="SharedFolderInvite",e[e.Bluenote=2200]="Bluenote"})(a=t.NotificationTypes||(t.NotificationTypes={})),t.getKey=e=>`${e.userId} ${e.typeId} ${e.targetObjectKey}`,t.isUnread=e=>e.status===o.Unread,t.isRead=e=>e.status===o.Read,t.isInvisible=e=>e.status===o.Invisible,t.isSeen=e=>!(e.seenState===s.Unseen&&e.status===o.Unread),t.getFeedTime=e=>void 0===e.feedTimeInSec?void 0:new Date(1e3*e.feedTimeInSec),t.getCampaignId=e=>{let t;if(e.typeId===a.Bluenote){const i=e.typeData;i.campaignInfo&&i.campaignInfo.campaignId&&(t=`${i.campaignInfo.campaignId}`)}return t},t.getCampaignVersion=e=>{if(e.typeId===a.Bluenote){const t=e.typeData;if(t.campaignInfo&&t.campaignInfo.versionId)return t.campaignInfo.versionId}},t.getDisplayTime=e=>{const i=t.getFeedTime(e);return void 0===i?"":n.ago(i,!0)}})),define("modules/clean/react/user_notifications/renderer",["require","exports","tslib","react","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/user_notifications/dropdown_bluenote_row","modules/clean/react/user_notifications/dropdown_row","modules/clean/react/user_notifications/legacy_thumb_loader","modules/clean/react/user_notifications/models"],(function(e,t,i,n,o,s,a,r,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationRenderer=void 0,n=i.__importDefault(n),a=i.__importDefault(a);t.NotificationRenderer=class{constructor(){this.legacyThumbLoader=new r.LegacyThumbLoader,this.genericThumbStore=new o.GenericThumbStore}renderNotification(e,t){return e.rawDropdownRowHtml?n.default.createElement(a.default,{notification:e,legacyThumbLoader:this.legacyThumbLoader,isAcknowledged:t}):e.typeId===c.NotificationTypes.Bluenote?n.default.createElement(s.UserNotificationsDropdownBluenoteRow,{notification:e,thumbStore:this.genericThumbStore,isAcknowledged:t}):null}}})),define("modules/clean/react/user_notifications/shared/icon_mark_as_read",["require","exports","tslib","react"],(function(e,t,i,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IconMarkAsRead=void 0,n=i.__importStar(n),t.IconMarkAsRead=e=>n.createElement("svg",Object.assign({width:"24",height:"24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),n.createElement("path",{d:"M5 12l4.147 4.608a.5.5 0 0 0 .726.02L19 7.5",stroke:"#1D2737",strokeWidth:"1.5"}))})),define("modules/clean/react/user_notifications/shared/notification_row_wrapper",["require","exports","tslib","classnames","react","modules/clean/react/components/css","modules/clean/react/user_notifications/shared/icon_mark_as_read","modules/clean/react/title_bubble","modules/core/i18n","modules/clean/react/sticky_position"],(function(e,t,i,n,o,s,a,r,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationRowWrapper=void 0,n=i.__importDefault(n),o=i.__importDefault(o);class u extends o.default.Component{constructor(e){super(e),this.state={hover:!1},this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this)}onMouseOver(){this.setState({hover:!0})}onMouseOut(){this.setState({hover:!1})}renderInfoSheet(){const e=n.default({"notification-row-info-sheet":!0,"notification-row-info-sheet--visible":this.state.hover,"notification-row-info-sheet--unread":this.props.unread}),t=c.intl.formatMessage({id:"we6GC8",defaultMessage:"Mark as read"});return o.default.createElement("div",{className:e},o.default.createElement(r.TitleBubble,{position:l.StickyPosition.TOP,content:t},o.default.createElement("button",{className:"notification-row-info-sheet--markasread",onClick:this.props.onAcknowledge,"aria-label":t},o.default.createElement(a.IconMarkAsRead,null))))}render(){return o.default.createElement("div",{className:"notification-row-wrapper",onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut},this.props.unread&&this.renderInfoSheet(),this.props.row)}}u.displayName="NotificationRowWrapper";const d=s.requireCssWithComponent(u,["/static/css/user_notifications_shared-vfl9-_5_E.css"]);t.NotificationRowWrapper=d})),define("modules/clean/react/user_notifications/shared/tray_chrome",["require","exports","tslib","react","react-dom","modules/clean/react/components/css","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/shared/tray_section"],(function(e,t,i,n,o,s,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationsTrayChrome=void 0,n=i.__importDefault(n),o=i.__importStar(o);class c extends n.default.Component{constructor(e){super(e),this.handleOnScroll=()=>{this.scrollWithinOffsetToBottom(10)&&(this.logRendersForPage(this.state.visiblePages),this.setState({visiblePages:this.state.visiblePages+1}))},this.handleOnWheel=e=>{const t=-40*e.deltaY,i=o.findDOMNode(this);t<=0&&this.scrollWithinOffsetToBottom(0)?e.preventDefault():t>=0&&0===i.scrollTop&&e.preventDefault()};const t=this.processNotifications(this.props.notifications);this.state={visiblePages:1,unreadNotifications:t.unreadNotifications,readNotifications:t.readNotifications}}componentDidMount(){this.props.onTrayMount(),this.logRendersForPage(0)}processNotifications(e){const t=this.state&&this.state.unreadNotifications||[],i={};t.forEach(e=>i[a.getKey(e)]=!0);const n=[],o=[];return e.forEach(e=>{a.isUnread(e)||i[a.getKey(e)]?n.push(e):o.push(e)}),{unreadNotifications:n,readNotifications:o}}logRendersForPage(e){const t=this.state.unreadNotifications.concat(this.state.readNotifications).slice(10*e,10*(e+1));this.props.notifLogRenderFunc(t,10*e)}shouldComponentUpdate(e){return!(e.isLoading&&!this.props.isLoading)}UNSAFE_componentWillReceiveProps(e){this.setState(this.processNotifications(e.notifications))}scrollWithinOffsetToBottom(e){const t=o.findDOMNode(this);return t.scrollHeight-t.scrollTop-t.offsetHeight<=e}render(){if(this.props.isLoading)return n.default.createElement("div",{className:"notifications-tray--loading"},this.props.loadingMessage);if(0===this.state.unreadNotifications.length&&0===this.state.readNotifications.length)return n.default.createElement("div",{className:"notifications-tray--empty"},this.props.emptyMessage);const e=this.state.unreadNotifications.slice(0,10*this.state.visiblePages),t=this.state.readNotifications.slice(0,10*this.state.visiblePages-e.length);return n.default.createElement("div",{className:"notifications-tray--loaded",onScroll:this.handleOnScroll,onWheel:this.handleOnWheel},n.default.createElement(r.NotificationsTraySection,{notifications:e,sectionTitle:this.props.unreadSectionTitle,actionButtonText:this.props.markAllAsReadButtonTitle,actionButtonAction:this.props.markAllAsReadAction,notifRenderFunc:this.props.notifRenderFunc,isUnreadSection:!0}),n.default.createElement(r.NotificationsTraySection,{notifications:t,sectionTitle:this.props.readSectionTitle,notifRenderFunc:this.props.notifRenderFunc,isUnreadSection:!1}))}}c.displayName="NotificationsTrayChrome";const l=s.requireCssWithComponent(c,["/static/css/user_notifications_shared-vfl9-_5_E.css"]);t.NotificationsTrayChrome=l})),define("modules/clean/react/user_notifications/shared/tray_section",["require","exports","tslib","react","modules/clean/react/components/css","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/shared/notification_row_wrapper"],(function(e,t,i,n,o,s,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationsTraySection=void 0,n=i.__importDefault(n),s=i.__importDefault(s);class c extends n.default.Component{constructor(e){super(e),this.onClickActionButton=this.onClickActionButton.bind(this)}onClickActionButton(){this.props.actionButtonAction&&this.props.actionButtonAction()}renderReadSectionHeader(){let e=null;return this.props.actionButtonText&&(e=n.default.createElement("button",{className:"notifications-tray-section-header--button",onClick:this.onClickActionButton,tabIndex:0},this.props.actionButtonText)),n.default.createElement("div",{className:"notifications-tray-section-header"},n.default.createElement("span",{className:"notifications-tray-section-header--title"},this.props.sectionTitle),e)}onAckFactory(e){return t=>{t.stopPropagation(),s.default.acknowledge(e)}}render(){if(0===this.props.notifications.length)return null;const e=[];for(const t of this.props.notifications){const i=this.props.notifRenderFunc(t,!a.isUnread(t));null!=i&&e.push(n.default.createElement(r.NotificationRowWrapper,{onAcknowledge:this.onAckFactory(t),row:i,timestamp:a.getDisplayTime(t),unread:a.isUnread(t)}))}return n.default.createElement("div",null,this.renderReadSectionHeader(),e)}}c.displayName="NotificationsTraySection";const l=o.requireCssWithComponent(c,["/static/css/user_notifications_shared-vfl9-_5_E.css"]);t.NotificationsTraySection=l})),define("modules/clean/react/user_notifications/single_task_preview",["require","exports","tslib","classnames","spectrum/checkbox/index","react"],(function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SingleTaskPreview=void 0,n=i.__importDefault(n),s=i.__importDefault(s);class a extends s.default.Component{render(){const e=this.props.task,t=e.isComplete?"checked":"unchecked",i=n.default({"preview-single-task--text":!0,"preview-single-task--text--complete":e.isComplete});return s.default.createElement("div",{className:"preview-single-task"},s.default.createElement("div",null,s.default.createElement(o.Checkbox,{className:"preview-single-task--checkbox",checked:t,disabled:!0})),s.default.createElement("div",{className:i},e.name))}}t.SingleTaskPreview=a,a.displayName="SingleTaskPreview"})),define("modules/clean/react/user_notifications/store",["require","exports","tslib","lodash","modules/clean/flux/flux_store","modules/clean/react/user_notifications/api_helper","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dispatcher","modules/clean/react/user_notifications/models"],(function(e,t,i,n,o,s,a,r,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userNotificationsStore=t.UserNotificationsStore=void 0,n=i.__importStar(n);class l extends o.FluxStore{constructor(e){super(e),this.markNotificationAsReadLocally=e=>c.isUnread(e)?Object.assign(Object.assign({},e),{status:c.NotificationStatuses.Read}):e,this.isLoadingFlag=!1,this.userNotifications=[]}isLoading(){return this.isLoadingFlag}getActionableCount(){return this.getUnseenInternal().length}getUnacknowledgedCount(){return this.getUnacknowledgedInternal().length}getCursor(){return this.cursor}getAll(){return this.userNotifications}getAllVisible(){return this.userNotifications.filter(e=>!c.isInvisible(e))}getUnacknowledged(){return this.getUnacknowledgedInternal()}getUnacknowledgedInternal(){return this.userNotifications.filter(c.isUnread)}getUnseen(){return this.getUnseenInternal()}getUnseenInternal(){return this.userNotifications.filter(e=>!c.isSeen(e))}onLoadRequest(){this.isLoadingFlag||(this.isLoadingFlag=!0,this.__emitChange())}onLoadSuccess(e){if(this.isLoadingFlag&&(this.isLoadingFlag=!1,this.__emitChange()),n.isEqual(e.cursor,this.cursor)||(this.cursor=e.cursor,this.__emitChange()),e.notifications.length>0){const t={};e.notifications.concat(this.userNotifications).forEach(e=>{t[c.getKey(e)]||(t[c.getKey(e)]=e)}),this.userNotifications=n.values(t).sort(s.userNotificationComparator),this.__emitChange()}}onLoadFailure(){this.isLoadingFlag&&(this.isLoadingFlag=!1,this.__emitChange())}onAcknowledgementRequest(){this.userNotifications=this.userNotifications.map(this.markNotificationAsReadLocally),this.__emitChange()}onAcknowledgementRequestSingle(e){this.userNotifications=this.userNotifications.map(t=>t!==e?t:this.markNotificationAsReadLocally(e)),this.__emitChange()}onMarkAsSeenRequest(){this.userNotifications=this.userNotifications.map(e=>c.isSeen(e)?e:Object.assign(Object.assign({},e),{seenState:c.NotificationSeenState.Seen})),this.__emitChange()}__onDispatch(e){const t=e.action;switch(t.type){case a.ActionTypes.LOAD_REQUEST:this.onLoadRequest();break;case a.ActionTypes.LOAD_SUCCESS:this.onLoadSuccess(t.data);break;case a.ActionTypes.LOAD_FAILURE:this.onLoadFailure();break;case a.ActionTypes.ACKNOWLEDGEMENT_REQUEST:this.onAcknowledgementRequest();break;case a.ActionTypes.ACKNOWLEDGEMENT_REQUEST_SINGLE:this.onAcknowledgementRequestSingle(t.data.notifications[0]);break;case a.ActionTypes.MARK_AS_SEEN_REQUEST:this.onMarkAsSeenRequest()}}}t.UserNotificationsStore=l,t.userNotificationsStore=new l(r.userNotificationsDispatcher)})),define("modules/clean/react/user_notifications/thumbnail_preview",["require","exports","tslib","react","spectrum/file_icon/index","spectrum/icon_content/index"],(function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThumbnailPreview=void 0,n=i.__importDefault(n);const a={"paper-pad":"paper-small","paper-folder":"folder-small","dropbox-folder":"folder-small"};class r extends n.default.Component{render(){const{type:e,name:t}=this.props.object||{};return e&&t?n.default.createElement("div",{className:"preview-thumbnail--wrapper"},n.default.createElement("div",{className:"preview-thumbnail"},"dropbox-file"===e?n.default.createElement(o.FileIcon,{path:t,variant:"small",className:"preview-thumbnail--icon"}):n.default.createElement(s.IconContent,{name:a[e]||"unknown-small",className:"preview-thumbnail--icon"}),n.default.createElement("div",{className:"preview-thumbnail--text"},t))):null}}t.ThumbnailPreview=r,r.displayName="ThumbnailPreview"})),define("modules/clean/sprite",["require","exports","tslib","jquery","modules/clean/static_urls","modules/core/html"],(function(e,t,i,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=i.__importDefault(n);const a={SPACER:o.static_url("/static/images/icons/icon_spacer-vflN3BYt2.gif"),CLASS_PREFIX:"s_",_make_class(e,t){return this.CLASS_PREFIX+e+"_"+t},src(e,t,i){return this.clear(e),n.default(e).addClass(this._make_class(t,i))},replace(e,t,i,o){return n.default(e).removeClass(this._make_class(t,i)).addClass(this._make_class(t,o))},clear(e){let t=e.className.split(" ");return t=n.default.grep(t,e=>e&&0!==e.indexOf(this.CLASS_PREFIX)),e.className=t.join(" ")},make(e,t,i){return i=this._prep_attrs(e,t,i),n.default("<img />",i)[0]},html(e,t,i){i=this._prep_attrs(e,t,i);const n=["<img "];for(const e in i)n.push(e,'="',s.HTML._raw_escape(i[e]),'" ');return n.push("/>"),new s.HTML(n.join(""))},_prep_attrs(e,t,i={}){i.src=i.src||this.SPACER;const n=["sprite",`sprite_${e}`,this._make_class(e,t)];return i.class&&n.push(i.class),i.class=n.join(" "),i},_get:e=>e.className,_set(e,t){return e.className=t,e.src=this.SPACER}};t.default=a}));
//# sourceMappingURL=pkg-notifications.min.js-vflHd_5xq.map