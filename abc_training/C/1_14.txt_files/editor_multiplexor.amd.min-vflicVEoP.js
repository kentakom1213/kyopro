define(["require","exports","tslib","typescript/libraries/comments2/src/components/comment_editor/index","react","typescript/libraries/file-viewer/src/plugins/index","dig-components/buttons","dig-components/typography","dig-components/icons","react-intl","dig-components/icons/src","dig-components/tooltips","react-redux","typescript/component_libraries/files_components/src/blades/comments/data/actions","typescript/libraries/file-viewer/src/comments2/disabled_time_annotation_tooltip","typescript/libraries/file-viewer/src/comments2/plugin/utils"],(function(e,t,n,a,i,o,s,r,l,d,m,c,u,p,g,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommentEditorMultiplexor=t.toFramePrecisionProps=void 0,i=n.__importStar(i);const E={type:"image",region:{x:0,y:0,width:1,height:1}},v=()=>window.localStorage.setItem("has_seen_timestamp_annotation_tooltip","true"),b=e=>{var{draftNumberedAnnotation:t,annotationState:o,intl:s,placeholder:r}=e,l=n.__rest(e,["draftNumberedAnnotation","annotationState","intl","placeholder"]);return i.default.createElement(a.NumberedCommentEditor,Object.assign({},l,{disabled:f.isAnnotating(o),placeholder:f.isAnnotating(o)?s.formatMessage(S):r,defaultAnnotation:E,pendingAnnotation:t}))};b.displayName="ImageCommentEditor";const y=e=>{var{currentPageIndex:t,draftNumberedAnnotation:o,annotationState:s,intl:r,placeholder:l}=e,d=n.__rest(e,["currentPageIndex","draftNumberedAnnotation","annotationState","intl","placeholder"]);const m=i.default.useMemo(()=>({type:"document",regionType:"rectangle",regions:[{page:t+1,x:0,y:0,width:1,height:1}]}),[t]);return i.default.createElement(a.NumberedCommentEditor,Object.assign({},d,{disabled:f.isAnnotating(s),placeholder:f.isAnnotating(s)?r.formatMessage(_):l,defaultAnnotation:m,pendingAnnotation:o}))};y.displayName="DocumentCommentEditor";const M=e=>{var{currentTimestamp:t,intl:o,annotationState:s,useV2Design:r}=e,l=n.__rest(e,["currentTimestamp","intl","annotationState","useV2Design"]);const{playerIntegrationEnabled:m,placeholder:c}=l,u=!r||f.isEditingAnnotation(s),p=i.default.useMemo(()=>u?{type:"audio",time:m?Math.floor(100*t):0}:void 0,[t,m,u]);return i.default.createElement(d.IntlContext.Provider,{value:o},i.default.createElement(a.TimeCodedCommentEditor,Object.assign({},l,{pendingAnnotation:p,disabled:f.isAnnotating(s),placeholder:f.isAnnotating(s)?o.formatMessage(x):c})))};function A(e,t){return e&&void 0!==t?{framePreciseCommentsEnabled:!0,frameRate:t}:{framePreciseCommentsEnabled:!1}}M.displayName="AudioCommentEditor",t.toFramePrecisionProps=A;const h=e=>{var{currentTimestamp:t,isPlaying:o,intl:s,annotationState:r,useV2Design:l}=e,m=n.__rest(e,["currentTimestamp","isPlaying","intl","annotationState","useV2Design"]);const{framePreciseCommentsEnabled:c,playerIntegrationEnabled:u,placeholder:p}=m,E=(({lastTimestampFromVideoPlayer:e,shouldApproximate:t})=>{const[n,a]=i.default.useState(e);return i.default.useEffect(()=>{if(!t)return;const n=performance.now();let i=!0;const o=()=>{if(i){const t=performance.now()-n;a(e+t/1e3),requestAnimationFrame(o)}};return o(),()=>{i=!1}},[e,t]),t?n:e})({lastTimestampFromVideoPlayer:u?t:0,shouldApproximate:Boolean(o&&u&&c)}),v=!l||f.isEditingAnnotation(r),b=i.default.useMemo(()=>v?{type:"video",time:Math.floor(100*E),timeSec:E}:void 0,[E,v]);return i.default.createElement("span",null,i.default.createElement(d.IntlContext.Provider,{value:s},i.default.createElement(a.TimeCodedCommentEditor,Object.assign({},m,{pendingAnnotation:b,disabled:f.isAnnotating(r),placeholder:f.isAnnotating(r)?s.formatMessage(x):p,tooltipComponent:u?void 0:g.DisabledTimeAnnotationTooltip}))))};h.displayName="VideoCommentEditor";const C=d.defineMessage({id:"mXX6Pu",defaultMessage:"Comment on a section"}),w=d.defineMessage({id:"AeKHE6",defaultMessage:"Comment on an area"}),I=d.defineMessage({id:"ueIzgL",defaultMessage:"Click to comment on this timestamp"}),T=d.defineMessage({id:"HRP1D0",defaultMessage:"This file is not on a plan that includes time-based commenting."}),P=d.defineMessage({id:"JgXeI9",defaultMessage:"Cancel"}),_=d.defineMessage({id:"HrUUyJ",defaultMessage:"Highlight a section to comment on"}),S=d.defineMessage({id:"+XrOKO",defaultMessage:"Highlight an area to comment on"}),x=d.defineMessage({id:"clBbW2",defaultMessage:"Select a timestamp to comment on"}),N=d.defineMessage({id:"qAINeh",defaultMessage:"Comment on a timestamp"}),D=d.defineMessage({id:"STlbVd",defaultMessage:"Click this icon to comment on a specific point in the file."}),k=d.defineMessage({id:"oCFCES",defaultMessage:"To comment on the entire thing, simply click into the comment box."}),F=d.defineMessage({id:"oNp+kB",defaultMessage:"Got it"}),V=({visible:e,setSeen:t,intl:n,triggerRef:a})=>i.default.createElement(c.Tooltip.Control,{triggerRef:a,variant:"rich",open:e,auto:!0,placement:"bottom-start"},i.default.createElement(r.Title,{size:"standard",inverse:!0},n.formatMessage(N)),i.default.createElement(r.Text,{tagName:"p",color:"standard",inverse:!0},n.formatMessage(D)),i.default.createElement(r.Text,{tagName:"p",color:"standard",inverse:!0},n.formatMessage(k)),i.default.createElement("div",{className:"step-actions"},i.default.createElement(s.Button,{variant:"outline",inverse:!0,onClick:t,autoFocus:!0},n.formatMessage(F)))),O=i.default.memo(({file:e,annotationState:t,previewType:n,fileViewerId:a,timestampAnnotationsEnabled:r,navigation:g,axAnnotationsEnabled:E})=>{const b=i.useRef(null),[y,M]=i.useState(()=>null!==localStorage.getItem("has_seen_timestamp_annotation_tooltip")),A=d.useIntl(),h=u.useDispatch(),_=e=>e.preventDefault();if(i.useEffect(()=>(window.addEventListener("beforeunload",v),()=>window.removeEventListener("beforeunload",v)),[]),f.isEditingAnnotation(t)){const e=()=>{h(p.cancelAnnotating(a))},t=e=>{" "!==e.key&&"Enter"!==e.key||(h(p.cancelAnnotating(a)),e.nativeEvent.stopImmediatePropagation())},n=A.formatMessage(P);return i.default.createElement(s.IconButton,{variant:"transparent",size:"small",onClick:e,onKeyDown:t,onMouseDown:_,"aria-label":n},i.default.createElement(l.UIIcon,{src:m.CloseLine}))}let S,x,N,D=!1;switch(n){case o.PreviewType.Image:e.dimensions?(S=A.formatMessage(w),N=e=>{h(p.startAnnotating(a,e))}):(S=void 0,N=void 0,D=!0),x=i.default.createElement(l.UIIcon,{src:m.AddCommentLine});break;case o.PreviewType.Other:S=A.formatMessage(w),N=e=>{h(p.startAnnotating(a,e))},x=i.default.createElement(l.UIIcon,{src:m.AddCommentLine});break;case o.PreviewType.SsrDoc:S=A.formatMessage(C),x=i.default.createElement(l.UIIcon,{src:m.AddCommentLine}),N=e=>{h(p.startAnnotating(a,e))};break;case o.PreviewType.Audio:case o.PreviewType.Video:r?y?(S=A.formatMessage(I),N=e=>{g.pause(),h(e?p.startAnnotating(a,!0):p.confirmDraftAnnotation(a))}):S=void 0:(N=void 0,S=A.formatMessage(T),D=!0),x=i.default.createElement(l.UIIcon,{src:m.ClockLine});break;default:return null}return i.default.createElement(i.default.Fragment,null,i.default.createElement(V,{intl:A,visible:!y&&r,setSeen:()=>{M(!0),v()},triggerRef:b}),i.default.createElement("div",{ref:b},i.default.createElement(c.Tooltip,{title:S,placement:"bottom"},i.default.createElement("span",{style:{display:"inline-block"},tabIndex:D?0:-1},i.default.createElement(s.IconButton,{variant:"transparent",size:"small",onClick:()=>{N&&N(!1)},onMouseDown:_,onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||N&&(N(E),e.preventDefault(),e.nativeEvent.stopImmediatePropagation())},"aria-label":S,disabled:D},x)))))});O.displayName="RightAccessoryButton",t.CommentEditorMultiplexor=e=>{var t,n;const{draftNumberedAnnotation:s,editorFocusRequested:r,commentEditorProps:l,intl:d,file:m,context:c,navigation:p}=e,g=i.default.useMemo(()=>f.getFrameRateFromMetadata(m.contentMetadata),[m]),E=u.useSelector(e=>e.annotationState),v=null!==(n=null===(t=e.supportedEnhancements)||void 0===t?void 0:t.time_based_annotations)&&void 0!==n&&n,C=i.default.createElement(O,{file:e.file,annotationState:E,previewType:e.previewType,fileViewerId:c.fileViewerId,timestampAnnotationsEnabled:v,navigation:p,axAnnotationsEnabled:c.sdkConfig.ax_annotations}),w=c.sdkConfig.preview_page_revamp;switch(e.previewType){case o.PreviewType.Image:return i.default.createElement(b,Object.assign({},l,{rightAccessory:C,draftNumberedAnnotation:s,shouldFocus:r,annotationState:E,intl:d}));case o.PreviewType.SsrDoc:return i.default.createElement(y,Object.assign({},l,{rightAccessory:C,draftNumberedAnnotation:s,currentPageIndex:e.ui.currentPageIndex,shouldFocus:r,annotationState:E,intl:d}));case o.PreviewType.Audio:return i.default.createElement(M,Object.assign({},l,{rightAccessory:C,currentTimestamp:e.ui.currentTimestamp,intl:d,shouldFocus:r,playerIntegrationEnabled:v,annotationState:E,useV2Design:w}));case o.PreviewType.Video:return i.default.createElement(h,Object.assign({},l,{rightAccessory:C,currentTimestamp:e.ui.currentTimestamp,isPlaying:e.ui.isPlaying,intl:d,shouldFocus:r,playerIntegrationEnabled:v,annotationState:E,useV2Design:w},A(e.framePreciseCommentsEnabled,g)));case o.PreviewType.CloudDoc:return null}return i.default.createElement(a.CommentEditor,Object.assign({},l))},t.CommentEditorMultiplexor.displayName="CommentEditorMultiplexor",t.CommentEditorMultiplexor.displayName="CommentEditorMultiplexor"}));
//# sourceMappingURL=editor_multiplexor.amd.min.js-vfli7YHgo.map