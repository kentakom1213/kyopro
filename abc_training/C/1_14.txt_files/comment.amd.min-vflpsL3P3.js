define(["require","exports","tslib","react","classnames","spectrum/tertiary_link/index","spectrum/tooltip/index","typescript/libraries/comments2/src/components/comment/separator","typescript/libraries/comments2/src/components/comment_avatar/index","typescript/libraries/comments2/src/components/comment_editor/comment_editor","typescript/libraries/comments2/src/components/comment_editor/components/post_bar","typescript/libraries/comments2/src/components/comment_editor/comment_renderer","prop-types","typescript/libraries/dbx-i18n/src/index","react-intl","dig-components/typography","dig-components/buttons","typescript/libraries/comments2/src/components/utils/approval_utils","typescript/libraries/comments2/src/components/approval_comment/comment_title"],(function(e,t,n,s,o,a,i,r,m,c,l,p,d,u,h,v,g,f,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Comment=t.CommentActionMenu=t.InactiveCommentInfo=t.RightRailCommentInfo=t.ActiveCommentInfo=t.OlderInfo=t.InlineCommentEditorPostBar=void 0,s=n.__importStar(s),o=n.__importDefault(o),d=n.__importDefault(d);const M=(e,{localization:{intl:t}})=>s.createElement(l.PostBar,Object.assign({},e,{postLabel:t.formatMessage({id:"GM9O28",defaultMessage:"Save"}),cancelLabel:t.formatMessage({id:"xuJw2w",defaultMessage:"Cancel"})}));function C(e){const{actions:t,active:n,comment:{revisionInfo:o,threadId:r},intl:m}=e,c=o.timestamp?m.formatMessage({id:"TrMn7R",defaultMessage:"On older version ({timestamp})"},{timestamp:m.formatTime(o.timestamp,{day:"numeric",month:"short"})}):m.formatMessage({id:"KwIXAO",defaultMessage:"On older version"});return n&&o.revision?s.createElement(i.Tooltip,{positioning:"above",tooltipContent:m.formatMessage({id:"1d7dxH",defaultMessage:"View version history"})},s.createElement(a.TertiaryLink,{className:"sc-comment-older-version",onClick:()=>t.onClickOlderInfo(o,r)},c)):s.createElement("div",{className:"sc-comment-older-version"},c)}function y(e){const{comment:t,intl:n,showRevisionInfo:o}=e,{author:a,id:i,revisionInfo:r,threadId:m,timestamp:c}=t;return s.createElement("div",{className:"sc-comment-info"},o&&!r.isCurrent&&i===m?s.createElement(C,Object.assign({},e)):null,s.createElement("div",{className:"sc-comment-author-timestamp"},s.createElement("span",{className:"sc-comment-author"},a.name.display),c.getTime()?s.createElement("span",{className:"sc-comment-timestamp"},u.timeSince(n,c,{displayLocation:"label",displayContext:"sentence-middle"})):null))}function b(e){const{comment:{id:t,revisionInfo:n,threadId:o},showRevisionInfo:a}=e;return a&&!n.isCurrent&&t==o?s.createElement("div",{className:"sc-comment-info"},s.createElement(C,Object.assign({},e))):null}M.contextTypes={localization:d.default.object},t.InlineCommentEditorPostBar=s.memo(M),t.InlineCommentEditorPostBar.displayName="InlineCommentEditorPostBar",t.OlderInfo=C,t.ActiveCommentInfo=y,t.RightRailCommentInfo=e=>{const{comment:t,intl:n,showRevisionInfo:o,commentControls:a}=e,{author:i,id:r,revisionInfo:m,threadId:c,timestamp:l}=t;return s.createElement("div",{className:"sc-comment-info--right-rail"},o&&!m.isCurrent&&r===c?s.createElement(C,Object.assign({},e)):null,s.createElement("div",{className:"sc-comment-author-timestamp"},s.createElement("span",{className:"sc-comment-author--right-rail"},i.name.display),l.getTime()?s.createElement("span",{className:"sc-comment-timestamp--right-rail"},u.timeSince(n,l,{displayLocation:"label",displayContext:"sentence-middle"})):null),s.createElement("div",{className:"sc-comments-thread-control-wrapper"},a))},t.RightRailCommentInfo.displayName="RightRailCommentInfo",t.InactiveCommentInfo=b;const I=h.defineMessage({id:"ZeF6kJ",defaultMessage:"Edit"}),N=h.defineMessage({id:"2WeS6D",defaultMessage:"Delete"});t.CommentActionMenu=e=>{const{comment:t,comment:{userPermissions:{canEdit:n,canDelete:i},content:{text:r,metadata:m}},actions:{onDeleted:c,onApproverRespond:l,onEditApproval:p,onDeleteApprovalComment:d,onResubmitApprovalFocus:u},isMobile:h,active:E,onStartEdit:M,intl:C,useV2Design:y,isLatestReply:b,isApprovalOpen:A,showApproval:D}=e,x=s.useCallback(()=>{M(t)},[t,M]),R=(e=x)=>y?s.createElement(v.Text,{size:"small"},s.createElement(v.Link,{href:e,variant:"monochromatic"},C.formatMessage(I))):s.createElement(a.TertiaryLink,{onClick:e},C.formatMessage(I)),_=(e=c)=>y?s.createElement(v.Text,{size:"small"},s.createElement(v.Link,{href:e,variant:"monochromatic"},C.formatMessage(N))):s.createElement(a.TertiaryLink,{onClick:e},C.formatMessage(N)),O=f.getApprovalMetadata(m),w=null==O?void 0:O.actor,k=Boolean(O&&("requester"==w||"approver"==w));if(!n&&!i&&!k||h||!E)return null;if(D&&O&&w){if(!y)return null;if(!b||A)return null;const e=s.createElement(g.Button,{variant:"outline",onClick:l,size:"small"},C.formatMessage({id:"q997hq",defaultMessage:"Respond"})),a=s.createElement(g.Button,{variant:"outline",onClick:u,size:"small"},C.formatMessage({id:"MoNd+x",defaultMessage:"Resubmit request"}));return s.createElement("div",{className:o.default("sc-comment-actions","approval")},n&&p&&R(()=>p({commentId:t.id,content:r,approvalMetadata:O})),n&&i&&s.createElement("span",{className:"sc-comment-actions-separator"},"•"),i&&d&&_(()=>d(t.id,w)),l&&"request"===O.approval_type&&"approver"===w&&!n&&!i&&e,u&&"response"===O.approval_type&&"requester"===w&&!n&&!i&&a)}return s.createElement("div",{className:"sc-comment-actions"},n&&R(),n&&i&&s.createElement("span",{className:"sc-comment-actions-separator"},"•"),i&&_())},t.CommentActionMenu.displayName="CommentActionMenu";class A extends s.PureComponent{constructor(){super(...arguments),this.onSave=e=>{this.props.actions.onEdited(e),this.props.onEndEdit()},this.onMentionsQueryUpdated=this.props.actions.onMentionsQueryUpdated}classNameUtil(...e){const{active:t=!1,className:n,comment:{deleted:s}}=this.props;return o.default(n,...e,{"sc-comment-active":t,"sc-comment-deleted":s})}get intl(){return this.context.localization.intl}get useV2Design(){return this.context.useV2Design}get showApproval(){return this.context.showApproval}get approvalMetadata(){return f.getApprovalMetadata(this.props.comment.content.metadata)}renderDeletedMode(){const{children:e}=this.props;return s.createElement("li",{className:this.classNameUtil(this.useV2Design?"sc-comment-deleted--right-rail":void 0)},this.useV2Design?s.createElement(m.DeletedDIGCommentAvatar,null):s.createElement(m.DeletedCommentAvatar,null),s.createElement("div",{className:"sc-comment-content-container"},s.createElement("div",{className:"sc-comment-content"},e,e&&s.createElement(r.Separator,null),s.createElement("span",{className:"sc-comment-text"},this.intl.formatMessage({id:"w9I0zq",defaultMessage:"This comment was deleted."})))))}renderDisplayMode(){const{active:e=!1,children:n,comment:{content:o,author:a,revisionInfo:i},commentAvatarComponent:r}=this.props,m=Object.assign(Object.assign({},this.props),{intl:this.intl}),c=this.useV2Design?p.CommentRendererV2:p.CommentRenderer;return s.createElement("li",{className:this.classNameUtil(this.context.useV2Design?"sc-comment-renderer--right-rail":"sc-comment-renderer")},s.createElement(c,{content:o,author:a,commentAvatarComponent:r,annotation:n,revisionInfo:i},n=>s.createElement("div",{className:"sc-comment-renderer-content-wrapper"},this.useV2Design?s.createElement(t.RightRailCommentInfo,Object.assign({},m)):e?s.createElement(y,Object.assign({},m)):s.createElement(b,Object.assign({},m)),this.showApproval&&this.approvalMetadata&&s.createElement(E.ApprovalCommentTitle,{intl:this.intl,metadata:this.approvalMetadata,content:o.text}),n,s.createElement(t.CommentActionMenu,Object.assign({},m,{useV2Design:this.useV2Design,showApproval:this.showApproval})))))}renderEditMode(){const{comment:e,mentionsMatches:n,onEndEdit:o}=this.props;return s.createElement("li",{className:this.classNameUtil("sc-comment-editor","sc-comment-inline-editor",this.useV2Design?"sc-comment-editor--right-rail":void 0)},s.createElement(c.CommentEditor,{author:e.author,content:e.content,postSignalComponent:t.InlineCommentEditorPostBar,onCancel:o,onPost:this.onSave,mentionsMatches:n,onMentionsQueryUpdated:this.onMentionsQueryUpdated,renderBare:!0,shouldFocus:!0}))}render(){return this.approvalMetadata&&this.props.isEditingApproval&&this.props.isLatestReply?null:this.props.comment.deleted?this.renderDeletedMode():this.props.isEditing?this.renderEditMode():this.renderDisplayMode()}}t.Comment=A,A.contextTypes={localization:d.default.object,useV2Design:d.default.bool,showApproval:d.default.bool},A.defaultProps={isEditing:!1},A.displayName="Comment"}));
//# sourceMappingURL=comment.amd.min.js-vflIHCiH3.map