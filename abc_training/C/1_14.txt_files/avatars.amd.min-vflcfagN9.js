define(["require","exports","tslib","react","typescript/libraries/comments2/src/components/rich_facepile/context","spectrum/avatar/index","spectrum/facepile/index","typescript/libraries/comments2/src/components/rich_facepile/spectrum_fork/facepile_members_avatar","spectrum/util/uuid_generator","typescript/libraries/comments2/src/components/rich_facepile/leave_active_mode_wrapper","typescript/libraries/comments2/src/components/rich_facepile/types"],(function(e,t,o,i,n,s,a,r,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Avatars=void 0,i=o.__importStar(i);class p extends i.Component{constructor(){super(...arguments),this.state={},this.tooltipContentWrapperClassName=l.generateUUID("sc-rich-facepile-tooltip-content"),this.documentClickListener=e=>{const t=e.target;void 0===this.state.activeTooltipIndex||this.closest(t,this.tooltipContentWrapperClassName)||this.closest(t,"mc-facepile-container")||this.setActiveTooltipIndex(void 0)},this.leaveActiveMode=()=>{this.setActiveTooltipIndex(void 0)},this.bindN=e=>{const t=[];for(let o=0;o<d.MAX_FACES;o++)t.push(()=>e(o));return t},this.onTooltipShownForIndex=e=>{if(this.activeMode)return;const{onTooltipChange:t}=this.props,o=this.infoFromIndex(e);if(t&&null!==o){const i=this.avatarRectForIndex(e,o);t({activeMode:this.activeMode,displayInfo:null},{activeMode:this.activeMode,displayInfo:o,avatarRect:i})}},this.onTooltipHiddenForIndex=e=>{if(this.activeMode)return;const{onTooltipChange:t}=this.props,o=this.infoFromIndex(e);t&&null!==o&&t({activeMode:this.activeMode,displayInfo:o},{activeMode:this.activeMode,displayInfo:null})},this.onAvatarClickForIndex=e=>{const{becomePassiveOnOverflowAvatarClick:t,onAvatarClick:o}=this.props,i=this.infoFromIndex(e),n=t&&i===d.OVERFLOW;n||this.activeMode||this.setActiveTooltipIndex(e),n&&this.activeMode&&this.setActiveTooltipIndex(void 0),i&&o&&o(i)},this.onAvatarMouseOverForIndex=e=>{this.activeMode&&this.setActiveTooltipIndex(e)},this.onAvatarMouseEnterForIndex=e=>{if(this.props.onAvatarMouseEnter){const t=this.infoFromIndex(e),o=this.avatarRectForIndex(e,t);this.props.onAvatarMouseEnter({activeMode:this.activeMode,displayInfo:t,avatarRect:o})}},this.onAvatarFocusForIndex=e=>{this.onAvatarMouseEnterForIndex(e),this.onAvatarMouseOverForIndex(e)},this.onTooltipShown=this.bindN(this.onTooltipShownForIndex),this.onTooltipHidden=this.bindN(this.onTooltipHiddenForIndex),this.onAvatarClick=this.bindN(this.onAvatarClickForIndex),this.onAvatarMouseOver=this.bindN(this.onAvatarMouseOverForIndex),this.onAvatarMouseEnter=this.bindN(this.onAvatarMouseEnterForIndex),this.onAvatarFocus=this.bindN(this.onAvatarFocusForIndex),this.avatarDivRefs=Array(d.MAX_FACES).fill(0).map(e=>i.createRef())}componentDidMount(){document.addEventListener("click",this.documentClickListener,!0),window.addEventListener("resize",this.leaveActiveMode,!0)}componentWillUnmount(){document.removeEventListener("click",this.documentClickListener,!0),window.removeEventListener("resize",this.leaveActiveMode,!0)}closest(e,t){for(;e;e=e.parentElement)if(e.classList.contains(t))return e;return null}get activeMode(){return void 0!==this.state.activeTooltipIndex}setActiveTooltipIndex(e){const{activeTooltipIndex:t}=this.state,{onTooltipChange:o}=this.props;if(o&&t!==e){const{activeMode:i}=this,n=void 0!==e,s=n?this.infoFromIndex(e):null;o({activeMode:i,displayInfo:i?this.infoFromIndex(t):s},{activeMode:n,displayInfo:s,avatarRect:n?this.avatarRectForIndex(e,s):void 0})}this.setState({activeTooltipIndex:e})}displayModeForIndex(e){const{activeTooltipIndex:t}=this.state,o=this.props.passiveShowOnHover?d.DisplayMode.Hover:d.DisplayMode.Auto;return void 0===t?o:t===e?d.DisplayMode.ForceShow:d.DisplayMode.ForceHide}infoFromIndex(e){const{avatarInfoList:t,avatarInfoList:{length:o},overflowRemainderCount:i}=this.props;return i&&e===o?d.OVERFLOW:e>=o?null:t[e]}getBoundingClientRectForRef({current:e}){return e?e.getBoundingClientRect():{left:-1,top:-1,width:0,height:0,right:-1,bottom:-1}}avatarRectForIndex(e,t){if(void 0===t&&(t=this.infoFromIndex(e)),!t)return;const{left:o,top:i,width:n,height:s}=this.getBoundingClientRectForRef(this.avatarDivRefs[e]);return{origin:{x:o,y:i},size:{width:n,height:s}}}get intl(){return this.context.intl}render(){const{avatarSize:e,avatarInfoList:t,overflowRemainderCount:o,tooltipComponent:n,renderFacepile:l,initialsToColorAssigner:p,source:v}=this.props,h=t.map((t,o)=>{const{present:a,activeTooltipContent:l,avatarColorSeed:d,displayName:h,initials:u,memberKey:m,passiveTooltipContent:f,photoUrl:M}=t,C=d||h,I=i.createElement("div",{onFocusCapture:this.onAvatarFocus[o],ref:this.avatarDivRefs[o]},i.createElement(r.FacepileMembersAvatar,{active:a,"aria-label":h,avatarColorSeed:C,avatarSize:e,initials:u,onClick:this.onAvatarClick[o],onMouseEnter:this.onAvatarMouseEnter[o],onMouseOver:this.onAvatarMouseOver[o],photoUrl:M,initialsToColorAssigner:p||void 0}));let x;return this.activeMode?(x=void 0!==l?l:f,null!==x&&(x=i.createElement(c.LeaveActiveModeWrapperContext.Provider,{value:{signalClick:this.leaveActiveMode}},x))):x=f,i.createElement(n,{avatar:I,source:v,displayMode:this.displayModeForIndex(o),tooltipContent:x,avatarColor:p?p(C):s.avatarColorForUserIdentifier(C),onTooltipShown:this.onTooltipShown[o],onTooltipHidden:this.onTooltipHidden[o],tooltipContentWrapperClassName:this.tooltipContentWrapperClassName,key:m})}),{intl:u}=this;if(o){const s=u.formatMessage({id:"tkBGME",defaultMessage:"99+"}),r=o>=99?s:""+o,l=t.length,c=i.createElement("div",{onFocusCapture:this.onAvatarMouseOver[l],ref:this.avatarDivRefs[l]},i.createElement(a.FacepileMembersOverflowCircle,{avatarSize:e,backgroundColor:"#627283",textColor:"white",onClick:this.onAvatarClick[l],onMouseOver:this.onAvatarMouseOver[l],remainderCount:r})),p=u.formatMessage({id:"U34Aor",defaultMessage:"{count, plural, one {# other} other {# others}}"},{count:o});h.push(i.createElement(n,{source:v,avatar:c,displayMode:this.displayModeForIndex(l),tooltipContent:i.createElement("div",{className:"sc-rich-facepile-overflow-tooltip-content"},p),avatarColor:"#627283",onTooltipShown:this.onTooltipShown[l],onTooltipHidden:this.onTooltipHidden[l],tooltipContentWrapperClassName:this.tooltipContentWrapperClassName,key:d.OVERFLOW}))}return l(h)}}t.Avatars=p,p.contextType=n.RichFacepileContext,p.displayName="Avatars"}));
//# sourceMappingURL=avatars.amd.min.js-vflkxEDUz.map