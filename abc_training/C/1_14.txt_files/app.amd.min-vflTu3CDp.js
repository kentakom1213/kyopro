define(["require","exports","tslib","react","classnames","react-redux","typescript/libraries/file-viewer/src/core/data/actions","typescript/libraries/file-viewer/src/core/data/selectors","typescript/libraries/file-viewer/src/css/app.css","typescript/libraries/file-viewer/src/core/logging/constants","typescript/libraries/file-viewer/src/renderer","typescript/libraries/file-viewer/src/titlebar/index","typescript/libraries/file-viewer/src/modes/index","typescript/libraries/file-viewer/src/modes/sidebar/sidebar","typescript/libraries/file-viewer/src/keyboard/index","react-intl","typescript/libraries/file-viewer/src/plugins/types","typescript/libraries/file-viewer/src/plugins/selectors/index","dig-components/layer","dig-components/progress_indicators","typescript/libraries/file-viewer/src/plugins/props","typescript/libraries/file-viewer/src/plugins/data","typescript/libraries/file-viewer/src/preview_error/index","typescript/libraries/file-viewer/src/modes/render_sidebar_pass","typescript/libraries/file-viewer/src/sidebar/index","typescript/libraries/file-viewer/src/modes/sidebar/utils","typescript/libraries/file-viewer/src/title_bar_v2/index","typescript/libraries/file-viewer/src/preview_archive/breadcrumbs","typescript/libraries/file-viewer/src/sidebar_v2/index","typescript/libraries/file-viewer/src/utils","typescript/libraries/file-viewer/src/mobile_web/footer","typescript/libraries/file-viewer/src/mobile_web/meatball_menu","typescript/libraries/file-viewer/src/toolbar/toolbar_v2","typescript/component_libraries/retrieval-components/src/simple-action-bar/action_bar_types","typescript/libraries/file-viewer/src/preview_audio_video/helper/browser_detection","typescript/libraries/file-viewer/src/sidebar_v2/edit_plugin_sidebar","typescript/libraries/file-viewer/src/preview_error/error_boundary","typescript/libraries/file-viewer/src/plugins/edit_fullscreen_plugin_action","typescript/libraries/file-viewer/src/css/preview-core.css","typescript/libraries/file-viewer/src/core/data/modes/types","typescript/libraries/file-viewer/src/core/logging/actions","typescript/libraries/file-viewer/src/core/utils/index"],(function(e,i,r,t,n,s,l,a,o,d,p,c,u,v,g,f,w,b,h,y,I,m,_,S,P,E,F,T,A,R,C,M,D,V,B,K,O,x,N,L,k,z){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.AppWithProvider=i.App=i.calcResponsiveSize=void 0,t=r.__importStar(t),n=r.__importDefault(n),o=r.__importStar(o),N=r.__importStar(N);function U(e){return B.is_mobile_or_tablet()?e>1026?V.ResponsiveSize.DESKTOP:e<=736?V.ResponsiveSize.MOBILE:V.ResponsiveSize.TABLET:e>736?V.ResponsiveSize.DESKTOP:e<=428?V.ResponsiveSize.MOBILE:V.ResponsiveSize.TABLET}i.calcResponsiveSize=U;const H=t.memo(e=>{const{id:i,previewKey:r,isFileFlippingEnabled:n,isPreviewZoomed:s,enableFullscreen:a,dispatch:o}=e,d=a?g.getKeyboardBinding({callback:()=>o(l.enterFullScreen({previewKey:r,fileViewerId:i,sourceContext:w.UserActionContext.Keyboard})),keyCode:g.Key.F}):[];if(!n)return t.createElement(g.KeyboardBindingConnector,{keyboardBindings:d});const p=g.getFileFlippingBindings({dispatch:o,previewKey:r,fileViewerId:i,requireCommandKey:s});return t.createElement(g.KeyboardBindingConnector,{keyboardBindings:[...p,...d]})});H.displayName="AppKeyboardBindings";class W extends t.PureComponent{constructor(e){super(e),this.renderSidebarPASSFn=e=>{const{config:i,fileMetadata:r}=this.props;if(r){const{fileConfig:t}=r,n=S.renderSidebarPASSFn(i,t);if(n)return n(e)}return[]},this.renderSidebarCallToActionsFn=e=>{const{renderSidebarCallToActionsFn:i,fileMetadata:r}=this.props;if(i)return i(e);if(r){const{fileConfig:i}=r;return P.renderSidebarCallToActionsFn(i)(e)}return[]},this.onRenderSucceeded=e=>{var i;this.props.dispatch(k.logSessionEvent({event:d.SessionEventType.FilePreviewRenderSucceeded,fileViewerId:this.props.id,previewSessionId:e})),(null===(i=this.props.callbacks)||void 0===i?void 0:i.onRenderSucceeded)&&this.props.callbacks.onRenderSucceeded()},this.onRenderFailed=e=>{this.props.dispatch(k.logSessionEvent({event:d.SessionEventType.FilePreviewRenderFailed,fileViewerId:this.props.id,previewSessionId:e}))},this.logTTI=()=>{this.props.dispatch(k.logTTI(this.props.id))},this.logTTV=()=>{this.props.dispatch(k.logTTV(this.props.id))},this.onAppDownload=()=>{this.props.dispatch(k.logSessionEvent({event:d.SessionEventType.FilePreviewGetApp,fileViewerId:this.props.id,previewSessionId:this.props.loggingSession.file_preview_session_id}))},this.state={openInAppInterstitialShown:!1}}componentDidMount(){this.props.dispatch(l.subscribeNetworkState()),this.props.onMount&&this.props.onMount();const e=document.getSelection();e&&e.removeAllRanges()}componentWillUnmount(){this.props.dispatch(l.unsubscribeNetworkState()),this.props.onDestroy&&this.props.onDestroy()}render(){var e,i;const{activePluginInstance:r,config:s,coreFileViewerUiData:l,dispatch:a,fileInfo:d,fileMetadata:g,filePreviewUiData:f,id:b,intl:h,previewMetadata:I,rivieraData:m,registerSidebarPanesFn:S,renderSidebarControlsFn:P,currentMode:B,loggingSession:{file_preview_session_id:x},loggingSession:k,pluginQueryBus:W,shouldShowSidebar:j,shouldShowTitlebar:G,viewport:Q,pluginProps:Z,rightRailPluginInstances:q,pluginNavigation:X,sharedLinkInfo:Y,archiveFiles:J,fullFilePreviewUi:$,fullRivieraData:ee,isFullScreen:ie,account:re,isPreviewZoomed:te,pluginInstances:ne,children:se}=this.props,le=r&&"mode"in r&&r.mode||{type:"default"};let ae=void 0;"edit"===le.type&&(ae=le.titlePrefix);const{file_id:oe,previewKey:de,bootstrap:pe}=d,ce=null!==(e=null==g?void 0:g.file_name)&&void 0!==e?e:"",ue=null!==(i=null==g?void 0:g.file_path)&&void 0!==i?i:"",ve=s.preview_page_revamp,ge=s.mobile_web_fvsdk_variant,fe=s.preview_page_revamp,we=s.preview_content_only,be=R.extractToolbarComponentsFromPlugins(this.props.pluginInstances),he=R.extractSnackbarManagerFromPlugins(this.props.pluginInstances),ye=r&&w.isEditPluginOverlayInstance(r);if(r&&w.isEditPluginFullscreenInstance(r)){if(Z){const e=r.fullscreenLayer;return t.createElement("div",{className:o.editPluginFullscreenContainer},t.createElement(e,Object.assign({},Z)))}return null}const Ie=Object.values(ne).filter(w.isOpenInAppPluginInstance);if(Ie.length>1)throw new Error("More than one Open-in-app plugin is not allowed");const me=Ie?Ie[0]:void 0;if(Z&&me&&!this.state.openInAppInterstitialShown){const e=me.getInterstitial();if(e)return t.createElement(e,Object.assign({},Z,{onHide:()=>this.setState({openInAppInterstitialShown:!0}),onClickAppDownload:this.onAppDownload}))}return t.createElement(t.Fragment,null,se,t.createElement(p.FileViewer,{className:n.default({[o.containerV2]:ve}),intl:h,viewport:Q},({width:e,height:i})=>{var Q,se,Ie,_e;const Se=U(e),Pe=(function(e,i,r=!0,t=!1,n=!1){if(!r||n)return e;const s=t?u.SIDEBAR_OPEN_WIDTH_RIGHT_RAIL:u.SIDEBAR_OPEN_WIDTH,l=t?u.SIDEBAR_CLOSED_WIDTH_RIGHT_RAIL:u.SIDEBAR_CLOSED_WIDTH;return e<=(t?u.RIGHT_RAIL_RESPONSIVE_BREAKPOINT:u.SIDEBAR_RESPONSIVE_BREAKPOINT)?e:e-(i===L.SidebarVisibility.Open?s:l)})(e,ye?L.SidebarVisibility.Open:B.sidebar.visibility,j&&!we,fe,null!==ge),Ee=(function(e,i,r){const t=r?F.TITLE_BAR_V2_HEIGHT:c.TITLE_BAR_HEIGHT;return e-(i?t:0)})(i,G&&!we,ve),Fe=ve?e-F.TITLE_BAR_BACK_AND_HELP_ICONS+32:Pe,Te=(null===(se=null===(Q=this.props.previewMetadata)||void 0===Q?void 0:Q.content)||void 0===se?void 0:se[".tag"])===w.PreviewType.Archive?{canExtract:!0,rootInfo:this.props.rootInfo,filePreviewUiData:f}:{canExtract:!1};let Ae;Ae=f.currentPath&&f.currentPath.length>0?t.createElement(T.ArchiveFileBreadcrumbs,{archiveName:ce,currentPath:f.currentPath,fileViewerId:b,previewKey:de,dispatch:a,isMobile:Se===V.ResponsiveSize.MOBILE}):t.createElement(c.TruncatedTitle,{width:Fe,fileName:ce,filePath:ue});const Re={downloadConfig:null==g?void 0:g.fileConfig.download_button,extractConfig:Te,fileId:oe,dispatch:a,intl:h,fileViewerId:b,previewKey:de},Ce=G&&!we&&(ve?t.createElement(F.TitleBarV2,{previewKey:de,dispatch:a,title:Ae,mobileWebVariant:ge,baseUrl:s.titlebar_logo_config.base_url,canCloseViewer:this.props.pluginNavigation.canCloseViewer,intl:h,fileViewerId:b,config:null==g?void 0:g.fileConfig,actions:R.extractActionsFromPlugins(this.props.pluginInstances,this.props.enabledEditPluginFullscreenActionDefinitions),responsiveSize:Se,width:e,components:R.extractTitlebarComponentsFromPlugins(this.props.pluginInstances)}):t.createElement(c.Titlebar,{downloadButtonProps:Re,icon:s.titlebar_logo_config.show_logo?t.createElement(c.TitleBarLogo,{baseUrl:s.titlebar_logo_config.base_url,dispatch:a,previewKey:de,fileViewerId:b}):null,title:Ae,isInverse:E.isPluginEditMode(le),prefix:ae})),Me=(()=>{const e={fileViewerId:b,width:Pe,height:Ee,onRenderSucceeded:()=>this.onRenderSucceeded(x),onRenderFailed:()=>this.onRenderFailed(x),intl:h,dispatch:a,onInteractive:this.logTTI,onViewable:this.logTTV,config:s,currentMode:B,filePreviewUiData:f,fileMetadata:g,fileInfo:d,previewMetadata:I,data:void 0,coreFileViewerUiData:l,activePluginInstance:r,pluginProps:Z,pluginQueryBus:W,extractConfig:Te,sharedLinkInfo:Y,previewKey:de,archiveFiles:J,fullFilePreviewUi:$,fullRivieraData:ee,loggingSession:k,account:re,fileConfig:null==g?void 0:g.fileConfig,toolbarPlugins:be,snackbarManagerPluginInstance:he,responsiveSize:Se,openInAppPluginInstance:me},i=z.resolvePreviewType(I),c=we&&(i===w.PreviewType.Audio||i===w.PreviewType.Video);switch(pe.state){case"initializing":return t.createElement("div",{className:n.default(o.loadingSpinnerWrapper,{[N.isFullScreen]:ie})},t.createElement(y.Spinner,{"aria-valuetext":h.formatMessage({id:"zqXonC",defaultMessage:"Your preview is loading"}),"aria-label":"preview-loading-spinner",inverse:ie||E.isPluginEditMode(le)}),s.preview_page_revamp&&!c&&t.createElement(D.ConfigurableToolbarV2,{featureConfig:s,previewKey:de,previewType:w.PreviewType.Loading,intl:h,filePreviewUi:f,fileMetadata:g,fileViewerUi:l,fileViewerId:b,plugins:be,snackbarManagerPluginInstance:he,previewWidth:Pe,responsiveSize:Se}));case"ready":return t.createElement(p.PreviewRenderer,Object.assign({rivieraData:m},e));case"errored":return t.createElement(_.PreviewError,Object.assign({error:pe.error},e))}})();let De;we||ie||ge||(fe&&!ge?De=r&&w.isEditPluginOverlayInstance(r)?t.createElement(K.EditPluginSidebar,{fileViewerId:b,pluginNavigation:X,pluginQueryBus:W,plugin:r}):t.createElement(A.PreviewRightRail,{previewKey:de,fileName:ce,fileViewerId:b,intl:h,pluginInstances:q,pluginNavigation:X,pluginQueryBus:W,height:ve?Ee:void 0}):j&&S&&P&&(De=t.createElement(v.Sidebar,{registerSidebarPanesFn:S,renderSidebarControlsFn:P,renderSidebarPASSFn:this.renderSidebarPASSFn,renderSidebarCallToActionsFn:this.renderSidebarCallToActionsFn,dispatch:a,fileId:oe,previewKey:de,fileViewerUiData:{currentMode:B.mode,sidebar:B.sidebar},pluginMode:le,fileViewerId:b,intl:h,extractConfig:Te})));const Ve=t.createElement(H,{id:b,previewKey:de,enableFullscreen:s.enable_fullscreen,isFileFlippingEnabled:null!=g&&!!g.file_collection_context&&!ye,isPreviewZoomed:te,dispatch:a});return ve?t.createElement(t.Fragment,null,Ce,t.createElement("div",{className:o.contentContainer},t.createElement("div",{className:n.default(o.contentWrapper,{[o.editMode]:E.isPluginEditMode(le)}),style:{width:Pe}},t.createElement(O.ErrorBoundary,Object.assign({},this.props,{activePluginInstance:r,previewKey:this.props.fileInfo.previewKey,key:de.serialized,fileViewerId:this.props.id,rivieraData:void 0,data:void 0,onRenderSucceeded:()=>this.onRenderSucceeded(x),fileConfig:null===(Ie=this.props.fileMetadata)||void 0===Ie?void 0:Ie.fileConfig,onRenderFailed:()=>this.onRenderFailed(x),width:Pe,height:Ee,onInteractive:this.logTTI}),Me)),De,Ve),ge&&t.createElement(C.Footer,{showAuthModal:this.props.pluginNavigation.showAuthModal,mobilePluginActions:ne.mobile_plugin,variant:ge}),ge&&t.createElement(M.MeatballMenu,{previewKey:de,mobilePluginActions:ne.mobile_plugin,fileViewerId:b,sharedLinkInfo:Y,size:null==g?void 0:g.size,showAuthModal:this.props.pluginNavigation.showAuthModal})):t.createElement(t.Fragment,null,t.createElement("div",{className:n.default(o.contentWrapper,{[o.editMode]:E.isPluginEditMode(le)}),style:{width:Fe}},Ce,t.createElement(O.ErrorBoundary,Object.assign({},this.props,{activePluginInstance:r,previewKey:this.props.fileInfo.previewKey,key:de.serialized,fileViewerId:this.props.id,rivieraData:void 0,data:void 0,onRenderSucceeded:()=>this.onRenderSucceeded(x),fileConfig:null===(_e=this.props.fileMetadata)||void 0===_e?void 0:_e.fileConfig,onRenderFailed:()=>this.onRenderFailed(x),width:Pe,height:Ee,onInteractive:this.logTTI}),Me)),De,Ve)}))}}i.App=W,W.displayName="App";const j=s.connect((function(e,i){const{config:r,id:t,pluginNavigation:n,pluginQueryBus:s,registerSidebarPanesFn:l,renderSidebarControlsFn:o}=i,d=a.getCurrentFile(e,t),p=d.previewKey,c=e.previewData[p.serialized],u=b.getActivePluginId(e,{fileViewerId:t});let v;if(null==u)v=null;else{const e=i.pluginInstances[u];v=e&&(w.parseEditPluginOverlayInstance(e)||w.parseEditPluginFullscreenInstance(e)||w.parseRightRailPluginInstance(e))}const g=I.makePluginProps(e,t,m.getPluginData(e,{fileViewerId:t,navigation:n}),s),f=b.getRuntimeDisabledPlugins(e,{fileViewerId:t}),h=a.getIsFullScreen(e,t),y=!h&&void 0!==l&&void 0!==o,_=!h&&r.show_titlebar&&!w.isEditPluginOverlayInstance(v),S=x.getEditPluginFullscreenActionDefinitions(i.pluginInstances,f,p,t);return{account:a.getLoadableCurrentUser(e),activePluginInstance:v,coreFileViewerUiData:e.fileViewerUi[t]||{},currentMode:e.modes[t],fileInfo:d,fileMetadata:e.fileMetadata[p.serialized],filePreviewUiData:(e.filePreviewUi[t]||{})[p.serialized]||{},isPreviewZoomed:a.isPreviewZoomed(e,{fileViewerId:t}),loggingSession:e.loggingSession[t],pluginProps:g,previewMetadata:c,rivieraData:e.rivieraData[p.serialized],sharedLinkInfo:e.sharedLinkInfo[p.serialized],shouldShowSidebar:y,shouldShowTitlebar:_,unstable_runtimeDisabledPluginsUsedOnlyToTriggerUpdate:f,rootInfo:e.rootInfo,archiveFiles:e.archiveFiles,fullFilePreviewUi:e.filePreviewUi[t]||{},fullRivieraData:e.rivieraData||{},isFullScreen:h,enabledEditPluginFullscreenActionDefinitions:S}}),(function(e){return{dispatch:e}}))(W);class G extends t.PureComponent{render(){const e=this.props,{store:i,intl:n,osModifierKey:l}=e,a=r.__rest(e,["store","intl","osModifierKey"]),{config:o}=a;return t.createElement(s.Provider,{store:i},t.createElement(f.RawIntlProvider,{value:n},t.createElement(g.KeyboardBindingProvider,{disableBindings:!o.keyboard_shortcuts||o.preview_content_only,osModifierKey:l},t.createElement(h.LayerContext.Provider,{value:501},t.createElement(j,Object.assign({intl:n},a))))))}}i.AppWithProvider=G,G.displayName="AppWithProvider"}));
//# sourceMappingURL=app.amd.min.js-vflehcZcS.map